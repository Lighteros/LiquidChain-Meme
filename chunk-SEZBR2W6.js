import{a as ne}from"./chunk-CHO3IBPB.js";import{b as A,c as x,d as y,g as M}from"./chunk-YVK6EA54.js";import{d as te,e as Pe,f as Ue,g as Re,h as R}from"./chunk-MGL7NSAW.js";import"./chunk-CT4HELHY.js";import"./chunk-LI53BOMV.js";import"./chunk-TSLWMKS5.js";import"./chunk-IV5FR2YO.js";import{a as he,b as V,c as z,d as le,e as B,g as Ce,h as v,j as ue,k as G,l as me,m as ge,o as Q,p as Y,q as pe,r as we,s as fe,t as Ie,u as Ne,v as Ee,w as ve,y as Ae}from"./chunk-G5N4ZAKI.js";import"./chunk-2CDTKQ3E.js";import"./chunk-UHR73J24.js";import"./chunk-VAHX4GR7.js";import"./chunk-I2YJHZ2B.js";import{D as ke,F as ee,G as D,Q as I,a as ye,d as be,h as T,i as S,s as k,x as Te}from"./chunk-XLSZADC6.js";import"./chunk-YSWAE63R.js";import{b as l,c as L,j as Z,k as q}from"./chunk-CDMUM2L7.js";import"./chunk-QSWUHUZZ.js";import{pa as de}from"./chunk-AX3MU5C4.js";import"./chunk-ZRBE6OMV.js";import"./chunk-Z3SE2D4B.js";import"./chunk-5LQ6A2AX.js";import{Z as X,ac as U,fc as W,ha as ae,ia as j,lb as ce}from"./chunk-5G3DVQVW.js";import"./chunk-HINDXNTT.js";import"./chunk-X3F4NDXO.js";import"./chunk-JKZLGYQN.js";import"./chunk-EEU3LH2V.js";import"./chunk-TRLFM7P4.js";import"./chunk-QMRWXCSQ.js";import{a as N,b as P,f as F,m as re,n as c}from"./chunk-VNDKUXGB.js";function ie(w){let e=[],t,n;function i(a){let C=I.getCaipNetworks(l.CHAIN.EVM),r=Number(L.parseEvmChainId(a));if(!C.some(g=>String(g.id)===String(a))){let g=I.getActiveCaipNetwork(l.CHAIN.EVM)?.id||C[0]?.id;g&&Number.isInteger(Number(g))&&(r=Number(g))}if(!r)throw new Error("ChainId not found in networks");return r}function o(){return t||(t=ne.getInstance({projectId:w.options.projectId,chainId:D()?.caipNetworkId,enableLogger:w.options.enableAuthLogger,onTimeout:a=>{a==="iframe_load_failed"?R.open(y.ALERT_ERRORS.IFRAME_LOAD_FAILED,"error"):a==="iframe_request_timeout"?R.open(y.ALERT_ERRORS.IFRAME_REQUEST_TIMEOUT,"error"):a==="unverified_domain"&&R.open(y.ALERT_ERRORS.UNVERIFIED_DOMAIN,"error")},abortController:y.EmbeddedWalletAbortController,getActiveCaipNetwork:a=>D(a),getCaipNetworks:a=>I.getCaipNetworks(a)})),t}function m(){return c(this,arguments,function*(a={}){let C=o(),r=a.chainId;if(a.isReconnecting){let u=L.parseEvmChainId(C.getLastUsedChainId()||""),f=w.chains?.[0].id;if(r=u||f,!r)throw new Error("ChainId not found in provider")}let g=ee("eip155"),{address:s,chainId:d,accounts:p}=yield Ue.authConnectorAuthenticate({authConnector:C,chainId:r,preferredAccountType:g,socialUri:a.socialUri,chainNamespace:l.CHAIN.EVM});e=p?.map(u=>u.address)||[s];let h=i(d);return{accounts:e,account:s,chainId:h,chain:{id:h,unsupported:!1}}})}return a=>({id:l.CONNECTOR_ID.AUTH,name:l.CONNECTOR_NAMES.AUTH,type:"AUTH",chain:l.CHAIN.EVM,connect(){return c(this,arguments,function*(r={}){if(n){let s=yield n;return{accounts:r.withCapabilities?s.accounts.map(d=>({address:d,capabilities:{}})):s.accounts,chainId:s.chainId}}n||(n=new Promise(s=>{s(m(r))}));let g=yield n;return n=void 0,{accounts:r.withCapabilities?g.accounts.map(s=>({address:s,capabilities:{}})):g.accounts,chainId:g.chainId}})},disconnect(){return c(this,null,function*(){yield(yield this.getProvider()).disconnect()})},getAccounts(){return e?.length?(a.emitter.emit("change",{accounts:e}),Promise.resolve(e)):Promise.resolve([])},getProvider(){return c(this,null,function*(){return this.provider||(this.provider=ne.getInstance({projectId:w.options.projectId,chainId:D()?.caipNetworkId,enableLogger:w.options.enableAuthLogger,abortController:y.EmbeddedWalletAbortController,onTimeout:r=>{r==="iframe_load_failed"?R.open(y.ALERT_ERRORS.IFRAME_LOAD_FAILED,"error"):r==="iframe_request_timeout"?R.open(y.ALERT_ERRORS.IFRAME_REQUEST_TIMEOUT,"error"):r==="unverified_domain"&&R.open(y.ALERT_ERRORS.UNVERIFIED_DOMAIN,"error")},getActiveCaipNetwork:r=>D(r),getCaipNetworks:r=>I.getCaipNetworks(r)})),Promise.resolve(this.provider)})},getChainId(){return c(this,null,function*(){let r=yield this.getProvider(),{chainId:g}=yield r.getChainId();return i(g)})},isAuthorized(){return c(this,null,function*(){let g=I.state.activeChain===l.CHAIN.EVM;if(l.AUTH_CONNECTOR_SUPPORTED_CHAINS.some(p=>ke.getConnectorId(p)===l.CONNECTOR_ID.AUTH)&&!g)return!1;let d=yield this.getProvider();return Promise.resolve(d.getLoginEmailUsed())})},switchChain(g){return c(this,arguments,function*({chainId:r}){try{let s=a.chains.find(u=>u.id===r);if(!s)throw new W(new Error("chain not found on connector."));let d=yield this.getProvider(),p=ee("eip155"),h=yield d.connect({chainId:r,preferredAccountType:p});return e=h?.accounts?.map(u=>u.address)||[h.address],a.emitter.emit("change",{chainId:Number(r),accounts:e}),s}catch(s){throw s instanceof Error?new W(s):s}})},onAccountsChanged(r){r.length===0?this.onDisconnect():a.emitter.emit("change",{accounts:r.map(j)})},onChainChanged(r){let g=Number(r);a.emitter.emit("change",{chainId:g})},onDisconnect(r){return c(this,null,function*(){yield(yield this.getProvider()).disconnect()})}})}K.type="walletConnect";function K(w){let e=w.isNewChainsStale??!0,t,n,i,o,m,a,C;return r=>({id:"walletConnect",name:"WalletConnect",type:K.type,provider:w.universalProvider,setup(){return c(this,null,function*(){let s=yield this.getProvider().catch(()=>null);s&&(o||(o=this.onConnect.bind(this),s.on("connect",o)),a||(a=this.onSessionDelete.bind(this),s.on("session_delete",a)))})},connect(){return c(this,arguments,function*(d={}){var s=F(d,[]);try{let p=I.getCaipNetworks(),h=yield this.getProvider();if(!h)throw new Q;m||(m=this.onDisplayUri,h.on("display_uri",m));let u=yield this.isChainsStale();h.session&&u&&(yield h.disconnect());let f=k.state.universalProviderConfigOverride;if(!h.session||u){let J=te.createNamespaces(p,f);yield h.connect(N({optionalNamespaces:J},"pairingTopic"in s?{pairingTopic:s.pairingTopic}:{})),this.setRequestedChainsIds(p.map(We=>Number(We.id)))}let E=yield this.getAccounts(),b=yield this.getChainId(),O=h.session?.namespaces?.eip155?.chains,$=O?.some(J=>Number(J.split(":")[1])===b),_=1;$?_=b:O?.[0]&&(_=Number(O[0].split(":")[1])),m&&(h.removeListener("display_uri",m),m=void 0),o&&(h.removeListener("connect",o),o=void 0),n||(n=this.onAccountsChanged.bind(this),h.on("accountsChanged",n)),i||(i=this.onChainChanged.bind(this),h.on("chainChanged",i)),C||(C=this.onDisconnect.bind(this),h.on("disconnect",C)),a||(a=this.onSessionDelete.bind(this),h.on("session_delete",a));let Oe=f?.defaultChain;return h.setDefaultChain(Oe??`eip155:${_}`),{accounts:E,chainId:_}}catch(p){throw/(user rejected|connection request reset)/i.test(p?.message)?new U(p):p}})},disconnect(){return c(this,null,function*(){let s=yield this.getProvider();try{yield s?.disconnect()}catch(d){if(!/No matching key/i.test(d.message))throw d}finally{i&&(s?.removeListener("chainChanged",i),i=void 0),C&&(s?.removeListener("disconnect",C),C=void 0),o||(o=this.onConnect.bind(this),s?.on("connect",o)),n&&(s?.removeListener("accountsChanged",n),n=void 0),a&&(s?.removeListener("session_delete",a),a=void 0),this.setRequestedChainsIds([])}})},getAccounts(){return c(this,null,function*(){let s=yield this.getProvider();if(!s?.session?.namespaces)return[];let p=s?.session?.namespaces[l.CHAIN.EVM]?.accounts?.map(f=>f.split(":")[2])??[],h=new Set;return p.filter(f=>{let E=f?.toLowerCase();return h.has(E)?!1:(h.add(E),!0)})})},getProvider(){return c(this,arguments,function*({chainId:s}={}){t||(t=w.universalProvider,t?.events.setMaxListeners(Number.POSITIVE_INFINITY));let d=T.getActiveNamespace(),p=I.getActiveCaipNetwork()?.id;if(s&&p!==s&&d){let h=T.getStoredActiveCaipNetworkId(),f=(d?I.getCaipNetworks(d):[])?.find(E=>E.id===h);f&&f.chainNamespace===l.CHAIN.EVM&&(yield this.switchChain?.({chainId:Number(f.id)}))}return t})},getChainId(){return c(this,null,function*(){let s=I.getActiveCaipNetwork(l.CHAIN.EVM)?.id;if(s)return s;let p=(yield this.getProvider()).session?.namespaces[l.CHAIN.EVM]?.chains?.[0];return I.getCaipNetworks().find(u=>u.id===p)?.id})},isAuthorized(){return c(this,null,function*(){try{let[s,d]=yield Promise.all([this.getAccounts(),this.getProvider()]);return s.length?(yield this.isChainsStale())&&d.session?(yield d.disconnect().catch(()=>{}),!1):!0:!1}catch{return!1}})},switchChain(p){return c(this,arguments,function*({addEthereumChainParameter:s,chainId:d}){let h=yield this.getProvider();if(!h)throw new Q;let u=I.getCaipNetworks().find(f=>f.id===d);if(!u)throw new W(new he);try{yield h.request({method:"wallet_switchEthereumChain",params:[{chainId:X(d)}]}),u?.caipNetworkId&&h.setDefaultChain(u?.caipNetworkId),r.emitter.emit("change",{chainId:Number(d)});let f=yield this.getRequestedChainsIds();return this.setRequestedChainsIds([...f,d]),P(N({},u),{id:u.id})}catch(f){let E=f;if(/(?:user rejected)/iu.test(E.message))throw new U(E);try{let b;s?.blockExplorerUrls?b=s.blockExplorerUrls:b=u.blockExplorers?.default.url?[u.blockExplorers?.default.url]:[];let O=u.rpcUrls?.chainDefault?.http||[],$={blockExplorerUrls:b,chainId:X(d),chainName:u.name,iconUrls:s?.iconUrls,nativeCurrency:u.nativeCurrency,rpcUrls:O};yield h.request({method:"wallet_addEthereumChain",params:[$]});let _=yield this.getRequestedChainsIds();return this.setRequestedChainsIds([..._,d]),P(N({},u),{id:u.id})}catch(b){throw new U(b)}}})},onAccountsChanged(s){s.length===0?this.onDisconnect():r.emitter.emit("change",{accounts:s.map(d=>j(d))})},onChainChanged(s){let d=Number(s);r.emitter.emit("change",{chainId:d})},onConnect(s){this.setRequestedChainsIds(I.getCaipNetworks().map(d=>Number(d.id)))},onDisconnect(s){return c(this,null,function*(){this.setRequestedChainsIds([]),r.emitter.emit("disconnect");let d=yield this.getProvider();n&&(d.removeListener("accountsChanged",n),n=void 0),i&&(d.removeListener("chainChanged",i),i=void 0),C&&(d.removeListener("disconnect",C),C=void 0),a&&(d.removeListener("session_delete",a),a=void 0),o||(o=this.onConnect.bind(this),d.on("connect",o))})},onDisplayUri(s){r.emitter.emit("message",{type:"display_uri",data:s})},onSessionDelete(){this.onDisconnect()},getNamespaceChainsIds(){return t?.session?.namespaces?t?.session?.namespaces[l.CHAIN.EVM]?.accounts?.map(p=>Number.parseInt(p.split(":")[1]??""))??[]:[]},getRequestedChainsIds(){return c(this,null,function*(){let s=(yield r.storage?.getItem(this.requestedChainsStorageKey))??[];return[...new Set(s)]})},isChainsStale(){return c(this,null,function*(){if(!e)return!1;let s=r.chains.map(h=>h.id),d=this.getNamespaceChainsIds();if(d.length&&!d.some(h=>s.includes(h)))return!1;let p=yield this.getRequestedChainsIds();return!s.every(h=>p.includes(Number(h)))})},setRequestedChainsIds(s){return c(this,null,function*(){yield r.storage?.setItem(this.requestedChainsStorageKey,s)})},get requestedChainsStorageKey(){return`${this.id}.requestedChains`}})}var H=ye({pendingTransactions:0}),oe={state:H,subscribeKey(w,e){return be(H,w,e)},increase(w){H[w]+=1},decrease(w){H[w]-=1},reset(w){H[w]=0}};function _e(w){return c(this,null,function*(){if(S.isSafeApp()){let{safe:e}=yield import("./chunk-GA5Q5WJD.js");if(e&&!w.some(t=>t.type==="safe"))return e()}return null})}function Se(w){return c(this,null,function*(){try{let{baseAccount:e}=yield import("./chunk-GA5Q5WJD.js");if(e&&!w.some(t=>t.id==="baseAccount"))return e()}catch(e){console.error("Failed to import Coinbase Wallet SDK:",e)}return null})}var Le={enable:!1,pollingInterval:3e4},se=class w extends Pe{constructor(e){let t=M.extendCaipNetworks(e.networks,{projectId:e.projectId,customNetworkImageUrls:{},customRpcUrls:e.customRpcUrls});super(),this.balancePromises={},this.namespace=l.CHAIN.EVM,this.adapterType=l.ADAPTER_TYPES.WAGMI,this.projectId=e.projectId,this.pendingTransactionsFilter=N(N({},Le),e.pendingTransactionsFilter??{}),this.createConfig(P(N({},e),{networks:t})),this.checkChainId()}construct(e){this.checkChainId(),this.setupWatchers()}getAccounts(e){return c(this,null,function*(){let t=this.getWagmiConnector(e.id);if(!t)return{accounts:[]};if(t.id===l.CONNECTOR_ID.AUTH){let o=yield t.getProvider();if(!o?.user)return{accounts:[]};let{address:m,accounts:a}=o.user;return Promise.resolve({accounts:(a||[{address:m,type:"eoa"}]).map(C=>S.createAccount("eip155",C.address,C.type))})}let{addresses:n,address:i}=B(this.wagmiConfig);return Promise.resolve({accounts:[...new Set(n||[i])].map(o=>S.createAccount("eip155",o||"","eoa"))})})}checkChainId(){let{chainId:e}=B(this.wagmiConfig);e&&this.emit("switchNetwork",{chainId:e})}getWagmiConnector(e){return this.wagmiConfig.connectors.find(t=>t.id===e)}createConfig(e){this.wagmiChains=e.networks.filter(i=>i.chainNamespace===l.CHAIN.EVM);let t={},n=[...e.connectors??[]];this.wagmiChains.forEach(i=>{let o=e.transports?.[i.id],m=M.getCaipNetworkId(i);o?t[i.id]=M.extendWagmiTransports(i,e.projectId,o):t[i.id]=M.getViemTransport(i,e.projectId,e.customRpcUrls?.[m])}),this.wagmiConfig=Ae(P(N({},e),{chains:this.wagmiChains,connectors:n,transports:t}))}setupWatchPendingTransactions(){if(!this.pendingTransactionsFilter.enable||this.unwatchPendingTransactions)return;this.unwatchPendingTransactions=Ne(this.wagmiConfig,{pollingInterval:this.pendingTransactionsFilter.pollingInterval,onError:()=>{},onTransactions:()=>{this.emit("pendingTransactions"),oe.increase("pendingTransactions")}});let e=oe.subscribeKey("pendingTransactions",t=>{t>=l.LIMITS.PENDING_TRANSACTIONS&&(this.unwatchPendingTransactions?.(),e())})}setupWatchers(){fe(this.wagmiConfig,{onChange:e=>{this.clearConnections(),this.addConnection(...e.map(t=>{let n=this.getCaipNetworks().find(o=>o.id===t.chainId),i=t.connector.id===l.CONNECTOR_ID.AUTH;return{accounts:t.accounts.map(o=>({address:this.toChecksummedAddress(o)})),caipNetwork:n,connectorId:t.connector.id,auth:i?{name:T.getConnectedSocialProvider(),username:T.getConnectedSocialUsername()}:void 0}}))}}),we(this.wagmiConfig,{onChange:(e,t)=>{if(e.status==="disconnected"&&t.address&&this.emit("disconnect"),e?.chainId&&e?.chainId!==t?.chainId&&this.emit("switchNetwork",{chainId:e.chainId}),e.status==="connected"){let n=e.address!==t?.address,i=e.connector.id!==t.connector?.id,o=t.status!=="connected";(n||i||o)&&(this.setupWatchPendingTransactions(),this.handleAccountChanged({address:e.address,chainId:e.chainId,connector:e.connector}))}}})}addThirdPartyConnectors(){return c(this,null,function*(){let e=[],{enableCoinbase:t}=k.state||{};if(t!==!1){let i=yield Se(this.wagmiConfig.connectors);i&&e.push(i)}let n=yield _e(this.wagmiConfig.connectors);n&&e.push(n),yield Promise.all(e.map(i=>{let o=this.configureInternalConnector(i);return this.addWagmiConnector(o)}))})}addWagmiConnectors(){let e=[];k.state.enableInjected!==!1&&e.push(ve({shimDisconnect:!0}));let{features:t,remoteFeatures:n,projectId:i,enableAuthLogger:o}=k.state,m=n?.email??t?.email??!0,a=n?.socials??t?.socials,C=Array.isArray(a)&&a?.length>0;(m||C)&&e.push(ie({chains:this.wagmiChains,options:{projectId:i,enableAuthLogger:o}})),e.forEach(r=>{this.configureInternalConnector(r)})}configureInternalConnector(e){let t=this.wagmiConfig._internal.connectors.setup(e);return this.wagmiConfig._internal.connectors.setState(n=>[...n,t]),t}handleAccountChanged(i){return c(this,arguments,function*({address:e,chainId:t,connector:n}){if(!this.namespace)throw new Error("WagmiAdapter:handleAccountChanged - namespace is required");let o=yield n.getProvider().catch(()=>{});this.emit("accountChanged",{address:this.toChecksummedAddress(e),chainId:t,connector:{id:n.id,name:A.ConnectorNamesMap[n.id]??n.name,imageId:A.ConnectorImageIds[n.id],type:A.ConnectorTypesMap[n.type]??"EXTERNAL",info:n.id===l.CONNECTOR_ID.INJECTED?void 0:{rdns:n.id},provider:o,chain:this.namespace,chains:[]}})})}signMessage(e){return c(this,null,function*(){try{return{signature:yield ge(this.wagmiConfig,{message:e.message,account:e.address})}}catch{throw new Error("WagmiAdapter:signMessage - Sign message failed")}})}sendTransaction(e){return c(this,null,function*(){let{chainId:t,address:n}=B(this.wagmiConfig),i=this.wagmiChains?.find(a=>a.id===t),o={account:n,to:e.to,value:Number.isNaN(Number(e.value))?BigInt(0):BigInt(e.value),gas:e.gas?BigInt(e.gas):void 0,gasPrice:e.gasPrice?BigInt(e.gasPrice):void 0,data:e.data,chain:i,type:"legacy",parameters:["nonce"]};yield ue(this.wagmiConfig,o);let m=yield me(this.wagmiConfig,o);return yield pe(this.wagmiConfig,{hash:m,timeout:25e3}),{hash:m}})}writeContract(e){return c(this,null,function*(){let a=e,{caipNetwork:t}=a,n=F(a,["caipNetwork"]),i=Number(L.caipNetworkIdToNumber(t.caipNetworkId)),o=this.wagmiChains?.find(C=>C.id===i);return{hash:yield Ee(this.wagmiConfig,{chain:o,address:n.tokenAddress,account:n.fromAddress,abi:n.abi,functionName:n.method,args:n.args,__mode:"prepared"})}})}estimateGas(e){return c(this,null,function*(){try{return{gas:yield le(this.wagmiConfig,{account:e.address,to:e.to,data:e.data,type:"legacy"})}}catch{throw new Error("WagmiAdapter:estimateGas - error estimating gas")}})}parseUnits(e){return de(e.value,e.decimals)}formatUnits(e){return ce(e.value,e.decimals)}addWagmiConnector(e){return c(this,null,function*(){if(!this.namespace)throw new Error("WagmiAdapter:addWagmiConnector - namespace is required");let{enableEIP6963:t}=k.state||{};if(e.type===l.CONNECTOR_ID.INJECTED&&t===!1||e.id===l.CONNECTOR_ID.AUTH||e.id===l.CONNECTOR_ID.WALLET_CONNECT)return;let n;e.id!==l.CONNECTOR_ID.BASE_ACCOUNT&&(n=yield e.getProvider().catch(()=>{}));let i=Te.state.connectorImages;this.addConnector({id:e.id,explorerId:A.ConnectorExplorerIds[e.id],imageUrl:i?.[e.id]??e.icon,name:A.ConnectorNamesMap[e.id]??e.name,imageId:A.ConnectorImageIds[e.id],type:A.ConnectorTypesMap[e.type]??"EXTERNAL",info:e.id===l.CONNECTOR_ID.INJECTED?void 0:{rdns:e.id},provider:n,chain:this.namespace,chains:[]})})}syncConnectors(){return c(this,null,function*(){Ie(this.wagmiConfig,{onChange:e=>{e.forEach(t=>this.addWagmiConnector(t))}}),this.addWagmiConnectors(),yield Promise.all(this.wagmiConfig.connectors.map(e=>this.addWagmiConnector(e))),yield this.addThirdPartyConnectors()})}syncConnections(){return c(this,null,function*(){let e=this.connectors.filter(t=>{let{hasDisconnected:n,hasConnected:i}=x.getConnectorStorageInfo(t.id,this.namespace);return!n&&i}).map(t=>this.getWagmiConnector(t.id)).filter(Boolean);yield G(this.wagmiConfig,{connectors:e})})}syncConnection(e){return c(this,null,function*(){let{id:t,chainId:n}=e,o=v(this.wagmiConfig).find(r=>r.connector.id===t),a=yield this.getWagmiConnector(t)?.getProvider();if(S.isSafeApp()&&t===l.CONNECTOR_ID.SAFE&&!o?.accounts.length){let r=this.getWagmiConnector("safe");if(r){let g=yield V(this.wagmiConfig,{connector:r,chainId:Number(n)}),s=yield r.getProvider();return{chainId:Number(n),address:this.toChecksummedAddress(g.accounts[0]),provider:s,type:o?.connector.type?.toUpperCase(),id:o?.connector.id}}}return{chainId:Number(o?.chainId),address:this.toChecksummedAddress(o?.accounts[0]),provider:a,type:o?.connector.type?.toUpperCase(),id:o?.connector.id}})}connectWalletConnect(e){return c(this,null,function*(){try{let t=this.getWalletConnectConnector();yield t.authenticate();let n=this.getWagmiConnector("walletConnect");if(!n)throw new Error("UniversalAdapter:connectWalletConnect - connector not found");let i=yield V(this.wagmiConfig,{connector:n,chainId:e?Number(e):void 0});return i.chainId!==Number(e)&&(yield Y(this.wagmiConfig,{chainId:i.chainId})),{clientId:yield t.provider.client.core.crypto.getClientId()}}catch(t){throw t instanceof U?new q(t):Z.isUserRejectedRequestError(t)?new q(t):t}})}connect(e){return c(this,null,function*(){try{let{id:t,address:n,provider:i,type:o,info:m,chainId:a,socialUri:C}=e,r=this.getWagmiConnector(t);if(!r)throw new Error("connectionControllerClient:connectExternal - connector is undefined");i&&m&&r.id===l.CONNECTOR_ID.EIP6963&&r.setEip6963Wallet?.({provider:i,info:m});let g=this.wagmiConfig.state?.connections?.get(r.uid);if(g){yield this.wagmiConfig.storage?.setItem("recentConnectorId",r.id);let p=[...g.accounts].sort((h,u)=>x.isLowerCaseMatch(h,n)?-1:x.isLowerCaseMatch(u,n)?1:0);return this.wagmiConfig?.setState(h=>P(N({},h),{connections:new Map(h.connections).set(r.uid,{accounts:p,chainId:g.chainId,connector:g.connector}),current:r.uid,status:"connected"})),{address:this.toChecksummedAddress(p[0]),chainId:g.chainId,provider:i,type:o,id:t}}let s=yield V(this.wagmiConfig,{connector:r,chainId:a?Number(a):void 0,socialUri:C}),d=i??(yield r.getProvider());return{address:this.toChecksummedAddress(s.accounts[0]),chainId:s.chainId,provider:d,type:o,id:t}}catch(t){throw t instanceof U?new q(t):Z.isUserRejectedRequestError(t)?new q(t):t}})}get connections(){return Array.from(this.wagmiConfig.state.connections.values()).map(e=>({accounts:e.accounts.map(t=>({address:this.toChecksummedAddress(t)})),connectorId:e.connector.id}))}reconnect(e){return c(this,null,function*(){let{id:t}=e,n=this.getWagmiConnector(t);if(!n)throw new Error("connectionControllerClient:connectExternal - connector is undefined");yield G(this.wagmiConfig,{connectors:[n]})})}getBalance(e){return c(this,null,function*(){let t=e.address,n=this.getCaipNetworks().find(i=>i.id===e.chainId);if(!t)return Promise.resolve({balance:"0.00",symbol:"ETH"});if(n&&this.wagmiConfig){let i=`${n.caipNetworkId}:${e.address}`,o=this.balancePromises[i];if(o)return o;let m=T.getNativeBalanceCacheForCaipAddress(i);return m?{balance:m.balance,symbol:m.symbol}:(this.balancePromises[i]=new Promise(a=>c(this,null,function*(){try{let C=Number(e.chainId),r=yield Ce(this.wagmiConfig,{address:e.address,chainId:C,token:e.tokens?.[n.caipNetworkId]?.address});T.updateNativeBalanceCache({caipAddress:i,balance:r.formatted,symbol:r.symbol,timestamp:Date.now()}),a({balance:r.formatted,symbol:r.symbol})}catch(C){console.warn("Appkit:WagmiAdapter:getBalance - Error getting balance",C),a({balance:"0.00",symbol:"ETH"})}})).finally(()=>{delete this.balancePromises[i]}),this.balancePromises[i]||{balance:"0.00",symbol:"ETH"})}return{balance:"",symbol:""}})}getWalletConnectProvider(){return this.getWagmiConnector("walletConnect")?.provider}disconnect(e){return c(this,null,function*(){if(e.id){let t=this.getWagmiConnector(e.id),i=v(this.wagmiConfig).find(o=>x.isLowerCaseMatch(o.connector.id,e.id));return yield z(this.wagmiConfig,{connector:t}),k.state.enableReconnect===!1&&this.deleteConnection(e.id),i?{connections:[{accounts:i.accounts.map(o=>({address:this.toChecksummedAddress(o)})),connectorId:i.connector.id}]}:{connections:[]}}return this.disconnectAll()})}disconnectAll(){return c(this,null,function*(){let e=v(this.wagmiConfig),t=yield Promise.allSettled(e.map(n=>c(this,null,function*(){let i=this.getWagmiConnector(n.connector.id);return i&&(yield z(this.wagmiConfig,{connector:i})),n})));return this.wagmiConfig.state.connections.clear(),{connections:t.filter(n=>n.status==="fulfilled").map(({value:n})=>({accounts:n.accounts.map(i=>({address:this.toChecksummedAddress(i)})),connectorId:n.connector.id}))}})}switchNetwork(e){return c(this,null,function*(){let{caipNetwork:t}=e,n=this.wagmiConfig.chains.find(p=>p.id.toString()===t.id.toString());if(!n)throw new Error("connectionControllerClient:switchNetwork - wagmiChain is undefined");let{name:i,nativeCurrency:o,rpcUrls:m,blockExplorers:a,id:C}=n,r=t.rpcUrls?.chainDefault?.http?.[0]??m.default.http[0]??"",g=a?.default.url??t.blockExplorers?.default?.url??"",s=o??t.nativeCurrency,d=i??t.name;yield Y(this.wagmiConfig,{chainId:C,addEthereumChainParameter:{chainName:d,nativeCurrency:s,rpcUrls:[r],blockExplorerUrls:[g]}}),yield re(w.prototype,this,"switchNetwork").call(this,e)})}getCapabilities(e){return c(this,null,function*(){if(!this.wagmiConfig)throw new Error("connectionControllerClient:getCapabilities - wagmiConfig is undefined");let n=v(this.wagmiConfig)[0],i=n?this.getWagmiConnector(n.connector.id):null;if(!i)throw new Error("connectionControllerClient:getCapabilities - connector is undefined");let o=yield i.getProvider();if(!o)throw new Error("connectionControllerClient:getCapabilities - provider is undefined");return yield o.request({method:"wallet_getCapabilities",params:[e]})})}grantPermissions(e){return c(this,null,function*(){if(!this.wagmiConfig)throw new Error("connectionControllerClient:grantPermissions - wagmiConfig is undefined");let n=v(this.wagmiConfig)[0],i=n?this.getWagmiConnector(n.connector.id):null;if(!i)throw new Error("connectionControllerClient:grantPermissions - connector is undefined");let o=yield i.getProvider();if(!o)throw new Error("connectionControllerClient:grantPermissions - provider is undefined");return o.request({method:"wallet_grantPermissions",params:e})})}revokePermissions(e){return c(this,null,function*(){if(!this.wagmiConfig)throw new Error("connectionControllerClient:revokePermissions - wagmiConfig is undefined");let n=v(this.wagmiConfig)[0],i=n?this.getWagmiConnector(n.connector.id):null;if(!i)throw new Error("connectionControllerClient:revokePermissions - connector is undefined");let o=yield i.getProvider();if(!o)throw new Error("connectionControllerClient:revokePermissions - provider is undefined");return o.request({method:"wallet_revokePermissions",params:e})})}walletGetAssets(e){return c(this,null,function*(){if(!this.wagmiConfig)throw new Error("connectionControllerClient:walletGetAssets - wagmiConfig is undefined");let n=v(this.wagmiConfig)[0],i=n?this.getWagmiConnector(n.connector.id):null;if(!i)throw new Error("connectionControllerClient:walletGetAssets - connector is undefined");let o=yield i.getProvider();if(!o)throw new Error("connectionControllerClient:walletGetAssets - provider is undefined");return o.request({method:"wallet_getAssets",params:[e]})})}setAuthProvider(e){if(!this.namespace)throw new Error("WagmiAdapter:setAuthProvider - namespace is required");this.addConnector({id:l.CONNECTOR_ID.AUTH,type:"AUTH",name:l.CONNECTOR_NAMES.AUTH,provider:e,imageId:A.ConnectorImageIds[l.CONNECTOR_ID.AUTH],chain:this.namespace,chains:[]})}setUniversalProvider(e){return c(this,null,function*(){e.on("connect",()=>{let n=v(this.wagmiConfig),i=this.getWagmiConnector("walletConnect");if(i&&!n.find(o=>o.connector.id===i.id)){if(I.state.activeChain==="eip155")return;G(this.wagmiConfig,{connectors:[i]})}});let t=K({universalProvider:e});return this.configureInternalConnector(t),this.addConnector(new Re({provider:e,caipNetworks:this.getCaipNetworks(),namespace:"eip155"})),Promise.resolve()})}toChecksummedAddress(e){return ae(e.toLowerCase())}};export{se as WagmiAdapter,ie as authConnector};
