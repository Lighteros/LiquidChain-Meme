import{a as oa,b as cr,c as lr,d as th,e as sh,f as rh,g as yn,h as aa,i as nh,j as ih,k as oh,l as ty,m as ca,n as ah,o as ch}from"./chunk-CT4HELHY.js";import{b as gs,c as ms,d as Et,e as Bs,f as mi,i as wn,j as bn,k as Vt,l as Ut,m as la,n as vn,o as yi}from"./chunk-LI53BOMV.js";import{a as gi}from"./chunk-TSLWMKS5.js";import{A as fi,B as pe,D as as,E as gn,F as Us,G as mn,J as ht,K as eh,M as pi,O as Br,Q as Y,S as vt,a as ct,b as kt,d as lt,e as na,f as Zu,g as ar,h as pn,i as Ce,j as Ur,m as Qu,n as rt,o as ut,p as di,s as Te,t as Se,u as Re,w as Ht,z as nt}from"./chunk-XLSZADC6.js";import{b as ia,c as Ju}from"./chunk-YSWAE63R.js";import{b as ve,e as Ee,i as or,k as Xu}from"./chunk-CDMUM2L7.js";import{a as Wu,b as Jm}from"./chunk-HINDXNTT.js";import{a as Yu,b as ey}from"./chunk-JKZLGYQN.js";import{c as Gu,f as Qm}from"./chunk-EEU3LH2V.js";import{I as Hu,L as Vu,M as Ku,u as zu}from"./chunk-QMRWXCSQ.js";import{a as H,b as be,h as hi,i as $u,k as zt,n as f,o as ta,p as ju,q as sa,r as ra}from"./chunk-VNDKUXGB.js";var hc=hi((t8,Cd)=>{"use strict";var qw="Input must be an string, Buffer or Uint8Array";function Mw(t){let e;if(t instanceof Uint8Array)e=t;else if(typeof t=="string")e=new TextEncoder().encode(t);else throw new Error(qw);return e}function Fw(t){return Array.prototype.map.call(t,function(e){return(e<16?"0":"")+e.toString(16)}).join("")}function uo(t){return(4294967296+t).toString(16).substring(1)}function $w(t,e,s){let r=`
`+t+" = ";for(let n=0;n<e.length;n+=2){if(s===32)r+=uo(e[n]).toUpperCase(),r+=" ",r+=uo(e[n+1]).toUpperCase();else if(s===64)r+=uo(e[n+1]).toUpperCase(),r+=uo(e[n]).toUpperCase();else throw new Error("Invalid size "+s);n%6===4?r+=`
`+new Array(t.length+4).join(" "):n<e.length-2&&(r+=" ")}console.log(r)}function jw(t,e,s){let r=new Date().getTime(),n=new Uint8Array(e);for(let o=0;o<e;o++)n[o]=o%256;let i=new Date().getTime();console.log("Generated random input in "+(i-r)+"ms"),r=i;for(let o=0;o<s;o++){let a=t(n),c=new Date().getTime(),l=c-r;r=c,console.log("Hashed in "+l+"ms: "+a.substring(0,20)+"..."),console.log(Math.round(e/(1<<20)/(l/1e3)*100)/100+" MB PER SECOND")}}Cd.exports={normalizeInput:Mw,toHex:Fw,debugPrint:$w,testSpeed:jw}});var qd=hi((s8,Ld)=>{"use strict";var fo=hc();function ho(t,e,s){let r=t[e]+t[s],n=t[e+1]+t[s+1];r>=4294967296&&n++,t[e]=r,t[e+1]=n}function Od(t,e,s,r){let n=t[e]+s;s<0&&(n+=4294967296);let i=t[e+1]+r;n>=4294967296&&i++,t[e]=n,t[e+1]=i}function Rd(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function qs(t,e,s,r,n,i){let o=Bn[n],a=Bn[n+1],c=Bn[i],l=Bn[i+1];ho(te,t,e),Od(te,t,o,a);let u=te[r]^te[t],h=te[r+1]^te[t+1];te[r]=h,te[r+1]=u,ho(te,s,r),u=te[e]^te[s],h=te[e+1]^te[s+1],te[e]=u>>>24^h<<8,te[e+1]=h>>>24^u<<8,ho(te,t,e),Od(te,t,c,l),u=te[r]^te[t],h=te[r+1]^te[t+1],te[r]=u>>>16^h<<16,te[r+1]=h>>>16^u<<16,ho(te,s,r),u=te[e]^te[s],h=te[e+1]^te[s+1],te[e]=h>>>31^u<<1,te[e+1]=u>>>31^h<<1}var Nd=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),zw=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],He=new Uint8Array(zw.map(function(t){return t*2})),te=new Uint32Array(32),Bn=new Uint32Array(32);function kd(t,e){let s=0;for(s=0;s<16;s++)te[s]=t.h[s],te[s+16]=Nd[s];for(te[24]=te[24]^t.t,te[25]=te[25]^t.t/4294967296,e&&(te[28]=~te[28],te[29]=~te[29]),s=0;s<32;s++)Bn[s]=Rd(t.b,4*s);for(s=0;s<12;s++)qs(0,8,16,24,He[s*16+0],He[s*16+1]),qs(2,10,18,26,He[s*16+2],He[s*16+3]),qs(4,12,20,28,He[s*16+4],He[s*16+5]),qs(6,14,22,30,He[s*16+6],He[s*16+7]),qs(0,10,20,30,He[s*16+8],He[s*16+9]),qs(2,12,22,24,He[s*16+10],He[s*16+11]),qs(4,14,16,26,He[s*16+12],He[s*16+13]),qs(6,8,18,28,He[s*16+14],He[s*16+15]);for(s=0;s<16;s++)t.h[s]=t.h[s]^te[s]^te[s+16]}var Ms=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function Ud(t,e,s,r){if(t===0||t>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(e&&e.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(s&&s.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(r&&r.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");let n={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:t};Ms.fill(0),Ms[0]=t,e&&(Ms[1]=e.length),Ms[2]=1,Ms[3]=1,s&&Ms.set(s,32),r&&Ms.set(r,48);for(let i=0;i<16;i++)n.h[i]=Nd[i]^Rd(Ms,i*4);return e&&(dc(n,e),n.c=128),n}function dc(t,e){for(let s=0;s<e.length;s++)t.c===128&&(t.t+=t.c,kd(t,!1),t.c=0),t.b[t.c++]=e[s]}function Bd(t){for(t.t+=t.c;t.c<128;)t.b[t.c++]=0;kd(t,!0);let e=new Uint8Array(t.outlen);for(let s=0;s<t.outlen;s++)e[s]=t.h[s>>2]>>8*(s&3);return e}function Dd(t,e,s,r,n){s=s||64,t=fo.normalizeInput(t),r&&(r=fo.normalizeInput(r)),n&&(n=fo.normalizeInput(n));let i=Ud(s,e,r,n);return dc(i,t),Bd(i)}function Hw(t,e,s,r,n){let i=Dd(t,e,s,r,n);return fo.toHex(i)}Ld.exports={blake2b:Dd,blake2bHex:Hw,blake2bInit:Ud,blake2bUpdate:dc,blake2bFinal:Bd}});var Kd=hi((r8,Vd)=>{"use strict";var Md=hc();function Vw(t,e){return t[e]^t[e+1]<<8^t[e+2]<<16^t[e+3]<<24}function Fs(t,e,s,r,n,i){oe[t]=oe[t]+oe[e]+n,oe[r]=po(oe[r]^oe[t],16),oe[s]=oe[s]+oe[r],oe[e]=po(oe[e]^oe[s],12),oe[t]=oe[t]+oe[e]+i,oe[r]=po(oe[r]^oe[t],8),oe[s]=oe[s]+oe[r],oe[e]=po(oe[e]^oe[s],7)}function po(t,e){return t>>>e^t<<32-e}var Fd=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ve=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),oe=new Uint32Array(16),De=new Uint32Array(16);function $d(t,e){let s=0;for(s=0;s<8;s++)oe[s]=t.h[s],oe[s+8]=Fd[s];for(oe[12]^=t.t,oe[13]^=t.t/4294967296,e&&(oe[14]=~oe[14]),s=0;s<16;s++)De[s]=Vw(t.b,4*s);for(s=0;s<10;s++)Fs(0,4,8,12,De[Ve[s*16+0]],De[Ve[s*16+1]]),Fs(1,5,9,13,De[Ve[s*16+2]],De[Ve[s*16+3]]),Fs(2,6,10,14,De[Ve[s*16+4]],De[Ve[s*16+5]]),Fs(3,7,11,15,De[Ve[s*16+6]],De[Ve[s*16+7]]),Fs(0,5,10,15,De[Ve[s*16+8]],De[Ve[s*16+9]]),Fs(1,6,11,12,De[Ve[s*16+10]],De[Ve[s*16+11]]),Fs(2,7,8,13,De[Ve[s*16+12]],De[Ve[s*16+13]]),Fs(3,4,9,14,De[Ve[s*16+14]],De[Ve[s*16+15]]);for(s=0;s<8;s++)t.h[s]^=oe[s]^oe[s+8]}function jd(t,e){if(!(t>0&&t<=32))throw new Error("Incorrect output length, should be in [1, 32]");let s=e?e.length:0;if(e&&!(s>0&&s<=32))throw new Error("Incorrect key length, should be in [1, 32]");let r={h:new Uint32Array(Fd),b:new Uint8Array(64),c:0,t:0,outlen:t};return r.h[0]^=16842752^s<<8^t,s>0&&(fc(r,e),r.c=64),r}function fc(t,e){for(let s=0;s<e.length;s++)t.c===64&&(t.t+=t.c,$d(t,!1),t.c=0),t.b[t.c++]=e[s]}function zd(t){for(t.t+=t.c;t.c<64;)t.b[t.c++]=0;$d(t,!0);let e=new Uint8Array(t.outlen);for(let s=0;s<t.outlen;s++)e[s]=t.h[s>>2]>>8*(s&3)&255;return e}function Hd(t,e,s){s=s||32,t=Md.normalizeInput(t);let r=jd(s,e);return fc(r,t),zd(r)}function Kw(t,e,s){let r=Hd(t,e,s);return Md.toHex(r)}Vd.exports={blake2s:Hd,blake2sHex:Kw,blake2sInit:jd,blake2sUpdate:fc,blake2sFinal:zd}});var Gd=hi((n8,Wd)=>{"use strict";var Dn=qd(),Ln=Kd();Wd.exports={blake2b:Dn.blake2b,blake2bHex:Dn.blake2bHex,blake2bInit:Dn.blake2bInit,blake2bUpdate:Dn.blake2bUpdate,blake2bFinal:Dn.blake2bFinal,blake2s:Ln.blake2s,blake2sHex:Ln.blake2sHex,blake2sInit:Ln.blake2sInit,blake2sUpdate:Ln.blake2sUpdate,blake2sFinal:Ln.blake2sFinal}});var En={id:"2b92315d-eab7-5bef-84fa-089a131333f5",name:"USD Coin",symbol:"USDC",networks:[{name:"ethereum-mainnet",display_name:"Ethereum",chain_id:"1",contract_address:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48"},{name:"polygon-mainnet",display_name:"Polygon",chain_id:"137",contract_address:"0x2791Bca1f2de4661ED88A30C99A7a9449Aa84174"}]},ua={id:"USD",payment_method_limits:[{id:"card",min:"10.00",max:"7500.00"},{id:"ach_bank_account",min:"10.00",max:"25000.00"}]},sy={providers:na,selectedProvider:null,error:null,purchaseCurrency:En,paymentCurrency:ua,purchaseCurrencies:[En],paymentCurrencies:[],quotesLoading:!1},ie=ct(sy),ry={state:ie,subscribe(t){return kt(ie,()=>t(ie))},subscribeKey(t,e){return lt(ie,t,e)},setSelectedProvider(t){if(t&&t.name==="meld"){let e=Y.state.activeChain,s=e===ve.CHAIN.SOLANA?"SOL":"USDC",r=e?Y.state.chains.get(e)?.accountState?.address??"":"",n=new URL(t.url);n.searchParams.append("publicKey",Zu),n.searchParams.append("destinationCurrencyCode",s),n.searchParams.append("walletAddress",r),n.searchParams.append("externalCustomerId",Te.state.projectId),ie.selectedProvider=be(H({},t),{url:n.toString()})}else ie.selectedProvider=t},setOnrampProviders(t){if(Array.isArray(t)&&t.every(e=>typeof e=="string")){let e=t,s=na.filter(r=>e.includes(r.name));ie.providers=s}else ie.providers=[]},setPurchaseCurrency(t){ie.purchaseCurrency=t},setPaymentCurrency(t){ie.paymentCurrency=t},setPurchaseAmount(t){ha.state.purchaseAmount=t},setPaymentAmount(t){ha.state.paymentAmount=t},getAvailableCurrencies(){return f(this,null,function*(){let t=yield Re.getOnrampOptions();ie.purchaseCurrencies=t.purchaseCurrencies,ie.paymentCurrencies=t.paymentCurrencies,ie.paymentCurrency=t.paymentCurrencies[0]||ua,ie.purchaseCurrency=t.purchaseCurrencies[0]||En,yield fi.fetchCurrencyImages(t.paymentCurrencies.map(e=>e.id)),yield fi.fetchTokenImages(t.purchaseCurrencies.map(e=>e.symbol))})},getQuote(){return f(this,null,function*(){ie.quotesLoading=!0;try{let t=yield Re.getOnrampQuote({purchaseCurrency:ie.purchaseCurrency,paymentCurrency:ie.paymentCurrency,amount:ie.paymentAmount?.toString()||"0",network:ie.purchaseCurrency?.symbol});return ie.quotesLoading=!1,ie.purchaseAmount=Number(t?.purchaseAmount.amount),t}catch(t){return ie.error=t.message,ie.quotesLoading=!1,null}finally{ie.quotesLoading=!1}})},resetState(){ie.selectedProvider=null,ie.error=null,ie.purchaseCurrency=En,ie.paymentCurrency=ua,ie.purchaseCurrencies=[En],ie.paymentCurrencies=[],ie.paymentAmount=void 0,ie.purchaseAmount=void 0,ie.quotesLoading=!1}},ha=Ht(ry);var Ko=zt(gi(),1);var Rs=zt(gi(),1);var hh=zt(gi()),ny=Object.defineProperty,iy=(t,e,s)=>e in t?ny(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,lh=(t,e,s)=>iy(t,typeof e!="symbol"?e+"":e,s),wi=class extends cr{constructor(e){super(),this.opts=e,lh(this,"protocol","wc"),lh(this,"version",2)}};var oy=Object.defineProperty,ay=(t,e,s)=>e in t?oy(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,cy=(t,e,s)=>ay(t,typeof e!="symbol"?e+"":e,s),bi=class extends cr{constructor(e,s){super(),this.core=e,this.logger=s,cy(this,"records",new Map)}},vi=class{constructor(e,s){this.logger=e,this.core=s}},Ei=class extends cr{constructor(e,s){super(),this.relayer=e,this.logger=s}},xi=class extends cr{constructor(e){super()}},Si=class{constructor(e,s,r,n){this.core=e,this.logger=s,this.name=r}};var Ii=class extends cr{constructor(e,s){super(),this.relayer=e,this.logger=s}};var Ai=class extends cr{constructor(e,s){super(),this.core=e,this.logger=s}};var _i=class{constructor(e,s,r){this.core=e,this.logger=s,this.store=r}},Ti=class{constructor(e,s){this.projectId=e,this.logger=s}},Pi=class{constructor(e,s,r){this.core=e,this.logger=s,this.telemetryEnabled=r}},ly=Object.defineProperty,uy=(t,e,s)=>e in t?ly(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,uh=(t,e,s)=>uy(t,typeof e!="symbol"?e+"":e,s);var Ci=class{constructor(e){this.opts=e,uh(this,"protocol","wc"),uh(this,"version",2)}};var Oi=class{constructor(e){this.client=e}};var K=zt(oa(),1);var _s=zt(oa(),1),Zt=zt(oh(),1),Of=zt(ty(),1);var dh="0.1.1";function fh(){return dh}var le=class t extends Error{constructor(e,s={}){let r=(()=>{if(s.cause instanceof t){if(s.cause.details)return s.cause.details;if(s.cause.shortMessage)return s.cause.shortMessage}return s.cause&&"details"in s.cause&&typeof s.cause.details=="string"?s.cause.details:s.cause?.message?s.cause.message:s.details})(),n=s.cause instanceof t&&s.cause.docsPath||s.docsPath,o=`https://oxlib.sh${n??""}`,a=[e||"An error occurred.",...s.metaMessages?["",...s.metaMessages]:[],...r||n?["",r?`Details: ${r}`:void 0,n?`See: ${o}`:void 0]:[]].filter(c=>typeof c=="string").join(`
`);super(a,s.cause?{cause:s.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cause",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:`ox@${fh()}`}),this.cause=s.cause,this.details=r,this.docs=o,this.docsPath=n,this.shortMessage=e}walk(e){return ph(this,e)}};function ph(t,e){return e?.(t)?t:t&&typeof t=="object"&&"cause"in t&&t.cause?ph(t.cause,e):e?null:t}Jm();var ga=BigInt(0),pa=BigInt(1);function Lr(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ma(t){if(!Lr(t))throw new Error("Uint8Array expected")}function qr(t,e){if(typeof e!="boolean")throw new Error(t+" boolean expected, got "+e)}function xn(t){let e=t.toString(16);return e.length&1?"0"+e:e}function yh(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?ga:BigInt("0x"+t)}var wh=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",hy=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Mr(t){if(ma(t),wh)return t.toHex();let e="";for(let s=0;s<t.length;s++)e+=hy[t[s]];return e}var ys={_0:48,_9:57,A:65,F:70,a:97,f:102};function gh(t){if(t>=ys._0&&t<=ys._9)return t-ys._0;if(t>=ys.A&&t<=ys.F)return t-(ys.A-10);if(t>=ys.a&&t<=ys.f)return t-(ys.a-10)}function Sn(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(wh)return Uint8Array.fromHex(t);let e=t.length,s=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let r=new Uint8Array(s);for(let n=0,i=0;n<s;n++,i+=2){let o=gh(t.charCodeAt(i)),a=gh(t.charCodeAt(i+1));if(o===void 0||a===void 0){let c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}r[n]=o*16+a}return r}function ws(t){return yh(Mr(t))}function ya(t){return ma(t),yh(Mr(Uint8Array.from(t).reverse()))}function ur(t,e){return Sn(t.toString(16).padStart(e*2,"0"))}function wa(t,e){return ur(t,e).reverse()}function dt(t,e,s){let r;if(typeof e=="string")try{r=Sn(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(Lr(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");let n=r.length;if(typeof s=="number"&&n!==s)throw new Error(t+" of length "+s+" expected, got "+n);return r}function In(...t){let e=0;for(let r=0;r<t.length;r++){let n=t[r];ma(n),e+=n.length}let s=new Uint8Array(e);for(let r=0,n=0;r<t.length;r++){let i=t[r];s.set(i,n),n+=i.length}return s}var da=t=>typeof t=="bigint"&&ga<=t;function Ri(t,e,s){return da(t)&&da(e)&&da(s)&&e<=t&&t<s}function hr(t,e,s,r){if(!Ri(e,s,r))throw new Error("expected valid "+t+": "+s+" <= n < "+r+", got "+e)}function bh(t){let e;for(e=0;t>ga;t>>=pa,e+=1);return e}var dr=t=>(pa<<BigInt(t))-pa,fa=t=>new Uint8Array(t),mh=t=>Uint8Array.from(t);function vh(t,e,s){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof s!="function")throw new Error("hmacFn must be a function");let r=fa(t),n=fa(t),i=0,o=()=>{r.fill(1),n.fill(0),i=0},a=(...h)=>s(n,r,...h),c=(h=fa(0))=>{n=a(mh([0]),h),r=a(),h.length!==0&&(n=a(mh([1]),h),r=a())},l=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let h=0,d=[];for(;h<e;){r=a();let p=r.slice();d.push(p),h+=r.length}return In(...d)};return(h,d)=>{o(),c(h);let p;for(;!(p=d(l()));)c();return o(),p}}var dy={bigint:t=>typeof t=="bigint",function:t=>typeof t=="function",boolean:t=>typeof t=="boolean",string:t=>typeof t=="string",stringOrUint8Array:t=>typeof t=="string"||Lr(t),isSafeInteger:t=>Number.isSafeInteger(t),array:t=>Array.isArray(t),field:(t,e)=>e.Fp.isValid(t),hash:t=>typeof t=="function"&&Number.isSafeInteger(t.outputLen)};function fr(t,e,s={}){let r=(n,i,o)=>{let a=dy[i];if(typeof a!="function")throw new Error("invalid validator function");let c=t[n];if(!(o&&c===void 0)&&!a(c,t))throw new Error("param "+String(n)+" is invalid. Expected "+i+", got "+c)};for(let[n,i]of Object.entries(e))r(n,i,!1);for(let[n,i]of Object.entries(s))r(n,i,!0);return t}function ba(t){let e=new WeakMap;return(s,...r)=>{let n=e.get(s);if(n!==void 0)return n;let i=t(s,...r);return e.set(s,i),i}}function Eh(t,e){if(va(t)>e)throw new Ni({givenSize:va(t),maxSize:e})}var bs={zero:48,nine:57,A:65,F:70,a:97,f:102};function Ea(t){if(t>=bs.zero&&t<=bs.nine)return t-bs.zero;if(t>=bs.A&&t<=bs.F)return t-(bs.A-10);if(t>=bs.a&&t<=bs.f)return t-(bs.a-10)}function xh(t,e={}){let{dir:s,size:r=32}=e;if(r===0)return t;if(t.length>r)throw new ki({size:t.length,targetSize:r,type:"Bytes"});let n=new Uint8Array(r);for(let i=0;i<r;i++){let o=s==="right";n[o?i:r-i-1]=t[o?i:t.length-i-1]}return n}function Ui(t,e){if(Bt(t)>e)throw new Bi({givenSize:Bt(t),maxSize:e})}function Sh(t,e){if(typeof e=="number"&&e>0&&e>Bt(t)-1)throw new An({offset:e,position:"start",size:Bt(t)})}function Ih(t,e,s){if(typeof e=="number"&&typeof s=="number"&&Bt(t)!==s-e)throw new An({offset:s,position:"end",size:Bt(t)})}function xa(t,e={}){let{dir:s,size:r=32}=e;if(r===0)return t;let n=t.replace("0x","");if(n.length>r*2)throw new Di({size:Math.ceil(n.length/2),targetSize:r,type:"Hex"});return`0x${n[s==="right"?"padEnd":"padStart"](r*2,"0")}`}function Ah(t,e={}){let{dir:s="left"}=e,r=t.replace("0x",""),n=0;for(let i=0;i<r.length-1&&r[s==="left"?i:r.length-i-1].toString()==="0";i++)n++;return r=s==="left"?r.slice(n):r.slice(0,r.length-n),r==="0"?"0x":s==="right"&&r.length%2===1?`0x${r}0`:`0x${r}`}var py="#__bigint";function Ds(t,e,s){return JSON.stringify(t,(r,n)=>typeof e=="function"?e(r,n):typeof n=="bigint"?n.toString()+py:n,s)}var gy=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function my(t,e={}){let{strict:s=!1}=e;if(!t)throw new Li(t);if(typeof t!="string")throw new Li(t);if(s&&!/^0x[0-9a-fA-F]*$/.test(t))throw new qi(t);if(!t.startsWith("0x"))throw new qi(t)}function Mi(...t){return`0x${t.reduce((e,s)=>e+s.replace("0x",""),"")}`}function cs(t){return t instanceof Uint8Array?xt(t):Array.isArray(t)?xt(new Uint8Array(t)):t}function xt(t,e={}){let s="";for(let n=0;n<t.length;n++)s+=gy[t[n]];let r=`0x${s}`;return typeof e.size=="number"?(Ui(r,e.size),Ia(r,e.size)):r}function St(t,e={}){let{signed:s,size:r}=e,n=BigInt(t),i;r?s?i=(1n<<BigInt(r)*8n-1n)-1n:i=2n**(BigInt(r)*8n)-1n:typeof t=="number"&&(i=BigInt(Number.MAX_SAFE_INTEGER));let o=typeof i=="bigint"&&s?-i-1n:0;if(i&&n>i||n<o){let l=typeof t=="bigint"?"n":"";throw new Sa({max:i?`${i}${l}`:void 0,min:`${o}${l}`,signed:s,size:r,value:`${t}${l}`})}let c=`0x${(s&&n<0?(1n<<BigInt(r*8))+BigInt(n):n).toString(16)}`;return r?yy(c,r):c}function yy(t,e){return xa(t,{dir:"left",size:e})}function Ia(t,e){return xa(t,{dir:"right",size:e})}function Kt(t,e,s,r={}){let{strict:n}=r;Sh(t,e);let i=`0x${t.replace("0x","").slice((e??0)*2,(s??t.length)*2)}`;return n&&Ih(i,e,s),i}function Bt(t){return Math.ceil((t.length-2)/2)}function Aa(t){return Ah(t,{dir:"left"})}function _a(t,e={}){let{strict:s=!1}=e;try{return my(t,{strict:s}),!0}catch{return!1}}var Sa=class extends le{constructor({max:e,min:s,signed:r,size:n,value:i}){super(`Number \`${i}\` is not in safe${n?` ${n*8}-bit`:""}${r?" signed":" unsigned"} integer range ${e?`(\`${s}\` to \`${e}\`)`:`(above \`${s}\`)`}`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.IntegerOutOfRangeError"})}};var Li=class extends le{constructor(e){super(`Value \`${typeof e=="object"?Ds(e):e}\` of type \`${typeof e}\` is an invalid hex type.`,{metaMessages:['Hex types must be represented as `"0x${string}"`.']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexTypeError"})}},qi=class extends le{constructor(e){super(`Value \`${e}\` is an invalid hex value.`,{metaMessages:['Hex values must start with `"0x"` and contain only hexadecimal characters (0-9, a-f, A-F).']}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.InvalidHexValueError"})}};var Bi=class extends le{constructor({givenSize:e,maxSize:s}){super(`Size cannot exceed \`${s}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeOverflowError"})}},An=class extends le{constructor({offset:e,position:s,size:r}){super(`Slice ${s==="start"?"starting":"ending"} at offset \`${e}\` is out-of-bounds (size: \`${r}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SliceOffsetOutOfBoundsError"})}},Di=class extends le{constructor({size:e,targetSize:s,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${s}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Hex.SizeExceedsPaddingSizeError"})}};var wy=new TextEncoder;function by(t){if(!(t instanceof Uint8Array)){if(!t)throw new Fr(t);if(typeof t!="object")throw new Fr(t);if(!("BYTES_PER_ELEMENT"in t))throw new Fr(t);if(t.BYTES_PER_ELEMENT!==1||t.constructor.name!=="Uint8Array")throw new Fr(t)}}function $r(t){return t instanceof Uint8Array?t:typeof t=="string"?Tn(t):vy(t)}function vy(t){return t instanceof Uint8Array?t:new Uint8Array(t)}function Tn(t,e={}){let{size:s}=e,r=t;s&&(Ui(t,s),r=Ia(t,s));let n=r.slice(2);n.length%2&&(n=`0${n}`);let i=n.length/2,o=new Uint8Array(i);for(let a=0,c=0;a<i;a++){let l=Ea(n.charCodeAt(c++)),u=Ea(n.charCodeAt(c++));if(l===void 0||u===void 0)throw new le(`Invalid byte sequence ("${n[c-2]}${n[c-1]}" in "${n}").`);o[a]=l*16+u}return o}function Th(t,e={}){let{size:s}=e,r=wy.encode(t);return typeof s=="number"?(Eh(r,s),Ey(r,s)):r}function Ey(t,e){return xh(t,{dir:"right",size:e})}function va(t){return t.length}function Ph(t){try{return by(t),!0}catch{return!1}}var Fr=class extends le{constructor(e){super(`Value \`${typeof e=="object"?Ds(e):e}\` of type \`${typeof e}\` is an invalid Bytes value.`,{metaMessages:["Bytes values must be of type `Bytes`."]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.InvalidBytesTypeError"})}},Ni=class extends le{constructor({givenSize:e,maxSize:s}){super(`Size cannot exceed \`${s}\` bytes. Given size: \`${e}\` bytes.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeOverflowError"})}};var ki=class extends le{constructor({size:e,targetSize:s,type:r}){super(`${r.charAt(0).toUpperCase()}${r.slice(1).toLowerCase()} size (\`${e}\`) exceeds padding size (\`${s}\`).`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Bytes.SizeExceedsPaddingSizeError"})}};function Ta(t,e={}){let{as:s=typeof t=="string"?"Hex":"Bytes"}=e,r=Wu($r(t));return s==="Bytes"?r:xt(r)}var Fi=class extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){let s=super.get(e);return super.has(e)&&s!==void 0&&(this.delete(e),super.set(e,s)),s}set(e,s){if(super.set(e,s),this.maxSize&&this.size>this.maxSize){let r=this.keys().next().value;r&&this.delete(r)}return this}};var xy={checksum:new Fi(8192)},$i=xy.checksum;function Rh(t,e={}){let{compressed:s}=e,{prefix:r,x:n,y:i}=t;if(s===!1||typeof n=="bigint"&&typeof i=="bigint"){if(r!==4)throw new ji({prefix:r,cause:new Oa});return}if(s===!0||typeof n=="bigint"&&typeof i>"u"){if(r!==3&&r!==2)throw new ji({prefix:r,cause:new Ca});return}throw new Pa({publicKey:t})}function Na(t){let e=(()=>{if(_a(t))return Nh(t);if(Ph(t))return Sy(t);let{prefix:s,x:r,y:n}=t;return typeof r=="bigint"&&typeof n=="bigint"?{prefix:s??4,x:r,y:n}:{prefix:s,x:r}})();return Rh(e),e}function Sy(t){return Nh(xt(t))}function Nh(t){if(t.length!==132&&t.length!==130&&t.length!==68)throw new Ra({publicKey:t});if(t.length===130){let r=BigInt(Kt(t,0,32)),n=BigInt(Kt(t,32,64));return{prefix:4,x:r,y:n}}if(t.length===132){let r=Number(Kt(t,0,1)),n=BigInt(Kt(t,1,33)),i=BigInt(Kt(t,33,65));return{prefix:r,x:n,y:i}}let e=Number(Kt(t,0,1)),s=BigInt(Kt(t,1,33));return{prefix:e,x:s}}function kh(t,e={}){return Tn(Pn(t,e))}function Pn(t,e={}){Rh(t);let{prefix:s,x:r,y:n}=t,{includePrefix:i=!0}=e;return Mi(i?St(s,{size:1}):"0x",St(r,{size:32}),typeof n=="bigint"?St(n,{size:32}):"0x")}var Pa=class extends le{constructor({publicKey:e}){super(`Value \`${Ds(e)}\` is not a valid public key.`,{metaMessages:["Public key must contain:","- an `x` and `prefix` value (compressed)","- an `x`, `y`, and `prefix` value (uncompressed)"]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidError"})}},ji=class extends le{constructor({prefix:e,cause:s}){super(`Prefix "${e}" is invalid.`,{cause:s}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidPrefixError"})}},Ca=class extends le{constructor(){super("Prefix must be 2 or 3 for compressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidCompressedPrefixError"})}},Oa=class extends le{constructor(){super("Prefix must be 4 for uncompressed public keys."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidUncompressedPrefixError"})}},Ra=class extends le{constructor({publicKey:e}){super(`Value \`${e}\` is an invalid public key size.`,{metaMessages:["Expected: 33 bytes (compressed + prefix), 64 bytes (uncompressed) or 65 bytes (uncompressed + prefix).",`Received ${Bt(cs(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"PublicKey.InvalidSerializedSizeError"})}};var Iy=/^0x[a-fA-F0-9]{40}$/;function zi(t,e={}){let{strict:s=!0}=e;if(!Iy.test(t))throw new Hi({address:t,cause:new Ua});if(s){if(t.toLowerCase()===t)return;if(Uh(t)!==t)throw new Hi({address:t,cause:new Ba})}}function Uh(t){if($i.has(t))return $i.get(t);zi(t,{strict:!1});let e=t.substring(2).toLowerCase(),s=Ta(Th(e),{as:"Bytes"}),r=e.split("");for(let i=0;i<40;i+=2)s[i>>1]>>4>=8&&r[i]&&(r[i]=r[i].toUpperCase()),(s[i>>1]&15)>=8&&r[i+1]&&(r[i+1]=r[i+1].toUpperCase());let n=`0x${r.join("")}`;return $i.set(t,n),n}function Ay(t,e={}){let{checksum:s=!1}=e;return zi(t),s?Uh(t):t}function Bh(t,e={}){let s=Ta(`0x${Pn(t).slice(4)}`).substring(26);return Ay(`0x${s}`,e)}function Dh(t,e){return zi(t,{strict:!1}),zi(e,{strict:!1}),t.toLowerCase()===e.toLowerCase()}var Hi=class extends le{constructor({address:e,cause:s}){super(`Address "${e}" is invalid.`,{cause:s}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidAddressError"})}},Ua=class extends le{constructor(){super("Address is not a 20 byte (40 hexadecimal character) value."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidInputError"})}},Ba=class extends le{constructor(){super("Address does not match its checksum counterpart."),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Address.InvalidChecksumError"})}};var SA=2n**(8n-1n)-1n,IA=2n**(16n-1n)-1n,AA=2n**(24n-1n)-1n,_A=2n**(32n-1n)-1n,TA=2n**(40n-1n)-1n,PA=2n**(48n-1n)-1n,CA=2n**(56n-1n)-1n,OA=2n**(64n-1n)-1n,RA=2n**(72n-1n)-1n,NA=2n**(80n-1n)-1n,kA=2n**(88n-1n)-1n,UA=2n**(96n-1n)-1n,BA=2n**(104n-1n)-1n,DA=2n**(112n-1n)-1n,LA=2n**(120n-1n)-1n,qA=2n**(128n-1n)-1n,MA=2n**(136n-1n)-1n,FA=2n**(144n-1n)-1n,$A=2n**(152n-1n)-1n,jA=2n**(160n-1n)-1n,zA=2n**(168n-1n)-1n,HA=2n**(176n-1n)-1n,VA=2n**(184n-1n)-1n,KA=2n**(192n-1n)-1n,WA=2n**(200n-1n)-1n,GA=2n**(208n-1n)-1n,YA=2n**(216n-1n)-1n,XA=2n**(224n-1n)-1n,ZA=2n**(232n-1n)-1n,JA=2n**(240n-1n)-1n,QA=2n**(248n-1n)-1n,e_=2n**(256n-1n)-1n,t_=-(2n**(8n-1n)),s_=-(2n**(16n-1n)),r_=-(2n**(24n-1n)),n_=-(2n**(32n-1n)),i_=-(2n**(40n-1n)),o_=-(2n**(48n-1n)),a_=-(2n**(56n-1n)),c_=-(2n**(64n-1n)),l_=-(2n**(72n-1n)),u_=-(2n**(80n-1n)),h_=-(2n**(88n-1n)),d_=-(2n**(96n-1n)),f_=-(2n**(104n-1n)),p_=-(2n**(112n-1n)),g_=-(2n**(120n-1n)),m_=-(2n**(128n-1n)),y_=-(2n**(136n-1n)),w_=-(2n**(144n-1n)),b_=-(2n**(152n-1n)),v_=-(2n**(160n-1n)),E_=-(2n**(168n-1n)),x_=-(2n**(176n-1n)),S_=-(2n**(184n-1n)),I_=-(2n**(192n-1n)),A_=-(2n**(200n-1n)),__=-(2n**(208n-1n)),T_=-(2n**(216n-1n)),P_=-(2n**(224n-1n)),C_=-(2n**(232n-1n)),O_=-(2n**(240n-1n)),R_=-(2n**(248n-1n)),N_=-(2n**(256n-1n)),k_=2n**8n-1n,U_=2n**16n-1n,B_=2n**24n-1n,D_=2n**32n-1n,L_=2n**40n-1n,q_=2n**48n-1n,M_=2n**56n-1n,F_=2n**64n-1n,$_=2n**72n-1n,j_=2n**80n-1n,z_=2n**88n-1n,H_=2n**96n-1n,V_=2n**104n-1n,K_=2n**112n-1n,W_=2n**120n-1n,G_=2n**128n-1n,Y_=2n**136n-1n,X_=2n**144n-1n,Z_=2n**152n-1n,J_=2n**160n-1n,Q_=2n**168n-1n,eT=2n**176n-1n,tT=2n**184n-1n,sT=2n**192n-1n,rT=2n**200n-1n,nT=2n**208n-1n,iT=2n**216n-1n,oT=2n**224n-1n,aT=2n**232n-1n,cT=2n**240n-1n,lT=2n**248n-1n,Da=2n**256n-1n;var Ji={};$u(Ji,{InvalidRError:()=>Wi,InvalidSError:()=>Gi,InvalidSerializedSizeError:()=>Ki,InvalidVError:()=>Yi,InvalidYParityError:()=>yr,MissingPropertiesError:()=>jr,assert:()=>Xi,extract:()=>jy,from:()=>Qa,fromBytes:()=>nd,fromDerBytes:()=>zy,fromDerHex:()=>id,fromHex:()=>Ja,fromLegacy:()=>od,fromRpc:()=>ad,fromTuple:()=>Hy,toBytes:()=>Vy,toDerBytes:()=>Ky,toDerHex:()=>Wy,toHex:()=>cd,toLegacy:()=>Gy,toRpc:()=>Yy,toTuple:()=>Xy,vToYParity:()=>Zi,validate:()=>Zy,yParityToV:()=>ec});Qm();ey();Ku();Ku();var it=BigInt(0),ze=BigInt(1),mr=BigInt(2),_y=BigInt(3),Fh=BigInt(4),$h=BigInt(5),jh=BigInt(8);function je(t,e){let s=t%e;return s>=it?s:e+s}function It(t,e,s){let r=t;for(;e-- >it;)r*=r,r%=s;return r}function Vi(t,e){if(t===it)throw new Error("invert: expected non-zero number");if(e<=it)throw new Error("invert: expected positive modulus, got "+e);let s=je(t,e),r=e,n=it,i=ze,o=ze,a=it;for(;s!==it;){let l=r/s,u=r%s,h=n-o*l,d=i-a*l;r=s,s=u,n=o,i=a,o=h,a=d}if(r!==ze)throw new Error("invert: does not exist");return je(n,e)}function zh(t,e){let s=(t.ORDER+ze)/Fh,r=t.pow(e,s);if(!t.eql(t.sqr(r),e))throw new Error("Cannot find square root");return r}function Ty(t,e){let s=(t.ORDER-$h)/jh,r=t.mul(e,mr),n=t.pow(r,s),i=t.mul(e,n),o=t.mul(t.mul(i,mr),n),a=t.mul(i,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),e))throw new Error("Cannot find square root");return a}function Py(t){if(t<BigInt(3))throw new Error("sqrt is not defined for small field");let e=t-ze,s=0;for(;e%mr===it;)e/=mr,s++;let r=mr,n=Cn(t);for(;Mh(n,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(s===1)return zh;let i=n.pow(r,e),o=(e+ze)/mr;return function(c,l){if(c.is0(l))return l;if(Mh(c,l)!==1)throw new Error("Cannot find square root");let u=s,h=c.mul(c.ONE,i),d=c.pow(l,e),p=c.pow(l,o);for(;!c.eql(d,c.ONE);){if(c.is0(d))return c.ZERO;let m=1,g=c.sqr(d);for(;!c.eql(g,c.ONE);)if(m++,g=c.sqr(g),m===u)throw new Error("Cannot find square root");let w=ze<<BigInt(u-m-1),N=c.pow(h,w);u=m,h=c.sqr(N),d=c.mul(d,h),p=c.mul(p,N)}return p}}function Cy(t){return t%Fh===_y?zh:t%jh===$h?Ty:Py(t)}var Oy=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function La(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},s=Oy.reduce((r,n)=>(r[n]="function",r),e);return fr(t,s)}function Ry(t,e,s){if(s<it)throw new Error("invalid exponent, negatives unsupported");if(s===it)return t.ONE;if(s===ze)return e;let r=t.ONE,n=e;for(;s>it;)s&ze&&(r=t.mul(r,n)),n=t.sqr(n),s>>=ze;return r}function qa(t,e,s=!1){let r=new Array(e.length).fill(s?t.ZERO:void 0),n=e.reduce((o,a,c)=>t.is0(a)?o:(r[c]=o,t.mul(o,a)),t.ONE),i=t.inv(n);return e.reduceRight((o,a,c)=>t.is0(a)?o:(r[c]=t.mul(o,r[c]),t.mul(o,a)),i),r}function Mh(t,e){let s=(t.ORDER-ze)/mr,r=t.pow(e,s),n=t.eql(r,t.ONE),i=t.eql(r,t.ZERO),o=t.eql(r,t.neg(t.ONE));if(!n&&!i&&!o)throw new Error("invalid Legendre symbol result");return n?1:i?0:-1}function Ma(t,e){e!==void 0&&zu(e);let s=e!==void 0?e:t.toString(2).length,r=Math.ceil(s/8);return{nBitLength:s,nByteLength:r}}function Cn(t,e,s=!1,r={}){if(t<=it)throw new Error("invalid field: expected ORDER > 0, got "+t);let{nBitLength:n,nByteLength:i}=Ma(t,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o,a=Object.freeze({ORDER:t,isLE:s,BITS:n,BYTES:i,MASK:dr(n),ZERO:it,ONE:ze,create:c=>je(c,t),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return it<=c&&c<t},is0:c=>c===it,isOdd:c=>(c&ze)===ze,neg:c=>je(-c,t),eql:(c,l)=>c===l,sqr:c=>je(c*c,t),add:(c,l)=>je(c+l,t),sub:(c,l)=>je(c-l,t),mul:(c,l)=>je(c*l,t),pow:(c,l)=>Ry(a,c,l),div:(c,l)=>je(c*Vi(l,t),t),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Vi(c,t),sqrt:r.sqrt||(c=>(o||(o=Cy(t)),o(a,c))),toBytes:c=>s?wa(c,i):ur(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return s?ya(c):ws(c)},invertBatch:c=>qa(a,c),cmov:(c,l,u)=>u?l:c});return Object.freeze(a)}function Hh(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function Fa(t){let e=Hh(t);return e+Math.ceil(e/2)}function Vh(t,e,s=!1){let r=t.length,n=Hh(e),i=Fa(e);if(r<16||r<i||r>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+r);let o=s?ya(t):ws(t),a=je(o,e-ze)+ze;return s?wa(a,n):ur(a,n)}var Kh=BigInt(0),Va=BigInt(1);function $a(t,e){let s=e.negate();return t?s:e}function Gh(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function ja(t,e){Gh(t,e);let s=Math.ceil(e/t)+1,r=2**(t-1),n=2**t,i=dr(t),o=BigInt(t);return{windows:s,windowSize:r,mask:i,maxNumber:n,shiftBy:o}}function Wh(t,e,s){let{windowSize:r,mask:n,maxNumber:i,shiftBy:o}=s,a=Number(t&n),c=t>>o;a>r&&(a-=i,c+=Va);let l=e*r,u=l+Math.abs(a)-1,h=a===0,d=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:d,isNegF:p,offsetF:l}}function Ny(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((s,r)=>{if(!(s instanceof e))throw new Error("invalid point at index "+r)})}function ky(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((s,r)=>{if(!e.isValid(s))throw new Error("invalid scalar at index "+r)})}var za=new WeakMap,Yh=new WeakMap;function Ha(t){return Yh.get(t)||1}function Xh(t,e){return{constTimeNegate:$a,hasPrecomputes(s){return Ha(s)!==1},unsafeLadder(s,r,n=t.ZERO){let i=s;for(;r>Kh;)r&Va&&(n=n.add(i)),i=i.double(),r>>=Va;return n},precomputeWindow(s,r){let{windows:n,windowSize:i}=ja(r,e),o=[],a=s,c=a;for(let l=0;l<n;l++){c=a,o.push(c);for(let u=1;u<i;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(s,r,n){let i=t.ZERO,o=t.BASE,a=ja(s,e);for(let c=0;c<a.windows;c++){let{nextN:l,offset:u,isZero:h,isNeg:d,isNegF:p,offsetF:m}=Wh(n,c,a);n=l,h?o=o.add($a(p,r[m])):i=i.add($a(d,r[u]))}return{p:i,f:o}},wNAFUnsafe(s,r,n,i=t.ZERO){let o=ja(s,e);for(let a=0;a<o.windows&&n!==Kh;a++){let{nextN:c,offset:l,isZero:u,isNeg:h}=Wh(n,a,o);if(n=c,!u){let d=r[l];i=i.add(h?d.negate():d)}}return i},getPrecomputes(s,r,n){let i=za.get(r);return i||(i=this.precomputeWindow(r,s),s!==1&&za.set(r,n(i))),i},wNAFCached(s,r,n){let i=Ha(s);return this.wNAF(i,this.getPrecomputes(i,s,n),r)},wNAFCachedUnsafe(s,r,n,i){let o=Ha(s);return o===1?this.unsafeLadder(s,r,i):this.wNAFUnsafe(o,this.getPrecomputes(o,s,n),r,i)},setWindowSize(s,r){Gh(r,e),Yh.set(s,r),za.delete(s)}}}function Zh(t,e,s,r){Ny(s,t),ky(r,e);let n=s.length,i=r.length;if(n!==i)throw new Error("arrays of points and scalars must have equal length");let o=t.ZERO,a=bh(BigInt(n)),c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);let l=dr(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c,d=o;for(let p=h;p>=0;p-=c){u.fill(o);for(let g=0;g<i;g++){let w=r[g],N=Number(w>>BigInt(p)&l);u[N]=u[N].add(s[g])}let m=o;for(let g=u.length-1,w=o;g>0;g--)w=w.add(u[g]),m=m.add(w);if(d=d.add(m),p!==0)for(let g=0;g<c;g++)d=d.double()}return d}function Ka(t){return La(t.Fp),fr(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze(be(H(H({},Ma(t.n,t.nBitLength)),t),{p:t.Fp.ORDER}))}function Jh(t){t.lowS!==void 0&&qr("lowS",t.lowS),t.prehash!==void 0&&qr("prehash",t.prehash)}function Uy(t){let e=Ka(t);fr(e,{a:"field",b:"field"},{allowInfinityPoint:"boolean",allowedPrivateKeyLengths:"array",clearCofactor:"function",fromBytes:"function",isTorsionFree:"function",toBytes:"function",wrapPrivateKey:"boolean"});let{endo:s,Fp:r,a:n}=e;if(s){if(!r.eql(n,r.ZERO))throw new Error("invalid endo: CURVE.a must be 0");if(typeof s!="object"||typeof s.beta!="bigint"||typeof s.splitScalar!="function")throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function')}return Object.freeze(H({},e))}var Ya=class extends Error{constructor(e=""){super(e)}},vs={Err:Ya,_tlv:{encode:(t,e)=>{let{Err:s}=vs;if(t<0||t>256)throw new s("tlv.encode: wrong tag");if(e.length&1)throw new s("tlv.encode: unpadded data");let r=e.length/2,n=xn(r);if(n.length/2&128)throw new s("tlv.encode: long form length too big");let i=r>127?xn(n.length/2|128):"";return xn(t)+i+n+e},decode(t,e){let{Err:s}=vs,r=0;if(t<0||t>256)throw new s("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new s("tlv.decode: wrong tlv");let n=e[r++],i=!!(n&128),o=0;if(!i)o=n;else{let c=n&127;if(!c)throw new s("tlv.decode(long): indefinite length not supported");if(c>4)throw new s("tlv.decode(long): byte length is too big");let l=e.subarray(r,r+c);if(l.length!==c)throw new s("tlv.decode: length bytes not complete");if(l[0]===0)throw new s("tlv.decode(long): zero leftmost byte");for(let u of l)o=o<<8|u;if(r+=c,o<128)throw new s("tlv.decode(long): not minimal encoding")}let a=e.subarray(r,r+o);if(a.length!==o)throw new s("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){let{Err:e}=vs;if(t<Es)throw new e("integer: negative integers are not allowed");let s=xn(t);if(Number.parseInt(s[0],16)&8&&(s="00"+s),s.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return s},decode(t){let{Err:e}=vs;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return ws(t)}},toSig(t){let{Err:e,_int:s,_tlv:r}=vs,n=dt("signature",t),{v:i,l:o}=r.decode(48,n);if(o.length)throw new e("invalid signature: left bytes after parsing");let{v:a,l:c}=r.decode(2,i),{v:l,l:u}=r.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:s.decode(a),s:s.decode(l)}},hexFromSig(t){let{_tlv:e,_int:s}=vs,r=e.encode(2,s.encode(t.r)),n=e.encode(2,s.encode(t.s)),i=r+n;return e.encode(48,i)}};function Wa(t,e){return Mr(ur(t,e))}var Es=BigInt(0),Ne=BigInt(1),vT=BigInt(2),Ga=BigInt(3),By=BigInt(4);function Dy(t){let e=Uy(t),{Fp:s}=e,r=Cn(e.n,e.nBitLength),n=e.toBytes||((A,S,O)=>{let k=S.toAffine();return In(Uint8Array.from([4]),s.toBytes(k.x),s.toBytes(k.y))}),i=e.fromBytes||(A=>{let S=A.subarray(1),O=s.fromBytes(S.subarray(0,s.BYTES)),k=s.fromBytes(S.subarray(s.BYTES,2*s.BYTES));return{x:O,y:k}});function o(A){let{a:S,b:O}=e,k=s.sqr(A),D=s.mul(k,A);return s.add(s.add(D,s.mul(A,S)),O)}function a(A,S){let O=s.sqr(S),k=o(A);return s.eql(O,k)}if(!a(e.Gx,e.Gy))throw new Error("bad curve params: generator point");let c=s.mul(s.pow(e.a,Ga),By),l=s.mul(s.sqr(e.b),BigInt(27));if(s.is0(s.add(c,l)))throw new Error("bad curve params: a or b");function u(A){return Ri(A,Ne,e.n)}function h(A){let{allowedPrivateKeyLengths:S,nByteLength:O,wrapPrivateKey:k,n:D}=e;if(S&&typeof A!="bigint"){if(Lr(A)&&(A=Mr(A)),typeof A!="string"||!S.includes(A.length))throw new Error("invalid private key");A=A.padStart(O*2,"0")}let M;try{M=typeof A=="bigint"?A:ws(dt("private key",A,O))}catch{throw new Error("invalid private key, expected hex or "+O+" bytes, got "+typeof A)}return k&&(M=je(M,D)),hr("private key",M,Ne,D),M}function d(A){if(!(A instanceof g))throw new Error("ProjectivePoint expected")}let p=ba((A,S)=>{let{px:O,py:k,pz:D}=A;if(s.eql(D,s.ONE))return{x:O,y:k};let M=A.is0();S==null&&(S=M?s.ONE:s.inv(D));let P=s.mul(O,S),L=s.mul(k,S),F=s.mul(D,S);if(M)return{x:s.ZERO,y:s.ZERO};if(!s.eql(F,s.ONE))throw new Error("invZ was invalid");return{x:P,y:L}}),m=ba(A=>{if(A.is0()){if(e.allowInfinityPoint&&!s.is0(A.py))return;throw new Error("bad point: ZERO")}let{x:S,y:O}=A.toAffine();if(!s.isValid(S)||!s.isValid(O))throw new Error("bad point: x or y not FE");if(!a(S,O))throw new Error("bad point: equation left != right");if(!A.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});class g{constructor(S,O,k){if(S==null||!s.isValid(S))throw new Error("x required");if(O==null||!s.isValid(O)||s.is0(O))throw new Error("y required");if(k==null||!s.isValid(k))throw new Error("z required");this.px=S,this.py=O,this.pz=k,Object.freeze(this)}static fromAffine(S){let{x:O,y:k}=S||{};if(!S||!s.isValid(O)||!s.isValid(k))throw new Error("invalid affine point");if(S instanceof g)throw new Error("projective point not allowed");let D=M=>s.eql(M,s.ZERO);return D(O)&&D(k)?g.ZERO:new g(O,k,s.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(S){let O=qa(s,S.map(k=>k.pz));return S.map((k,D)=>k.toAffine(O[D])).map(g.fromAffine)}static fromHex(S){let O=g.fromAffine(i(dt("pointHex",S)));return O.assertValidity(),O}static fromPrivateKey(S){return g.BASE.multiply(h(S))}static msm(S,O){return Zh(g,r,S,O)}_setWindowSize(S){U.setWindowSize(this,S)}assertValidity(){m(this)}hasEvenY(){let{y:S}=this.toAffine();if(s.isOdd)return!s.isOdd(S);throw new Error("Field doesn't support isOdd")}equals(S){d(S);let{px:O,py:k,pz:D}=this,{px:M,py:P,pz:L}=S,F=s.eql(s.mul(O,L),s.mul(M,D)),C=s.eql(s.mul(k,L),s.mul(P,D));return F&&C}negate(){return new g(this.px,s.neg(this.py),this.pz)}double(){let{a:S,b:O}=e,k=s.mul(O,Ga),{px:D,py:M,pz:P}=this,L=s.ZERO,F=s.ZERO,C=s.ZERO,v=s.mul(D,D),I=s.mul(M,M),y=s.mul(P,P),b=s.mul(D,M);return b=s.add(b,b),C=s.mul(D,P),C=s.add(C,C),L=s.mul(S,C),F=s.mul(k,y),F=s.add(L,F),L=s.sub(I,F),F=s.add(I,F),F=s.mul(L,F),L=s.mul(b,L),C=s.mul(k,C),y=s.mul(S,y),b=s.sub(v,y),b=s.mul(S,b),b=s.add(b,C),C=s.add(v,v),v=s.add(C,v),v=s.add(v,y),v=s.mul(v,b),F=s.add(F,v),y=s.mul(M,P),y=s.add(y,y),v=s.mul(y,b),L=s.sub(L,v),C=s.mul(y,I),C=s.add(C,C),C=s.add(C,C),new g(L,F,C)}add(S){d(S);let{px:O,py:k,pz:D}=this,{px:M,py:P,pz:L}=S,F=s.ZERO,C=s.ZERO,v=s.ZERO,I=e.a,y=s.mul(e.b,Ga),b=s.mul(O,M),_=s.mul(k,P),R=s.mul(D,L),x=s.add(O,k),T=s.add(M,P);x=s.mul(x,T),T=s.add(b,_),x=s.sub(x,T),T=s.add(O,D);let q=s.add(M,L);return T=s.mul(T,q),q=s.add(b,R),T=s.sub(T,q),q=s.add(k,D),F=s.add(P,L),q=s.mul(q,F),F=s.add(_,R),q=s.sub(q,F),v=s.mul(I,T),F=s.mul(y,R),v=s.add(F,v),F=s.sub(_,v),v=s.add(_,v),C=s.mul(F,v),_=s.add(b,b),_=s.add(_,b),R=s.mul(I,R),T=s.mul(y,T),_=s.add(_,R),R=s.sub(b,R),R=s.mul(I,R),T=s.add(T,R),b=s.mul(_,T),C=s.add(C,b),b=s.mul(q,T),F=s.mul(x,F),F=s.sub(F,b),b=s.mul(x,_),v=s.mul(q,v),v=s.add(v,b),new g(F,C,v)}subtract(S){return this.add(S.negate())}is0(){return this.equals(g.ZERO)}wNAF(S){return U.wNAFCached(this,S,g.normalizeZ)}multiplyUnsafe(S){let{endo:O,n:k}=e;hr("scalar",S,Es,k);let D=g.ZERO;if(S===Es)return D;if(this.is0()||S===Ne)return this;if(!O||U.hasPrecomputes(this))return U.wNAFCachedUnsafe(this,S,g.normalizeZ);let{k1neg:M,k1:P,k2neg:L,k2:F}=O.splitScalar(S),C=D,v=D,I=this;for(;P>Es||F>Es;)P&Ne&&(C=C.add(I)),F&Ne&&(v=v.add(I)),I=I.double(),P>>=Ne,F>>=Ne;return M&&(C=C.negate()),L&&(v=v.negate()),v=new g(s.mul(v.px,O.beta),v.py,v.pz),C.add(v)}multiply(S){let{endo:O,n:k}=e;hr("scalar",S,Ne,k);let D,M;if(O){let{k1neg:P,k1:L,k2neg:F,k2:C}=O.splitScalar(S),{p:v,f:I}=this.wNAF(L),{p:y,f:b}=this.wNAF(C);v=U.constTimeNegate(P,v),y=U.constTimeNegate(F,y),y=new g(s.mul(y.px,O.beta),y.py,y.pz),D=v.add(y),M=I.add(b)}else{let{p:P,f:L}=this.wNAF(S);D=P,M=L}return g.normalizeZ([D,M])[0]}multiplyAndAddUnsafe(S,O,k){let D=g.BASE,M=(L,F)=>F===Es||F===Ne||!L.equals(D)?L.multiplyUnsafe(F):L.multiply(F),P=M(this,O).add(M(S,k));return P.is0()?void 0:P}toAffine(S){return p(this,S)}isTorsionFree(){let{h:S,isTorsionFree:O}=e;if(S===Ne)return!0;if(O)return O(g,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){let{h:S,clearCofactor:O}=e;return S===Ne?this:O?O(g,this):this.multiplyUnsafe(e.h)}toRawBytes(S=!0){return qr("isCompressed",S),this.assertValidity(),n(g,this,S)}toHex(S=!0){return qr("isCompressed",S),Mr(this.toRawBytes(S))}}g.BASE=new g(e.Gx,e.Gy,s.ONE),g.ZERO=new g(s.ZERO,s.ONE,s.ZERO);let{endo:w,nBitLength:N}=e,U=Xh(g,w?Math.ceil(N/2):N);return{CURVE:e,ProjectivePoint:g,normPrivateKeyToScalar:h,weierstrassEquation:o,isWithinCurveOrder:u}}function Ly(t){let e=Ka(t);return fr(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze(H({lowS:!0},e))}function Qh(t){let e=Ly(t),{Fp:s,n:r,nByteLength:n,nBitLength:i}=e,o=s.BYTES+1,a=2*s.BYTES+1;function c(y){return je(y,r)}function l(y){return Vi(y,r)}let{ProjectivePoint:u,normPrivateKeyToScalar:h,weierstrassEquation:d,isWithinCurveOrder:p}=Dy(be(H({},e),{toBytes(y,b,_){let R=b.toAffine(),x=s.toBytes(R.x),T=In;return qr("isCompressed",_),_?T(Uint8Array.from([b.hasEvenY()?2:3]),x):T(Uint8Array.from([4]),x,s.toBytes(R.y))},fromBytes(y){let b=y.length,_=y[0],R=y.subarray(1);if(b===o&&(_===2||_===3)){let x=ws(R);if(!Ri(x,Ne,s.ORDER))throw new Error("Point is not on curve");let T=d(x),q;try{q=s.sqrt(T)}catch(W){let V=W instanceof Error?": "+W.message:"";throw new Error("Point is not on curve"+V)}let $=(q&Ne)===Ne;return(_&1)===1!==$&&(q=s.neg(q)),{x,y:q}}else if(b===a&&_===4){let x=s.fromBytes(R.subarray(0,s.BYTES)),T=s.fromBytes(R.subarray(s.BYTES,2*s.BYTES));return{x,y:T}}else{let x=o,T=a;throw new Error("invalid Point, expected length of "+x+", or uncompressed "+T+", got "+b)}}}));function m(y){let b=r>>Ne;return y>b}function g(y){return m(y)?c(-y):y}let w=(y,b,_)=>ws(y.slice(b,_));class N{constructor(b,_,R){hr("r",b,Ne,r),hr("s",_,Ne,r),this.r=b,this.s=_,R!=null&&(this.recovery=R),Object.freeze(this)}static fromCompact(b){let _=n;return b=dt("compactSignature",b,_*2),new N(w(b,0,_),w(b,_,2*_))}static fromDER(b){let{r:_,s:R}=vs.toSig(dt("DER",b));return new N(_,R)}assertValidity(){}addRecoveryBit(b){return new N(this.r,this.s,b)}recoverPublicKey(b){let{r:_,s:R,recovery:x}=this,T=D(dt("msgHash",b));if(x==null||![0,1,2,3].includes(x))throw new Error("recovery id invalid");let q=x===2||x===3?_+e.n:_;if(q>=s.ORDER)throw new Error("recovery id 2 or 3 invalid");let $=x&1?"03":"02",J=u.fromHex($+Wa(q,s.BYTES)),W=l(q),V=c(-T*W),ee=c(R*W),Z=u.BASE.multiplyAndAddUnsafe(J,V,ee);if(!Z)throw new Error("point at infinify");return Z.assertValidity(),Z}hasHighS(){return m(this.s)}normalizeS(){return this.hasHighS()?new N(this.r,c(-this.s),this.recovery):this}toDERRawBytes(){return Sn(this.toDERHex())}toDERHex(){return vs.hexFromSig(this)}toCompactRawBytes(){return Sn(this.toCompactHex())}toCompactHex(){let b=n;return Wa(this.r,b)+Wa(this.s,b)}}let U={isValidPrivateKey(y){try{return h(y),!0}catch{return!1}},normPrivateKeyToScalar:h,randomPrivateKey:()=>{let y=Fa(e.n);return Vh(e.randomBytes(y),e.n)},precompute(y=8,b=u.BASE){return b._setWindowSize(y),b.multiply(BigInt(3)),b}};function A(y,b=!0){return u.fromPrivateKey(y).toRawBytes(b)}function S(y){if(typeof y=="bigint")return!1;if(y instanceof u)return!0;let _=dt("key",y).length,R=s.BYTES,x=R+1,T=2*R+1;if(!(e.allowedPrivateKeyLengths||n===x))return _===x||_===T}function O(y,b,_=!0){if(S(y)===!0)throw new Error("first arg must be private key");if(S(b)===!1)throw new Error("second arg must be public key");return u.fromHex(b).multiply(h(y)).toRawBytes(_)}let k=e.bits2int||function(y){if(y.length>8192)throw new Error("input is too large");let b=ws(y),_=y.length*8-i;return _>0?b>>BigInt(_):b},D=e.bits2int_modN||function(y){return c(k(y))},M=dr(i);function P(y){return hr("num < 2^"+i,y,Es,M),ur(y,n)}function L(y,b,_=F){if(["recovered","canonical"].some(Q=>Q in _))throw new Error("sign() legacy options not supported");let{hash:R,randomBytes:x}=e,{lowS:T,prehash:q,extraEntropy:$}=_;T==null&&(T=!0),y=dt("msgHash",y),Jh(_),q&&(y=dt("prehashed msgHash",R(y)));let J=D(y),W=h(b),V=[P(W),P(J)];if($!=null&&$!==!1){let Q=$===!0?x(s.BYTES):$;V.push(dt("extraEntropy",Q))}let ee=In(...V),Z=J;function de(Q){let fe=k(Q);if(!p(fe))return;let tt=l(fe),at=u.BASE.multiply(fe).toAffine(),st=c(at.x);if(st===Es)return;let Nt=c(tt*c(Z+st*W));if(Nt===Es)return;let ks=(at.x===st?0:2)|Number(at.y&Ne),Fu=Nt;return T&&m(Nt)&&(Fu=g(Nt),ks^=1),new N(st,Fu,ks)}return{seed:ee,k2sig:de}}let F={lowS:e.lowS,prehash:!1},C={lowS:e.lowS,prehash:!1};function v(y,b,_=F){let{seed:R,k2sig:x}=L(y,b,_),T=e;return vh(T.hash.outputLen,T.nByteLength,T.hmac)(R,x)}u.BASE._setWindowSize(8);function I(y,b,_,R=C){let x=y;b=dt("msgHash",b),_=dt("publicKey",_);let{lowS:T,prehash:q,format:$}=R;if(Jh(R),"strict"in R)throw new Error("options.strict was renamed to lowS");if($!==void 0&&$!=="compact"&&$!=="der")throw new Error("format must be compact or der");let J=typeof x=="string"||Lr(x),W=!J&&!$&&typeof x=="object"&&x!==null&&typeof x.r=="bigint"&&typeof x.s=="bigint";if(!J&&!W)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let V,ee;try{if(W&&(V=new N(x.r,x.s)),J){try{$!=="compact"&&(V=N.fromDER(x))}catch(ks){if(!(ks instanceof vs.Err))throw ks}!V&&$!=="der"&&(V=N.fromCompact(x))}ee=u.fromHex(_)}catch{return!1}if(!V||T&&V.hasHighS())return!1;q&&(b=e.hash(b));let{r:Z,s:de}=V,Q=D(b),fe=l(de),tt=c(Q*fe),at=c(Z*fe),st=u.BASE.multiplyAndAddUnsafe(ee,tt,at)?.toAffine();return st?c(st.x)===Z:!1}return{CURVE:e,getPublicKey:A,getSharedSecret:O,sign:v,verify:I,ProjectivePoint:u,Signature:N,utils:U}}function qy(t){return{hash:t,hmac:(e,...s)=>Yu(t,e,Hu(...s)),randomBytes:Vu}}function ed(t,e){let s=r=>Qh(H(H({},t),qy(r)));return be(H({},s(e)),{create:s})}var rd=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),td=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),My=BigInt(0),Fy=BigInt(1),Xa=BigInt(2),sd=(t,e)=>(t+e/Xa)/e;function $y(t){let e=rd,s=BigInt(3),r=BigInt(6),n=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=t*t*t%e,u=l*l*t%e,h=It(u,s,e)*u%e,d=It(h,s,e)*u%e,p=It(d,Xa,e)*l%e,m=It(p,n,e)*p%e,g=It(m,i,e)*m%e,w=It(g,a,e)*g%e,N=It(w,c,e)*w%e,U=It(N,a,e)*g%e,A=It(U,s,e)*u%e,S=It(A,o,e)*m%e,O=It(S,r,e)*l%e,k=It(O,Xa,e);if(!Za.eql(Za.sqr(k),t))throw new Error("Cannot find square root");return k}var Za=Cn(rd,void 0,void 0,{sqrt:$y}),At=ed({a:My,b:BigInt(7),Fp:Za,n:td,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:t=>{let e=td,s=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),r=-Fy*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),n=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=s,o=BigInt("0x100000000000000000000000000000000"),a=sd(i*t,e),c=sd(-r*t,e),l=je(t-a*s-c*n,e),u=je(-a*r-c*i,e),h=l>o,d=u>o;if(h&&(l=e-l),d&&(u=e-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:h,k1:l,k2neg:d,k2:u}}}},Gu);function Xi(t,e={}){let{recovered:s}=e;if(typeof t.r>"u")throw new jr({signature:t});if(typeof t.s>"u")throw new jr({signature:t});if(s&&typeof t.yParity>"u")throw new jr({signature:t});if(t.r<0n||t.r>Da)throw new Wi({value:t.r});if(t.s<0n||t.s>Da)throw new Gi({value:t.s});if(typeof t.yParity=="number"&&t.yParity!==0&&t.yParity!==1)throw new yr({value:t.yParity})}function nd(t){return Ja(xt(t))}function Ja(t){if(t.length!==130&&t.length!==132)throw new Ki({signature:t});let e=BigInt(Kt(t,0,32)),s=BigInt(Kt(t,32,64)),r=(()=>{let n=+`0x${t.slice(130)}`;if(!Number.isNaN(n))try{return Zi(n)}catch{throw new yr({value:n})}})();return typeof r>"u"?{r:e,s}:{r:e,s,yParity:r}}function jy(t){if(!(typeof t.r>"u")&&!(typeof t.s>"u"))return Qa(t)}function Qa(t){let e=typeof t=="string"?Ja(t):t instanceof Uint8Array?nd(t):typeof t.r=="string"?ad(t):t.v?od(t):H({r:t.r,s:t.s},typeof t.yParity<"u"?{yParity:t.yParity}:{});return Xi(e),e}function zy(t){return id(xt(t))}function id(t){let{r:e,s}=At.Signature.fromDER(cs(t).slice(2));return{r:e,s}}function od(t){return{r:t.r,s:t.s,yParity:Zi(t.v)}}function ad(t){let e=(()=>{let s=t.v?Number(t.v):void 0,r=t.yParity?Number(t.yParity):void 0;if(typeof s=="number"&&typeof r!="number"&&(r=Zi(s)),typeof r!="number")throw new yr({value:t.yParity});return r})();return{r:BigInt(t.r),s:BigInt(t.s),yParity:e}}function Hy(t){let[e,s,r]=t;return Qa({r:s==="0x"?0n:BigInt(s),s:r==="0x"?0n:BigInt(r),yParity:e==="0x"?0:Number(e)})}function Vy(t){return Tn(cd(t))}function cd(t){Xi(t);let e=t.r,s=t.s;return Mi(St(e,{size:32}),St(s,{size:32}),typeof t.yParity=="number"?St(ec(t.yParity),{size:1}):"0x")}function Ky(t){return new At.Signature(t.r,t.s).toDERRawBytes()}function Wy(t){return`0x${new At.Signature(t.r,t.s).toDERHex()}`}function Gy(t){return{r:t.r,s:t.s,v:ec(t.yParity)}}function Yy(t){let{r:e,s,yParity:r}=t;return{r:St(e,{size:32}),s:St(s,{size:32}),yParity:r===0?"0x0":"0x1"}}function Xy(t){let{r:e,s,yParity:r}=t;return[r?"0x01":"0x",e===0n?"0x":Aa(St(e)),s===0n?"0x":Aa(St(s))]}function Zy(t,e={}){try{return Xi(t,e),!0}catch{return!1}}function Zi(t){if(t===0||t===27)return 0;if(t===1||t===28)return 1;if(t>=35)return t%2===0?1:0;throw new Yi({value:t})}function ec(t){if(t===0)return 27;if(t===1)return 28;throw new yr({value:t})}var Ki=class extends le{constructor({signature:e}){super(`Value \`${e}\` is an invalid signature size.`,{metaMessages:["Expected: 64 bytes or 65 bytes.",`Received ${Bt(cs(e))} bytes.`]}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSerializedSizeError"})}},jr=class extends le{constructor({signature:e}){super(`Signature \`${Ds(e)}\` is missing either an \`r\`, \`s\`, or \`yParity\` property.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.MissingPropertiesError"})}},Wi=class extends le{constructor({value:e}){super(`Value \`${e}\` is an invalid r value. r must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidRError"})}},Gi=class extends le{constructor({value:e}){super(`Value \`${e}\` is an invalid s value. s must be a positive integer less than 2^256.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidSError"})}},yr=class extends le{constructor({value:e}){super(`Value \`${e}\` is an invalid y-parity value. Y-parity must be 0 or 1.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidYParityError"})}},Yi=class extends le{constructor({value:e}){super(`Value \`${e}\` is an invalid v value. v must be 27, 28 or >=35.`),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"Signature.InvalidVError"})}};function Jy(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function ud(t,e){return Array.isArray(e)?e.length===0?!0:t?e.every(s=>typeof s=="string"):e.every(s=>Number.isSafeInteger(s)):!1}function Qi(t,e){if(typeof e!="string")throw new Error(`${t}: string expected`);return!0}function rc(t){if(!Number.isSafeInteger(t))throw new Error(`invalid integer: ${t}`)}function sc(t){if(!Array.isArray(t))throw new Error("array expected")}function eo(t,e){if(!ud(!0,e))throw new Error(`${t}: array of strings expected`)}function Qy(t,e){if(!ud(!1,e))throw new Error(`${t}: array of numbers expected`)}function ew(...t){let e=i=>i,s=(i,o)=>a=>i(o(a)),r=t.map(i=>i.encode).reduceRight(s,e),n=t.map(i=>i.decode).reduce(s,e);return{encode:r,decode:n}}function tw(t){let e=typeof t=="string"?t.split(""):t,s=e.length;eo("alphabet",e);let r=new Map(e.map((n,i)=>[n,i]));return{encode:n=>(sc(n),n.map(i=>{if(!Number.isSafeInteger(i)||i<0||i>=s)throw new Error(`alphabet.encode: digit index outside alphabet "${i}". Allowed: ${t}`);return e[i]})),decode:n=>(sc(n),n.map(i=>{Qi("alphabet.decode",i);let o=r.get(i);if(o===void 0)throw new Error(`Unknown letter: "${i}". Allowed: ${t}`);return o}))}}function sw(t=""){return Qi("join",t),{encode:e=>(eo("join.decode",e),e.join(t)),decode:e=>(Qi("join.decode",e),e.split(t))}}function rw(t,e="="){return rc(t),Qi("padding",e),{encode(s){for(eo("padding.encode",s);s.length*t%8;)s.push(e);return s},decode(s){eo("padding.decode",s);let r=s.length;if(r*t%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;r>0&&s[r-1]===e;r--)if((r-1)*t%8===0)throw new Error("padding: invalid, string has too much padding");return s.slice(0,r)}}}var hd=(t,e)=>e===0?t:hd(e,t%e),to=(t,e)=>t+(e-hd(t,e)),tc=(()=>{let t=[];for(let e=0;e<40;e++)t.push(2**e);return t})();function ld(t,e,s,r){if(sc(t),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(s<=0||s>32)throw new Error(`convertRadix2: wrong to=${s}`);if(to(e,s)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${s} carryBits=${to(e,s)}`);let n=0,i=0,o=tc[e],a=tc[s]-1,c=[];for(let l of t){if(rc(l),l>=o)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(n=n<<e|l,i+e>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${e}`);for(i+=e;i>=s;i-=s)c.push((n>>i-s&a)>>>0);let u=tc[i];if(u===void 0)throw new Error("invalid carry");n&=u-1}if(n=n<<s-i&a,!r&&i>=e)throw new Error("Excess padding");if(!r&&n>0)throw new Error(`Non-zero padding: ${n}`);return r&&i>0&&c.push(n>>>0),c}function nw(t,e=!1){if(rc(t),t<=0||t>32)throw new Error("radix2: bits should be in (0..32]");if(to(8,t)>32||to(t,8)>32)throw new Error("radix2: carry overflow");return{encode:s=>{if(!Jy(s))throw new Error("radix2.encode input should be Uint8Array");return ld(Array.from(s),8,t,!e)},decode:s=>(Qy("radix2.decode",s),Uint8Array.from(ld(s,t,8,e)))}}var dd=ew(nw(5),tw("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),rw(5),sw(""));var so={};$u(so,{createKeyPair:()=>aw,getPublicKey:()=>pd,getSharedSecret:()=>cw,noble:()=>ow,randomPrivateKey:()=>gd,recoverAddress:()=>md,recoverPublicKey:()=>yd,sign:()=>lw,verify:()=>uw});var fd=!1;var ow=At;function aw(t={}){let{as:e="Hex"}=t,s=gd({as:e}),r=pd({privateKey:s});return{privateKey:s,publicKey:r}}function pd(t){let{privateKey:e}=t,s=At.ProjectivePoint.fromPrivateKey(cs(e).slice(2));return Na(s)}function cw(t){let{as:e="Hex",privateKey:s,publicKey:r}=t,o=At.ProjectivePoint.fromHex(Pn(r).slice(2)).multiply(At.utils.normPrivateKeyToScalar(cs(s).slice(2))).toRawBytes(!0);return e==="Hex"?xt(o):o}function gd(t={}){let{as:e="Hex"}=t,s=At.utils.randomPrivateKey();return e==="Hex"?xt(s):s}function md(t){return Bh(yd(t))}function yd(t){let{payload:e,signature:s}=t,{r,s:n,yParity:i}=s,a=new At.Signature(BigInt(r),BigInt(n)).addRecoveryBit(i).recoverPublicKey(cs(e).substring(2));return Na(a)}function lw(t){let{extraEntropy:e=fd,hash:s,payload:r,privateKey:n}=t,{r:i,s:o,recovery:a}=At.sign($r(r),$r(n),H({extraEntropy:typeof e=="boolean"?e:cs(e).slice(2),lowS:!0},s?{prehash:!0}:{}));return{r:i,s:o,yParity:a}}function uw(t){let{address:e,hash:s,payload:r,publicKey:n,signature:i}=t;return e?Dh(e,md({payload:r,signature:i})):At.verify(i,$r(r),kh(n),...s?[{prehash:!0,lowS:!0}]:[])}function hw(t){if(t.length>=255)throw new TypeError("Alphabet too long");let e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<t.length;l++){let u=t.charAt(l),h=u.charCodeAt(0);if(e[h]!==255)throw new TypeError(u+" is ambiguous");e[h]=l}let s=t.length,r=t.charAt(0),n=Math.log(s)/Math.log(256),i=Math.log(256)/Math.log(s);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let u=0,h=0,d=0,p=l.length;for(;d!==p&&l[d]===0;)d++,u++;let m=(p-d)*i+1>>>0,g=new Uint8Array(m);for(;d!==p;){let U=l[d],A=0;for(let S=m-1;(U!==0||A<h)&&S!==-1;S--,A++)U+=256*g[S]>>>0,g[S]=U%s>>>0,U=U/s>>>0;if(U!==0)throw new Error("Non-zero carry");h=A,d++}let w=m-h;for(;w!==m&&g[w]===0;)w++;let N=r.repeat(u);for(;w<m;++w)N+=t.charAt(g[w]);return N}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let u=0,h=0,d=0;for(;l[u]===r;)h++,u++;let p=(l.length-u)*n+1>>>0,m=new Uint8Array(p);for(;u<l.length;){let U=l.charCodeAt(u);if(U>255)return;let A=e[U];if(A===255)return;let S=0;for(let O=p-1;(A!==0||S<d)&&O!==-1;O--,S++)A+=s*m[O]>>>0,m[O]=A%256>>>0,A=A/256>>>0;if(A!==0)throw new Error("Non-zero carry");d=S,u++}let g=p-d;for(;g!==p&&m[g]===0;)g++;let w=new Uint8Array(h+(p-g)),N=h;for(;g!==p;)w[N++]=m[g++];return w}function c(l){let u=a(l);if(u)return u;throw new Error("Non-base"+s+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var wd=hw;var dw="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",zr=wd(dw);function bd(t){let e=t.length,s=0,r=0;for(;r<e;){let n=t.charCodeAt(r++);if(n&4294967168)if(!(n&4294965248))s+=2;else{if(n>=55296&&n<=56319&&r<e){let i=t.charCodeAt(r);(i&64512)===56320&&(++r,n=((n&1023)<<10)+(i&1023)+65536)}n&4294901760?s+=4:s+=3}else{s++;continue}}return s}function fw(t,e,s){let r=t.length,n=s,i=0;for(;i<r;){let o=t.charCodeAt(i++);if(o&4294967168)if(!(o&4294965248))e[n++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&i<r){let a=t.charCodeAt(i);(a&64512)===56320&&(++i,o=((o&1023)<<10)+(a&1023)+65536)}o&4294901760?(e[n++]=o>>18&7|240,e[n++]=o>>12&63|128,e[n++]=o>>6&63|128):(e[n++]=o>>12&15|224,e[n++]=o>>6&63|128)}else{e[n++]=o;continue}e[n++]=o&63|128}}var pw=new TextEncoder,gw=50;function mw(t,e,s){pw.encodeInto(t,e.subarray(s))}function vd(t,e,s){t.length>gw?mw(t,e,s):fw(t,e,s)}var yw=4096;function nc(t,e,s){let r=e,n=r+s,i=[],o="";for(;r<n;){let a=t[r++];if(!(a&128))i.push(a);else if((a&224)===192){let c=t[r++]&63;i.push((a&31)<<6|c)}else if((a&240)===224){let c=t[r++]&63,l=t[r++]&63;i.push((a&31)<<12|c<<6|l)}else if((a&248)===240){let c=t[r++]&63,l=t[r++]&63,u=t[r++]&63,h=(a&7)<<18|c<<12|l<<6|u;h>65535&&(h-=65536,i.push(h>>>10&1023|55296),h=56320|h&1023),i.push(h)}else i.push(a);i.length>=yw&&(o+=String.fromCharCode(...i),i.length=0)}return i.length>0&&(o+=String.fromCharCode(...i)),o}var ww=new TextDecoder,bw=200;function vw(t,e,s){let r=t.subarray(e,e+s);return ww.decode(r)}function Ed(t,e,s){return s>bw?vw(t,e,s):nc(t,e,s)}var wr=class{constructor(e,s){this.type=e,this.data=s}};var ft=class t extends Error{constructor(e){super(e);let s=Object.create(t.prototype);Object.setPrototypeOf(this,s),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:t.name})}};function xd(t,e,s){let r=s/4294967296,n=s;t.setUint32(e,r),t.setUint32(e+4,n)}function ro(t,e,s){let r=Math.floor(s/4294967296),n=s;t.setUint32(e,r),t.setUint32(e+4,n)}function no(t,e){let s=t.getInt32(e),r=t.getUint32(e+4);return s*4294967296+r}function Sd(t,e){let s=t.getUint32(e),r=t.getUint32(e+4);return s*4294967296+r}var Ew=-1,xw=4294967296-1,Sw=17179869184-1;function Iw({sec:t,nsec:e}){if(t>=0&&e>=0&&t<=Sw)if(e===0&&t<=xw){let s=new Uint8Array(4);return new DataView(s.buffer).setUint32(0,t),s}else{let s=t/4294967296,r=t&4294967295,n=new Uint8Array(8),i=new DataView(n.buffer);return i.setUint32(0,e<<2|s&3),i.setUint32(4,r),n}else{let s=new Uint8Array(12),r=new DataView(s.buffer);return r.setUint32(0,e),ro(r,4,t),s}}function Aw(t){let e=t.getTime(),s=Math.floor(e/1e3),r=(e-s*1e3)*1e6,n=Math.floor(r/1e9);return{sec:s+n,nsec:r-n*1e9}}function _w(t){if(t instanceof Date){let e=Aw(t);return Iw(e)}else return null}function Tw(t){let e=new DataView(t.buffer,t.byteOffset,t.byteLength);switch(t.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{let s=e.getUint32(0),r=e.getUint32(4),n=(s&3)*4294967296+r,i=s>>>2;return{sec:n,nsec:i}}case 12:{let s=no(e,4),r=e.getUint32(0);return{sec:s,nsec:r}}default:throw new ft(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${t.length}`)}}function Pw(t){let e=Tw(t);return new Date(e.sec*1e3+e.nsec/1e6)}var Id={type:Ew,encode:_w,decode:Pw};var Ls=class{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(Id)}register({type:e,encode:s,decode:r}){if(e>=0)this.encoders[e]=s,this.decoders[e]=r;else{let n=-1-e;this.builtInEncoders[n]=s,this.builtInDecoders[n]=r}}tryToEncode(e,s){for(let r=0;r<this.builtInEncoders.length;r++){let n=this.builtInEncoders[r];if(n!=null){let i=n(e,s);if(i!=null){let o=-1-r;return new wr(o,i)}}}for(let r=0;r<this.encoders.length;r++){let n=this.encoders[r];if(n!=null){let i=n(e,s);if(i!=null){let o=r;return new wr(o,i)}}}return e instanceof wr?e:null}decode(e,s,r){let n=s<0?this.builtInDecoders[-1-s]:this.decoders[s];return n?n(e,s,r):new wr(s,e)}};Ls.defaultCodec=new Ls;function Cw(t){return t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer}function On(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Cw(t)?new Uint8Array(t):Uint8Array.from(t)}var Ow=100,Rw=2048,io=class t{constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??Ls.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??Ow,this.initialBufferSize=e?.initialBufferSize??Rw,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new t({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,s){if(s>this.maxDepth)throw new Error(`Too deep objects in depth ${s}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,s)}ensureBufferSizeToWrite(e){let s=this.pos+e;this.view.byteLength<s&&this.resizeBuffer(s*2)}resizeBuffer(e){let s=new ArrayBuffer(e),r=new Uint8Array(s),n=new DataView(s);r.set(this.bytes),this.view=n,this.bytes=r}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){let r=bd(e);this.ensureBufferSizeToWrite(5+r),this.writeStringHeader(r),vd(e,this.bytes,this.pos),this.pos+=r}encodeObject(e,s){let r=this.extensionCodec.tryToEncode(e,this.context);if(r!=null)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,s);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,s);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){let s=e.byteLength;if(s<256)this.writeU8(196),this.writeU8(s);else if(s<65536)this.writeU8(197),this.writeU16(s);else if(s<4294967296)this.writeU8(198),this.writeU32(s);else throw new Error(`Too large binary: ${s}`);let r=On(e);this.writeU8a(r)}encodeArray(e,s){let r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else if(r<4294967296)this.writeU8(221),this.writeU32(r);else throw new Error(`Too large array: ${r}`);for(let n of e)this.doEncode(n,s+1)}countWithoutUndefined(e,s){let r=0;for(let n of s)e[n]!==void 0&&r++;return r}encodeMap(e,s){let r=Object.keys(e);this.sortKeys&&r.sort();let n=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(n<16)this.writeU8(128+n);else if(n<65536)this.writeU8(222),this.writeU16(n);else if(n<4294967296)this.writeU8(223),this.writeU32(n);else throw new Error(`Too large map object: ${n}`);for(let i of r){let o=e[i];this.ignoreUndefined&&o===void 0||(this.encodeString(i),this.doEncode(o,s+1))}}encodeExtension(e){if(typeof e.data=="function"){let r=e.data(this.pos+6),n=r.length;if(n>=4294967296)throw new Error(`Too large extension object: ${n}`);this.writeU8(201),this.writeU32(n),this.writeI8(e.type),this.writeU8a(r);return}let s=e.data.length;if(s===1)this.writeU8(212);else if(s===2)this.writeU8(213);else if(s===4)this.writeU8(214);else if(s===8)this.writeU8(215);else if(s===16)this.writeU8(216);else if(s<256)this.writeU8(199),this.writeU8(s);else if(s<65536)this.writeU8(200),this.writeU16(s);else if(s<4294967296)this.writeU8(201),this.writeU32(s);else throw new Error(`Too large extension object: ${s}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){let s=e.length;this.ensureBufferSizeToWrite(s),this.bytes.set(e,this.pos),this.pos+=s}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),xd(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),ro(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function ic(t,e){return new io(e).encodeSharedRef(t)}function oo(t){return`${t<0?"-":""}0x${Math.abs(t).toString(16).padStart(2,"0")}`}var Nw=16,kw=16,ao=class{constructor(e=Nw,s=kw){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=s,this.caches=[];for(let r=0;r<this.maxKeyLength;r++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,s,r){let n=this.caches[r-1];e:for(let i of n){let o=i.bytes;for(let a=0;a<r;a++)if(o[a]!==e[s+a])continue e;return i.str}return null}store(e,s){let r=this.caches[e.length-1],n={bytes:e,str:s};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=n:r.push(n)}decode(e,s,r){let n=this.find(e,s,r);if(n!=null)return this.hit++,n;this.miss++;let i=nc(e,s,r),o=Uint8Array.prototype.slice.call(e,s,s+r);return this.store(o,i),i}};var oc="array",kn="map_key",_d="map_value",Uw=t=>{if(typeof t=="string"||typeof t=="number")return t;throw new ft("The type of key must be string or number but "+typeof t)},ac=class{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){let s=this.getUninitializedStateFromPool();s.type=oc,s.position=0,s.size=e,s.array=new Array(e)}pushMapState(e){let s=this.getUninitializedStateFromPool();s.type=kn,s.readCount=0,s.size=e,s.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){let e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===oc){let r=e;r.size=0,r.array=void 0,r.position=0,r.type=void 0}if(e.type===kn||e.type===_d){let r=e;r.size=0,r.map=void 0,r.readCount=0,r.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}},Nn=-1,cc=new DataView(new ArrayBuffer(0)),Bw=new Uint8Array(cc.buffer);try{cc.getInt8(0)}catch(t){if(!(t instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}var Ad=new RangeError("Insufficient data"),Dw=new ao,co=class t{constructor(e){this.totalPos=0,this.pos=0,this.view=cc,this.bytes=Bw,this.headByte=Nn,this.stack=new ac,this.entered=!1,this.extensionCodec=e?.extensionCodec??Ls.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??4294967295,this.maxBinLength=e?.maxBinLength??4294967295,this.maxArrayLength=e?.maxArrayLength??4294967295,this.maxMapLength=e?.maxMapLength??4294967295,this.maxExtLength=e?.maxExtLength??4294967295,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:Dw,this.mapKeyConverter=e?.mapKeyConverter??Uw}clone(){return new t({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=Nn,this.stack.reset()}setBuffer(e){let s=On(e);this.bytes=s,this.view=new DataView(s.buffer,s.byteOffset,s.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===Nn&&!this.hasRemaining(1))this.setBuffer(e);else{let s=this.bytes.subarray(this.pos),r=On(e),n=new Uint8Array(s.length+r.length);n.set(s),n.set(r,s.length),this.setBuffer(n)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){let{view:s,pos:r}=this;return new RangeError(`Extra ${s.byteLength-r} of ${s.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);let s=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return s}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){let s=this.clone();yield*sa(s.decodeMulti(e));return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}decodeAsync(e){return f(this,null,function*(){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let o=!1,a;try{for(var s=ra(e),r,n,i;r=!(n=yield s.next()).done;r=!1){let h=n.value;if(o)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(h);try{a=this.doDecodeSync(),o=!0}catch(d){if(!(d instanceof RangeError))throw d}this.totalPos+=this.pos}}catch{i=[n]}finally{try{r&&(n=s.return)&&(yield n.call(s))}finally{if(i)throw i[0]}}if(o){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return a}let{headByte:c,pos:l,totalPos:u}=this;throw new RangeError(`Insufficient data in parsing ${oo(c)} at ${u} (${l} in the current buffer)`)}finally{this.entered=!1}})}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}decodeMultiAsync(e,s){return ju(this,null,function*(){if(this.entered){let a=this.clone();yield*sa(a.decodeMultiAsync(e,s));return}try{this.entered=!0;let a=s,c=-1;try{for(var r=ra(e),n,i,o;n=!(i=yield new ta(r.next())).done;n=!1){let l=i.value;if(s&&c===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(l),a&&(c=this.readArraySize(),a=!1,this.complete());try{for(;yield this.doDecodeSync(),--c!==0;);}catch(u){if(!(u instanceof RangeError))throw u}this.totalPos+=this.pos}}catch{o=[i]}finally{try{n&&(i=r.return)&&(yield new ta(i.call(r)))}finally{if(o)throw o[0]}}}finally{this.entered=!1}})}doDecodeSync(){e:for(;;){let e=this.readHeadByte(),s;if(e>=224)s=e-256;else if(e<192)if(e<128)s=e;else if(e<144){let n=e-128;if(n!==0){this.pushMapState(n),this.complete();continue e}else s={}}else if(e<160){let n=e-144;if(n!==0){this.pushArrayState(n),this.complete();continue e}else s=[]}else{let n=e-160;s=this.decodeString(n,0)}else if(e===192)s=null;else if(e===194)s=!1;else if(e===195)s=!0;else if(e===202)s=this.readF32();else if(e===203)s=this.readF64();else if(e===204)s=this.readU8();else if(e===205)s=this.readU16();else if(e===206)s=this.readU32();else if(e===207)this.useBigInt64?s=this.readU64AsBigInt():s=this.readU64();else if(e===208)s=this.readI8();else if(e===209)s=this.readI16();else if(e===210)s=this.readI32();else if(e===211)this.useBigInt64?s=this.readI64AsBigInt():s=this.readI64();else if(e===217){let n=this.lookU8();s=this.decodeString(n,1)}else if(e===218){let n=this.lookU16();s=this.decodeString(n,2)}else if(e===219){let n=this.lookU32();s=this.decodeString(n,4)}else if(e===220){let n=this.readU16();if(n!==0){this.pushArrayState(n),this.complete();continue e}else s=[]}else if(e===221){let n=this.readU32();if(n!==0){this.pushArrayState(n),this.complete();continue e}else s=[]}else if(e===222){let n=this.readU16();if(n!==0){this.pushMapState(n),this.complete();continue e}else s={}}else if(e===223){let n=this.readU32();if(n!==0){this.pushMapState(n),this.complete();continue e}else s={}}else if(e===196){let n=this.lookU8();s=this.decodeBinary(n,1)}else if(e===197){let n=this.lookU16();s=this.decodeBinary(n,2)}else if(e===198){let n=this.lookU32();s=this.decodeBinary(n,4)}else if(e===212)s=this.decodeExtension(1,0);else if(e===213)s=this.decodeExtension(2,0);else if(e===214)s=this.decodeExtension(4,0);else if(e===215)s=this.decodeExtension(8,0);else if(e===216)s=this.decodeExtension(16,0);else if(e===199){let n=this.lookU8();s=this.decodeExtension(n,1)}else if(e===200){let n=this.lookU16();s=this.decodeExtension(n,2)}else if(e===201){let n=this.lookU32();s=this.decodeExtension(n,4)}else throw new ft(`Unrecognized type byte: ${oo(e)}`);this.complete();let r=this.stack;for(;r.length>0;){let n=r.top();if(n.type===oc)if(n.array[n.position]=s,n.position++,n.position===n.size)s=n.array,r.release(n);else continue e;else if(n.type===kn){if(s==="__proto__")throw new ft("The key __proto__ is not allowed");n.key=this.mapKeyConverter(s),n.type=_d;continue e}else if(n.map[n.key]=s,n.readCount++,n.readCount===n.size)s=n.map,r.release(n);else{n.key=null,n.type=kn;continue e}}return s}}readHeadByte(){return this.headByte===Nn&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=Nn}readArraySize(){let e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new ft(`Unrecognized array type byte: ${oo(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new ft(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new ft(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,s){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,s):this.decodeBinary(e,s)}decodeUtf8String(e,s){if(e>this.maxStrLength)throw new ft(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+s+e)throw Ad;let r=this.pos+s,n;return this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?n=this.keyDecoder.decode(this.bytes,r,e):n=Ed(this.bytes,r,e),this.pos+=s+e,n}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===kn:!1}decodeBinary(e,s){if(e>this.maxBinLength)throw new ft(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+s))throw Ad;let r=this.pos+s,n=this.bytes.subarray(r,r+e);return this.pos+=s+e,n}decodeExtension(e,s){if(e>this.maxExtLength)throw new ft(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);let r=this.view.getInt8(this.pos+s),n=this.decodeBinary(e,s+1);return this.extensionCodec.decode(n,r,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){let e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){let e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){let e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){let e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){let e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){let e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){let e=Sd(this.view,this.pos);return this.pos+=8,e}readI64(){let e=no(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){let e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){let e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){let e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){let e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function lc(t,e){return new co(e).decode(t)}function br(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Un(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?br(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function vr(t,e){e||(e=t.reduce((n,i)=>n+i.length,0));let s=Un(e),r=0;for(let n of t)s.set(n,r),r+=n.length;return br(s)}function Pd(t,e,s,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:s},decoder:{decode:r}}}var Td=Pd("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),uc=Pd("ascii","a",t=>{let e="a";for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return e},t=>{t=t.substring(1);let e=Un(t.length);for(let s=0;s<t.length;s++)e[s]=t.charCodeAt(s);return e}),Lw=H({utf8:Td,"utf-8":Td,hex:ca.base16,latin1:uc,ascii:uc,binary:uc},ca),lo=Lw;function pt(t,e="utf8"){let s=lo[e];if(!s)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?br(globalThis.Buffer.from(t,"utf-8")):s.decoder.decode(`${s.prefix}${t}`)}function Be(t,e="utf8"){let s=lo[e];if(!s)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):s.encoder.encode(t).substring(1)}var Rf=zt(Gd(),1);var Ww=":";function Qt(t){let[e,s]=t.split(Ww);return{namespace:e,reference:s}}function Nf(t,e){return t.includes(":")?[t]:e.chains||[]}var Gw=Object.defineProperty,Yw=Object.defineProperties,Xw=Object.getOwnPropertyDescriptors,Yd=Object.getOwnPropertySymbols,Zw=Object.prototype.hasOwnProperty,Jw=Object.prototype.propertyIsEnumerable,_c=(t,e,s)=>e in t?Gw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Xd=(t,e)=>{for(var s in e||(e={}))Zw.call(e,s)&&_c(t,s,e[s]);if(Yd)for(var s of Yd(e))Jw.call(e,s)&&_c(t,s,e[s]);return t},Qw=(t,e)=>Yw(t,Xw(e)),Zd=(t,e,s)=>_c(t,typeof e!="symbol"?e+"":e,s),e0="ReactNative",mt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"};var t0="js";function Kn(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Ps(){return!(0,Zt.getDocument)()&&!!(0,Zt.getNavigator)()&&navigator.product===e0}function kf(){return Ps()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function Uf(){return Ps()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function _r(){return!Kn()&&!!(0,Zt.getNavigator)()&&!!(0,Zt.getDocument)()}function Wn(){return Ps()?mt.reactNative:Kn()?mt.node:_r()?mt.browser:mt.unknown}function Kc(){var t;try{return Ps()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function s0(t,e){let s=new URLSearchParams(t);return Object.entries(e).sort(([r],[n])=>r.localeCompare(n)).forEach(([r,n])=>{n!=null&&s.set(r,String(n))}),s.toString()}function Bf(t){var e,s;let r=Wc();try{return t!=null&&t.url&&r.url&&new URL(t.url).host!==new URL(r.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${t.url} differs from the actual page url:${r.url}. This is probably unintended and can lead to issues.`),t.url=r.url),(e=t?.icons)!=null&&e.length&&t.icons.length>0&&(t.icons=t.icons.filter(n=>n!=="")),Qw(Xd(Xd({},r),t),{url:t?.url||r.url,name:t?.name||r.name,description:t?.description||r.description,icons:(s=t?.icons)!=null&&s.length&&t.icons.length>0?t.icons:r.icons})}catch(n){return console.warn("Error populating app metadata",n),t||r}}function Wc(){return(0,Of.getWindowMetadata)()||{name:"",description:"",url:"",icons:[""]}}function r0(){if(Wn()===mt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){let{OS:s,Version:r}=global.Platform;return[s,r].join("-")}let t=ih();if(t===null)return"unknown";let e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function n0(){var t;let e=Wn();return e===mt.browser?[e,((t=(0,Zt.getLocation)())==null?void 0:t.host)||"unknown"].join(":"):e}function Gc(t,e,s){let r=r0(),n=n0();return[[t,e].join("-"),[t0,s].join("-"),r,n].join("/")}function Df({protocol:t,version:e,relayUrl:s,sdkVersion:r,auth:n,projectId:i,useOnCloseEvent:o,bundleId:a,packageName:c}){let l=s.split("?"),u=Gc(t,e,r),h={auth:n,ua:u,projectId:i,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},d=s0(l[1]||"",h);return l[0]+"?"+d}function Er(t,e){return t.filter(s=>e.includes(s)).length===t.length}function Po(t){return Object.fromEntries(t.entries())}function Co(t){return new Map(Object.entries(t))}function Cs(t=_s.FIVE_MINUTES,e){let s=(0,_s.toMiliseconds)(t||_s.FIVE_MINUTES),r,n,i,o;return{resolve:a=>{i&&r&&(clearTimeout(i),r(a),o=Promise.resolve(a))},reject:a=>{i&&n&&(clearTimeout(i),n(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);i=setTimeout(()=>{let l=new Error(e);o=Promise.reject(l),c(l)},s),r=a,n=c})}}function es(t,e,s){return new Promise((r,n)=>f(this,null,function*(){let i=setTimeout(()=>n(new Error(s)),e);try{let o=yield t;r(o)}catch(o){n(o)}clearTimeout(i)}))}function Lf(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function qf(t){return Lf("topic",t)}function Mf(t){return Lf("id",t)}function Oo(t){let[e,s]=t.split(":"),r={id:void 0,topic:void 0};if(e==="topic"&&typeof s=="string")r.topic=s;else if(e==="id"&&Number.isInteger(Number(s)))r.id=Number(s);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${s}`);return r}function xe(t,e){return(0,_s.fromMiliseconds)((e||Date.now())+(0,_s.toMiliseconds)(t))}function Tt(t){return Date.now()>=(0,_s.toMiliseconds)(t)}function ue(t,e){return`${t}${e?`:${e}`:""}`}function Yt(t=[],e=[]){return[...new Set([...t,...e])]}function Ff(r){return f(this,arguments,function*({id:t,topic:e,wcDeepLink:s}){var n;try{if(!s)return;let i=typeof s=="string"?JSON.parse(s):s,o=i?.href;if(typeof o!="string")return;let a=i0(o,t,e),c=Wn();if(c===mt.browser){if(!((n=(0,Zt.getDocument)())!=null&&n.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}o0(a)}else c===mt.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&(yield global.Linking.openURL(a))}catch(i){console.error(i)}})}function i0(t,e,s){let r=`requestId=${e}&sessionTopic=${s}`;t.endsWith("/")&&(t=t.slice(0,-1));let n=`${t}`;if(t.startsWith("https://t.me")){let i=t.includes("?")?"&startapp=":"?startapp=";n=`${n}${i}${l0(r,!0)}`}else n=`${n}/wc?${r}`;return n}function o0(t){let e="_self";c0()?e="_top":(a0()||t.startsWith("https://")||t.startsWith("http://"))&&(e="_blank"),window.open(t,e,"noreferrer noopener")}function $f(t,e){return f(this,null,function*(){let s="";try{if(_r()&&(s=localStorage.getItem(e),s))return s;s=yield t.getItem(e)}catch(r){console.error(r)}return s})}function Yc(t,e){if(!t.includes(e))return null;let s=t.split(/([&,?,=])/),r=s.indexOf(e);return s[r+2]}function Xc(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,t=>{let e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function Gn(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function a0(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function c0(){try{return window.self!==window.top}catch{return!1}}function l0(t,e=!1){let s=Buffer.from(t).toString("base64");return e?s.replace(/[=]/g,""):s}function jf(t){return Buffer.from(t,"base64").toString("utf-8")}function zf(t){return new Promise(e=>setTimeout(e,t))}var vo=class{constructor({limit:e}){Zd(this,"limit"),Zd(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){let s=this.set.values().next().value;s&&this.set.delete(s)}this.set.add(e)}}has(e){return this.set.has(e)}},go=BigInt(2**32-1),Jd=BigInt(32);function Hf(t,e=!1){return e?{h:Number(t&go),l:Number(t>>Jd&go)}:{h:Number(t>>Jd&go)|0,l:Number(t&go)|0}}function Vf(t,e=!1){let s=t.length,r=new Uint32Array(s),n=new Uint32Array(s);for(let i=0;i<s;i++){let{h:o,l:a}=Hf(t[i],e);[r[i],n[i]]=[o,a]}return[r,n]}var Qd=(t,e,s)=>t>>>s,ef=(t,e,s)=>t<<32-s|e>>>s,Ws=(t,e,s)=>t>>>s|e<<32-s,Gs=(t,e,s)=>t<<32-s|e>>>s,Fn=(t,e,s)=>t<<64-s|e>>>s-32,$n=(t,e,s)=>t>>>s-32|e<<64-s,u0=(t,e)=>e,h0=(t,e)=>t,d0=(t,e,s)=>t<<s|e>>>32-s,f0=(t,e,s)=>e<<s|t>>>32-s,p0=(t,e,s)=>e<<s-32|t>>>64-s,g0=(t,e,s)=>t<<s-32|e>>>64-s;function Gt(t,e,s,r){let n=(e>>>0)+(r>>>0);return{h:t+s+(n/2**32|0)|0,l:n|0}}var Zc=(t,e,s)=>(t>>>0)+(e>>>0)+(s>>>0),Jc=(t,e,s,r)=>e+s+r+(t/2**32|0)|0,m0=(t,e,s,r)=>(t>>>0)+(e>>>0)+(s>>>0)+(r>>>0),y0=(t,e,s,r,n)=>e+s+r+n+(t/2**32|0)|0,w0=(t,e,s,r,n)=>(t>>>0)+(e>>>0)+(s>>>0)+(r>>>0)+(n>>>0),b0=(t,e,s,r,n,i)=>e+s+r+n+i+(t/2**32|0)|0,Hr=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Ro(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function Ts(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function Jt(t,...e){if(!Ro(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function No(t){if(typeof t!="function"||typeof t.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Ts(t.outputLen),Ts(t.blockLen)}function Js(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function Qc(t,e){Jt(t);let s=e.outputLen;if(t.length<s)throw new Error("digestInto() expects output buffer of length at least "+s)}function zn(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Dt(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function pc(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function ls(t,e){return t<<32-e|t>>>e}var Kf=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Wf(t){return t<<24&4278190080|t<<8&16711680|t>>>8&65280|t>>>24&255}var Ss=Kf?t=>t:t=>Wf(t);function v0(t){for(let e=0;e<t.length;e++)t[e]=Wf(t[e]);return t}var Ys=Kf?t=>t:v0,Gf=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",E0=Array.from({length:256},(t,e)=>e.toString(16).padStart(2,"0"));function Wr(t){if(Jt(t),Gf)return t.toHex();let e="";for(let s=0;s<t.length;s++)e+=E0[t[s]];return e}var xs={_0:48,_9:57,A:65,F:70,a:97,f:102};function tf(t){if(t>=xs._0&&t<=xs._9)return t-xs._0;if(t>=xs.A&&t<=xs.F)return t-(xs.A-10);if(t>=xs.a&&t<=xs.f)return t-(xs.a-10)}function Eo(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);if(Gf)return Uint8Array.fromHex(t);let e=t.length,s=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let r=new Uint8Array(s);for(let n=0,i=0;n<s;n++,i+=2){let o=tf(t.charCodeAt(i)),a=tf(t.charCodeAt(i+1));if(o===void 0||a===void 0){let c=t[i]+t[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}r[n]=o*16+a}return r}function Yf(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Xt(t){return typeof t=="string"&&(t=Yf(t)),Jt(t),t}function Xs(...t){let e=0;for(let r=0;r<t.length;r++){let n=t[r];Jt(n),e+=n.length}let s=new Uint8Array(e);for(let r=0,n=0;r<t.length;r++){let i=t[r];s.set(i,n),n+=i.length}return s}var Yr=class{};function Yn(t){let e=r=>t().update(Xt(r)).digest(),s=t();return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=()=>t(),e}function x0(t){let e=(r,n)=>t(n).update(Xt(r)).digest(),s=t({});return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=r=>t(r),e}function Tr(t=32){if(Hr&&typeof Hr.getRandomValues=="function")return Hr.getRandomValues(new Uint8Array(t));if(Hr&&typeof Hr.randomBytes=="function")return Uint8Array.from(Hr.randomBytes(t));throw new Error("crypto.getRandomValues must be defined")}var S0=BigInt(0),qn=BigInt(1),I0=BigInt(2),A0=BigInt(7),_0=BigInt(256),T0=BigInt(113),Xf=[],Zf=[],Jf=[];for(let t=0,e=qn,s=1,r=0;t<24;t++){[s,r]=[r,(2*s+3*r)%5],Xf.push(2*(5*r+s)),Zf.push((t+1)*(t+2)/2%64);let n=S0;for(let i=0;i<7;i++)e=(e<<qn^(e>>A0)*T0)%_0,e&I0&&(n^=qn<<(qn<<BigInt(i))-qn);Jf.push(n)}var Qf=Vf(Jf,!0),P0=Qf[0],C0=Qf[1],sf=(t,e,s)=>s>32?p0(t,e,s):d0(t,e,s),rf=(t,e,s)=>s>32?g0(t,e,s):f0(t,e,s);function O0(t,e=24){let s=new Uint32Array(10);for(let r=24-e;r<24;r++){for(let o=0;o<10;o++)s[o]=t[o]^t[o+10]^t[o+20]^t[o+30]^t[o+40];for(let o=0;o<10;o+=2){let a=(o+8)%10,c=(o+2)%10,l=s[c],u=s[c+1],h=sf(l,u,1)^s[a],d=rf(l,u,1)^s[a+1];for(let p=0;p<50;p+=10)t[o+p]^=h,t[o+p+1]^=d}let n=t[2],i=t[3];for(let o=0;o<24;o++){let a=Zf[o],c=sf(n,i,a),l=rf(n,i,a),u=Xf[o];n=t[u],i=t[u+1],t[u]=c,t[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)s[a]=t[o+a];for(let a=0;a<10;a++)t[o+a]^=~s[(a+2)%10]&s[(a+4)%10]}t[0]^=P0[r],t[1]^=C0[r]}Dt(s)}var Tc=class t extends Yr{constructor(e,s,r,n=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=s,this.outputLen=r,this.enableXOF=n,this.rounds=i,Ts(r),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=zn(this.state)}clone(){return this._cloneInto()}keccak(){Ys(this.state32),O0(this.state32,this.rounds),Ys(this.state32),this.posOut=0,this.pos=0}update(e){Js(this),e=Xt(e),Jt(e);let{blockLen:s,state:r}=this,n=e.length;for(let i=0;i<n;){let o=Math.min(s-this.pos,n-i);for(let a=0;a<o;a++)r[this.pos++]^=e[i++];this.pos===s&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:s,pos:r,blockLen:n}=this;e[r]^=s,s&128&&r===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){Js(this,!1),Jt(e),this.finish();let s=this.state,{blockLen:r}=this;for(let n=0,i=e.length;n<i;){this.posOut>=r&&this.keccak();let o=Math.min(r-this.posOut,i-n);e.set(s.subarray(this.posOut,this.posOut+o),n),this.posOut+=o,n+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Ts(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Qc(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Dt(this.state)}_cloneInto(e){let{blockLen:s,suffix:r,outputLen:n,rounds:i,enableXOF:o}=this;return e||(e=new t(s,r,n,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=r,e.outputLen=n,e.enableXOF=o,e.destroyed=this.destroyed,e}},R0=(t,e,s)=>Yn(()=>new Tc(e,t,s)),N0=R0(1,136,256/8);function k0(t,e,s,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,s,r);let n=BigInt(32),i=BigInt(4294967295),o=Number(s>>n&i),a=Number(s&i),c=r?4:0,l=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+l,a,r)}function U0(t,e,s){return t&e^~t&s}function B0(t,e,s){return t&e^t&s^e&s}var xo=class extends Yr{constructor(e,s,r,n){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=s,this.padOffset=r,this.isLE=n,this.buffer=new Uint8Array(e),this.view=pc(this.buffer)}update(e){Js(this),e=Xt(e),Jt(e);let{view:s,buffer:r,blockLen:n}=this,i=e.length;for(let o=0;o<i;){let a=Math.min(n-this.pos,i-o);if(a===n){let c=pc(e);for(;n<=i-o;o+=n)this.process(c,o);continue}r.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(s,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Js(this),Qc(e,this),this.finished=!0;let{buffer:s,view:r,blockLen:n,isLE:i}=this,{pos:o}=this;s[o++]=128,Dt(this.buffer.subarray(o)),this.padOffset>n-o&&(this.process(r,0),o=0);for(let h=o;h<n;h++)s[h]=0;k0(r,n-8,BigInt(this.length*8),i),this.process(r,0);let a=pc(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],i)}digest(){let{buffer:e,outputLen:s}=this;this.digestInto(e);let r=e.slice(0,s);return this.destroy(),r}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:s,buffer:r,length:n,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=n,e.pos=a,n%s&&e.buffer.set(r),e}clone(){return this._cloneInto()}},$s=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Ke=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),We=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),D0=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),js=new Uint32Array(64),Pc=class extends xo{constructor(e=32){super(64,e,8,!1),this.A=$s[0]|0,this.B=$s[1]|0,this.C=$s[2]|0,this.D=$s[3]|0,this.E=$s[4]|0,this.F=$s[5]|0,this.G=$s[6]|0,this.H=$s[7]|0}get(){let{A:e,B:s,C:r,D:n,E:i,F:o,G:a,H:c}=this;return[e,s,r,n,i,o,a,c]}set(e,s,r,n,i,o,a,c){this.A=e|0,this.B=s|0,this.C=r|0,this.D=n|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,s){for(let h=0;h<16;h++,s+=4)js[h]=e.getUint32(s,!1);for(let h=16;h<64;h++){let d=js[h-15],p=js[h-2],m=ls(d,7)^ls(d,18)^d>>>3,g=ls(p,17)^ls(p,19)^p>>>10;js[h]=g+js[h-7]+m+js[h-16]|0}let{A:r,B:n,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){let d=ls(a,6)^ls(a,11)^ls(a,25),p=u+d+U0(a,c,l)+D0[h]+js[h]|0,m=(ls(r,2)^ls(r,13)^ls(r,22))+B0(r,n,i)|0;u=l,l=c,c=a,a=o+p|0,o=i,i=n,n=r,r=p+m|0}r=r+this.A|0,n=n+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(r,n,i,o,a,c,l,u)}roundClean(){Dt(js)}destroy(){this.set(0,0,0,0,0,0,0,0),Dt(this.buffer)}},ep=Vf(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(t=>BigInt(t))),L0=ep[0],q0=ep[1],zs=new Uint32Array(80),Hs=new Uint32Array(80),Hn=class extends xo{constructor(e=64){super(128,e,16,!1),this.Ah=We[0]|0,this.Al=We[1]|0,this.Bh=We[2]|0,this.Bl=We[3]|0,this.Ch=We[4]|0,this.Cl=We[5]|0,this.Dh=We[6]|0,this.Dl=We[7]|0,this.Eh=We[8]|0,this.El=We[9]|0,this.Fh=We[10]|0,this.Fl=We[11]|0,this.Gh=We[12]|0,this.Gl=We[13]|0,this.Hh=We[14]|0,this.Hl=We[15]|0}get(){let{Ah:e,Al:s,Bh:r,Bl:n,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:d,Gh:p,Gl:m,Hh:g,Hl:w}=this;return[e,s,r,n,i,o,a,c,l,u,h,d,p,m,g,w]}set(e,s,r,n,i,o,a,c,l,u,h,d,p,m,g,w){this.Ah=e|0,this.Al=s|0,this.Bh=r|0,this.Bl=n|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=d|0,this.Gh=p|0,this.Gl=m|0,this.Hh=g|0,this.Hl=w|0}process(e,s){for(let A=0;A<16;A++,s+=4)zs[A]=e.getUint32(s),Hs[A]=e.getUint32(s+=4);for(let A=16;A<80;A++){let S=zs[A-15]|0,O=Hs[A-15]|0,k=Ws(S,O,1)^Ws(S,O,8)^Qd(S,O,7),D=Gs(S,O,1)^Gs(S,O,8)^ef(S,O,7),M=zs[A-2]|0,P=Hs[A-2]|0,L=Ws(M,P,19)^Fn(M,P,61)^Qd(M,P,6),F=Gs(M,P,19)^$n(M,P,61)^ef(M,P,6),C=m0(D,F,Hs[A-7],Hs[A-16]),v=y0(C,k,L,zs[A-7],zs[A-16]);zs[A]=v|0,Hs[A]=C|0}let{Ah:r,Al:n,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:d,Fh:p,Fl:m,Gh:g,Gl:w,Hh:N,Hl:U}=this;for(let A=0;A<80;A++){let S=Ws(h,d,14)^Ws(h,d,18)^Fn(h,d,41),O=Gs(h,d,14)^Gs(h,d,18)^$n(h,d,41),k=h&p^~h&g,D=d&m^~d&w,M=w0(U,O,D,q0[A],Hs[A]),P=b0(M,N,S,k,L0[A],zs[A]),L=M|0,F=Ws(r,n,28)^Fn(r,n,34)^Fn(r,n,39),C=Gs(r,n,28)^$n(r,n,34)^$n(r,n,39),v=r&i^r&a^i&a,I=n&o^n&c^o&c;N=g|0,U=w|0,g=p|0,w=m|0,p=h|0,m=d|0,{h,l:d}=Gt(l|0,u|0,P|0,L|0),l=a|0,u=c|0,a=i|0,c=o|0,i=r|0,o=n|0;let y=Zc(L,C,I);r=Jc(y,P,F,v),n=y|0}({h:r,l:n}=Gt(this.Ah|0,this.Al|0,r|0,n|0)),{h:i,l:o}=Gt(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=Gt(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Gt(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:d}=Gt(this.Eh|0,this.El|0,h|0,d|0),{h:p,l:m}=Gt(this.Fh|0,this.Fl|0,p|0,m|0),{h:g,l:w}=Gt(this.Gh|0,this.Gl|0,g|0,w|0),{h:N,l:U}=Gt(this.Hh|0,this.Hl|0,N|0,U|0),this.set(r,n,i,o,a,c,l,u,h,d,p,m,g,w,N,U)}roundClean(){Dt(zs,Hs)}destroy(){Dt(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Cc=class extends Hn{constructor(){super(48),this.Ah=Ke[0]|0,this.Al=Ke[1]|0,this.Bh=Ke[2]|0,this.Bl=Ke[3]|0,this.Ch=Ke[4]|0,this.Cl=Ke[5]|0,this.Dh=Ke[6]|0,this.Dl=Ke[7]|0,this.Eh=Ke[8]|0,this.El=Ke[9]|0,this.Fh=Ke[10]|0,this.Fl=Ke[11]|0,this.Gh=Ke[12]|0,this.Gl=Ke[13]|0,this.Hh=Ke[14]|0,this.Hl=Ke[15]|0}},Ge=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]),Oc=class extends Hn{constructor(){super(32),this.Ah=Ge[0]|0,this.Al=Ge[1]|0,this.Bh=Ge[2]|0,this.Bl=Ge[3]|0,this.Ch=Ge[4]|0,this.Cl=Ge[5]|0,this.Dh=Ge[6]|0,this.Dl=Ge[7]|0,this.Eh=Ge[8]|0,this.El=Ge[9]|0,this.Fh=Ge[10]|0,this.Fl=Ge[11]|0,this.Gh=Ge[12]|0,this.Gl=Ge[13]|0,this.Hh=Ge[14]|0,this.Hl=Ge[15]|0}},ko=Yn(()=>new Pc),M0=Yn(()=>new Hn),F0=Yn(()=>new Cc),$0=Yn(()=>new Oc),j0=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Oe=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),z=new Uint32Array(32);function Vs(t,e,s,r,n,i){let o=n[i],a=n[i+1],c=z[2*t],l=z[2*t+1],u=z[2*e],h=z[2*e+1],d=z[2*s],p=z[2*s+1],m=z[2*r],g=z[2*r+1],w=Zc(c,u,o);l=Jc(w,l,h,a),c=w|0,{Dh:g,Dl:m}={Dh:g^l,Dl:m^c},{Dh:g,Dl:m}={Dh:u0(g,m),Dl:h0(g)},{h:p,l:d}=Gt(p,d,g,m),{Bh:h,Bl:u}={Bh:h^p,Bl:u^d},{Bh:h,Bl:u}={Bh:Ws(h,u,24),Bl:Gs(h,u,24)},z[2*t]=c,z[2*t+1]=l,z[2*e]=u,z[2*e+1]=h,z[2*s]=d,z[2*s+1]=p,z[2*r]=m,z[2*r+1]=g}function Ks(t,e,s,r,n,i){let o=n[i],a=n[i+1],c=z[2*t],l=z[2*t+1],u=z[2*e],h=z[2*e+1],d=z[2*s],p=z[2*s+1],m=z[2*r],g=z[2*r+1],w=Zc(c,u,o);l=Jc(w,l,h,a),c=w|0,{Dh:g,Dl:m}={Dh:g^l,Dl:m^c},{Dh:g,Dl:m}={Dh:Ws(g,m,16),Dl:Gs(g,m,16)},{h:p,l:d}=Gt(p,d,g,m),{Bh:h,Bl:u}={Bh:h^p,Bl:u^d},{Bh:h,Bl:u}={Bh:Fn(h,u,63),Bl:$n(h,u,63)},z[2*t]=c,z[2*t+1]=l,z[2*e]=u,z[2*e+1]=h,z[2*s]=d,z[2*s+1]=p,z[2*r]=m,z[2*r+1]=g}function z0(t,e={},s,r,n){if(Ts(s),t<0||t>s)throw new Error("outputLen bigger than keyLen");let{key:i,salt:o,personalization:a}=e;if(i!==void 0&&(i.length<1||i.length>s))throw new Error("key length must be undefined or 1.."+s);if(o!==void 0&&o.length!==r)throw new Error("salt must be undefined or "+r);if(a!==void 0&&a.length!==n)throw new Error("personalization must be undefined or "+n)}var Rc=class extends Yr{constructor(e,s){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,Ts(e),Ts(s),this.blockLen=e,this.outputLen=s,this.buffer=new Uint8Array(e),this.buffer32=zn(this.buffer)}update(e){Js(this),e=Xt(e),Jt(e);let{blockLen:s,buffer:r,buffer32:n}=this,i=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<i;){this.pos===s&&(Ys(n),this.compress(n,0,!1),Ys(n),this.pos=0);let l=Math.min(s-this.pos,i-c),u=o+c;if(l===s&&!(u%4)&&c+l<i){let h=new Uint32Array(a,u,Math.floor((i-c)/4));Ys(h);for(let d=0;c+s<i;d+=n.length,c+=s)this.length+=s,this.compress(h,d,!1);Ys(h);continue}r.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){Js(this),Qc(e,this);let{pos:s,buffer32:r}=this;this.finished=!0,Dt(this.buffer.subarray(s)),Ys(r),this.compress(r,0,!0),Ys(r);let n=zn(e);this.get().forEach((i,o)=>n[o]=Ss(i))}digest(){let{buffer:e,outputLen:s}=this;this.digestInto(e);let r=e.slice(0,s);return this.destroy(),r}_cloneInto(e){let{buffer:s,length:r,finished:n,destroyed:i,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(s),e.destroyed=i,e.finished=n,e.length=r,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}},Nc=class extends Rc{constructor(e={}){let s=e.dkLen===void 0?64:e.dkLen;super(128,s),this.v0l=Oe[0]|0,this.v0h=Oe[1]|0,this.v1l=Oe[2]|0,this.v1h=Oe[3]|0,this.v2l=Oe[4]|0,this.v2h=Oe[5]|0,this.v3l=Oe[6]|0,this.v3h=Oe[7]|0,this.v4l=Oe[8]|0,this.v4h=Oe[9]|0,this.v5l=Oe[10]|0,this.v5h=Oe[11]|0,this.v6l=Oe[12]|0,this.v6h=Oe[13]|0,this.v7l=Oe[14]|0,this.v7h=Oe[15]|0,z0(s,e,64,16,16);let{key:r,personalization:n,salt:i}=e,o=0;if(r!==void 0&&(r=Xt(r),o=r.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,i!==void 0){i=Xt(i);let a=zn(i);this.v4l^=Ss(a[0]),this.v4h^=Ss(a[1]),this.v5l^=Ss(a[2]),this.v5h^=Ss(a[3])}if(n!==void 0){n=Xt(n);let a=zn(n);this.v6l^=Ss(a[0]),this.v6h^=Ss(a[1]),this.v7l^=Ss(a[2]),this.v7h^=Ss(a[3])}if(r!==void 0){let a=new Uint8Array(this.blockLen);a.set(r),this.update(a)}}get(){let{v0l:e,v0h:s,v1l:r,v1h:n,v2l:i,v2h:o,v3l:a,v3h:c,v4l:l,v4h:u,v5l:h,v5h:d,v6l:p,v6h:m,v7l:g,v7h:w}=this;return[e,s,r,n,i,o,a,c,l,u,h,d,p,m,g,w]}set(e,s,r,n,i,o,a,c,l,u,h,d,p,m,g,w){this.v0l=e|0,this.v0h=s|0,this.v1l=r|0,this.v1h=n|0,this.v2l=i|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=u|0,this.v5l=h|0,this.v5h=d|0,this.v6l=p|0,this.v6h=m|0,this.v7l=g|0,this.v7h=w|0}compress(e,s,r){this.get().forEach((c,l)=>z[l]=c),z.set(Oe,16);let{h:n,l:i}=Hf(BigInt(this.length));z[24]=Oe[8]^i,z[25]=Oe[9]^n,r&&(z[28]=~z[28],z[29]=~z[29]);let o=0,a=j0;for(let c=0;c<12;c++)Vs(0,4,8,12,e,s+2*a[o++]),Ks(0,4,8,12,e,s+2*a[o++]),Vs(1,5,9,13,e,s+2*a[o++]),Ks(1,5,9,13,e,s+2*a[o++]),Vs(2,6,10,14,e,s+2*a[o++]),Ks(2,6,10,14,e,s+2*a[o++]),Vs(3,7,11,15,e,s+2*a[o++]),Ks(3,7,11,15,e,s+2*a[o++]),Vs(0,5,10,15,e,s+2*a[o++]),Ks(0,5,10,15,e,s+2*a[o++]),Vs(1,6,11,12,e,s+2*a[o++]),Ks(1,6,11,12,e,s+2*a[o++]),Vs(2,7,8,13,e,s+2*a[o++]),Ks(2,7,8,13,e,s+2*a[o++]),Vs(3,4,9,14,e,s+2*a[o++]),Ks(3,4,9,14,e,s+2*a[o++]);this.v0l^=z[0]^z[16],this.v0h^=z[1]^z[17],this.v1l^=z[2]^z[18],this.v1h^=z[3]^z[19],this.v2l^=z[4]^z[20],this.v2h^=z[5]^z[21],this.v3l^=z[6]^z[22],this.v3h^=z[7]^z[23],this.v4l^=z[8]^z[24],this.v4h^=z[9]^z[25],this.v5l^=z[10]^z[26],this.v5h^=z[11]^z[27],this.v6l^=z[12]^z[28],this.v6h^=z[13]^z[29],this.v7l^=z[14]^z[30],this.v7h^=z[15]^z[31],Dt(z)}destroy(){this.destroyed=!0,Dt(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},H0=x0(t=>new Nc(t)),V0="https://rpc.walletconnect.org/v1";function tp(t){let e=`Ethereum Signed Message:
${t.length}`,s=new TextEncoder().encode(e+t);return"0x"+Buffer.from(N0(s)).toString("hex")}function K0(t,e,s,r,n,i){return f(this,null,function*(){switch(s.t){case"eip191":return yield W0(t,e,s.s);case"eip1271":return yield G0(t,e,s.s,r,n,i);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${s.t}`)}})}function W0(t,e,s){let r=Ji.fromHex(s);return so.recoverAddress({payload:tp(e),signature:r}).toLowerCase()===t.toLowerCase()}function G0(t,e,s,r,n,i){return f(this,null,function*(){let o=Qt(r);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${r}`);try{let a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l=s.substring(2),u=(l.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:tp(e)).substring(2),d=a+h+c+u+l,p=yield fetch(`${i||V0}/?chainId=${r}&projectId=${n}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:Y0(),jsonrpc:"2.0",method:"eth_call",params:[{to:t,data:d},"latest"]})}),{result:m}=yield p.json();return m?m.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}})}function Y0(){return Date.now()+Math.floor(Math.random()*1e3)}function sp(t){let e=atob(t),s=new Uint8Array(e.length);for(let o=0;o<e.length;o++)s[o]=e.charCodeAt(o);let r=s[0];if(r===0)throw new Error("No signatures found");let n=1+r*64;if(s.length<n)throw new Error("Transaction data too short for claimed signature count");if(s.length<100)throw new Error("Transaction too short");let i=Buffer.from(t,"base64").slice(1,65);return zr.encode(i)}function rp(t){let e=new Uint8Array(Buffer.from(t,"base64")),s=Array.from("TransactionData::").map(i=>i.charCodeAt(0)),r=new Uint8Array(s.length+e.length);r.set(s),r.set(e,s.length);let n=H0(r,{dkLen:32});return zr.encode(n)}function el(t){let e=new Uint8Array(ko(X0(t)));return zr.encode(e)}function X0(t){if(t instanceof Uint8Array)return t;if(Array.isArray(t))return new Uint8Array(t);if(typeof t=="object"&&t!=null&&t.data)return new Uint8Array(Object.values(t.data));if(typeof t=="object"&&t)return new Uint8Array(Object.values(t));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function tl(t){let e=Buffer.from(t,"base64"),s=lc(e).txn;if(!s)throw new Error("Invalid signed transaction: missing 'txn' field");let r=ic(s),n=Buffer.from("TX"),i=Buffer.concat([n,Buffer.from(r)]),o=$0(i);return dd.encode(o).replace(/=+$/,"")}function gc(t){let e=[],s=BigInt(t);for(;s>=BigInt(128);)e.push(Number(s&BigInt(127)|BigInt(128))),s>>=BigInt(7);return e.push(Number(s)),Buffer.from(e)}function np(t){let e=Buffer.from(t.signed.bodyBytes,"base64"),s=Buffer.from(t.signed.authInfoBytes,"base64"),r=Buffer.from(t.signature.signature,"base64"),n=[];n.push(Buffer.from([10])),n.push(gc(e.length)),n.push(e),n.push(Buffer.from([18])),n.push(gc(s.length)),n.push(s),n.push(Buffer.from([26])),n.push(gc(r.length)),n.push(r);let i=Buffer.concat(n),o=ko(i);return Buffer.from(o).toString("hex").toUpperCase()}function ip(t){var e,s;let r=[];try{if(typeof t=="string")return r.push(t),r;if(typeof t!="object")return r;t!=null&&t.id&&r.push(t.id);let n=(s=(e=t?.capabilities)==null?void 0:e.caip345)==null?void 0:s.transactionHashes;n&&r.push(...n)}catch(n){console.warn("getWalletSendCallsHashes failed: ",n)}return r}var Z0=Object.defineProperty,J0=Object.defineProperties,Q0=Object.getOwnPropertyDescriptors,nf=Object.getOwnPropertySymbols,eb=Object.prototype.hasOwnProperty,tb=Object.prototype.propertyIsEnumerable,of=(t,e,s)=>e in t?Z0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,sb=(t,e)=>{for(var s in e||(e={}))eb.call(e,s)&&of(t,s,e[s]);if(nf)for(var s of nf(e))tb.call(e,s)&&of(t,s,e[s]);return t},rb=(t,e)=>J0(t,Q0(e)),op="did:pkh:",nb={eip155:"Ethereum",solana:"Solana",bip122:"Bitcoin"},ib=t=>t?nb[t]||t:"",Uo=t=>t?.split(":"),ob=t=>{let e=t&&Uo(t);if(e)return t.includes(op)?e[3]:e[1]},ab=t=>{let e=t&&Uo(t);if(e)return t.includes(op)?e[2]:e[0]},Bo=t=>{let e=t&&Uo(t);if(e)return e[2]+":"+e[3]},Xn=t=>{let e=t&&Uo(t);if(e)return e.pop()};function sl(t){return f(this,null,function*(){let{cacao:e,projectId:s}=t,{s:r,p:n}=e,i=rl(n,n.iss),o=Xn(n.iss);return yield K0(o,i,r,Bo(n.iss),s)})}var rl=(t,e)=>{let s=ab(e);if(!s)throw new Error("Invalid issuer: "+e);let r=`${t.domain} wants you to sign in with your ${ib(s)} account:`,n=Xn(e);if(!t.aud&&!t.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let i=t.statement||void 0,o=`URI: ${t.aud||t.uri}`,a=`Version: ${t.version}`,c=`Chain ID: ${ob(e)}`,l=`Nonce: ${t.nonce}`,u=`Issued At: ${t.iat}`,h=t.exp?`Expiration Time: ${t.exp}`:void 0,d=t.nbf?`Not Before: ${t.nbf}`:void 0,p=t.requestId?`Request ID: ${t.requestId}`:void 0,m=t.resources?`Resources:${t.resources.map(w=>`
- ${w}`).join("")}`:void 0,g=Zn(t.resources);if(g){let w=Vn(g);i=pb(i,w)}return[r,n,"",i,"",o,a,c,l,u,h,d,p,m].filter(w=>w!=null).join(`
`)};function cb(t){return Buffer.from(JSON.stringify(t)).toString("base64")}function lb(t){return JSON.parse(Buffer.from(t,"base64").toString("utf-8"))}function Ar(t){if(!t)throw new Error("No recap provided, value is undefined");if(!t.att)throw new Error("No `att` property found");let e=Object.keys(t.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(s=>{let r=t.att[s];if(Array.isArray(r))throw new Error(`Resource must be an object: ${s}`);if(typeof r!="object")throw new Error(`Resource must be an object: ${s}`);if(!Object.keys(r).length)throw new Error(`Resource object is empty: ${s}`);Object.keys(r).forEach(n=>{let i=r[n];if(!Array.isArray(i))throw new Error(`Ability limits ${n} must be an array of objects, found: ${i}`);if(!i.length)throw new Error(`Value of ${n} is empty array, must be an array with objects`);i.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${n}) must be an array of objects, found: ${o}`)})})})}function ub(t,e,s,r={}){return s?.sort((n,i)=>n.localeCompare(i)),{att:{[t]:hb(e,s,r)}}}function hb(t,e,s={}){e=e?.sort((n,i)=>n.localeCompare(i));let r=e.map(n=>({[`${t}/${n}`]:[s]}));return Object.assign({},...r)}function ap(t){return Ar(t),`urn:recap:${cb(t).replace(/=/g,"")}`}function Vn(t){let e=lb(t.replace("urn:recap:",""));return Ar(e),e}function cp(t,e,s){let r=ub(t,e,s);return ap(r)}function db(t){return t&&t.includes("urn:recap:")}function lp(t,e){let s=Vn(t),r=Vn(e),n=fb(s,r);return ap(n)}function fb(t,e){Ar(t),Ar(e);let s=Object.keys(t.att).concat(Object.keys(e.att)).sort((n,i)=>n.localeCompare(i)),r={att:{}};return s.forEach(n=>{var i,o;Object.keys(((i=t.att)==null?void 0:i[n])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[n])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;r.att[n]=rb(sb({},r.att[n]),{[a]:((c=t.att[n])==null?void 0:c[a])||((l=e.att[n])==null?void 0:l[a])})})}),r}function pb(t="",e){Ar(e);let s="I further authorize the stated URI to perform the following actions on my behalf: ";if(t.includes(s))return t;let r=[],n=0;Object.keys(e.att).forEach(a=>{let c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,d)=>h.action.localeCompare(d.action));let l={};c.forEach(h=>{l[h.ability]||(l[h.ability]=[]),l[h.ability].push(h.action)});let u=Object.keys(l).map(h=>(n++,`(${n}) '${h}': '${l[h].join("', '")}' for '${a}'.`));r.push(u.join(", ").replace(".,","."))});let i=r.join(" "),o=`${s}${i}`;return`${t?t+" ":""}${o}`}function nl(t){var e;let s=Vn(t);Ar(s);let r=(e=s.att)==null?void 0:e.eip155;return r?Object.keys(r).map(n=>n.split("/")[1]):[]}function il(t){let e=Vn(t);Ar(e);let s=[];return Object.values(e.att).forEach(r=>{Object.values(r).forEach(n=>{var i;(i=n?.[0])!=null&&i.chains&&s.push(n[0].chains)})}),[...new Set(s.flat())]}function Zn(t){if(!t)return;let e=t?.[t.length-1];return db(e)?e:void 0}function up(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&t.constructor.name==="Uint8Array"}function kc(t){if(typeof t!="boolean")throw new Error(`boolean expected, not ${t}`)}function mc(t){if(!Number.isSafeInteger(t)||t<0)throw new Error("positive integer expected, got "+t)}function gt(t,...e){if(!up(t))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(t.length))throw new Error("Uint8Array expected of length "+e+", got length="+t.length)}function af(t,e=!0){if(t.destroyed)throw new Error("Hash instance has been destroyed");if(e&&t.finished)throw new Error("Hash#digest() has already been called")}function gb(t,e){gt(t);let s=e.outputLen;if(t.length<s)throw new Error("digestInto() expects output buffer of length at least "+s)}function Zs(t){return new Uint32Array(t.buffer,t.byteOffset,Math.floor(t.byteLength/4))}function Xr(...t){for(let e=0;e<t.length;e++)t[e].fill(0)}function mb(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}var yb=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function wb(t){if(typeof t!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(t))}function Uc(t){if(typeof t=="string")t=wb(t);else if(up(t))t=Bc(t);else throw new Error("Uint8Array expected, got "+typeof t);return t}function bb(t,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(t,e)}function vb(t,e){if(t.length!==e.length)return!1;let s=0;for(let r=0;r<t.length;r++)s|=t[r]^e[r];return s===0}var Eb=(t,e)=>{function s(r,...n){if(gt(r),!yb)throw new Error("Non little-endian hardware is not yet supported");if(t.nonceLength!==void 0){let l=n[0];if(!l)throw new Error("nonce / iv required");t.varSizeNonce?gt(l):gt(l,t.nonceLength)}let i=t.tagLength;i&&n[1]!==void 0&&gt(n[1]);let o=e(r,...n),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");gt(u)}},c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,gt(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(gt(l),i&&l.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(s,t),s};function cf(t,e,s=!0){if(e===void 0)return new Uint8Array(t);if(e.length!==t)throw new Error("invalid output length, expected "+t+", got: "+e.length);if(s&&!Sb(e))throw new Error("invalid output, must be aligned");return e}function lf(t,e,s,r){if(typeof t.setBigUint64=="function")return t.setBigUint64(e,s,r);let n=BigInt(32),i=BigInt(4294967295),o=Number(s>>n&i),a=Number(s&i),c=r?4:0,l=r?0:4;t.setUint32(e+c,o,r),t.setUint32(e+l,a,r)}function xb(t,e,s){kc(s);let r=new Uint8Array(16),n=mb(r);return lf(n,0,BigInt(e),s),lf(n,8,BigInt(t),s),r}function Sb(t){return t.byteOffset%4===0}function Bc(t){return Uint8Array.from(t)}var hp=t=>Uint8Array.from(t.split("").map(e=>e.charCodeAt(0))),Ib=hp("expand 16-byte k"),Ab=hp("expand 32-byte k"),_b=Zs(Ib),Tb=Zs(Ab);function ae(t,e){return t<<e|t>>>32-e}function Dc(t){return t.byteOffset%4===0}var mo=64,Pb=16,dp=2**32-1,uf=new Uint32Array;function Cb(t,e,s,r,n,i,o,a){let c=n.length,l=new Uint8Array(mo),u=Zs(l),h=Dc(n)&&Dc(i),d=h?Zs(n):uf,p=h?Zs(i):uf;for(let m=0;m<c;o++){if(t(e,s,r,u,o,a),o>=dp)throw new Error("arx: counter overflow");let g=Math.min(mo,c-m);if(h&&g===mo){let w=m/4;if(m%4!==0)throw new Error("arx: invalid block position");for(let N=0,U;N<Pb;N++)U=w+N,p[U]=d[U]^u[N];m+=mo;continue}for(let w=0,N;w<g;w++)N=m+w,i[N]=n[N]^l[w];m+=g}}function Ob(t,e){let{allowShortKeys:s,extendNonceFn:r,counterLength:n,counterRight:i,rounds:o}=bb({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof t!="function")throw new Error("core must be a function");return mc(n),mc(o),kc(i),kc(s),(a,c,l,u,h=0)=>{gt(a),gt(c),gt(l);let d=l.length;if(u===void 0&&(u=new Uint8Array(d)),gt(u),mc(h),h<0||h>=dp)throw new Error("arx: counter overflow");if(u.length<d)throw new Error(`arx: output (${u.length}) is shorter than data (${d})`);let p=[],m=a.length,g,w;if(m===32)p.push(g=Bc(a)),w=Tb;else if(m===16&&s)g=new Uint8Array(32),g.set(a),g.set(a,16),w=_b,p.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${m}`);Dc(c)||p.push(c=Bc(c));let N=Zs(g);if(r){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");r(w,N,Zs(c.subarray(0,16)),N),c=c.subarray(16)}let U=16-n;if(U!==c.length)throw new Error(`arx: nonce must be ${U} or 16 bytes`);if(U!==12){let S=new Uint8Array(12);S.set(c,i?0:12-c.length),c=S,p.push(c)}let A=Zs(c);return Cb(t,w,N,A,l,u,h,o),Xr(...p),u}}var Le=(t,e)=>t[e++]&255|(t[e++]&255)<<8,Lc=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=Uc(e),gt(e,32);let s=Le(e,0),r=Le(e,2),n=Le(e,4),i=Le(e,6),o=Le(e,8),a=Le(e,10),c=Le(e,12),l=Le(e,14);this.r[0]=s&8191,this.r[1]=(s>>>13|r<<3)&8191,this.r[2]=(r>>>10|n<<6)&7939,this.r[3]=(n>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Le(e,16+2*u)}process(e,s,r=!1){let n=r?0:2048,{h:i,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],d=o[5],p=o[6],m=o[7],g=o[8],w=o[9],N=Le(e,s+0),U=Le(e,s+2),A=Le(e,s+4),S=Le(e,s+6),O=Le(e,s+8),k=Le(e,s+10),D=Le(e,s+12),M=Le(e,s+14),P=i[0]+(N&8191),L=i[1]+((N>>>13|U<<3)&8191),F=i[2]+((U>>>10|A<<6)&8191),C=i[3]+((A>>>7|S<<9)&8191),v=i[4]+((S>>>4|O<<12)&8191),I=i[5]+(O>>>1&8191),y=i[6]+((O>>>14|k<<2)&8191),b=i[7]+((k>>>11|D<<5)&8191),_=i[8]+((D>>>8|M<<8)&8191),R=i[9]+(M>>>5|n),x=0,T=x+P*a+L*(5*w)+F*(5*g)+C*(5*m)+v*(5*p);x=T>>>13,T&=8191,T+=I*(5*d)+y*(5*h)+b*(5*u)+_*(5*l)+R*(5*c),x+=T>>>13,T&=8191;let q=x+P*c+L*a+F*(5*w)+C*(5*g)+v*(5*m);x=q>>>13,q&=8191,q+=I*(5*p)+y*(5*d)+b*(5*h)+_*(5*u)+R*(5*l),x+=q>>>13,q&=8191;let $=x+P*l+L*c+F*a+C*(5*w)+v*(5*g);x=$>>>13,$&=8191,$+=I*(5*m)+y*(5*p)+b*(5*d)+_*(5*h)+R*(5*u),x+=$>>>13,$&=8191;let J=x+P*u+L*l+F*c+C*a+v*(5*w);x=J>>>13,J&=8191,J+=I*(5*g)+y*(5*m)+b*(5*p)+_*(5*d)+R*(5*h),x+=J>>>13,J&=8191;let W=x+P*h+L*u+F*l+C*c+v*a;x=W>>>13,W&=8191,W+=I*(5*w)+y*(5*g)+b*(5*m)+_*(5*p)+R*(5*d),x+=W>>>13,W&=8191;let V=x+P*d+L*h+F*u+C*l+v*c;x=V>>>13,V&=8191,V+=I*a+y*(5*w)+b*(5*g)+_*(5*m)+R*(5*p),x+=V>>>13,V&=8191;let ee=x+P*p+L*d+F*h+C*u+v*l;x=ee>>>13,ee&=8191,ee+=I*c+y*a+b*(5*w)+_*(5*g)+R*(5*m),x+=ee>>>13,ee&=8191;let Z=x+P*m+L*p+F*d+C*h+v*u;x=Z>>>13,Z&=8191,Z+=I*l+y*c+b*a+_*(5*w)+R*(5*g),x+=Z>>>13,Z&=8191;let de=x+P*g+L*m+F*p+C*d+v*h;x=de>>>13,de&=8191,de+=I*u+y*l+b*c+_*a+R*(5*w),x+=de>>>13,de&=8191;let Q=x+P*w+L*g+F*m+C*p+v*d;x=Q>>>13,Q&=8191,Q+=I*h+y*u+b*l+_*c+R*a,x+=Q>>>13,Q&=8191,x=(x<<2)+x|0,x=x+T|0,T=x&8191,x=x>>>13,q+=x,i[0]=T,i[1]=q,i[2]=$,i[3]=J,i[4]=W,i[5]=V,i[6]=ee,i[7]=Z,i[8]=de,i[9]=Q}finalize(){let{h:e,pad:s}=this,r=new Uint16Array(10),n=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=n,n=e[a]>>>13,e[a]&=8191;e[0]+=n*5,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,r[0]=e[0]+5,n=r[0]>>>13,r[0]&=8191;for(let a=1;a<10;a++)r[a]=e[a]+n,n=r[a]>>>13,r[a]&=8191;r[9]-=8192;let i=(n^1)-1;for(let a=0;a<10;a++)r[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|r[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+s[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+s[a]|0)+(o>>>16)|0,e[a]=o&65535;Xr(r)}update(e){af(this),e=Uc(e),gt(e);let{buffer:s,blockLen:r}=this,n=e.length;for(let i=0;i<n;){let o=Math.min(r-this.pos,n-i);if(o===r){for(;r<=n-i;i+=r)this.process(e,i);continue}s.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===r&&(this.process(s,0,!1),this.pos=0)}return this}destroy(){Xr(this.h,this.r,this.buffer,this.pad)}digestInto(e){af(this),gb(e,this),this.finished=!0;let{buffer:s,h:r}=this,{pos:n}=this;if(n){for(s[n++]=1;n<16;n++)s[n]=0;this.process(s,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)e[i++]=r[o]>>>0,e[i++]=r[o]>>>8;return e}digest(){let{buffer:e,outputLen:s}=this;this.digestInto(e);let r=e.slice(0,s);return this.destroy(),r}};function Rb(t){let e=(r,n)=>t(n).update(Uc(r)).digest(),s=t(new Uint8Array(32));return e.outputLen=s.outputLen,e.blockLen=s.blockLen,e.create=r=>t(r),e}var Nb=Rb(t=>new Lc(t));function kb(t,e,s,r,n,i=20){let o=t[0],a=t[1],c=t[2],l=t[3],u=e[0],h=e[1],d=e[2],p=e[3],m=e[4],g=e[5],w=e[6],N=e[7],U=n,A=s[0],S=s[1],O=s[2],k=o,D=a,M=c,P=l,L=u,F=h,C=d,v=p,I=m,y=g,b=w,_=N,R=U,x=A,T=S,q=O;for(let J=0;J<i;J+=2)k=k+L|0,R=ae(R^k,16),I=I+R|0,L=ae(L^I,12),k=k+L|0,R=ae(R^k,8),I=I+R|0,L=ae(L^I,7),D=D+F|0,x=ae(x^D,16),y=y+x|0,F=ae(F^y,12),D=D+F|0,x=ae(x^D,8),y=y+x|0,F=ae(F^y,7),M=M+C|0,T=ae(T^M,16),b=b+T|0,C=ae(C^b,12),M=M+C|0,T=ae(T^M,8),b=b+T|0,C=ae(C^b,7),P=P+v|0,q=ae(q^P,16),_=_+q|0,v=ae(v^_,12),P=P+v|0,q=ae(q^P,8),_=_+q|0,v=ae(v^_,7),k=k+F|0,q=ae(q^k,16),b=b+q|0,F=ae(F^b,12),k=k+F|0,q=ae(q^k,8),b=b+q|0,F=ae(F^b,7),D=D+C|0,R=ae(R^D,16),_=_+R|0,C=ae(C^_,12),D=D+C|0,R=ae(R^D,8),_=_+R|0,C=ae(C^_,7),M=M+v|0,x=ae(x^M,16),I=I+x|0,v=ae(v^I,12),M=M+v|0,x=ae(x^M,8),I=I+x|0,v=ae(v^I,7),P=P+L|0,T=ae(T^P,16),y=y+T|0,L=ae(L^y,12),P=P+L|0,T=ae(T^P,8),y=y+T|0,L=ae(L^y,7);let $=0;r[$++]=o+k|0,r[$++]=a+D|0,r[$++]=c+M|0,r[$++]=l+P|0,r[$++]=u+L|0,r[$++]=h+F|0,r[$++]=d+C|0,r[$++]=p+v|0,r[$++]=m+I|0,r[$++]=g+y|0,r[$++]=w+b|0,r[$++]=N+_|0,r[$++]=U+R|0,r[$++]=A+x|0,r[$++]=S+T|0,r[$++]=O+q|0}var Ub=Ob(kb,{counterRight:!1,counterLength:4,allowShortKeys:!1}),Bb=new Uint8Array(16),hf=(t,e)=>{t.update(e);let s=e.length%16;s&&t.update(Bb.subarray(s))},Db=new Uint8Array(32);function df(t,e,s,r,n){let i=t(e,s,Db),o=Nb.create(i);n&&hf(o,n),hf(o,r);let a=xb(r.length,n?n.length:0,!0);o.update(a);let c=o.digest();return Xr(i,a),c}var Lb=t=>(e,s,r)=>({encrypt(n,i){let o=n.length;i=cf(o+16,i,!1),i.set(n);let a=i.subarray(0,-16);t(e,s,a,a,1);let c=df(t,e,s,a,r);return i.set(c,o),Xr(c),i},decrypt(n,i){i=cf(n.length-16,i,!1);let o=n.subarray(0,-16),a=n.subarray(-16),c=df(t,e,s,o,r);if(!vb(a,c))throw new Error("invalid tag");return i.set(n.subarray(0,-16)),t(e,s,i,i,1),Xr(c),i}}),fp=Eb({blockSize:64,nonceLength:12,tagLength:16},Lb(Ub)),So=class extends Yr{constructor(e,s){super(),this.finished=!1,this.destroyed=!1,No(e);let r=Xt(s);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let n=this.blockLen,i=new Uint8Array(n);i.set(r.length>n?e.create().update(r).digest():r);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),Dt(i)}update(e){return Js(this),this.iHash.update(e),this}digestInto(e){Js(this),Jt(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:s,iHash:r,finished:n,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=n,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=s._cloneInto(e.oHash),e.iHash=r._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Do=(t,e,s)=>new So(t,e).update(s).digest();Do.create=(t,e)=>new So(t,e);function qb(t,e,s){return No(t),s===void 0&&(s=new Uint8Array(t.outputLen)),Do(t,Xt(s),Xt(e))}var yc=Uint8Array.from([0]),ff=Uint8Array.of();function Mb(t,e,s,r=32){No(t),Ts(r);let n=t.outputLen;if(r>255*n)throw new Error("Length should be <= 255*HashLen");let i=Math.ceil(r/n);s===void 0&&(s=ff);let o=new Uint8Array(i*n),a=Do.create(t,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<i;u++)yc[0]=u+1,c.update(u===0?ff:l).update(s).update(yc).digestInto(l),o.set(l,n*u),a._cloneInto(c);return a.destroy(),c.destroy(),Dt(l,yc),o.slice(0,r)}var Fb=(t,e,s,r,n)=>Mb(t,qb(t,e,s),r,n),Lo=ko,ol=BigInt(0),qc=BigInt(1);function Io(t,e=""){if(typeof t!="boolean"){let s=e&&`"${e}"`;throw new Error(s+"expected boolean, got type="+typeof t)}return t}function xr(t,e,s=""){let r=Ro(t),n=t?.length,i=e!==void 0;if(!r||i&&n!==e){let o=s&&`"${s}" `,a=i?` of length ${e}`:"",c=r?`length=${n}`:`type=${typeof t}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return t}function yo(t){let e=t.toString(16);return e.length&1?"0"+e:e}function pp(t){if(typeof t!="string")throw new Error("hex string expected, got "+typeof t);return t===""?ol:BigInt("0x"+t)}function qo(t){return pp(Wr(t))}function Ao(t){return Jt(t),pp(Wr(Uint8Array.from(t).reverse()))}function al(t,e){return Eo(t.toString(16).padStart(e*2,"0"))}function cl(t,e){return al(t,e).reverse()}function Ye(t,e,s){let r;if(typeof e=="string")try{r=Eo(e)}catch(i){throw new Error(t+" must be hex string or Uint8Array, cause: "+i)}else if(Ro(e))r=Uint8Array.from(e);else throw new Error(t+" must be hex string or Uint8Array");let n=r.length;if(typeof s=="number"&&n!==s)throw new Error(t+" of length "+s+" expected, got "+n);return r}var wc=t=>typeof t=="bigint"&&ol<=t;function $b(t,e,s){return wc(t)&&wc(e)&&wc(s)&&e<=t&&t<s}function Mc(t,e,s,r){if(!$b(e,s,r))throw new Error("expected valid "+t+": "+s+" <= n < "+r+", got "+e)}function gp(t){let e;for(e=0;t>ol;t>>=qc,e+=1);return e}var Jn=t=>(qc<<BigInt(t))-qc;function jb(t,e,s){if(typeof t!="number"||t<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof s!="function")throw new Error("hmacFn must be a function");let r=d=>new Uint8Array(d),n=d=>Uint8Array.of(d),i=r(t),o=r(t),a=0,c=()=>{i.fill(1),o.fill(0),a=0},l=(...d)=>s(o,i,...d),u=(d=r(0))=>{o=l(n(0),d),i=l(),d.length!==0&&(o=l(n(1),d),i=l())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let d=0,p=[];for(;d<e;){i=l();let m=i.slice();p.push(m),d+=i.length}return Xs(...p)};return(d,p)=>{c(),u(d);let m;for(;!(m=p(h()));)u();return c(),m}}function Mo(t,e,s={}){if(!t||typeof t!="object")throw new Error("expected valid options object");function r(n,i,o){let a=t[n];if(o&&a===void 0)return;let c=typeof a;if(c!==i||a===null)throw new Error(`param "${n}" is invalid: expected ${i}, got ${c}`)}Object.entries(e).forEach(([n,i])=>r(n,i,!1)),Object.entries(s).forEach(([n,i])=>r(n,i,!0))}function pf(t){let e=new WeakMap;return(s,...r)=>{let n=e.get(s);if(n!==void 0)return n;let i=t(s,...r);return e.set(s,i),i}}var yt=BigInt(0),ot=BigInt(1),Sr=BigInt(2),mp=BigInt(3),yp=BigInt(4),wp=BigInt(5),zb=BigInt(7),bp=BigInt(8),Hb=BigInt(9),vp=BigInt(16);function _t(t,e){let s=t%e;return s>=yt?s:e+s}function Wt(t,e,s){let r=t;for(;e-- >yt;)r*=r,r%=s;return r}function gf(t,e){if(t===yt)throw new Error("invert: expected non-zero number");if(e<=yt)throw new Error("invert: expected positive modulus, got "+e);let s=_t(t,e),r=e,n=yt,i=ot;for(;s!==yt;){let o=r/s,a=r%s,c=n-i*o;r=s,s=a,n=i,i=c}if(r!==ot)throw new Error("invert: does not exist");return _t(n,e)}function ll(t,e,s){if(!t.eql(t.sqr(e),s))throw new Error("Cannot find square root")}function Ep(t,e){let s=(t.ORDER+ot)/yp,r=t.pow(e,s);return ll(t,r,e),r}function Vb(t,e){let s=(t.ORDER-wp)/bp,r=t.mul(e,Sr),n=t.pow(r,s),i=t.mul(e,n),o=t.mul(t.mul(i,Sr),n),a=t.mul(i,t.sub(o,t.ONE));return ll(t,a,e),a}function Kb(t){let e=tr(t),s=xp(t),r=s(e,e.neg(e.ONE)),n=s(e,r),i=s(e,e.neg(r)),o=(t+zb)/vp;return(a,c)=>{let l=a.pow(c,o),u=a.mul(l,r),h=a.mul(l,n),d=a.mul(l,i),p=a.eql(a.sqr(u),c),m=a.eql(a.sqr(h),c);l=a.cmov(l,u,p),u=a.cmov(d,h,m);let g=a.eql(a.sqr(u),c),w=a.cmov(l,u,g);return ll(a,w,c),w}}function xp(t){if(t<mp)throw new Error("sqrt is not defined for small field");let e=t-ot,s=0;for(;e%Sr===yt;)e/=Sr,s++;let r=Sr,n=tr(t);for(;mf(n,r)===1;)if(r++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(s===1)return Ep;let i=n.pow(r,e),o=(e+ot)/Sr;return function(a,c){if(a.is0(c))return c;if(mf(a,c)!==1)throw new Error("Cannot find square root");let l=s,u=a.mul(a.ONE,i),h=a.pow(c,e),d=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let p=1,m=a.sqr(h);for(;!a.eql(m,a.ONE);)if(p++,m=a.sqr(m),p===l)throw new Error("Cannot find square root");let g=ot<<BigInt(l-p-1),w=a.pow(u,g);l=p,u=a.sqr(w),h=a.mul(h,u),d=a.mul(d,w)}return d}}function Wb(t){return t%yp===mp?Ep:t%bp===wp?Vb:t%vp===Hb?Kb(t):xp(t)}var Gb=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function Yb(t){let e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},s=Gb.reduce((r,n)=>(r[n]="function",r),e);return Mo(t,s),t}function Xb(t,e,s){if(s<yt)throw new Error("invalid exponent, negatives unsupported");if(s===yt)return t.ONE;if(s===ot)return e;let r=t.ONE,n=e;for(;s>yt;)s&ot&&(r=t.mul(r,n)),n=t.sqr(n),s>>=ot;return r}function Sp(t,e,s=!1){let r=new Array(e.length).fill(s?t.ZERO:void 0),n=e.reduce((o,a,c)=>t.is0(a)?o:(r[c]=o,t.mul(o,a)),t.ONE),i=t.inv(n);return e.reduceRight((o,a,c)=>t.is0(a)?o:(r[c]=t.mul(o,r[c]),t.mul(o,a)),i),r}function mf(t,e){let s=(t.ORDER-ot)/Sr,r=t.pow(e,s),n=t.eql(r,t.ONE),i=t.eql(r,t.ZERO),o=t.eql(r,t.neg(t.ONE));if(!n&&!i&&!o)throw new Error("invalid Legendre symbol result");return n?1:i?0:-1}function Ip(t,e){e!==void 0&&Ts(e);let s=e!==void 0?e:t.toString(2).length,r=Math.ceil(s/8);return{nBitLength:s,nByteLength:r}}function tr(t,e,s=!1,r={}){if(t<=yt)throw new Error("invalid field: expected ORDER > 0, got "+t);let n,i,o=!1,a;if(typeof e=="object"&&e!=null){if(r.sqrt||s)throw new Error("cannot specify opts in two arguments");let d=e;d.BITS&&(n=d.BITS),d.sqrt&&(i=d.sqrt),typeof d.isLE=="boolean"&&(s=d.isLE),typeof d.modFromBytes=="boolean"&&(o=d.modFromBytes),a=d.allowedLengths}else typeof e=="number"&&(n=e),r.sqrt&&(i=r.sqrt);let{nBitLength:c,nByteLength:l}=Ip(t,n);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u,h=Object.freeze({ORDER:t,isLE:s,BITS:c,BYTES:l,MASK:Jn(c),ZERO:yt,ONE:ot,allowedLengths:a,create:d=>_t(d,t),isValid:d=>{if(typeof d!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof d);return yt<=d&&d<t},is0:d=>d===yt,isValidNot0:d=>!h.is0(d)&&h.isValid(d),isOdd:d=>(d&ot)===ot,neg:d=>_t(-d,t),eql:(d,p)=>d===p,sqr:d=>_t(d*d,t),add:(d,p)=>_t(d+p,t),sub:(d,p)=>_t(d-p,t),mul:(d,p)=>_t(d*p,t),pow:(d,p)=>Xb(h,d,p),div:(d,p)=>_t(d*gf(p,t),t),sqrN:d=>d*d,addN:(d,p)=>d+p,subN:(d,p)=>d-p,mulN:(d,p)=>d*p,inv:d=>gf(d,t),sqrt:i||(d=>(u||(u=Wb(t)),u(h,d))),toBytes:d=>s?cl(d,l):al(d,l),fromBytes:(d,p=!0)=>{if(a){if(!a.includes(d.length)||d.length>l)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+d.length);let g=new Uint8Array(l);g.set(d,s?0:g.length-d.length),d=g}if(d.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+d.length);let m=s?Ao(d):qo(d);if(o&&(m=_t(m,t)),!p&&!h.isValid(m))throw new Error("invalid field element: outside of range 0..ORDER");return m},invertBatch:d=>Sp(h,d),cmov:(d,p,m)=>m?p:d});return Object.freeze(h)}function Ap(t){if(typeof t!="bigint")throw new Error("field order must be bigint");let e=t.toString(2).length;return Math.ceil(e/8)}function _p(t){let e=Ap(t);return e+Math.ceil(e/2)}function Zb(t,e,s=!1){let r=t.length,n=Ap(e),i=_p(e);if(r<16||r<i||r>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+r);let o=s?Ao(t):qo(t),a=_t(o,e-ot)+ot;return s?cl(a,n):al(a,n)}var Zr=BigInt(0),Ir=BigInt(1);function _o(t,e){let s=e.negate();return t?s:e}function bc(t,e){let s=Sp(t.Fp,e.map(r=>r.Z));return e.map((r,n)=>t.fromAffine(r.toAffine(s[n])))}function Tp(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+t)}function vc(t,e){Tp(t,e);let s=Math.ceil(e/t)+1,r=2**(t-1),n=2**t,i=Jn(t),o=BigInt(t);return{windows:s,windowSize:r,mask:i,maxNumber:n,shiftBy:o}}function yf(t,e,s){let{windowSize:r,mask:n,maxNumber:i,shiftBy:o}=s,a=Number(t&n),c=t>>o;a>r&&(a-=i,c+=Ir);let l=e*r,u=l+Math.abs(a)-1,h=a===0,d=a<0,p=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:d,isNegF:p,offsetF:l}}function Jb(t,e){if(!Array.isArray(t))throw new Error("array expected");t.forEach((s,r)=>{if(!(s instanceof e))throw new Error("invalid point at index "+r)})}function Qb(t,e){if(!Array.isArray(t))throw new Error("array of scalars expected");t.forEach((s,r)=>{if(!e.isValid(s))throw new Error("invalid scalar at index "+r)})}var Ec=new WeakMap,Pp=new WeakMap;function xc(t){return Pp.get(t)||1}function wf(t){if(t!==Zr)throw new Error("invalid wNAF")}var Fc=class{constructor(e,s){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=s}_unsafeLadder(e,s,r=this.ZERO){let n=e;for(;s>Zr;)s&Ir&&(r=r.add(n)),n=n.double(),s>>=Ir;return r}precomputeWindow(e,s){let{windows:r,windowSize:n}=vc(s,this.bits),i=[],o=e,a=o;for(let c=0;c<r;c++){a=o,i.push(a);for(let l=1;l<n;l++)a=a.add(o),i.push(a);o=a.double()}return i}wNAF(e,s,r){if(!this.Fn.isValid(r))throw new Error("invalid scalar");let n=this.ZERO,i=this.BASE,o=vc(e,this.bits);for(let a=0;a<o.windows;a++){let{nextN:c,offset:l,isZero:u,isNeg:h,isNegF:d,offsetF:p}=yf(r,a,o);r=c,u?i=i.add(_o(d,s[p])):n=n.add(_o(h,s[l]))}return wf(r),{p:n,f:i}}wNAFUnsafe(e,s,r,n=this.ZERO){let i=vc(e,this.bits);for(let o=0;o<i.windows&&r!==Zr;o++){let{nextN:a,offset:c,isZero:l,isNeg:u}=yf(r,o,i);if(r=a,!l){let h=s[c];n=n.add(u?h.negate():h)}}return wf(r),n}getPrecomputes(e,s,r){let n=Ec.get(s);return n||(n=this.precomputeWindow(s,e),e!==1&&(typeof r=="function"&&(n=r(n)),Ec.set(s,n))),n}cached(e,s,r){let n=xc(e);return this.wNAF(n,this.getPrecomputes(n,e,r),s)}unsafe(e,s,r,n){let i=xc(e);return i===1?this._unsafeLadder(e,s,n):this.wNAFUnsafe(i,this.getPrecomputes(i,e,r),s,n)}createCache(e,s){Tp(s,this.bits),Pp.set(e,s),Ec.delete(e)}hasCache(e){return xc(e)!==1}};function e1(t,e,s,r){let n=e,i=t.ZERO,o=t.ZERO;for(;s>Zr||r>Zr;)s&Ir&&(i=i.add(n)),r&Ir&&(o=o.add(n)),n=n.double(),s>>=Ir,r>>=Ir;return{p1:i,p2:o}}function t1(t,e,s,r){Jb(s,t),Qb(r,e);let n=s.length,i=r.length;if(n!==i)throw new Error("arrays of points and scalars must have equal length");let o=t.ZERO,a=gp(BigInt(n)),c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);let l=Jn(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c,d=o;for(let p=h;p>=0;p-=c){u.fill(o);for(let g=0;g<i;g++){let w=r[g],N=Number(w>>BigInt(p)&l);u[N]=u[N].add(s[g])}let m=o;for(let g=u.length-1,w=o;g>0;g--)w=w.add(u[g]),m=m.add(w);if(d=d.add(m),p!==0)for(let g=0;g<c;g++)d=d.double()}return d}function bf(t,e,s){if(e){if(e.ORDER!==t)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return Yb(e),e}else return tr(t,{isLE:s})}function s1(t,e,s={},r){if(r===void 0&&(r=t==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${t} CURVE object`);for(let a of["p","n","h"]){let c=e[a];if(!(typeof c=="bigint"&&c>Zr))throw new Error(`CURVE.${a} must be positive bigint`)}let n=bf(e.p,s.Fp,r),i=bf(e.n,s.Fn,r),o=["Gx","Gy","a",t==="weierstrass"?"b":"d"];for(let a of o)if(!n.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:n,Fn:i}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),Yf("HashToScalar-");var Mn=BigInt(0),Vr=BigInt(1),wo=BigInt(2);function r1(t){return Mo(t,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze(H({},t))}function n1(t){let e=r1(t),{P:s,type:r,adjustScalarBytes:n,powPminus2:i,randomBytes:o}=e,a=r==="x25519";if(!a&&r!=="x448")throw new Error("invalid type");let c=o||Tr,l=a?255:448,u=a?32:56,h=BigInt(a?9:5),d=BigInt(a?121665:39081),p=a?wo**BigInt(254):wo**BigInt(447),m=a?BigInt(8)*wo**BigInt(251)-Vr:BigInt(4)*wo**BigInt(445)-Vr,g=p+m+Vr,w=C=>_t(C,s),N=U(h);function U(C){return cl(w(C),u)}function A(C){let v=Ye("u coordinate",C,u);return a&&(v[31]&=127),w(Ao(v))}function S(C){return Ao(n(Ye("scalar",C,u)))}function O(C,v){let I=M(A(v),S(C));if(I===Mn)throw new Error("invalid private or public key received");return U(I)}function k(C){return O(C,N)}function D(C,v,I){let y=w(C*(v-I));return v=w(v-y),I=w(I+y),{x_2:v,x_3:I}}function M(C,v){Mc("u",C,Mn,s),Mc("scalar",v,p,g);let I=v,y=C,b=Vr,_=Mn,R=C,x=Vr,T=Mn;for(let $=BigInt(l-1);$>=Mn;$--){let J=I>>$&Vr;T^=J,{x_2:b,x_3:R}=D(T,b,R),{x_2:_,x_3:x}=D(T,_,x),T=J;let W=b+_,V=w(W*W),ee=b-_,Z=w(ee*ee),de=V-Z,Q=R+x,fe=R-x,tt=w(fe*W),at=w(Q*ee),st=tt+at,Nt=tt-at;R=w(st*st),x=w(y*w(Nt*Nt)),b=w(V*Z),_=w(de*(V+w(d*de)))}({x_2:b,x_3:R}=D(T,b,R)),{x_2:_,x_3:x}=D(T,_,x);let q=i(_);return w(b*q)}let P={secretKey:u,publicKey:u,seed:u},L=(C=c(u))=>(Jt(C,P.seed),C);function F(C){let v=L(C);return{secretKey:v,publicKey:k(v)}}return{keygen:F,getSharedSecret:(C,v)=>O(C,v),getPublicKey:C=>k(C),scalarMult:O,scalarMultBase:k,utils:{randomSecretKey:L,randomPrivateKey:L},GuBytes:N.slice(),lengths:P}}var i1=BigInt(1),vf=BigInt(2),o1=BigInt(3),a1=BigInt(5),c1=BigInt(8),Cp=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),l1={p:Cp,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:c1,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function u1(t){let e=BigInt(10),s=BigInt(20),r=BigInt(40),n=BigInt(80),i=Cp,o=t*t%i*t%i,a=Wt(o,vf,i)*o%i,c=Wt(a,i1,i)*t%i,l=Wt(c,a1,i)*c%i,u=Wt(l,e,i)*l%i,h=Wt(u,s,i)*u%i,d=Wt(h,r,i)*h%i,p=Wt(d,n,i)*d%i,m=Wt(p,n,i)*d%i,g=Wt(m,e,i)*l%i;return{pow_p_5_8:Wt(g,vf,i)*t%i,b2:o}}function h1(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}var d1=tr(l1.p,{isLE:!0}),$c=(()=>{let t=d1.ORDER;return n1({P:t,type:"x25519",powPminus2:e=>{let{pow_p_5_8:s,b2:r}=u1(e);return _t(Wt(s,o1,t)*r,t)},adjustScalarBytes:h1})})(),Ef=(t,e)=>(t+(t>=0?e:-e)/Op)/e;function f1(t,e,s){let[[r,n],[i,o]]=e,a=Ef(o*t,s),c=Ef(-n*t,s),l=t-a*r-c*i,u=-a*n-c*o,h=l<As,d=u<As;h&&(l=-l),d&&(u=-u);let p=Jn(Math.ceil(gp(s)/2))+Gr;if(l<As||l>=p||u<As||u>=p)throw new Error("splitScalar (endomorphism): failed, k="+t);return{k1neg:h,k1:l,k2neg:d,k2:u}}function jc(t){if(!["compact","recovered","der"].includes(t))throw new Error('Signature format must be "compact", "recovered", or "der"');return t}function Sc(t,e){let s={};for(let r of Object.keys(e))s[r]=t[r]===void 0?e[r]:t[r];return Io(s.lowS,"lowS"),Io(s.prehash,"prehash"),s.format!==void 0&&jc(s.format),s}var zc=class extends Error{constructor(e=""){super(e)}},Is={Err:zc,_tlv:{encode:(t,e)=>{let{Err:s}=Is;if(t<0||t>256)throw new s("tlv.encode: wrong tag");if(e.length&1)throw new s("tlv.encode: unpadded data");let r=e.length/2,n=yo(r);if(n.length/2&128)throw new s("tlv.encode: long form length too big");let i=r>127?yo(n.length/2|128):"";return yo(t)+i+n+e},decode(t,e){let{Err:s}=Is,r=0;if(t<0||t>256)throw new s("tlv.encode: wrong tag");if(e.length<2||e[r++]!==t)throw new s("tlv.decode: wrong tlv");let n=e[r++],i=!!(n&128),o=0;if(!i)o=n;else{let c=n&127;if(!c)throw new s("tlv.decode(long): indefinite length not supported");if(c>4)throw new s("tlv.decode(long): byte length is too big");let l=e.subarray(r,r+c);if(l.length!==c)throw new s("tlv.decode: length bytes not complete");if(l[0]===0)throw new s("tlv.decode(long): zero leftmost byte");for(let u of l)o=o<<8|u;if(r+=c,o<128)throw new s("tlv.decode(long): not minimal encoding")}let a=e.subarray(r,r+o);if(a.length!==o)throw new s("tlv.decode: wrong value length");return{v:a,l:e.subarray(r+o)}}},_int:{encode(t){let{Err:e}=Is;if(t<As)throw new e("integer: negative integers are not allowed");let s=yo(t);if(Number.parseInt(s[0],16)&8&&(s="00"+s),s.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return s},decode(t){let{Err:e}=Is;if(t[0]&128)throw new e("invalid signature integer: negative");if(t[0]===0&&!(t[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return qo(t)}},toSig(t){let{Err:e,_int:s,_tlv:r}=Is,n=Ye("signature",t),{v:i,l:o}=r.decode(48,n);if(o.length)throw new e("invalid signature: left bytes after parsing");let{v:a,l:c}=r.decode(2,i),{v:l,l:u}=r.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:s.decode(a),s:s.decode(l)}},hexFromSig(t){let{_tlv:e,_int:s}=Is,r=e.encode(2,s.encode(t.r)),n=e.encode(2,s.encode(t.s)),i=r+n;return e.encode(48,i)}},As=BigInt(0),Gr=BigInt(1),Op=BigInt(2),bo=BigInt(3),p1=BigInt(4);function Kr(t,e){let{BYTES:s}=t,r;if(typeof e=="bigint")r=e;else{let n=Ye("private key",e);try{r=t.fromBytes(n)}catch{throw new Error(`invalid private key: expected ui8a of size ${s}, got ${typeof e}`)}}if(!t.isValidNot0(r))throw new Error("invalid private key: out of range [1..N-1]");return r}function g1(t,e={}){let s=s1("weierstrass",t,e),{Fp:r,Fn:n}=s,i=s.CURVE,{h:o,n:a}=i;Mo(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:c}=e;if(c&&(!r.is0(i.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');let l=Np(r,n);function u(){if(!r.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h(C,v,I){let{x:y,y:b}=v.toAffine(),_=r.toBytes(y);if(Io(I,"isCompressed"),I){u();let R=!r.isOdd(b);return Xs(Rp(R),_)}else return Xs(Uint8Array.of(4),_,r.toBytes(b))}function d(C){xr(C,void 0,"Point");let{publicKey:v,publicKeyUncompressed:I}=l,y=C.length,b=C[0],_=C.subarray(1);if(y===v&&(b===2||b===3)){let R=r.fromBytes(_);if(!r.isValid(R))throw new Error("bad point: is not on curve, wrong x");let x=g(R),T;try{T=r.sqrt(x)}catch($){let J=$ instanceof Error?": "+$.message:"";throw new Error("bad point: is not on curve, sqrt error"+J)}u();let q=r.isOdd(T);return(b&1)===1!==q&&(T=r.neg(T)),{x:R,y:T}}else if(y===I&&b===4){let R=r.BYTES,x=r.fromBytes(_.subarray(0,R)),T=r.fromBytes(_.subarray(R,R*2));if(!w(x,T))throw new Error("bad point: is not on curve");return{x,y:T}}else throw new Error(`bad point: got length ${y}, expected compressed=${v} or uncompressed=${I}`)}let p=e.toBytes||h,m=e.fromBytes||d;function g(C){let v=r.sqr(C),I=r.mul(v,C);return r.add(r.add(I,r.mul(C,i.a)),i.b)}function w(C,v){let I=r.sqr(v),y=g(C);return r.eql(I,y)}if(!w(i.Gx,i.Gy))throw new Error("bad curve params: generator point");let N=r.mul(r.pow(i.a,bo),p1),U=r.mul(r.sqr(i.b),BigInt(27));if(r.is0(r.add(N,U)))throw new Error("bad curve params: a or b");function A(C,v,I=!1){if(!r.isValid(v)||I&&r.is0(v))throw new Error(`bad point coordinate ${C}`);return v}function S(C){if(!(C instanceof P))throw new Error("ProjectivePoint expected")}function O(C){if(!c||!c.basises)throw new Error("no endo");return f1(C,c.basises,n.ORDER)}let k=pf((C,v)=>{let{X:I,Y:y,Z:b}=C;if(r.eql(b,r.ONE))return{x:I,y};let _=C.is0();v==null&&(v=_?r.ONE:r.inv(b));let R=r.mul(I,v),x=r.mul(y,v),T=r.mul(b,v);if(_)return{x:r.ZERO,y:r.ZERO};if(!r.eql(T,r.ONE))throw new Error("invZ was invalid");return{x:R,y:x}}),D=pf(C=>{if(C.is0()){if(e.allowInfinityPoint&&!r.is0(C.Y))return;throw new Error("bad point: ZERO")}let{x:v,y:I}=C.toAffine();if(!r.isValid(v)||!r.isValid(I))throw new Error("bad point: x or y not field elements");if(!w(v,I))throw new Error("bad point: equation left != right");if(!C.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function M(C,v,I,y,b){return I=new P(r.mul(I.X,C),I.Y,I.Z),v=_o(y,v),I=_o(b,I),v.add(I)}class P{constructor(v,I,y){this.X=A("x",v),this.Y=A("y",I,!0),this.Z=A("z",y),Object.freeze(this)}static CURVE(){return i}static fromAffine(v){let{x:I,y}=v||{};if(!v||!r.isValid(I)||!r.isValid(y))throw new Error("invalid affine point");if(v instanceof P)throw new Error("projective point not allowed");return r.is0(I)&&r.is0(y)?P.ZERO:new P(I,y,r.ONE)}static fromBytes(v){let I=P.fromAffine(m(xr(v,void 0,"point")));return I.assertValidity(),I}static fromHex(v){return P.fromBytes(Ye("pointHex",v))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(v=8,I=!0){return F.createCache(this,v),I||this.multiply(bo),this}assertValidity(){D(this)}hasEvenY(){let{y:v}=this.toAffine();if(!r.isOdd)throw new Error("Field doesn't support isOdd");return!r.isOdd(v)}equals(v){S(v);let{X:I,Y:y,Z:b}=this,{X:_,Y:R,Z:x}=v,T=r.eql(r.mul(I,x),r.mul(_,b)),q=r.eql(r.mul(y,x),r.mul(R,b));return T&&q}negate(){return new P(this.X,r.neg(this.Y),this.Z)}double(){let{a:v,b:I}=i,y=r.mul(I,bo),{X:b,Y:_,Z:R}=this,x=r.ZERO,T=r.ZERO,q=r.ZERO,$=r.mul(b,b),J=r.mul(_,_),W=r.mul(R,R),V=r.mul(b,_);return V=r.add(V,V),q=r.mul(b,R),q=r.add(q,q),x=r.mul(v,q),T=r.mul(y,W),T=r.add(x,T),x=r.sub(J,T),T=r.add(J,T),T=r.mul(x,T),x=r.mul(V,x),q=r.mul(y,q),W=r.mul(v,W),V=r.sub($,W),V=r.mul(v,V),V=r.add(V,q),q=r.add($,$),$=r.add(q,$),$=r.add($,W),$=r.mul($,V),T=r.add(T,$),W=r.mul(_,R),W=r.add(W,W),$=r.mul(W,V),x=r.sub(x,$),q=r.mul(W,J),q=r.add(q,q),q=r.add(q,q),new P(x,T,q)}add(v){S(v);let{X:I,Y:y,Z:b}=this,{X:_,Y:R,Z:x}=v,T=r.ZERO,q=r.ZERO,$=r.ZERO,J=i.a,W=r.mul(i.b,bo),V=r.mul(I,_),ee=r.mul(y,R),Z=r.mul(b,x),de=r.add(I,y),Q=r.add(_,R);de=r.mul(de,Q),Q=r.add(V,ee),de=r.sub(de,Q),Q=r.add(I,b);let fe=r.add(_,x);return Q=r.mul(Q,fe),fe=r.add(V,Z),Q=r.sub(Q,fe),fe=r.add(y,b),T=r.add(R,x),fe=r.mul(fe,T),T=r.add(ee,Z),fe=r.sub(fe,T),$=r.mul(J,Q),T=r.mul(W,Z),$=r.add(T,$),T=r.sub(ee,$),$=r.add(ee,$),q=r.mul(T,$),ee=r.add(V,V),ee=r.add(ee,V),Z=r.mul(J,Z),Q=r.mul(W,Q),ee=r.add(ee,Z),Z=r.sub(V,Z),Z=r.mul(J,Z),Q=r.add(Q,Z),V=r.mul(ee,Q),q=r.add(q,V),V=r.mul(fe,Q),T=r.mul(de,T),T=r.sub(T,V),V=r.mul(de,ee),$=r.mul(fe,$),$=r.add($,V),new P(T,q,$)}subtract(v){return this.add(v.negate())}is0(){return this.equals(P.ZERO)}multiply(v){let{endo:I}=e;if(!n.isValidNot0(v))throw new Error("invalid scalar: out of range");let y,b,_=R=>F.cached(this,R,x=>bc(P,x));if(I){let{k1neg:R,k1:x,k2neg:T,k2:q}=O(v),{p:$,f:J}=_(x),{p:W,f:V}=_(q);b=J.add(V),y=M(I.beta,$,W,R,T)}else{let{p:R,f:x}=_(v);y=R,b=x}return bc(P,[y,b])[0]}multiplyUnsafe(v){let{endo:I}=e,y=this;if(!n.isValid(v))throw new Error("invalid scalar: out of range");if(v===As||y.is0())return P.ZERO;if(v===Gr)return y;if(F.hasCache(this))return this.multiply(v);if(I){let{k1neg:b,k1:_,k2neg:R,k2:x}=O(v),{p1:T,p2:q}=e1(P,y,_,x);return M(I.beta,T,q,b,R)}else return F.unsafe(y,v)}multiplyAndAddUnsafe(v,I,y){let b=this.multiplyUnsafe(I).add(v.multiplyUnsafe(y));return b.is0()?void 0:b}toAffine(v){return k(this,v)}isTorsionFree(){let{isTorsionFree:v}=e;return o===Gr?!0:v?v(P,this):F.unsafe(this,a).is0()}clearCofactor(){let{clearCofactor:v}=e;return o===Gr?this:v?v(P,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(v=!0){return Io(v,"isCompressed"),this.assertValidity(),p(P,this,v)}toHex(v=!0){return Wr(this.toBytes(v))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(v=!0){return this.toBytes(v)}_setWindowSize(v){this.precompute(v)}static normalizeZ(v){return bc(P,v)}static msm(v,I){return t1(P,n,v,I)}static fromPrivateKey(v){return P.BASE.multiply(Kr(n,v))}}P.BASE=new P(i.Gx,i.Gy,r.ONE),P.ZERO=new P(r.ZERO,r.ONE,r.ZERO),P.Fp=r,P.Fn=n;let L=n.BITS,F=new Fc(P,e.endo?Math.ceil(L/2):L);return P.BASE.precompute(8),P}function Rp(t){return Uint8Array.of(t?2:3)}function Np(t,e){return{secretKey:e.BYTES,publicKey:1+t.BYTES,publicKeyUncompressed:1+2*t.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function m1(t,e={}){let{Fn:s}=t,r=e.randomBytes||Tr,n=Object.assign(Np(t.Fp,s),{seed:_p(s.ORDER)});function i(d){try{return!!Kr(s,d)}catch{return!1}}function o(d,p){let{publicKey:m,publicKeyUncompressed:g}=n;try{let w=d.length;return p===!0&&w!==m||p===!1&&w!==g?!1:!!t.fromBytes(d)}catch{return!1}}function a(d=r(n.seed)){return Zb(xr(d,n.seed,"seed"),s.ORDER)}function c(d,p=!0){return t.BASE.multiply(Kr(s,d)).toBytes(p)}function l(d){let p=a(d);return{secretKey:p,publicKey:c(p)}}function u(d){if(typeof d=="bigint")return!1;if(d instanceof t)return!0;let{secretKey:p,publicKey:m,publicKeyUncompressed:g}=n;if(s.allowedLengths||p===m)return;let w=Ye("key",d).length;return w===m||w===g}function h(d,p,m=!0){if(u(d)===!0)throw new Error("first arg must be private key");if(u(p)===!1)throw new Error("second arg must be public key");let g=Kr(s,d);return t.fromHex(p).multiply(g).toBytes(m)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:l,Point:t,utils:{isValidSecretKey:i,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:i,randomPrivateKey:a,normPrivateKeyToScalar:d=>Kr(s,d),precompute(d=8,p=t.BASE){return p.precompute(d,!1)}},lengths:n})}function y1(t,e,s={}){No(e),Mo(s,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let r=s.randomBytes||Tr,n=s.hmac||((I,...y)=>Do(e,I,Xs(...y))),{Fp:i,Fn:o}=t,{ORDER:a,BITS:c}=o,{keygen:l,getPublicKey:u,getSharedSecret:h,utils:d,lengths:p}=m1(t,s),m={prehash:!1,lowS:typeof s.lowS=="boolean"?s.lowS:!1,format:void 0,extraEntropy:!1},g="compact";function w(I){let y=a>>Gr;return I>y}function N(I,y){if(!o.isValidNot0(y))throw new Error(`invalid signature ${I}: out of range 1..Point.Fn.ORDER`);return y}function U(I,y){jc(y);let b=p.signature,_=y==="compact"?b:y==="recovered"?b+1:void 0;return xr(I,_,`${y} signature`)}class A{constructor(y,b,_){this.r=N("r",y),this.s=N("s",b),_!=null&&(this.recovery=_),Object.freeze(this)}static fromBytes(y,b=g){U(y,b);let _;if(b==="der"){let{r:q,s:$}=Is.toSig(xr(y));return new A(q,$)}b==="recovered"&&(_=y[0],b="compact",y=y.subarray(1));let R=o.BYTES,x=y.subarray(0,R),T=y.subarray(R,R*2);return new A(o.fromBytes(x),o.fromBytes(T),_)}static fromHex(y,b){return this.fromBytes(Eo(y),b)}addRecoveryBit(y){return new A(this.r,this.s,y)}recoverPublicKey(y){let b=i.ORDER,{r:_,s:R,recovery:x}=this;if(x==null||![0,1,2,3].includes(x))throw new Error("recovery id invalid");if(a*Op<b&&x>1)throw new Error("recovery id is ambiguous for h>1 curve");let T=x===2||x===3?_+a:_;if(!i.isValid(T))throw new Error("recovery id 2 or 3 invalid");let q=i.toBytes(T),$=t.fromBytes(Xs(Rp((x&1)===0),q)),J=o.inv(T),W=O(Ye("msgHash",y)),V=o.create(-W*J),ee=o.create(R*J),Z=t.BASE.multiplyUnsafe(V).add($.multiplyUnsafe(ee));if(Z.is0())throw new Error("point at infinify");return Z.assertValidity(),Z}hasHighS(){return w(this.s)}toBytes(y=g){if(jc(y),y==="der")return Eo(Is.hexFromSig(this));let b=o.toBytes(this.r),_=o.toBytes(this.s);if(y==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return Xs(Uint8Array.of(this.recovery),b,_)}return Xs(b,_)}toHex(y){return Wr(this.toBytes(y))}assertValidity(){}static fromCompact(y){return A.fromBytes(Ye("sig",y),"compact")}static fromDER(y){return A.fromBytes(Ye("sig",y),"der")}normalizeS(){return this.hasHighS()?new A(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Wr(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Wr(this.toBytes("compact"))}}let S=s.bits2int||function(I){if(I.length>8192)throw new Error("input is too large");let y=qo(I),b=I.length*8-c;return b>0?y>>BigInt(b):y},O=s.bits2int_modN||function(I){return o.create(S(I))},k=Jn(c);function D(I){return Mc("num < 2^"+c,I,As,k),o.toBytes(I)}function M(I,y){return xr(I,void 0,"message"),y?xr(e(I),void 0,"prehashed message"):I}function P(I,y,b){if(["recovered","canonical"].some(ee=>ee in b))throw new Error("sign() legacy options not supported");let{lowS:_,prehash:R,extraEntropy:x}=Sc(b,m);I=M(I,R);let T=O(I),q=Kr(o,y),$=[D(q),D(T)];if(x!=null&&x!==!1){let ee=x===!0?r(p.secretKey):x;$.push(Ye("extraEntropy",ee))}let J=Xs(...$),W=T;function V(ee){let Z=S(ee);if(!o.isValidNot0(Z))return;let de=o.inv(Z),Q=t.BASE.multiply(Z).toAffine(),fe=o.create(Q.x);if(fe===As)return;let tt=o.create(de*o.create(W+fe*q));if(tt===As)return;let at=(Q.x===fe?0:2)|Number(Q.y&Gr),st=tt;return _&&w(tt)&&(st=o.neg(tt),at^=1),new A(fe,st,at)}return{seed:J,k2sig:V}}function L(I,y,b={}){I=Ye("message",I);let{seed:_,k2sig:R}=P(I,y,b);return jb(e.outputLen,o.BYTES,n)(_,R)}function F(I){let y,b=typeof I=="string"||Ro(I),_=!b&&I!==null&&typeof I=="object"&&typeof I.r=="bigint"&&typeof I.s=="bigint";if(!b&&!_)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(_)y=new A(I.r,I.s);else if(b){try{y=A.fromBytes(Ye("sig",I),"der")}catch(R){if(!(R instanceof Is.Err))throw R}if(!y)try{y=A.fromBytes(Ye("sig",I),"compact")}catch{return!1}}return y||!1}function C(I,y,b,_={}){let{lowS:R,prehash:x,format:T}=Sc(_,m);if(b=Ye("publicKey",b),y=M(Ye("message",y),x),"strict"in _)throw new Error("options.strict was renamed to lowS");let q=T===void 0?F(I):A.fromBytes(Ye("sig",I),T);if(q===!1)return!1;try{let $=t.fromBytes(b);if(R&&q.hasHighS())return!1;let{r:J,s:W}=q,V=O(y),ee=o.inv(W),Z=o.create(V*ee),de=o.create(J*ee),Q=t.BASE.multiplyUnsafe(Z).add($.multiplyUnsafe(de));return Q.is0()?!1:o.create(Q.x)===J}catch{return!1}}function v(I,y,b={}){let{prehash:_}=Sc(b,m);return y=M(y,_),A.fromBytes(I,"recovered").recoverPublicKey(y).toBytes()}return Object.freeze({keygen:l,getPublicKey:u,getSharedSecret:h,utils:d,lengths:p,Point:t,sign:L,verify:C,recoverPublicKey:v,Signature:A,hash:e})}function w1(t){let e={a:t.a,b:t.b,p:t.Fp.ORDER,n:t.n,h:t.h,Gx:t.Gx,Gy:t.Gy},s=t.Fp,r=t.allowedPrivateKeyLengths?Array.from(new Set(t.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0,n=tr(e.n,{BITS:t.nBitLength,allowedLengths:r,modFromBytes:t.wrapPrivateKey}),i={Fp:s,Fn:n,allowInfinityPoint:t.allowInfinityPoint,endo:t.endo,isTorsionFree:t.isTorsionFree,clearCofactor:t.clearCofactor,fromBytes:t.fromBytes,toBytes:t.toBytes};return{CURVE:e,curveOpts:i}}function b1(t){let{CURVE:e,curveOpts:s}=w1(t),r={hmac:t.hmac,randomBytes:t.randomBytes,lowS:t.lowS,bits2int:t.bits2int,bits2int_modN:t.bits2int_modN};return{CURVE:e,curveOpts:s,hash:t.hash,ecdsaOpts:r}}function v1(t,e){let s=e.Point;return Object.assign({},e,{ProjectivePoint:s,CURVE:Object.assign({},t,Ip(s.Fn.ORDER,s.Fn.BITS))})}function E1(t){let{CURVE:e,curveOpts:s,hash:r,ecdsaOpts:n}=b1(t),i=g1(e,s),o=y1(i,r,n);return v1(t,o)}function Hc(t,e){let s=r=>E1(be(H({},t),{hash:r}));return be(H({},s(e)),{create:s})}var kp={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},Up={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},Bp={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},x1=tr(kp.p),S1=tr(Up.p),I1=tr(Bp.p),A1=Hc(be(H({},kp),{Fp:x1,lowS:!1}),ko);Hc(be(H({},Up),{Fp:S1,lowS:!1}),F0),Hc(be(H({},Bp),{Fp:I1,lowS:!1,allowedPrivateKeyLengths:[130,131,132]}),M0);var _1=A1,Dp="base10",Xe="base16",Ze="base64pad",Os="base64url",Qn="utf8",Lp=0,ts=1,Jr=2,T1=0,xf=1,jn=12,ul=32;function qp(){let t=$c.utils.randomPrivateKey(),e=$c.getPublicKey(t);return{privateKey:Be(t,Xe),publicKey:Be(e,Xe)}}function Fo(){let t=Tr(ul);return Be(t,Xe)}function Mp(t,e){let s=$c.getSharedSecret(pt(t,Xe),pt(e,Xe)),r=Fb(Lo,s,void 0,void 0,ul);return Be(r,Xe)}function Qr(t){let e=Lo(pt(t,Xe));return Be(e,Xe)}function wt(t){let e=Lo(pt(t,Qn));return Be(e,Xe)}function Fp(t){return pt(`${t}`,Dp)}function Qs(t){return Number(Be(t,Dp))}function $p(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function jp(t){let e=t.replace(/-/g,"+").replace(/_/g,"/"),s=(4-e.length%4)%4;return e+"=".repeat(s)}function zp(t){let e=Fp(typeof t.type<"u"?t.type:Lp);if(Qs(e)===ts&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");let s=typeof t.senderPublicKey<"u"?pt(t.senderPublicKey,Xe):void 0,r=typeof t.iv<"u"?pt(t.iv,Xe):Tr(jn),n=pt(t.symKey,Xe),i=fp(n,r).encrypt(pt(t.message,Qn)),o=Wp({type:e,sealed:i,iv:r,senderPublicKey:s});return t.encoding===Os?$p(o):o}function Hp(t){let e=pt(t.symKey,Xe),{sealed:s,iv:r}=en({encoded:t.encoded,encoding:t.encoding}),n=fp(e,r).decrypt(s);if(n===null)throw new Error("Failed to decrypt");return Be(n,Qn)}function Vp(t,e){let s=Fp(Jr),r=Tr(jn),n=pt(t,Qn),i=Wp({type:s,sealed:n,iv:r});return e===Os?$p(i):i}function Kp(t,e){let{sealed:s}=en({encoded:t,encoding:e});return Be(s,Qn)}function Wp(t){if(Qs(t.type)===Jr)return Be(vr([t.type,t.sealed]),Ze);if(Qs(t.type)===ts){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Be(vr([t.type,t.senderPublicKey,t.iv,t.sealed]),Ze)}return Be(vr([t.type,t.iv,t.sealed]),Ze)}function en(t){let e=(t.encoding||Ze)===Os?jp(t.encoded):t.encoded,s=pt(e,Ze),r=s.slice(T1,xf),n=xf;if(Qs(r)===ts){let c=n+ul,l=c+jn,u=s.slice(n,c),h=s.slice(c,l),d=s.slice(l);return{type:r,sealed:d,iv:h,senderPublicKey:u}}if(Qs(r)===Jr){let c=s.slice(n),l=Tr(jn);return{type:r,sealed:c,iv:l}}let i=n+jn,o=s.slice(n,i),a=s.slice(i);return{type:r,sealed:a,iv:o}}function Gp(t,e){let s=en({encoded:t,encoding:e?.encoding});return hl({type:Qs(s.type),senderPublicKey:typeof s.senderPublicKey<"u"?Be(s.senderPublicKey,Xe):void 0,receiverPublicKey:e?.receiverPublicKey})}function hl(t){let e=t?.type||Lp;if(e===ts){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function dl(t){return t.type===ts&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}function fl(t){return t.type===Jr}function P1(t){let e=Buffer.from(t.x,"base64"),s=Buffer.from(t.y,"base64");return vr([new Uint8Array([4]),e,s])}function Yp(t,e){let[s,r,n]=t.split("."),i=Buffer.from(jp(n),"base64");if(i.length!==64)throw new Error("Invalid signature length");let o=i.slice(0,32),a=i.slice(32,64),c=`${s}.${r}`,l=Lo(c),u=P1(e);if(!_1.verify(vr([o,a]),l,u))throw new Error("Invalid signature");return yn(t).payload}var C1="irn";function ei(t){return t?.relay||{protocol:C1}}function Pr(t){let e=ah[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var O1=Object.defineProperty,R1=Object.defineProperties,N1=Object.getOwnPropertyDescriptors,Sf=Object.getOwnPropertySymbols,k1=Object.prototype.hasOwnProperty,U1=Object.prototype.propertyIsEnumerable,If=(t,e,s)=>e in t?O1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Ic=(t,e)=>{for(var s in e||(e={}))k1.call(e,s)&&If(t,s,e[s]);if(Sf)for(var s of Sf(e))U1.call(e,s)&&If(t,s,e[s]);return t},B1=(t,e)=>R1(t,N1(e));function D1(t,e="-"){let s={},r="relay"+e;return Object.keys(t).forEach(n=>{if(n.startsWith(r)){let i=n.replace(r,""),o=t[n];s[i]=o}}),s}function pl(t){if(!t.includes("wc:")){let l=jf(t);l!=null&&l.includes("wc:")&&(t=l)}t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;let e=t.indexOf(":"),s=t.indexOf("?")!==-1?t.indexOf("?"):void 0,r=t.substring(0,e),n=t.substring(e+1,s).split("@"),i=typeof s<"u"?t.substring(s):"",o=new URLSearchParams(i),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:r,topic:L1(n[0]),version:parseInt(n[1],10),symKey:a.symKey,relay:D1(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function L1(t){return t.startsWith("//")?t.substring(2):t}function q1(t,e="-"){let s="relay",r={};return Object.keys(t).forEach(n=>{let i=n,o=s+e+i;t[i]&&(r[o]=t[i])}),r}function gl(t){let e=new URLSearchParams,s=Ic(Ic(B1(Ic({},q1(t.relay)),{symKey:t.symKey}),t.expiryTimestamp&&{expiryTimestamp:t.expiryTimestamp.toString()}),t.methods&&{methods:t.methods.join(",")});return Object.entries(s).sort(([r],[n])=>r.localeCompare(n)).forEach(([r,n])=>{n!==void 0&&e.append(r,String(n))}),`${t.protocol}:${t.topic}@${t.version}?${e}`}function ti(t,e,s){return`${t}?wc_ev=${s}&topic=${e}`}var M1=Object.defineProperty,F1=Object.defineProperties,$1=Object.getOwnPropertyDescriptors,Af=Object.getOwnPropertySymbols,j1=Object.prototype.hasOwnProperty,z1=Object.prototype.propertyIsEnumerable,_f=(t,e,s)=>e in t?M1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,H1=(t,e)=>{for(var s in e||(e={}))j1.call(e,s)&&_f(t,s,e[s]);if(Af)for(var s of Af(e))z1.call(e,s)&&_f(t,s,e[s]);return t},V1=(t,e)=>F1(t,$1(e));function tn(t){let e=[];return t.forEach(s=>{let[r,n]=s.split(":");e.push(`${r}:${n}`)}),e}function ml(t){let e=[];return Object.values(t).forEach(s=>{e.push(...tn(s.accounts))}),[...new Set(e)]}function Xp(t){let e=[];return Object.values(t).forEach(s=>{e.push(...s.methods)}),[...new Set(e)]}function Zp(t){let e=[];return Object.values(t).forEach(s=>{e.push(...s.events)}),[...new Set(e)]}function K1(t,e){let s=[];return Object.values(t).forEach(r=>{tn(r.accounts).includes(e)&&s.push(...r.methods)}),s}function W1(t,e){let s=[];return Object.values(t).forEach(r=>{tn(r.accounts).includes(e)&&s.push(...r.events)}),s}function si(t){return t.includes(":")}function Cr(t){return si(t)?t.split(":")[0]:t}function Tf(t){var e,s,r;let n={};if(!Lt(t))return n;for(let[i,o]of Object.entries(t)){let a=si(i)?[i]:o.chains,c=o.methods||[],l=o.events||[],u=Cr(i);n[u]=V1(H1({},n[u]),{chains:Yt(a,(e=n[u])==null?void 0:e.chains),methods:Yt(c,(s=n[u])==null?void 0:s.methods),events:Yt(l,(r=n[u])==null?void 0:r.events)})}return n}function G1(t){let e={};return t?.forEach(s=>{var r;let[n,i]=s.split(":");e[n]||(e[n]={accounts:[],chains:[],events:[],methods:[]}),e[n].accounts.push(s),(r=e[n].chains)==null||r.push(`${n}:${i}`)}),e}function yl(t,e){e=e.map(r=>r.replace("did:pkh:",""));let s=G1(e);for(let[r,n]of Object.entries(s))n.methods?n.methods=Yt(n.methods,t):n.methods=t,n.events=["chainChanged","accountsChanged"];return s}function Jp(t,e){var s,r,n,i,o,a;let c=Tf(t),l=Tf(e),u={},h=Object.keys(c).concat(Object.keys(l));for(let d of h)u[d]={chains:Yt((s=c[d])==null?void 0:s.chains,(r=l[d])==null?void 0:r.chains),methods:Yt((n=c[d])==null?void 0:n.methods,(i=l[d])==null?void 0:i.methods),events:Yt((o=c[d])==null?void 0:o.events,(a=l[d])==null?void 0:a.events)};return u}var Y1={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},X1={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function j(t,e){let{message:s,code:r}=X1[t];return{message:e?`${s} ${e}`:s,code:r}}function ge(t,e){let{message:s,code:r}=Y1[t];return{message:e?`${s} ${e}`:s,code:r}}function ss(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Lt(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function Ae(t){return typeof t>"u"}function Ie(t,e){return e&&Ae(t)?!0:typeof t=="string"&&!!t.trim().length}function wl(t,e){return e&&Ae(t)?!0:typeof t=="number"&&!isNaN(t)}function Qp(t,e){let{requiredNamespaces:s}=e,r=Object.keys(t.namespaces),n=Object.keys(s),i=!0;return Er(n,r)?(r.forEach(o=>{let{accounts:a,methods:c,events:l}=t.namespaces[o],u=tn(a),h=s[o];(!Er(Nf(o,h),u)||!Er(h.methods,c)||!Er(h.events,l))&&(i=!1)}),i):!1}function To(t){return Ie(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function Z1(t){if(Ie(t,!1)&&t.includes(":")){let e=t.split(":");if(e.length===3){let s=e[0]+":"+e[1];return!!e[2]&&To(s)}}return!1}function eg(t){function e(s){try{return typeof new URL(s)<"u"}catch{return!1}}try{if(Ie(t,!1)){if(e(t))return!0;let s=jf(t);return e(s)}}catch{}return!1}function tg(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function sg(t){return t?.topic}function rg(t,e){let s=null;return Ie(t?.publicKey,!1)||(s=j("MISSING_OR_INVALID",`${e} controller public key should be a string`)),s}function Pf(t){let e=!0;return ss(t)?t.length&&(e=t.every(s=>Ie(s,!1))):e=!1,e}function J1(t,e,s){let r=null;return ss(e)&&e.length?e.forEach(n=>{r||To(n)||(r=ge("UNSUPPORTED_CHAINS",`${s}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):To(t)||(r=ge("UNSUPPORTED_CHAINS",`${s}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),r}function Q1(t,e,s){let r=null;return Object.entries(t).forEach(([n,i])=>{if(r)return;let o=J1(n,Nf(n,i),`${e} ${s}`);o&&(r=o)}),r}function ev(t,e){let s=null;return ss(t)?t.forEach(r=>{s||Z1(r)||(s=ge("UNSUPPORTED_ACCOUNTS",`${e}, account ${r} should be a string and conform to "namespace:chainId:address" format`))}):s=ge("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),s}function tv(t,e){let s=null;return Object.values(t).forEach(r=>{if(s)return;let n=ev(r?.accounts,`${e} namespace`);n&&(s=n)}),s}function sv(t,e){let s=null;return Pf(t?.methods)?Pf(t?.events)||(s=ge("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):s=ge("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),s}function ng(t,e){let s=null;return Object.values(t).forEach(r=>{if(s)return;let n=sv(r,`${e}, namespace`);n&&(s=n)}),s}function ig(t,e,s){let r=null;if(t&&Lt(t)){let n=ng(t,e);n&&(r=n);let i=Q1(t,e,s);i&&(r=i)}else r=j("MISSING_OR_INVALID",`${e}, ${s} should be an object with data`);return r}function $o(t,e){let s=null;if(t&&Lt(t)){let r=ng(t,e);r&&(s=r);let n=tv(t,e);n&&(s=n)}else s=j("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return s}function bl(t){return Ie(t.protocol,!0)}function og(t,e){let s=!1;return e&&!t?s=!0:t&&ss(t)&&t.length&&t.forEach(r=>{s=bl(r)}),s}function ag(t){return typeof t=="number"}function Je(t){return typeof t<"u"&&typeof t!==null}function cg(t){return!(!t||typeof t!="object"||!t.code||!wl(t.code,!1)||!t.message||!Ie(t.message,!1))}function lg(t){return!(Ae(t)||!Ie(t.method,!1))}function ug(t){return!(Ae(t)||Ae(t.result)&&Ae(t.error)||!wl(t.id,!1)||!Ie(t.jsonrpc,!1))}function hg(t){return!(Ae(t)||!Ie(t.name,!1))}function vl(t,e){return!(!To(e)||!ml(t).includes(e))}function dg(t,e,s){return Ie(s,!1)?K1(t,e).includes(s):!1}function fg(t,e,s){return Ie(s,!1)?W1(t,e).includes(s):!1}function El(t,e,s){let r=null,n=rv(t),i=nv(e),o=Object.keys(n),a=Object.keys(i),c=Cf(Object.keys(t)),l=Cf(Object.keys(e)),u=c.filter(h=>!l.includes(h));return u.length&&(r=j("NON_CONFORMING_NAMESPACES",`${s} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),Er(o,a)||(r=j("NON_CONFORMING_NAMESPACES",`${s} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||r)return;let d=tn(e[h].accounts);d.includes(h)||(r=j("NON_CONFORMING_NAMESPACES",`${s} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${d.toString()}`))}),o.forEach(h=>{r||(Er(n[h].methods,i[h].methods)?Er(n[h].events,i[h].events)||(r=j("NON_CONFORMING_NAMESPACES",`${s} namespaces events don't satisfy namespace events for ${h}`)):r=j("NON_CONFORMING_NAMESPACES",`${s} namespaces methods don't satisfy namespace methods for ${h}`))}),r}function rv(t){let e={};return Object.keys(t).forEach(s=>{var r;s.includes(":")?e[s]=t[s]:(r=t[s].chains)==null||r.forEach(n=>{e[n]={methods:t[s].methods,events:t[s].events}})}),e}function Cf(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function nv(t){let e={};return Object.keys(t).forEach(s=>{s.includes(":")?e[s]=t[s]:tn(t[s].accounts)?.forEach(n=>{e[n]={accounts:t[s].accounts.filter(i=>i.includes(`${n}:`)),methods:t[s].methods,events:t[s].events}})}),e}function pg(t,e){return wl(t,!1)&&t<=e.max&&t>=e.min}function xl(){let t=Wn();return new Promise(e=>{switch(t){case mt.browser:e(iv());break;case mt.reactNative:e(ov());break;case mt.node:e(av());break;default:e(!0)}})}function iv(){return _r()&&navigator?.onLine}function ov(){return f(this,null,function*(){return Ps()&&typeof global<"u"&&global!=null&&global.NetInfo?(yield global==null?void 0:global.NetInfo.fetch())?.isConnected:!0})}function av(){return!0}function gg(t){switch(Wn()){case mt.browser:cv(t);break;case mt.reactNative:lv(t);break;case mt.node:break}}function cv(t){!Ps()&&_r()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function lv(t){Ps()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}function mg(){var t;return _r()&&(0,Zt.getDocument)()?((t=(0,Zt.getDocument)())==null?void 0:t.visibilityState)==="visible":!0}var Ac={},er=class{static get(e){return Ac[e]}static set(e,s){Ac[e]=s}static delete(e){delete Ac[e]}};function uv(t){let e=zr.decode(t);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function hv({publicKey:t,signature:e,payload:s}){var r;let n=Vc(s.method),i=128|parseInt(((r=s.version)==null?void 0:r.toString())||"4"),o=pv(s.address),a=s.era==="00"?new Uint8Array([0]):Vc(s.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");let c=parseInt(s.nonce,16),l=new Uint8Array([c&255,c>>8&255]),u=BigInt(`0x${fv(s.tip)}`),h=mv(u),d=new Uint8Array([0,...t,o,...e,...a,...l,...h,...n]),p=gv(d.length+1);return new Uint8Array([...p,i,...d])}function dv(t){let e=Vc(t),s=(0,Rf.blake2b)(e,void 0,32);return"0x"+Buffer.from(s).toString("hex")}function Vc(t){return new Uint8Array(t.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function fv(t){return t.startsWith("0x")?t.slice(2):t}function pv(t){let e=zr.decode(t)[0];return e===42?0:e===60?2:1}function gv(t){if(t<64)return new Uint8Array([t<<2]);if(t<16384){let e=t<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(t<1<<30){let e=t<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function mv(t){if(t<BigInt(1)<<BigInt(6))return new Uint8Array([Number(t<<BigInt(2))]);if(t<BigInt(1)<<BigInt(14)){let e=t<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(t<BigInt(1)<<BigInt(30)){let e=t<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function yg(t){let e=Uint8Array.from(Buffer.from(t.signature,"hex")),s=uv(t.transaction.address),r=hv({publicKey:s,signature:e,payload:t.transaction}),n=Buffer.from(r).toString("hex");return dv(n)}function sn({logger:t,name:e}){let s=typeof t=="string"?di({opts:{level:t,name:e}}).logger:t;return s.level=typeof t=="string"?t:t.level,s}var jg=zt(oh(),1);var zg="wc",Hg=2,zo="core",ds=`${zg}@2:${zo}:`,yv={name:zo,logger:"error"},wv={database:":memory:"},bv="crypto",wg="client_ed25519_seed",vv=K.ONE_DAY,Ev="keychain",xv="0.3",Sv="messages",Iv="0.3",Av=K.SIX_HOURS,_v="publisher",su="irn",Tv="error",Vg="wss://relay.walletconnect.org",Pv="relayer",_e={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Cv="_subscription",qt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},Ov=.1;var _l="2.23.0";var we={link_mode:"link_mode",relay:"relay"},jo={inbound:"inbound",outbound:"outbound"},Rv="0.3",Nv="WALLETCONNECT_CLIENT_ID",bg="WALLETCONNECT_LINK_MODE_APPS",Ct={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"};var kv="subscription",Uv="0.3",P8=K.FIVE_SECONDS*1e3,Bv="pairing",Dv="0.3";var ri={wc_pairingDelete:{req:{ttl:K.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:K.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:K.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:K.ONE_DAY,prompt:!1,tag:0},res:{ttl:K.ONE_DAY,prompt:!1,tag:0}}},sr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},rs={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Lv="history",qv="0.3",Mv="expirer",Ot={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Fv="0.3";var $v="verify-api",jv="https://verify.walletconnect.com",Kg="https://verify.walletconnect.org",on=Kg,zv=`${on}/v3`,Hv=[jv,Kg],Vv="echo",Kv="https://echo.walletconnect.com";var ns={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},hs={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Ft={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success",session_request_response_started:"session_request_response_started",session_request_response_validation_success:"session_request_response_validation_success",session_request_response_publish_started:"session_request_response_publish_started"},rr={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found",session_request_response_validation_failure:"session_request_response_validation_failure",session_request_response_publish_failure:"session_request_response_publish_failure"},nr={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},an={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},Wv=.1,Gv="event-client",Yv=86400,Xv="https://pulse.walletconnect.org/batch";function Zv(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var s=new Uint8Array(256),r=0;r<s.length;r++)s[r]=255;for(var n=0;n<t.length;n++){var i=t.charAt(n),o=i.charCodeAt(0);if(s[o]!==255)throw new TypeError(i+" is ambiguous");s[o]=n}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";for(var g=0,w=0,N=0,U=m.length;N!==U&&m[N]===0;)N++,g++;for(var A=(U-N)*u+1>>>0,S=new Uint8Array(A);N!==U;){for(var O=m[N],k=0,D=A-1;(O!==0||k<w)&&D!==-1;D--,k++)O+=256*S[D]>>>0,S[D]=O%a>>>0,O=O/a>>>0;if(O!==0)throw new Error("Non-zero carry");w=k,N++}for(var M=A-w;M!==A&&S[M]===0;)M++;for(var P=c.repeat(g);M<A;++M)P+=t.charAt(S[M]);return P}function d(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;var g=0;if(m[g]!==" "){for(var w=0,N=0;m[g]===c;)w++,g++;for(var U=(m.length-g)*l+1>>>0,A=new Uint8Array(U);m[g];){var S=s[m.charCodeAt(g)];if(S===255)return;for(var O=0,k=U-1;(S!==0||O<N)&&k!==-1;k--,O++)S+=a*A[k]>>>0,A[k]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");N=O,g++}if(m[g]!==" "){for(var D=U-N;D!==U&&A[D]===0;)D++;for(var M=new Uint8Array(w+(U-D)),P=w;D!==U;)M[P++]=A[D++];return M}}}function p(m){var g=d(m);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:p}}var Jv=Zv,Qv=Jv,Wg=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},eE=t=>new TextEncoder().encode(t),tE=t=>new TextDecoder().decode(t),Tl=class{constructor(e,s,r){this.name=e,this.prefix=s,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Pl=class{constructor(e,s,r){if(this.name=e,this.prefix=s,s.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=s.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Gg(this,e)}},Cl=class{constructor(e){this.decoders=e}or(e){return Gg(this,e)}decode(e){let s=e[0],r=this.decoders[s];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},Gg=(t,e)=>new Cl(H(H({},t.decoders||{[t.prefix]:t}),e.decoders||{[e.prefix]:e})),Ol=class{constructor(e,s,r,n){this.name=e,this.prefix=s,this.baseEncode=r,this.baseDecode=n,this.encoder=new Tl(e,s,r),this.decoder=new Pl(e,s,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Ho=({name:t,prefix:e,encode:s,decode:r})=>new Ol(t,e,s,r),ci=({prefix:t,name:e,alphabet:s})=>{let{encode:r,decode:n}=Qv(s,e);return Ho({prefix:t,name:e,encode:r,decode:i=>Wg(n(i))})},sE=(t,e,s,r)=>{let n={};for(let u=0;u<e.length;++u)n[e[u]]=u;let i=t.length;for(;t[i-1]==="=";)--i;let o=new Uint8Array(i*s/8|0),a=0,c=0,l=0;for(let u=0;u<i;++u){let h=n[t[u]];if(h===void 0)throw new SyntaxError(`Non-${r} character`);c=c<<s|h,a+=s,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=s||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},rE=(t,e,s)=>{let r=e[e.length-1]==="=",n=(1<<s)-1,i="",o=0,a=0;for(let c=0;c<t.length;++c)for(a=a<<8|t[c],o+=8;o>s;)o-=s,i+=e[n&a>>o];if(o&&(i+=e[n&a<<s-o]),r)for(;i.length*s&7;)i+="=";return i},Me=({name:t,prefix:e,bitsPerChar:s,alphabet:r})=>Ho({prefix:e,name:t,encode(n){return rE(n,r,s)},decode(n){return sE(n,r,s,t)}}),nE=Ho({prefix:"\0",name:"identity",encode:t=>tE(t),decode:t=>eE(t)}),iE=Object.freeze({__proto__:null,identity:nE}),oE=Me({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),aE=Object.freeze({__proto__:null,base2:oE}),cE=Me({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),lE=Object.freeze({__proto__:null,base8:cE}),uE=ci({prefix:"9",name:"base10",alphabet:"0123456789"}),hE=Object.freeze({__proto__:null,base10:uE}),dE=Me({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),fE=Me({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),pE=Object.freeze({__proto__:null,base16:dE,base16upper:fE}),gE=Me({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),mE=Me({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),yE=Me({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),wE=Me({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),bE=Me({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),vE=Me({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),EE=Me({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),xE=Me({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),SE=Me({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),IE=Object.freeze({__proto__:null,base32:gE,base32upper:mE,base32pad:yE,base32padupper:wE,base32hex:bE,base32hexupper:vE,base32hexpad:EE,base32hexpadupper:xE,base32z:SE}),AE=ci({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),_E=ci({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),TE=Object.freeze({__proto__:null,base36:AE,base36upper:_E}),PE=ci({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),CE=ci({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),OE=Object.freeze({__proto__:null,base58btc:PE,base58flickr:CE}),RE=Me({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),NE=Me({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),kE=Me({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),UE=Me({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),BE=Object.freeze({__proto__:null,base64:RE,base64pad:NE,base64url:kE,base64urlpad:UE}),Yg=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),DE=Yg.reduce((t,e,s)=>(t[s]=e,t),[]),LE=Yg.reduce((t,e,s)=>(t[e.codePointAt(0)]=s,t),[]);function qE(t){return t.reduce((e,s)=>(e+=DE[s],e),"")}function ME(t){let e=[];for(let s of t){let r=LE[s.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${s}`);e.push(r)}return new Uint8Array(e)}var FE=Ho({prefix:"\u{1F680}",name:"base256emoji",encode:qE,decode:ME}),$E=Object.freeze({__proto__:null,base256emoji:FE}),jE=Xg,vg=128,zE=127,HE=~zE,VE=Math.pow(2,31);function Xg(t,e,s){e=e||[],s=s||0;for(var r=s;t>=VE;)e[s++]=t&255|vg,t/=128;for(;t&HE;)e[s++]=t&255|vg,t>>>=7;return e[s]=t|0,Xg.bytes=s-r+1,e}var KE=Rl,WE=128,Eg=127;function Rl(t,r){var s=0,r=r||0,n=0,i=r,o,a=t.length;do{if(i>=a)throw Rl.bytes=0,new RangeError("Could not decode varint");o=t[i++],s+=n<28?(o&Eg)<<n:(o&Eg)*Math.pow(2,n),n+=7}while(o>=WE);return Rl.bytes=i-r,s}var GE=Math.pow(2,7),YE=Math.pow(2,14),XE=Math.pow(2,21),ZE=Math.pow(2,28),JE=Math.pow(2,35),QE=Math.pow(2,42),ex=Math.pow(2,49),tx=Math.pow(2,56),sx=Math.pow(2,63),rx=function(t){return t<GE?1:t<YE?2:t<XE?3:t<ZE?4:t<JE?5:t<QE?6:t<ex?7:t<tx?8:t<sx?9:10},nx={encode:jE,decode:KE,encodingLength:rx},Zg=nx,xg=(t,e,s=0)=>(Zg.encode(t,e,s),e),Sg=t=>Zg.encodingLength(t),Nl=(t,e)=>{let s=e.byteLength,r=Sg(t),n=r+Sg(s),i=new Uint8Array(n+s);return xg(t,i,0),xg(s,i,r),i.set(e,n),new kl(t,s,e,i)},kl=class{constructor(e,s,r,n){this.code=e,this.size=s,this.digest=r,this.bytes=n}},Jg=({name:t,code:e,encode:s})=>new Ul(t,e,s),Ul=class{constructor(e,s,r){this.name=e,this.code=s,this.encode=r}digest(e){if(e instanceof Uint8Array){let s=this.encode(e);return s instanceof Uint8Array?Nl(this.code,s):s.then(r=>Nl(this.code,r))}else throw Error("Unknown type, must be binary type")}},Qg=t=>e=>f(void 0,null,function*(){return new Uint8Array(yield crypto.subtle.digest(t,e))}),ix=Jg({name:"sha2-256",code:18,encode:Qg("SHA-256")}),ox=Jg({name:"sha2-512",code:19,encode:Qg("SHA-512")}),ax=Object.freeze({__proto__:null,sha256:ix,sha512:ox}),em=0,cx="identity",tm=Wg,lx=t=>Nl(em,tm(t)),ux={code:em,name:cx,encode:tm,digest:lx},hx=Object.freeze({__proto__:null,identity:ux});new TextEncoder,new TextDecoder;var Ig=H(H(H(H(H(H(H(H(H(H({},iE),aE),lE),hE),pE),IE),TE),OE),BE),$E);H(H({},ax),hx);function sm(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function dx(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?sm(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function rm(t,e,s,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:s},decoder:{decode:r}}}var Ag=rm("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Sl=rm("ascii","a",t=>{let e="a";for(let s=0;s<t.length;s++)e+=String.fromCharCode(t[s]);return e},t=>{t=t.substring(1);let e=dx(t.length);for(let s=0;s<t.length;s++)e[s]=t.charCodeAt(s);return e}),fx=H({utf8:Ag,"utf-8":Ag,hex:Ig.base16,latin1:Sl,ascii:Sl,binary:Sl},Ig);function px(t,e="utf8"){let s=fx[e];if(!s)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?sm(globalThis.Buffer.from(t,"utf-8")):s.decoder.decode(`${s.prefix}${t}`)}var gx=Object.defineProperty,mx=(t,e,s)=>e in t?gx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,us=(t,e,s)=>mx(t,typeof e!="symbol"?e+"":e,s),Bl=class{constructor(e,s){this.core=e,this.logger=s,us(this,"keychain",new Map),us(this,"name",Ev),us(this,"version",xv),us(this,"initialized",!1),us(this,"storagePrefix",ds),us(this,"init",()=>f(this,null,function*(){if(!this.initialized){let r=yield this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}})),us(this,"has",r=>(this.isInitialized(),this.keychain.has(r))),us(this,"set",(r,n)=>f(this,null,function*(){this.isInitialized(),this.keychain.set(r,n),yield this.persist()})),us(this,"get",r=>{this.isInitialized();let n=this.keychain.get(r);if(typeof n>"u"){let{message:i}=j("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(i)}return n}),us(this,"del",r=>f(this,null,function*(){this.isInitialized(),this.keychain.delete(r),yield this.persist()})),this.core=e,this.logger=ut(s,this.name)}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}setKeyChain(e){return f(this,null,function*(){yield this.core.storage.setItem(this.storageKey,Po(e))})}getKeyChain(){return f(this,null,function*(){let e=yield this.core.storage.getItem(this.storageKey);return typeof e<"u"?Co(e):void 0})}persist(){return f(this,null,function*(){yield this.setKeyChain(this.keychain)})}isInitialized(){if(!this.initialized){let{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}},yx=Object.defineProperty,wx=(t,e,s)=>e in t?yx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ke=(t,e,s)=>wx(t,typeof e!="symbol"?e+"":e,s),Dl=class{constructor(e,s,r){this.core=e,this.logger=s,ke(this,"name",bv),ke(this,"keychain"),ke(this,"randomSessionIdentifier",Fo()),ke(this,"initialized",!1),ke(this,"clientId"),ke(this,"init",()=>f(this,null,function*(){this.initialized||(yield this.keychain.init(),this.initialized=!0)})),ke(this,"hasKeys",n=>(this.isInitialized(),this.keychain.has(n))),ke(this,"getClientId",()=>f(this,null,function*(){if(this.isInitialized(),this.clientId)return this.clientId;let n=yield this.getClientSeed(),i=aa(n),o=rh(i.publicKey);return this.clientId=o,o})),ke(this,"generateKeyPair",()=>{this.isInitialized();let n=qp();return this.setPrivateKey(n.publicKey,n.privateKey)}),ke(this,"signJWT",n=>f(this,null,function*(){this.isInitialized();let i=yield this.getClientSeed(),o=aa(i),a=this.randomSessionIdentifier;return yield nh(a,n,vv,o)})),ke(this,"generateSharedKey",(n,i,o)=>{this.isInitialized();let a=this.getPrivateKey(n),c=Mp(a,i);return this.setSymKey(c,o)}),ke(this,"setSymKey",(n,i)=>f(this,null,function*(){this.isInitialized();let o=i||Qr(n);return yield this.keychain.set(o,n),o})),ke(this,"deleteKeyPair",n=>f(this,null,function*(){this.isInitialized(),yield this.keychain.del(n)})),ke(this,"deleteSymKey",n=>f(this,null,function*(){this.isInitialized(),yield this.keychain.del(n)})),ke(this,"encode",(n,i,o)=>f(this,null,function*(){this.isInitialized();let a=hl(o),c=Ju(i);if(fl(a))return Vp(c,o?.encoding);if(dl(a)){let d=a.senderPublicKey,p=a.receiverPublicKey;n=yield this.generateSharedKey(d,p)}let l=this.getSymKey(n),{type:u,senderPublicKey:h}=a;return zp({type:u,symKey:l,message:c,senderPublicKey:h,encoding:o?.encoding})})),ke(this,"decode",(n,i,o)=>f(this,null,function*(){this.isInitialized();let a=Gp(i,o);if(fl(a)){let c=Kp(i,o?.encoding);return ia(c)}if(dl(a)){let c=a.receiverPublicKey,l=a.senderPublicKey;n=yield this.generateSharedKey(c,l)}try{let c=this.getSymKey(n),l=Hp({symKey:c,encoded:i,encoding:o?.encoding});return ia(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${n}', clientId: '${yield this.getClientId()}'`),this.logger.error(c)}})),ke(this,"getPayloadType",(n,i=Ze)=>{let o=en({encoded:n,encoding:i});return Qs(o.type)}),ke(this,"getPayloadSenderPublicKey",(n,i=Ze)=>{let o=en({encoded:n,encoding:i});return o.senderPublicKey?Be(o.senderPublicKey,Xe):void 0}),this.core=e,this.logger=ut(s,this.name),this.keychain=r||new Bl(this.core,this.logger)}get context(){return rt(this.logger)}setPrivateKey(e,s){return f(this,null,function*(){return yield this.keychain.set(e,s),e})}getPrivateKey(e){return this.keychain.get(e)}getClientSeed(){return f(this,null,function*(){let e="";try{e=this.keychain.get(wg)}catch{e=Fo(),yield this.keychain.set(wg,e)}return px(e,"base16")})}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){let{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}},bx=Object.defineProperty,vx=Object.defineProperties,Ex=Object.getOwnPropertyDescriptors,_g=Object.getOwnPropertySymbols,xx=Object.prototype.hasOwnProperty,Sx=Object.prototype.propertyIsEnumerable,Ll=(t,e,s)=>e in t?bx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Ix=(t,e)=>{for(var s in e||(e={}))xx.call(e,s)&&Ll(t,s,e[s]);if(_g)for(var s of _g(e))Sx.call(e,s)&&Ll(t,s,e[s]);return t},Ax=(t,e)=>vx(t,Ex(e)),Pt=(t,e,s)=>Ll(t,typeof e!="symbol"?e+"":e,s),ql=class extends vi{constructor(e,s){super(e,s),this.logger=e,this.core=s,Pt(this,"messages",new Map),Pt(this,"messagesWithoutClientAck",new Map),Pt(this,"name",Sv),Pt(this,"version",Iv),Pt(this,"initialized",!1),Pt(this,"storagePrefix",ds),Pt(this,"init",()=>f(this,null,function*(){if(!this.initialized){this.logger.trace("Initialized");try{let r=yield this.getRelayerMessages();typeof r<"u"&&(this.messages=r);let n=yield this.getRelayerMessagesWithoutClientAck();typeof n<"u"&&(this.messagesWithoutClientAck=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}})),Pt(this,"set",(r,n,i)=>f(this,null,function*(){this.isInitialized();let o=wt(n),a=this.messages.get(r);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=n,this.messages.set(r,a),i===jo.inbound){let c=this.messagesWithoutClientAck.get(r)||{};this.messagesWithoutClientAck.set(r,Ax(Ix({},c),{[o]:n}))}return yield this.persist(),o})),Pt(this,"get",r=>{this.isInitialized();let n=this.messages.get(r);return typeof n>"u"&&(n={}),n}),Pt(this,"getWithoutAck",r=>{this.isInitialized();let n={};for(let i of r){let o=this.messagesWithoutClientAck.get(i)||{};n[i]=Object.values(o)}return n}),Pt(this,"has",(r,n)=>{this.isInitialized();let i=this.get(r),o=wt(n);return typeof i[o]<"u"}),Pt(this,"ack",(r,n)=>f(this,null,function*(){this.isInitialized();let i=this.messagesWithoutClientAck.get(r);if(typeof i>"u")return;let o=wt(n);delete i[o],Object.keys(i).length===0?this.messagesWithoutClientAck.delete(r):this.messagesWithoutClientAck.set(r,i),yield this.persist()})),Pt(this,"del",r=>f(this,null,function*(){this.isInitialized(),this.messages.delete(r),this.messagesWithoutClientAck.delete(r),yield this.persist()})),this.logger=ut(e,this.name),this.core=s}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}setRelayerMessages(e){return f(this,null,function*(){yield this.core.storage.setItem(this.storageKey,Po(e))})}setRelayerMessagesWithoutClientAck(e){return f(this,null,function*(){yield this.core.storage.setItem(this.storageKeyWithoutClientAck,Po(e))})}getRelayerMessages(){return f(this,null,function*(){let e=yield this.core.storage.getItem(this.storageKey);return typeof e<"u"?Co(e):void 0})}getRelayerMessagesWithoutClientAck(){return f(this,null,function*(){let e=yield this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Co(e):void 0})}persist(){return f(this,null,function*(){yield this.setRelayerMessages(this.messages),yield this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)})}isInitialized(){if(!this.initialized){let{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}},_x=Object.defineProperty,Tx=Object.defineProperties,Px=Object.getOwnPropertyDescriptors,Tg=Object.getOwnPropertySymbols,Cx=Object.prototype.hasOwnProperty,Ox=Object.prototype.propertyIsEnumerable,Ml=(t,e,s)=>e in t?_x(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,rn=(t,e)=>{for(var s in e||(e={}))Cx.call(e,s)&&Ml(t,s,e[s]);if(Tg)for(var s of Tg(e))Ox.call(e,s)&&Ml(t,s,e[s]);return t},Pg=(t,e)=>Tx(t,Px(e)),Mt=(t,e,s)=>Ml(t,typeof e!="symbol"?e+"":e,s),Fl=class extends Ei{constructor(e,s){super(e,s),this.relayer=e,this.logger=s,Mt(this,"events",new Rs.EventEmitter),Mt(this,"name",_v),Mt(this,"queue",new Map),Mt(this,"publishTimeout",(0,K.toMiliseconds)(K.ONE_MINUTE)),Mt(this,"initialPublishTimeout",(0,K.toMiliseconds)(K.ONE_SECOND*15)),Mt(this,"needsTransportRestart",!1),Mt(this,"publish",(r,n,i)=>f(this,null,function*(){var o,a,c,l,u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:n,opts:i}});let h=i?.ttl||Av,d=i?.prompt||!1,p=i?.tag||0,m=i?.id||ms().toString(),g=Pr(ei().protocol),w={id:m,method:i?.publishMethod||g.publish,params:rn({topic:r,message:n,ttl:h,prompt:d,tag:p,attestation:i?.attestation},i?.tvf)},N=`Failed to publish payload, please try again. id:${m} tag:${p}`;try{Ae((o=w.params)==null?void 0:o.prompt)&&((a=w.params)==null||delete a.prompt),Ae((c=w.params)==null?void 0:c.tag)&&((l=w.params)==null||delete l.tag);let U=new Promise(A=>f(this,null,function*(){let S=({id:k})=>{var D;((D=w.id)==null?void 0:D.toString())===k.toString()&&(this.removeRequestFromQueue(k),this.relayer.events.removeListener(_e.publish,S),A())};this.relayer.events.on(_e.publish,S);let O=es(new Promise((k,D)=>{this.rpcPublish(w,i).then(k).catch(M=>{this.logger.warn(M,M?.message),D(M)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${m} tag:${p}`);try{yield O,this.events.removeListener(_e.publish,S)}catch(k){this.queue.set(m,{request:w,opts:i,attempt:1}),this.logger.warn(k,k?.message)}}));this.logger.trace({type:"method",method:"publish",params:{id:m,topic:r,message:n,opts:i}}),yield es(U,this.publishTimeout,N)}catch(U){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(U),(u=i?.internal)!=null&&u.throwOnFailedPublish)throw U}finally{this.queue.delete(m)}})),Mt(this,"publishCustom",r=>f(this,null,function*(){var n,i,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:r});let{payload:l,opts:u={}}=r,{attestation:h,tvf:d,publishMethod:p,prompt:m,tag:g,ttl:w=K.FIVE_MINUTES}=u,N=u.id||ms().toString(),U=Pr(ei().protocol),A=p||U.publish,S={id:N,method:A,params:rn(Pg(rn({},l),{ttl:w,prompt:m,tag:g,attestation:h}),d)},O=`Failed to publish custom payload, please try again. id:${N} tag:${g}`;try{Ae((n=S.params)==null?void 0:n.prompt)&&((i=S.params)==null||delete i.prompt),Ae((o=S.params)==null?void 0:o.tag)&&((a=S.params)==null||delete a.tag);let k=new Promise(D=>f(this,null,function*(){let M=({id:L})=>{var F;((F=S.id)==null?void 0:F.toString())===L.toString()&&(this.removeRequestFromQueue(L),this.relayer.events.removeListener(_e.publish,M),D())};this.relayer.events.on(_e.publish,M);let P=es(new Promise((L,F)=>{this.rpcPublish(S,u).then(L).catch(C=>{this.logger.warn(C,C?.message),F(C)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${A} id:${N} tag:${g}`);try{yield P,this.events.removeListener(_e.publish,M)}catch(L){this.queue.set(N,{request:S,opts:u,attempt:1}),this.logger.warn(L,L?.message)}}));this.logger.trace({type:"method",method:"publish",params:{id:N,payload:l,opts:u}}),yield es(k,this.publishTimeout,O)}catch(k){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(k),(c=u?.internal)!=null&&c.throwOnFailedPublish)throw k}finally{this.queue.delete(N)}})),Mt(this,"on",(r,n)=>{this.events.on(r,n)}),Mt(this,"once",(r,n)=>{this.events.once(r,n)}),Mt(this,"off",(r,n)=>{this.events.off(r,n)}),Mt(this,"removeListener",(r,n)=>{this.events.removeListener(r,n)}),this.relayer=e,this.logger=ut(s,this.name),this.registerEventListeners()}get context(){return rt(this.logger)}rpcPublish(e,s){return f(this,null,function*(){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});let r=yield this.relayer.request(e);return this.relayer.events.emit(_e.publish,rn(rn({},e),s)),this.logger.debug("Successfully Published Payload"),r})}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach((e,s)=>f(this,null,function*(){var r;let n=e.attempt+1;this.queue.set(s,Pg(rn({},e),{attempt:n})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(r=e.request.params)==null?void 0:r.tag}, attempt: ${n}`),yield this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)}))}registerEventListeners(){this.relayer.core.heartbeat.on(lr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(_e.connection_stalled);return}this.checkQueue()}),this.relayer.on(_e.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}},Rx=Object.defineProperty,Nx=(t,e,s)=>e in t?Rx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,nn=(t,e,s)=>Nx(t,typeof e!="symbol"?e+"":e,s),$l=class{constructor(){nn(this,"map",new Map),nn(this,"set",(e,s)=>{let r=this.get(e);this.exists(e,s)||this.map.set(e,[...r,s])}),nn(this,"get",e=>this.map.get(e)||[]),nn(this,"exists",(e,s)=>this.get(e).includes(s)),nn(this,"delete",(e,s)=>{if(typeof s>"u"){this.map.delete(e);return}if(!this.map.has(e))return;let r=this.get(e);if(!this.exists(e,s))return;let n=r.filter(i=>i!==s);if(!n.length){this.map.delete(e);return}this.map.set(e,n)}),nn(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}},kx=Object.defineProperty,Ux=Object.defineProperties,Bx=Object.getOwnPropertyDescriptors,Cg=Object.getOwnPropertySymbols,Dx=Object.prototype.hasOwnProperty,Lx=Object.prototype.propertyIsEnumerable,jl=(t,e,s)=>e in t?kx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ni=(t,e)=>{for(var s in e||(e={}))Dx.call(e,s)&&jl(t,s,e[s]);if(Cg)for(var s of Cg(e))Lx.call(e,s)&&jl(t,s,e[s]);return t},Il=(t,e)=>Ux(t,Bx(e)),me=(t,e,s)=>jl(t,typeof e!="symbol"?e+"":e,s),zl=class extends Ii{constructor(e,s){super(e,s),this.relayer=e,this.logger=s,me(this,"subscriptions",new Map),me(this,"topicMap",new $l),me(this,"events",new Rs.EventEmitter),me(this,"name",kv),me(this,"version",Uv),me(this,"pending",new Map),me(this,"cached",[]),me(this,"initialized",!1),me(this,"storagePrefix",ds),me(this,"subscribeTimeout",(0,K.toMiliseconds)(K.ONE_MINUTE)),me(this,"initialSubscribeTimeout",(0,K.toMiliseconds)(K.ONE_SECOND*15)),me(this,"clientId"),me(this,"batchSubscribeTopicsLimit",500),me(this,"init",()=>f(this,null,function*(){this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),yield this.restore()),this.initialized=!0})),me(this,"subscribe",(r,n)=>f(this,null,function*(){var i;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:n}});try{let o=ei(n),a={topic:r,relay:o,transportType:n?.transportType};(i=n?.internal)!=null&&i.skipSubscribe||this.pending.set(r,a);let c=yield this.rpcSubscribe(r,o,n);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:n}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}})),me(this,"unsubscribe",(r,n)=>f(this,null,function*(){this.isInitialized(),typeof n?.id<"u"?yield this.unsubscribeById(r,n.id,n):yield this.unsubscribeByTopic(r,n)})),me(this,"isSubscribed",r=>new Promise(n=>{n(this.topicMap.topics.includes(r))})),me(this,"isKnownTopic",r=>new Promise(n=>{n(this.topicMap.topics.includes(r)||this.pending.has(r)||this.cached.some(i=>i.topic===r))})),me(this,"on",(r,n)=>{this.events.on(r,n)}),me(this,"once",(r,n)=>{this.events.once(r,n)}),me(this,"off",(r,n)=>{this.events.off(r,n)}),me(this,"removeListener",(r,n)=>{this.events.removeListener(r,n)}),me(this,"start",()=>f(this,null,function*(){yield this.onConnect()})),me(this,"stop",()=>f(this,null,function*(){yield this.onDisconnect()})),me(this,"restart",()=>f(this,null,function*(){yield this.restore(),yield this.onRestart()})),me(this,"checkPending",()=>f(this,null,function*(){if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;let r=[];this.pending.forEach(n=>{r.push(n)}),yield this.batchSubscribe(r)})),me(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(lr.pulse,()=>f(this,null,function*(){yield this.checkPending()})),this.events.on(Ct.created,r=>f(this,null,function*(){let n=Ct.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:r}),yield this.persist()})),this.events.on(Ct.deleted,r=>f(this,null,function*(){let n=Ct.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:r}),yield this.persist()}))}),this.relayer=e,this.logger=ut(s,this.name),this.clientId=""}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,s){let r=!1;try{r=this.getSubscription(e).topic===s}catch{}return r}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}unsubscribeByTopic(e,s){return f(this,null,function*(){let r=this.topicMap.get(e);yield Promise.all(r.map(n=>f(this,null,function*(){return yield this.unsubscribeById(e,n,s)})))})}unsubscribeById(e,s,r){return f(this,null,function*(){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:s,opts:r}});try{let n=ei(r);yield this.restartToComplete({topic:e,id:s,relay:n}),yield this.rpcUnsubscribe(e,s,n);let i=ge("USER_DISCONNECTED",`${this.name}, ${e}`);yield this.onUnsubscribe(e,s,i),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:s,opts:r}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}})}rpcSubscribe(e,s,r){return f(this,null,function*(){var n,i;let o=yield this.getSubscriptionId(e);if((n=r?.internal)!=null&&n.skipSubscribe)return o;(!r||r?.transportType===we.relay)&&(yield this.restartToComplete({topic:e,id:e,relay:s}));let a={method:Pr(s.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});let c=(i=r?.internal)==null?void 0:i.throwOnFailedPublish;try{if(r?.transportType===we.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},(0,K.toMiliseconds)(K.ONE_SECOND)),o;let l=new Promise(h=>f(this,null,function*(){let d=p=>{p.topic===e&&(this.events.removeListener(Ct.created,d),h(p.id))};this.events.on(Ct.created,d);try{let p=yield es(new Promise((m,g)=>{this.relayer.request(a).catch(w=>{this.logger.warn(w,w?.message),g(w)}).then(m)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Ct.created,d),h(p)}catch{}})),u=yield es(l,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return u?o:null}catch(l){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(_e.connection_stalled),c)throw l}return null})}rpcBatchSubscribe(e){return f(this,null,function*(){if(!e.length)return;let s=e[0].relay,r={method:Pr(s.protocol).batchSubscribe,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{yield yield es(new Promise(n=>{this.relayer.request(r).catch(i=>this.logger.warn(i)).then(n)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(_e.connection_stalled)}})}rpcBatchFetchMessages(e){return f(this,null,function*(){if(!e.length)return;let s=e[0].relay,r={method:Pr(s.protocol).batchFetchMessages,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});let n;try{n=yield yield es(new Promise((i,o)=>{this.relayer.request(r).catch(a=>{this.logger.warn(a),o(a)}).then(i)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(_e.connection_stalled)}return n})}rpcUnsubscribe(e,s,r){let n={method:Pr(r.protocol).unsubscribe,params:{topic:e,id:s}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}onSubscribe(e,s){this.setSubscription(e,Il(ni({},s),{id:e})),this.pending.delete(s.topic)}onBatchSubscribe(e){e.length&&e.forEach(s=>{this.setSubscription(s.id,ni({},s)),this.pending.delete(s.topic)})}onUnsubscribe(e,s,r){return f(this,null,function*(){this.events.removeAllListeners(s),this.hasSubscription(s,e)&&this.deleteSubscription(s,r),yield this.relayer.messages.del(e)})}setRelayerSubscriptions(e){return f(this,null,function*(){yield this.relayer.core.storage.setItem(this.storageKey,e)})}getRelayerSubscriptions(){return f(this,null,function*(){return yield this.relayer.core.storage.getItem(this.storageKey)})}setSubscription(e,s){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:s}),this.addSubscription(e,s)}addSubscription(e,s){this.subscriptions.set(e,ni({},s)),this.topicMap.set(s.topic,e),this.events.emit(Ct.created,s)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});let s=this.subscriptions.get(e);if(!s){let{message:r}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return s}deleteSubscription(e,s){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:s});let r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(Ct.deleted,Il(ni({},r),{reason:s}))}persist(){return f(this,null,function*(){yield this.setRelayerSubscriptions(this.values),this.events.emit(Ct.sync)})}onRestart(){return f(this,null,function*(){if(this.cached.length){let e=[...this.cached],s=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<s;r++){let n=e.splice(0,this.batchSubscribeTopicsLimit);yield this.batchSubscribe(n)}}this.events.emit(Ct.resubscribed)})}restore(){return f(this,null,function*(){try{let e=yield this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(s=>{var r;return s.topic===((r=this.subscriptions.get(s.id))==null?void 0:r.topic)})){let{message:s}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}})}batchSubscribe(e){return f(this,null,function*(){e.length&&(yield this.rpcBatchSubscribe(e),this.onBatchSubscribe(yield Promise.all(e.map(s=>f(this,null,function*(){return Il(ni({},s),{id:yield this.getSubscriptionId(s.topic)})})))))})}batchFetchMessages(e){return f(this,null,function*(){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);let s=yield this.rpcBatchFetchMessages(e);s&&s.messages&&(yield zf((0,K.toMiliseconds)(K.ONE_SECOND)),yield this.relayer.handleBatchMessageEvents(s.messages))})}onConnect(){return f(this,null,function*(){yield this.restart(),this.reset()})}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}restartToComplete(e){return f(this,null,function*(){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),yield this.relayer.transportOpen())})}getClientId(){return f(this,null,function*(){return this.clientId||(this.clientId=yield this.relayer.core.crypto.getClientId()),this.clientId})}getSubscriptionId(e){return f(this,null,function*(){return wt(e+(yield this.getClientId()))})}},qx=Object.defineProperty,Og=Object.getOwnPropertySymbols,Mx=Object.prototype.hasOwnProperty,Fx=Object.prototype.propertyIsEnumerable,Hl=(t,e,s)=>e in t?qx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Rg=(t,e)=>{for(var s in e||(e={}))Mx.call(e,s)&&Hl(t,s,e[s]);if(Og)for(var s of Og(e))Fx.call(e,s)&&Hl(t,s,e[s]);return t},ce=(t,e,s)=>Hl(t,typeof e!="symbol"?e+"":e,s),Vl=class extends xi{constructor(e){var s;super(e),ce(this,"protocol","wc"),ce(this,"version",2),ce(this,"core"),ce(this,"logger"),ce(this,"events",new Rs.EventEmitter),ce(this,"provider"),ce(this,"messages"),ce(this,"subscriber"),ce(this,"publisher"),ce(this,"name",Pv),ce(this,"transportExplicitlyClosed",!1),ce(this,"initialized",!1),ce(this,"connectionAttemptInProgress",!1),ce(this,"relayUrl"),ce(this,"projectId"),ce(this,"packageName"),ce(this,"bundleId"),ce(this,"hasExperiencedNetworkDisruption",!1),ce(this,"pingTimeout"),ce(this,"heartBeatTimeout",(0,K.toMiliseconds)(K.THIRTY_SECONDS+K.FIVE_SECONDS)),ce(this,"reconnectTimeout"),ce(this,"connectPromise"),ce(this,"reconnectInProgress",!1),ce(this,"requestsInFlight",[]),ce(this,"connectTimeout",(0,K.toMiliseconds)(K.ONE_SECOND*15)),ce(this,"request",r=>f(this,null,function*(){var n,i;this.logger.debug("Publishing Request Payload");let o=r.id||ms().toString();yield this.toEstablishConnection();try{this.logger.trace({id:o,method:r.method,topic:(n=r.params)==null?void 0:n.topic},"relayer.request - publishing...");let a=`${o}:${((i=r.params)==null?void 0:i.tag)||""}`;this.requestsInFlight.push(a);let c=yield this.provider.request(r);return this.requestsInFlight=this.requestsInFlight.filter(l=>l!==a),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${o}`),a}})),ce(this,"resetPingTimeout",()=>{Kn()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,n,i,o;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(o=(i=(n=(r=this.provider)==null?void 0:r.connection)==null?void 0:n.socket)==null?void 0:i.terminate)==null||o.call(i)}catch(a){this.logger.warn(a,a?.message)}},this.heartBeatTimeout))}),ce(this,"onPayloadHandler",r=>{this.onProviderPayload(r),this.resetPingTimeout()}),ce(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1F6DC}"),this.startPingTimeout(),this.events.emit(_e.connect)}),ce(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1F6D1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),ce(this,"onProviderErrorHandler",r=>{this.logger.fatal(`Fatal socket error: ${r.message}`),this.events.emit(_e.error,r),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),ce(this,"registerProviderListeners",()=>{this.provider.on(qt.payload,this.onPayloadHandler),this.provider.on(qt.connect,this.onConnectHandler),this.provider.on(qt.disconnect,this.onDisconnectHandler),this.provider.on(qt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=sn({logger:(s=e.logger)!=null?s:Tv,name:this.name}),this.messages=new ql(this.logger,e.core),this.subscriber=new zl(this,this.logger),this.publisher=new Fl(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Vg,kf()?this.packageName=Kc():Uf()&&(this.bundleId=Kc()),this.provider={}}init(){return f(this,null,function*(){this.logger.trace("Initialized"),this.registerEventListeners(),yield Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))})}get context(){return rt(this.logger)}get connected(){var e,s,r;return((r=(s=(e=this.provider)==null?void 0:e.connection)==null?void 0:s.socket)==null?void 0:r.readyState)===1||!1}get connecting(){var e,s,r;return((r=(s=(e=this.provider)==null?void 0:e.connection)==null?void 0:s.socket)==null?void 0:r.readyState)===0||this.connectPromise!==void 0||!1}publish(e,s,r){return f(this,null,function*(){this.isInitialized(),yield this.publisher.publish(e,s,r),yield this.recordMessageEvent({topic:e,message:s,publishedAt:Date.now(),transportType:we.relay},jo.outbound)})}publishCustom(e){return f(this,null,function*(){this.isInitialized(),yield this.publisher.publishCustom(e)})}subscribe(e,s){return f(this,null,function*(){var r,n,i;this.isInitialized(),(!(s!=null&&s.transportType)||s?.transportType==="relay")&&(yield this.toEstablishConnection());let o=typeof((r=s?.internal)==null?void 0:r.throwOnFailedPublish)>"u"?!0:(n=s?.internal)==null?void 0:n.throwOnFailedPublish,a=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"",c,l=u=>{u.topic===e&&(this.subscriber.off(Ct.created,l),c())};return yield Promise.all([new Promise(u=>{c=u,this.subscriber.on(Ct.created,l)}),new Promise((u,h)=>f(this,null,function*(){a=(yield this.subscriber.subscribe(e,Rg({internal:{throwOnFailedPublish:o}},s)).catch(d=>{o&&h(d)}))||a,u()}))]),a})}unsubscribe(e,s){return f(this,null,function*(){this.isInitialized(),yield this.subscriber.unsubscribe(e,s)})}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}off(e,s){this.events.off(e,s)}removeListener(e,s){this.events.removeListener(e,s)}transportDisconnect(){return f(this,null,function*(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?yield es(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()})}transportClose(){return f(this,null,function*(){this.transportExplicitlyClosed=!0,yield this.transportDisconnect()})}transportOpen(e){return f(this,null,function*(){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),yield this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise((s,r)=>f(this,null,function*(){yield this.connect(e).then(s).catch(r).finally(()=>{this.connectPromise=void 0})})),yield this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)})}restartTransport(e){return f(this,null,function*(){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,yield this.confirmOnlineStateOrThrow(),yield this.transportClose(),yield this.transportOpen())})}confirmOnlineStateOrThrow(){return f(this,null,function*(){if(!(yield xl()))throw new Error("No internet connection detected. Please restart your network and try again.")})}handleBatchMessageEvents(e){return f(this,null,function*(){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}let s=e.sort((r,n)=>r.publishedAt-n.publishedAt);this.logger.debug(`Batch of ${s.length} message events sorted`);for(let r of s)try{yield this.onMessageEvent(r)}catch(n){this.logger.warn(n,"Error while processing batch message event: "+n?.message)}this.logger.trace(`Batch of ${s.length} message events processed`)})}onLinkMessageEvent(e,s){return f(this,null,function*(){let{topic:r}=e;if(!s.sessionExists){let n=xe(K.FIVE_MINUTES),i={topic:r,expiry:n,relay:{protocol:"irn"},active:!1};yield this.core.pairing.pairings.set(r,i)}this.events.emit(_e.message,e),yield this.recordMessageEvent(e,jo.inbound)})}connect(e){return f(this,null,function*(){yield this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,yield this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let s=1;for(;s<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${s}...`),yield this.createProvider(),yield new Promise((r,n)=>f(this,null,function*(){let i=()=>{n(new Error("Connection interrupted while trying to connect"))};this.provider.once(qt.disconnect,i),yield es(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{n(o)}).finally(()=>{this.provider.off(qt.disconnect,i),clearTimeout(this.reconnectTimeout)}),yield new Promise((o,a)=>f(this,null,function*(){let c=()=>{n(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(qt.disconnect,c),yield this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(qt.disconnect,c)})})),this.hasExperiencedNetworkDisruption=!1,r()}))}catch(r){yield this.subscriber.stop();let n=r;this.logger.warn({},n.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${s}`);break}yield new Promise(r=>setTimeout(r,(0,K.toMiliseconds)(s*1))),s++}})}startPingTimeout(){var e,s,r,n,i;if(Kn())try{(s=(e=this.provider)==null?void 0:e.connection)!=null&&s.socket&&((i=(n=(r=this.provider)==null?void 0:r.connection)==null?void 0:n.socket)==null||i.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}createProvider(){return f(this,null,function*(){this.provider.connection&&this.unregisterProviderListeners();let e=yield this.core.crypto.signJWT(this.relayUrl);this.provider=new vn(new ch(Df({sdkVersion:_l,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()})}recordMessageEvent(e,s){return f(this,null,function*(){let{topic:r,message:n}=e;yield this.messages.set(r,n,s)})}shouldIgnoreMessageEvent(e){return f(this,null,function*(){let{topic:s,message:r}=e;if(!r||r.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${r}`),!0;if(!(yield this.subscriber.isKnownTopic(s)))return this.logger.warn(`Ignoring message for unknown topic ${s}`),!0;let n=this.messages.has(s,r);return n&&this.logger.warn(`Ignoring duplicate message: ${r}`),n})}onProviderPayload(e){return f(this,null,function*(){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),wn(e)){if(!e.method.endsWith(Cv))return;let s=e.params,{topic:r,message:n,publishedAt:i,attestation:o}=s.data,a={topic:r,message:n,publishedAt:i,transportType:we.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Rg({type:"event",event:s.id},a)),this.events.emit(s.id,a),yield this.acknowledgePayload(e),yield this.onMessageEvent(a)}else bn(e)&&this.events.emit(_e.message_ack,e)})}onMessageEvent(e){return f(this,null,function*(){(yield this.shouldIgnoreMessageEvent(e))||(yield this.recordMessageEvent(e,jo.inbound),this.events.emit(_e.message,e))})}acknowledgePayload(e){return f(this,null,function*(){let s=Bs(e.id,!0);yield this.provider.connection.send(s)})}unregisterProviderListeners(){this.provider.off(qt.payload,this.onPayloadHandler),this.provider.off(qt.connect,this.onConnectHandler),this.provider.off(qt.disconnect,this.onDisconnectHandler),this.provider.off(qt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}registerEventListeners(){return f(this,null,function*(){let e=yield xl();gg(s=>f(this,null,function*(){e!==s&&(e=s,s?yield this.transportOpen().catch(r=>this.logger.error(r,r?.message)):(this.hasExperiencedNetworkDisruption=!0,yield this.transportDisconnect(),this.transportExplicitlyClosed=!1))})),this.core.heartbeat.on(lr.pulse,()=>f(this,null,function*(){if(!this.transportExplicitlyClosed&&!this.connected&&mg())try{yield this.confirmOnlineStateOrThrow(),yield this.transportOpen()}catch(s){this.logger.warn(s,s?.message)}}))})}onProviderDisconnect(){return f(this,null,function*(){clearTimeout(this.pingTimeout),this.events.emit(_e.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,yield this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(()=>f(this,null,function*(){yield this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1}),(0,K.toMiliseconds)(Ov)))))})}isInitialized(){if(!this.initialized){let{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}toEstablishConnection(){return f(this,null,function*(){if(yield this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){yield this.connectPromise;return}yield this.connect()}})}};function $x(t,e){return t===e||Number.isNaN(t)&&Number.isNaN(e)}function Ng(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function kg(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}var jx="[object RegExp]",zx="[object String]",Hx="[object Number]",Vx="[object Boolean]",Ug="[object Arguments]",Kx="[object Symbol]",Wx="[object Date]",Gx="[object Map]",Yx="[object Set]",Xx="[object Array]",Zx="[object Function]",Jx="[object ArrayBuffer]",Al="[object Object]",Qx="[object Error]",e2="[object DataView]",t2="[object Uint8Array]",s2="[object Uint8ClampedArray]",r2="[object Uint16Array]",n2="[object Uint32Array]",i2="[object BigUint64Array]",o2="[object Int8Array]",a2="[object Int16Array]",c2="[object Int32Array]",l2="[object BigInt64Array]",u2="[object Float32Array]",h2="[object Float64Array]";function d2(){}function Bg(t){if(!t||typeof t!="object")return!1;let e=Object.getPrototypeOf(t);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(t)==="[object Object]":!1}function f2(t,e,s){return oi(t,e,void 0,void 0,void 0,void 0,s)}function oi(t,e,s,r,n,i,o){let a=o(t,e,s,r,n,i);if(a!==void 0)return a;if(typeof t==typeof e)switch(typeof t){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return t===e;case"number":return t===e||Object.is(t,e);case"function":return t===e;case"object":return ai(t,e,i,o)}return ai(t,e,i,o)}function ai(t,e,s,r){if(Object.is(t,e))return!0;let n=kg(t),i=kg(e);if(n===Ug&&(n=Al),i===Ug&&(i=Al),n!==i)return!1;switch(n){case zx:return t.toString()===e.toString();case Hx:{let c=t.valueOf(),l=e.valueOf();return $x(c,l)}case Vx:case Wx:case Kx:return Object.is(t.valueOf(),e.valueOf());case jx:return t.source===e.source&&t.flags===e.flags;case Zx:return t===e}s=s??new Map;let o=s.get(t),a=s.get(e);if(o!=null&&a!=null)return o===e;s.set(t,e),s.set(e,t);try{switch(n){case Gx:{if(t.size!==e.size)return!1;for(let[c,l]of t.entries())if(!e.has(c)||!oi(l,e.get(c),c,t,e,s,r))return!1;return!0}case Yx:{if(t.size!==e.size)return!1;let c=Array.from(t.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){let h=c[u],d=l.findIndex(p=>oi(h,p,void 0,t,e,s,r));if(d===-1)return!1;l.splice(d,1)}return!0}case Xx:case t2:case s2:case r2:case n2:case i2:case o2:case a2:case c2:case l2:case u2:case h2:{if(typeof Buffer<"u"&&Buffer.isBuffer(t)!==Buffer.isBuffer(e)||t.length!==e.length)return!1;for(let c=0;c<t.length;c++)if(!oi(t[c],e[c],c,t,e,s,r))return!1;return!0}case Jx:return t.byteLength!==e.byteLength?!1:ai(new Uint8Array(t),new Uint8Array(e),s,r);case e2:return t.byteLength!==e.byteLength||t.byteOffset!==e.byteOffset?!1:ai(new Uint8Array(t),new Uint8Array(e),s,r);case Qx:return t.name===e.name&&t.message===e.message;case Al:{if(!(ai(t.constructor,e.constructor,s,r)||Bg(t)&&Bg(e)))return!1;let c=[...Object.keys(t),...Ng(t)],l=[...Object.keys(e),...Ng(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){let h=c[u],d=t[h];if(!Object.hasOwn(e,h))return!1;let p=e[h];if(!oi(d,p,h,t,e,s,r))return!1}return!0}default:return!1}}finally{s.delete(t),s.delete(e)}}function p2(t,e){return f2(t,e,d2)}var g2=Object.defineProperty,Dg=Object.getOwnPropertySymbols,m2=Object.prototype.hasOwnProperty,y2=Object.prototype.propertyIsEnumerable,Kl=(t,e,s)=>e in t?g2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Lg=(t,e)=>{for(var s in e||(e={}))m2.call(e,s)&&Kl(t,s,e[s]);if(Dg)for(var s of Dg(e))y2.call(e,s)&&Kl(t,s,e[s]);return t},bt=(t,e,s)=>Kl(t,typeof e!="symbol"?e+"":e,s),fs=class extends Si{constructor(e,s,r,n=ds,i=void 0){super(e,s,r,n),this.core=e,this.logger=s,this.name=r,bt(this,"map",new Map),bt(this,"version",Rv),bt(this,"cached",[]),bt(this,"initialized",!1),bt(this,"getKey"),bt(this,"storagePrefix",ds),bt(this,"recentlyDeleted",[]),bt(this,"recentlyDeletedLimit",200),bt(this,"init",()=>f(this,null,function*(){this.initialized||(this.logger.trace("Initialized"),yield this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Ae(o)?this.map.set(this.getKey(o),o):tg(o)?this.map.set(o.id,o):sg(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)})),bt(this,"set",(o,a)=>f(this,null,function*(){this.isInitialized(),this.map.has(o)?yield this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),yield this.persist())})),bt(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),bt(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>p2(a[c],o[c]))):this.values)),bt(this,"update",(o,a)=>f(this,null,function*(){this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});let c=Lg(Lg({},this.getData(o)),a);this.map.set(o,c),yield this.persist()})),bt(this,"delete",(o,a)=>f(this,null,function*(){this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),yield this.persist())})),this.logger=ut(s,this.name),this.storagePrefix=n,this.getKey=i}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}setDataStore(e){return f(this,null,function*(){yield this.core.storage.setItem(this.storageKey,e)})}getDataStore(){return f(this,null,function*(){return yield this.core.storage.getItem(this.storageKey)})}getData(e){let s=this.map.get(e);if(!s){if(this.recentlyDeleted.includes(e)){let{message:n}=j("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}let{message:r}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return s}persist(){return f(this,null,function*(){yield this.setDataStore(this.values)})}restore(){return f(this,null,function*(){try{let e=yield this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){let{message:s}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}})}isInitialized(){if(!this.initialized){let{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}},w2=Object.defineProperty,b2=(t,e,s)=>e in t?w2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,re=(t,e,s)=>b2(t,typeof e!="symbol"?e+"":e,s),Wl=class{constructor(e,s){this.core=e,this.logger=s,re(this,"name",Bv),re(this,"version",Dv),re(this,"events",new Rs.default),re(this,"pairings"),re(this,"initialized",!1),re(this,"storagePrefix",ds),re(this,"ignoredPayloadTypes",[ts]),re(this,"registeredMethods",[]),re(this,"init",()=>f(this,null,function*(){this.initialized||(yield this.pairings.init(),yield this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))})),re(this,"register",({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]}),re(this,"create",r=>f(this,null,function*(){this.isInitialized();let n=Fo(),i=yield this.core.crypto.setSymKey(n),o=xe(K.FIVE_MINUTES),a={protocol:su},c={topic:i,expiry:o,relay:a,active:!1,methods:r?.methods},l=gl({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:n,relay:a,expiryTimestamp:o,methods:r?.methods});return this.events.emit(sr.create,c),this.core.expirer.set(i,o),yield this.pairings.set(i,c),yield this.core.relayer.subscribe(i,{transportType:r?.transportType,internal:r?.internal}),{topic:i,uri:l}})),re(this,"pair",r=>f(this,null,function*(){this.isInitialized();let n=this.core.eventClient.createEvent({properties:{topic:r?.uri,trace:[ns.pairing_started]}});this.isValidPair(r,n);let{topic:i,symKey:o,relay:a,expiryTimestamp:c,methods:l}=pl(r.uri);n.props.properties.topic=i,n.addTrace(ns.pairing_uri_validation_success),n.addTrace(ns.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(i)){if(u=this.pairings.get(i),n.addTrace(ns.existing_pairing),u.active)throw n.setError(hs.active_pairing_already_exists),new Error(`Pairing already exists: ${i}. Please try again with a new connection URI.`);n.addTrace(ns.pairing_not_expired)}let h=c||xe(K.FIVE_MINUTES),d={topic:i,relay:a,expiry:h,active:!1,methods:l};this.core.expirer.set(i,h),yield this.pairings.set(i,d),n.addTrace(ns.store_new_pairing),r.activatePairing&&(yield this.activate({topic:i})),this.events.emit(sr.create,d),n.addTrace(ns.emit_inactive_pairing),this.core.crypto.keychain.has(i)||(yield this.core.crypto.setSymKey(o,i)),n.addTrace(ns.subscribing_pairing_topic);try{yield this.core.relayer.confirmOnlineStateOrThrow()}catch{n.setError(hs.no_internet_connection)}try{yield this.core.relayer.subscribe(i,{relay:a})}catch(p){throw n.setError(hs.subscribe_pairing_topic_failure),p}return n.addTrace(ns.subscribe_pairing_topic_success),d})),re(this,"activate",n=>f(this,[n],function*({topic:r}){this.isInitialized();let i=xe(K.FIVE_MINUTES);this.core.expirer.set(r,i),yield this.pairings.update(r,{active:!0,expiry:i})})),re(this,"ping",r=>f(this,null,function*(){this.isInitialized(),yield this.isValidPing(r),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:n}=r;if(this.pairings.keys.includes(n)){let i=yield this.sendRequest(n,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=Cs();this.events.once(ue("pairing_ping",i),({error:l})=>{l?c(l):a()}),yield o()}})),re(this,"updateExpiry",i=>f(this,[i],function*({topic:r,expiry:n}){this.isInitialized(),yield this.pairings.update(r,{expiry:n})})),re(this,"updateMetadata",i=>f(this,[i],function*({topic:r,metadata:n}){this.isInitialized(),yield this.pairings.update(r,{peerMetadata:n})})),re(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),re(this,"disconnect",r=>f(this,null,function*(){this.isInitialized(),yield this.isValidDisconnect(r);let{topic:n}=r;this.pairings.keys.includes(n)&&(yield this.sendRequest(n,"wc_pairingDelete",ge("USER_DISCONNECTED")),yield this.deletePairing(n))})),re(this,"formatUriFromPairing",r=>{this.isInitialized();let{topic:n,relay:i,expiry:o,methods:a}=r,c=this.core.crypto.keychain.get(n);return gl({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:c,relay:i,expiryTimestamp:o,methods:a})}),re(this,"sendRequest",(r,n,i)=>f(this,null,function*(){let o=Et(n,i),a=yield this.core.crypto.encode(r,o),c=ri[n].req;return this.core.history.set(r,o),this.core.relayer.publish(r,a,c),o.id})),re(this,"sendResult",(r,n,i)=>f(this,null,function*(){let o=Bs(r,i),a=yield this.core.crypto.encode(n,o),c=(yield this.core.history.get(n,r)).request.method,l=ri[c].res;yield this.core.relayer.publish(n,a,l),yield this.core.history.resolve(o)})),re(this,"sendError",(r,n,i)=>f(this,null,function*(){let o=mi(r,i),a=yield this.core.crypto.encode(n,o),c=(yield this.core.history.get(n,r)).request.method,l=ri[c]?ri[c].res:ri.unregistered_method.res;yield this.core.relayer.publish(n,a,l),yield this.core.history.resolve(o)})),re(this,"deletePairing",(r,n)=>f(this,null,function*(){yield this.core.relayer.unsubscribe(r),yield Promise.all([this.pairings.delete(r,ge("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),n?Promise.resolve():this.core.expirer.del(r)])})),re(this,"cleanup",()=>f(this,null,function*(){let r=this.pairings.getAll().filter(n=>Tt(n.expiry));yield Promise.all(r.map(n=>this.deletePairing(n.topic)))})),re(this,"onRelayEventRequest",r=>f(this,null,function*(){let{topic:n,payload:i}=r;switch(i.method){case"wc_pairingPing":return yield this.onPairingPingRequest(n,i);case"wc_pairingDelete":return yield this.onPairingDeleteRequest(n,i);default:return yield this.onUnknownRpcMethodRequest(n,i)}})),re(this,"onRelayEventResponse",r=>f(this,null,function*(){let{topic:n,payload:i}=r,o=(yield this.core.history.get(n,i.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(n,i);default:return this.onUnknownRpcMethodResponse(o)}})),re(this,"onPairingPingRequest",(r,n)=>f(this,null,function*(){let{id:i}=n;try{this.isValidPing({topic:r}),yield this.sendResult(i,r,!0),this.events.emit(sr.ping,{id:i,topic:r})}catch(o){yield this.sendError(i,r,o),this.logger.error(o)}})),re(this,"onPairingPingResponse",(r,n)=>{let{id:i}=n;setTimeout(()=>{Vt(n)?this.events.emit(ue("pairing_ping",i),{}):Ut(n)&&this.events.emit(ue("pairing_ping",i),{error:n.error})},500)}),re(this,"onPairingDeleteRequest",(r,n)=>f(this,null,function*(){let{id:i}=n;try{this.isValidDisconnect({topic:r}),yield this.deletePairing(r),this.events.emit(sr.delete,{id:i,topic:r})}catch(o){yield this.sendError(i,r,o),this.logger.error(o)}})),re(this,"onUnknownRpcMethodRequest",(r,n)=>f(this,null,function*(){let{id:i,method:o}=n;try{if(this.registeredMethods.includes(o))return;let a=ge("WC_METHOD_UNSUPPORTED",o);yield this.sendError(i,r,a),this.logger.error(a)}catch(a){yield this.sendError(i,r,a),this.logger.error(a)}})),re(this,"onUnknownRpcMethodResponse",r=>{this.registeredMethods.includes(r)||this.logger.error(ge("WC_METHOD_UNSUPPORTED",r))}),re(this,"isValidPair",(r,n)=>{var i;if(!Je(r)){let{message:a}=j("MISSING_OR_INVALID",`pair() params: ${r}`);throw n.setError(hs.malformed_pairing_uri),new Error(a)}if(!eg(r.uri)){let{message:a}=j("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw n.setError(hs.malformed_pairing_uri),new Error(a)}let o=pl(r?.uri);if(!((i=o?.relay)!=null&&i.protocol)){let{message:a}=j("MISSING_OR_INVALID","pair() uri#relay-protocol");throw n.setError(hs.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){let{message:a}=j("MISSING_OR_INVALID","pair() uri#symKey");throw n.setError(hs.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&(0,K.toMiliseconds)(o?.expiryTimestamp)<Date.now()){n.setError(hs.pairing_expired);let{message:a}=j("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),re(this,"isValidPing",r=>f(this,null,function*(){if(!Je(r)){let{message:i}=j("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(i)}let{topic:n}=r;yield this.isValidPairingTopic(n)})),re(this,"isValidDisconnect",r=>f(this,null,function*(){if(!Je(r)){let{message:i}=j("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(i)}let{topic:n}=r;yield this.isValidPairingTopic(n)})),re(this,"isValidPairingTopic",r=>f(this,null,function*(){if(!Ie(r,!1)){let{message:n}=j("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(n)}if(!this.pairings.keys.includes(r)){let{message:n}=j("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(n)}if(Tt(this.pairings.get(r).expiry)){yield this.deletePairing(r);let{message:n}=j("EXPIRED",`pairing topic: ${r}`);throw new Error(n)}})),this.core=e,this.logger=ut(s,this.name),this.pairings=new fs(this.core,this.logger,this.name,this.storagePrefix)}get context(){return rt(this.logger)}isInitialized(){if(!this.initialized){let{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(_e.message,e=>f(this,null,function*(){let{topic:s,message:r,transportType:n}=e;if(this.pairings.keys.includes(s)&&n!==we.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))try{let i=yield this.core.crypto.decode(s,r);wn(i)?(this.core.history.set(s,i),yield this.onRelayEventRequest({topic:s,payload:i})):bn(i)&&(yield this.core.history.resolve(i),yield this.onRelayEventResponse({topic:s,payload:i}),this.core.history.delete(s,i.id)),yield this.core.relayer.messages.ack(s,r)}catch(i){this.logger.error(i)}}))}registerExpirerEvents(){this.core.expirer.on(Ot.expired,e=>f(this,null,function*(){let{topic:s}=Oo(e.target);s&&this.pairings.keys.includes(s)&&(yield this.deletePairing(s,!0),this.events.emit(sr.expire,{topic:s}))}))}},v2=Object.defineProperty,E2=(t,e,s)=>e in t?v2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,qe=(t,e,s)=>E2(t,typeof e!="symbol"?e+"":e,s),Gl=class extends bi{constructor(e,s){super(e,s),this.core=e,this.logger=s,qe(this,"records",new Map),qe(this,"events",new Rs.EventEmitter),qe(this,"name",Lv),qe(this,"version",qv),qe(this,"cached",[]),qe(this,"initialized",!1),qe(this,"storagePrefix",ds),qe(this,"init",()=>f(this,null,function*(){this.initialized||(this.logger.trace("Initialized"),yield this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)})),qe(this,"set",(r,n,i)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:n,chainId:i}),this.records.has(n.id))return;let o={id:n.id,topic:r,request:{method:n.method,params:n.params||null},chainId:i,expiry:xe(K.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(rs.created,o)}),qe(this,"resolve",r=>f(this,null,function*(){if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;let n=yield this.getRecord(r.id);typeof n.response>"u"&&(n.response=Ut(r)?{error:r.error}:{result:r.result},this.records.set(n.id,n),this.persist(),this.events.emit(rs.updated,n))})),qe(this,"get",(r,n)=>f(this,null,function*(){return this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:n}),yield this.getRecord(n)})),qe(this,"delete",(r,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(i=>{if(i.topic===r){if(typeof n<"u"&&i.id!==n)return;this.records.delete(i.id),this.events.emit(rs.deleted,i)}}),this.persist()}),qe(this,"exists",(r,n)=>f(this,null,function*(){return this.isInitialized(),this.records.has(n)?(yield this.getRecord(n)).topic===r:!1})),qe(this,"on",(r,n)=>{this.events.on(r,n)}),qe(this,"once",(r,n)=>{this.events.once(r,n)}),qe(this,"off",(r,n)=>{this.events.off(r,n)}),qe(this,"removeListener",(r,n)=>{this.events.removeListener(r,n)}),this.logger=ut(s,this.name)}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let e=[];return this.values.forEach(s=>{if(typeof s.response<"u")return;let r={topic:s.topic,request:Et(s.request.method,s.request.params,s.id),chainId:s.chainId};return e.push(r)}),e}setJsonRpcRecords(e){return f(this,null,function*(){yield this.core.storage.setItem(this.storageKey,e)})}getJsonRpcRecords(){return f(this,null,function*(){return yield this.core.storage.getItem(this.storageKey)})}getRecord(e){this.isInitialized();let s=this.records.get(e);if(!s){let{message:r}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return s}persist(){return f(this,null,function*(){yield this.setJsonRpcRecords(this.values),this.events.emit(rs.sync)})}restore(){return f(this,null,function*(){try{let e=yield this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){let{message:s}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}})}registerEventListeners(){this.events.on(rs.created,e=>{let s=rs.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:e})}),this.events.on(rs.updated,e=>{let s=rs.updated;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:e})}),this.events.on(rs.deleted,e=>{let s=rs.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,record:e})}),this.core.heartbeat.on(lr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(s=>{(0,K.toMiliseconds)(s.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${s.id}`),this.records.delete(s.id),this.events.emit(rs.deleted,s,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){let{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}},x2=Object.defineProperty,S2=(t,e,s)=>e in t?x2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Qe=(t,e,s)=>S2(t,typeof e!="symbol"?e+"":e,s),Yl=class extends Ai{constructor(e,s){super(e,s),this.core=e,this.logger=s,Qe(this,"expirations",new Map),Qe(this,"events",new Rs.EventEmitter),Qe(this,"name",Mv),Qe(this,"version",Fv),Qe(this,"cached",[]),Qe(this,"initialized",!1),Qe(this,"storagePrefix",ds),Qe(this,"init",()=>f(this,null,function*(){this.initialized||(this.logger.trace("Initialized"),yield this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)})),Qe(this,"has",r=>{try{let n=this.formatTarget(r);return typeof this.getExpiration(n)<"u"}catch{return!1}}),Qe(this,"set",(r,n)=>{this.isInitialized();let i=this.formatTarget(r),o={target:i,expiry:n};this.expirations.set(i,o),this.checkExpiry(i,o),this.events.emit(Ot.created,{target:i,expiration:o})}),Qe(this,"get",r=>{this.isInitialized();let n=this.formatTarget(r);return this.getExpiration(n)}),Qe(this,"del",r=>{if(this.isInitialized(),this.has(r)){let n=this.formatTarget(r),i=this.getExpiration(n);this.expirations.delete(n),this.events.emit(Ot.deleted,{target:n,expiration:i})}}),Qe(this,"on",(r,n)=>{this.events.on(r,n)}),Qe(this,"once",(r,n)=>{this.events.once(r,n)}),Qe(this,"off",(r,n)=>{this.events.off(r,n)}),Qe(this,"removeListener",(r,n)=>{this.events.removeListener(r,n)}),this.logger=ut(s,this.name)}get context(){return rt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return qf(e);if(typeof e=="number")return Mf(e);let{message:s}=j("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(s)}setExpirations(e){return f(this,null,function*(){yield this.core.storage.setItem(this.storageKey,e)})}getExpirations(){return f(this,null,function*(){return yield this.core.storage.getItem(this.storageKey)})}persist(){return f(this,null,function*(){yield this.setExpirations(this.values),this.events.emit(Ot.sync)})}restore(){return f(this,null,function*(){try{let e=yield this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){let{message:s}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(s),new Error(s)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}})}getExpiration(e){let s=this.expirations.get(e);if(!s){let{message:r}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(r),new Error(r)}return s}checkExpiry(e,s){let{expiry:r}=s;(0,K.toMiliseconds)(r)-Date.now()<=0&&this.expire(e,s)}expire(e,s){this.expirations.delete(e),this.events.emit(Ot.expired,{target:e,expiration:s})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,s)=>this.checkExpiry(s,e))}registerEventListeners(){this.core.heartbeat.on(lr.pulse,()=>this.checkExpirations()),this.events.on(Ot.created,e=>{let s=Ot.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),this.persist()}),this.events.on(Ot.expired,e=>{let s=Ot.expired;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),this.persist()}),this.events.on(Ot.deleted,e=>{let s=Ot.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:e}),this.persist()})}isInitialized(){if(!this.initialized){let{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}},I2=Object.defineProperty,A2=(t,e,s)=>e in t?I2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Pe=(t,e,s)=>A2(t,typeof e!="symbol"?e+"":e,s),Xl=class extends _i{constructor(e,s,r){super(e,s,r),this.core=e,this.logger=s,this.store=r,Pe(this,"name",$v),Pe(this,"abortController"),Pe(this,"isDevEnv"),Pe(this,"verifyUrlV3",zv),Pe(this,"storagePrefix",ds),Pe(this,"version",Hg),Pe(this,"publicKey"),Pe(this,"fetchPromise"),Pe(this,"init",()=>f(this,null,function*(){var n;this.isDevEnv||(this.publicKey=yield this.store.getItem(this.storeKey),this.publicKey&&(0,K.toMiliseconds)((n=this.publicKey)==null?void 0:n.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),yield this.removePublicKey()))})),Pe(this,"register",n=>f(this,null,function*(){if(!_r()||this.isDevEnv)return;let i=window.location.origin,{id:o,decryptedId:a}=n,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${i}&id=${o}&decryptedId=${a}`;try{let l=(0,jg.getDocument)(),u=this.startAbortTimer(K.ONE_SECOND*5),h=yield new Promise((d,p)=>{let m=()=>{window.removeEventListener("message",w),l.body.removeChild(g),p("attestation aborted")};this.abortController.signal.addEventListener("abort",m);let g=l.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",m,{signal:this.abortController.signal});let w=N=>{if(N.data&&typeof N.data=="string")try{let U=JSON.parse(N.data);if(U.type==="verify_attestation"){if(yn(U.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(g),this.abortController.signal.removeEventListener("abort",m),window.removeEventListener("message",w),d(U.attestation===null?"":U.attestation)}}catch(U){this.logger.warn(U)}};l.body.appendChild(g),window.addEventListener("message",w,{signal:this.abortController.signal})});return this.logger.debug(h,"jwt attestation"),h}catch(l){this.logger.warn(l)}return""})),Pe(this,"resolve",n=>f(this,null,function*(){if(this.isDevEnv)return"";let{attestationId:i,hash:o,encryptedId:a}=n;if(i===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(i){if(yn(i).payload.id!==a)return;let l=yield this.isValidJwtAttestation(i);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;let c=this.getVerifyUrl(n?.verifyUrl);return this.fetchAttestation(o,c)})),Pe(this,"fetchAttestation",(n,i)=>f(this,null,function*(){this.logger.debug(`resolving attestation: ${n} from url: ${i}`);let o=this.startAbortTimer(K.ONE_SECOND*5),a=yield fetch(`${i}/attestation/${n}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?yield a.json():void 0})),Pe(this,"getVerifyUrl",n=>{let i=n||on;return Hv.includes(i)||(this.logger.info(`verify url: ${i}, not included in trusted list, assigning default: ${on}`),i=on),i}),Pe(this,"fetchPublicKey",()=>f(this,null,function*(){try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let n=this.startAbortTimer(K.FIVE_SECONDS),i=yield fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(n),yield i.json()}catch(n){this.logger.warn(n)}})),Pe(this,"persistPublicKey",n=>f(this,null,function*(){this.logger.debug(n,"persisting public key to local storage"),yield this.store.setItem(this.storeKey,n),this.publicKey=n})),Pe(this,"removePublicKey",()=>f(this,null,function*(){this.logger.debug("removing verify v2 public key from storage"),yield this.store.removeItem(this.storeKey),this.publicKey=void 0})),Pe(this,"isValidJwtAttestation",n=>f(this,null,function*(){let i=yield this.getPublicKey();try{if(i)return this.validateAttestation(n,i)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}let o=yield this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(n,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}})),Pe(this,"getPublicKey",()=>f(this,null,function*(){return this.publicKey?this.publicKey:yield this.fetchAndPersistPublicKey()})),Pe(this,"fetchAndPersistPublicKey",()=>f(this,null,function*(){if(this.fetchPromise)return yield this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(i=>f(this,null,function*(){let o=yield this.fetchPublicKey();o&&(yield this.persistPublicKey(o),i(o))}));let n=yield this.fetchPromise;return this.fetchPromise=void 0,n})),Pe(this,"validateAttestation",(n,i)=>{let o=Yp(n,i.publicKey),a={hasExpired:(0,K.toMiliseconds)(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=ut(s,this.name),this.abortController=new AbortController,this.isDevEnv=Gn(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return rt(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,K.toMiliseconds)(e))}},_2=Object.defineProperty,T2=(t,e,s)=>e in t?_2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,qg=(t,e,s)=>T2(t,typeof e!="symbol"?e+"":e,s),Zl=class extends Ti{constructor(e,s){super(e,s),this.projectId=e,this.logger=s,qg(this,"context",Vv),qg(this,"registerDeviceToken",r=>f(this,null,function*(){let{clientId:n,token:i,notificationType:o,enableEncrypted:a=!1}=r,c=`${Kv}/${this.projectId}/clients`;yield fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:n,type:o,token:i,always_raw:a})})})),this.logger=ut(s,this.context)}},P2=Object.defineProperty,Mg=Object.getOwnPropertySymbols,C2=Object.prototype.hasOwnProperty,O2=Object.prototype.propertyIsEnumerable,Jl=(t,e,s)=>e in t?P2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ii=(t,e)=>{for(var s in e||(e={}))C2.call(e,s)&&Jl(t,s,e[s]);if(Mg)for(var s of Mg(e))O2.call(e,s)&&Jl(t,s,e[s]);return t},Ue=(t,e,s)=>Jl(t,typeof e!="symbol"?e+"":e,s),Ql=class extends Pi{constructor(e,s,r=!0){super(e,s,r),this.core=e,this.logger=s,Ue(this,"context",Gv),Ue(this,"storagePrefix",ds),Ue(this,"storageVersion",Wv),Ue(this,"events",new Map),Ue(this,"shouldPersist",!1),Ue(this,"init",()=>f(this,null,function*(){if(!Gn())try{let n={eventId:Xc(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:yield this.core.crypto.getClientId(),user_agent:Gc(this.core.relayer.protocol,this.core.relayer.version,_l)}}};yield this.sendEvent([n])}catch(n){this.logger.warn(n)}})),Ue(this,"createEvent",n=>{let{event:i="ERROR",type:o="",properties:{topic:a,trace:c}}=n,l=Xc(),u=this.core.projectId||"",h=Date.now(),d=ii({eventId:l,timestamp:h,props:{event:i,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,d),this.shouldPersist=!0),d}),Ue(this,"getEvent",n=>{let{eventId:i,topic:o}=n;if(i)return this.events.get(i);let a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return ii(ii({},a),this.setMethods(a.eventId))}),Ue(this,"deleteEvent",n=>{let{eventId:i}=n;this.events.delete(i),this.shouldPersist=!0}),Ue(this,"setEventListeners",()=>{this.core.heartbeat.on(lr.pulse,()=>f(this,null,function*(){this.shouldPersist&&(yield this.persist()),this.events.forEach(n=>{(0,K.fromMiliseconds)(Date.now())-(0,K.fromMiliseconds)(n.timestamp)>Yv&&(this.events.delete(n.eventId),this.shouldPersist=!0)})}))}),Ue(this,"setMethods",n=>({addTrace:i=>this.addTrace(n,i),setError:i=>this.setError(n,i)})),Ue(this,"addTrace",(n,i)=>{let o=this.events.get(n);o&&(o.props.properties.trace.push(i),this.events.set(n,o),this.shouldPersist=!0)}),Ue(this,"setError",(n,i)=>{let o=this.events.get(n);o&&(o.props.type=i,o.timestamp=Date.now(),this.events.set(n,o),this.shouldPersist=!0)}),Ue(this,"persist",()=>f(this,null,function*(){yield this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1})),Ue(this,"restore",()=>f(this,null,function*(){try{let n=(yield this.core.storage.getItem(this.storageKey))||[];if(!n.length)return;n.forEach(i=>{this.events.set(i.eventId,ii(ii({},i),this.setMethods(i.eventId)))})}catch(n){this.logger.warn(n)}})),Ue(this,"submit",()=>f(this,null,function*(){if(!this.telemetryEnabled||this.events.size===0)return;let n=[];for(let[i,o]of this.events)o.props.type&&n.push(o);if(n.length!==0)try{if((yield this.sendEvent(n)).ok)for(let i of n)this.events.delete(i.eventId),this.shouldPersist=!0}catch(i){this.logger.warn(i)}})),Ue(this,"sendEvent",n=>f(this,null,function*(){let i=this.getAppDomain()?"":"&sp=desktop";return yield fetch(`${Xv}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${_l}${i}`,{method:"POST",body:JSON.stringify(n)})})),Ue(this,"getAppDomain",()=>Wc().url),this.logger=ut(s,this.context),this.telemetryEnabled=r,r?this.restore().then(()=>f(this,null,function*(){yield this.submit(),this.setEventListeners()})):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}},R2=Object.defineProperty,Fg=Object.getOwnPropertySymbols,N2=Object.prototype.hasOwnProperty,k2=Object.prototype.propertyIsEnumerable,eu=(t,e,s)=>e in t?R2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,$g=(t,e)=>{for(var s in e||(e={}))N2.call(e,s)&&eu(t,s,e[s]);if(Fg)for(var s of Fg(e))k2.call(e,s)&&eu(t,s,e[s]);return t},ye=(t,e,s)=>eu(t,typeof e!="symbol"?e+"":e,s),tu=class t extends wi{constructor(e){var s;super(e),ye(this,"protocol",zg),ye(this,"version",Hg),ye(this,"name",zo),ye(this,"relayUrl"),ye(this,"projectId"),ye(this,"customStoragePrefix"),ye(this,"events",new Rs.EventEmitter),ye(this,"logger"),ye(this,"heartbeat"),ye(this,"relayer"),ye(this,"crypto"),ye(this,"storage"),ye(this,"history"),ye(this,"expirer"),ye(this,"pairing"),ye(this,"verify"),ye(this,"echoClient"),ye(this,"linkModeSupportedApps"),ye(this,"eventClient"),ye(this,"initialized",!1),ye(this,"logChunkController"),ye(this,"on",(a,c)=>this.events.on(a,c)),ye(this,"once",(a,c)=>this.events.once(a,c)),ye(this,"off",(a,c)=>this.events.off(a,c)),ye(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),ye(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;let u={topic:a,message:c,publishedAt:Date.now(),transportType:we.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});let r=this.getGlobalCore(e?.customStoragePrefix);if(r)try{return this.customStoragePrefix=r.customStoragePrefix,this.logger=r.logger,this.heartbeat=r.heartbeat,this.crypto=r.crypto,this.history=r.history,this.expirer=r.expirer,this.storage=r.storage,this.relayer=r.relayer,this.pairing=r.pairing,this.verify=r.verify,this.echoClient=r.echoClient,this.linkModeSupportedApps=r.linkModeSupportedApps,this.eventClient=r.eventClient,this.initialized=r.initialized,this.logChunkController=r.logChunkController,r}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Vg,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";let n=Qu({level:typeof e?.logger=="string"&&e.logger?e.logger:yv.logger,name:zo}),{logger:i,chunkLoggerController:o}=di({opts:n,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(s=this.logChunkController)!=null&&s.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=()=>f(this,null,function*(){var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:yield this.crypto.getClientId()}))})),this.logger=ut(i,this.name),this.heartbeat=new th,this.crypto=new Dl(this,this.logger,e?.keychain),this.history=new Gl(this,this.logger),this.expirer=new Yl(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new sh($g($g({},wv),e?.storageOptions)),this.relayer=new Vl({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Wl(this,this.logger),this.verify=new Xl(this,this.logger,this.storage),this.echoClient=new Zl(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new Ql(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static init(e){return f(this,null,function*(){let s=new t(e);yield s.initialize();let r=yield s.crypto.getClientId();return yield s.storage.setItem(Nv,r),s})}get context(){return rt(this.logger)}start(){return f(this,null,function*(){this.initialized||(yield this.initialize())})}getLogsBlob(){return f(this,null,function*(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:yield this.crypto.getClientId()})})}addLinkModeSupportedApp(e){return f(this,null,function*(){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),yield this.storage.setItem(bg,this.linkModeSupportedApps))})}initialize(){return f(this,null,function*(){this.logger.trace("Initialized");try{yield this.crypto.init(),yield this.history.init(),yield this.expirer.init(),yield this.relayer.init(),yield this.heartbeat.init(),yield this.pairing.init(),this.linkModeSupportedApps=(yield this.storage.getItem(bg))||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(e,`Core Initialization Failure at epoch ${Date.now()}`),this.logger.error(e.message),e}})}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;let s=`_walletConnectCore_${e}`,r=`${s}_count`;return globalThis[r]=(globalThis[r]||0)+1,globalThis[r]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[r]} times.`),globalThis[s]}catch(s){console.warn("Failed to get global WalletConnect core",s);return}}setGlobalCore(e){var s;try{if(this.isGlobalCoreDisabled())return;let r=`_walletConnectCore_${((s=e.opts)==null?void 0:s.customStoragePrefix)||""}`;globalThis[r]=e}catch(r){console.warn("Failed to set global WalletConnect core",r)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&process.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}},nm=tu;var se=zt(oa(),1);var cm="wc",lm=2,um="client",mu=`${cm}@${lm}:${um}:`,ru={name:um,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.org"};var im="WALLETCONNECT_DEEPLINK_CHOICE";var U2="proposal";var om="Proposal expired",B2="session",cn=se.SEVEN_DAYS,D2="engine",Fe={wc_sessionPropose:{req:{ttl:se.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:se.ONE_DAY,prompt:!1,tag:1104},res:{ttl:se.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:se.ONE_DAY,prompt:!1,tag:1106},res:{ttl:se.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:se.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:se.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:se.ONE_DAY,prompt:!1,tag:1112},res:{ttl:se.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:se.ONE_DAY,prompt:!1,tag:1114},res:{ttl:se.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:se.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:se.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:se.FIVE_MINUTES,prompt:!1,tag:1119}}},nu={min:se.FIVE_MINUTES,max:se.SEVEN_DAYS},ps={idle:"IDLE",active:"ACTIVE"},L2={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},q2="request",M2=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],F2="wc";var $2="auth",j2="authKeys",z2="pairingTopics",H2="requests",Wo=`${F2}@${1.5}:${$2}:`,Vo=`${Wo}:PUB_KEY`,V2=Object.defineProperty,K2=Object.defineProperties,W2=Object.getOwnPropertyDescriptors,am=Object.getOwnPropertySymbols,G2=Object.prototype.hasOwnProperty,Y2=Object.prototype.propertyIsEnumerable,ou=(t,e,s)=>e in t?V2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,he=(t,e)=>{for(var s in e||(e={}))G2.call(e,s)&&ou(t,s,e[s]);if(am)for(var s of am(e))Y2.call(e,s)&&ou(t,s,e[s]);return t},$e=(t,e)=>K2(t,W2(e)),B=(t,e,s)=>ou(t,typeof e!="symbol"?e+"":e,s),au=class extends Oi{constructor(e){super(e),B(this,"name",D2),B(this,"events",new Ko.default),B(this,"initialized",!1),B(this,"requestQueue",{state:ps.idle,queue:[]}),B(this,"sessionRequestQueue",{state:ps.idle,queue:[]}),B(this,"emittedSessionRequests",new vo({limit:500})),B(this,"requestQueueDelay",se.ONE_SECOND),B(this,"expectedPairingMethodMap",new Map),B(this,"recentlyDeletedMap",new Map),B(this,"recentlyDeletedLimit",200),B(this,"relayMessageCache",[]),B(this,"pendingSessions",new Map),B(this,"init",()=>f(this,null,function*(){this.initialized||(yield this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),yield this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(Fe)}),this.initialized=!0,setTimeout(()=>f(this,null,function*(){yield this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()}),(0,se.toMiliseconds)(this.requestQueueDelay)))})),B(this,"connect",s=>f(this,null,function*(){var r;this.isInitialized(),yield this.confirmOnlineStateOrThrow();let n=$e(he({},s),{requiredNamespaces:s.requiredNamespaces||{},optionalNamespaces:s.optionalNamespaces||{}});yield this.isValidConnect(n),n.optionalNamespaces=Jp(n.requiredNamespaces,n.optionalNamespaces),n.requiredNamespaces={};let{pairingTopic:i,requiredNamespaces:o,optionalNamespaces:a,sessionProperties:c,scopedProperties:l,relays:u,authentication:h,walletPay:d}=n,p=((r=h?.[0])==null?void 0:r.ttl)||Fe.wc_sessionPropose.req.ttl||se.FIVE_MINUTES;this.validateRequestExpiry(p);let m=i,g,w=!1;try{if(m){let P=this.client.core.pairing.pairings.get(m);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),w=P.active}}catch(P){throw this.client.logger.error(`connect() -> pairing.get(${m}) failed`),P}if(!m||!w){let{topic:P,uri:L}=yield this.client.core.pairing.create({internal:{skipSubscribe:!0}});m=P,g=L}if(!m){let{message:P}=j("NO_MATCHING_KEY",`connect() pairing topic: ${m}`);throw new Error(P)}let N=yield this.client.core.crypto.generateKeyPair(),U=xe(p),A=he($e(he(he({requiredNamespaces:o,optionalNamespaces:a,relays:u??[{protocol:su}],proposer:{publicKey:N,metadata:this.client.metadata},expiryTimestamp:U,pairingTopic:m},c&&{sessionProperties:c}),l&&{scopedProperties:l}),{id:gs()}),(h||d)&&{requests:{authentication:h?.map(P=>{let{domain:L,chains:F,nonce:C,uri:v,exp:I,nbf:y,type:b,statement:_,requestId:R,resources:x,signatureTypes:T}=P;return{domain:L,chains:F,nonce:C,type:b??"caip122",aud:v,version:"1",iat:new Date().toISOString(),exp:I,nbf:y,statement:_,requestId:R,resources:x,signatureTypes:T}}),walletPay:d}}),S=ue("session_connect",A.id),{reject:O,resolve:k,done:D}=Cs(p,om),M=({id:P})=>{P===A.id&&(this.client.events.off("proposal_expire",M),this.pendingSessions.delete(A.id),this.events.emit(S,{error:{message:om,code:0}}))};return this.client.events.on("proposal_expire",M),this.events.once(S,({error:P,session:L})=>{this.client.events.off("proposal_expire",M),P?O(P):L&&k(L)}),yield this.setProposal(A.id,A),yield this.sendProposeSession({proposal:A,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:A.id}}}).catch(P=>{throw this.deleteProposal(A.id),P}),{uri:g,approval:D}})),B(this,"pair",s=>f(this,null,function*(){this.isInitialized(),yield this.confirmOnlineStateOrThrow();try{return yield this.client.core.pairing.pair(s)}catch(r){throw this.client.logger.error("pair() failed"),r}})),B(this,"approve",s=>f(this,null,function*(){var r,n,i;let o=this.client.core.eventClient.createEvent({properties:{topic:(r=s?.id)==null?void 0:r.toString(),trace:[Ft.session_approve_started]}});try{this.isInitialized(),yield this.confirmOnlineStateOrThrow()}catch(L){throw o.setError(rr.no_internet_connection),L}try{yield this.isValidProposalId(s?.id)}catch(L){throw this.client.logger.error(`approve() -> proposal.get(${s?.id}) failed`),o.setError(rr.proposal_not_found),L}try{yield this.isValidApprove(s)}catch(L){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(rr.session_approve_namespace_validation_failure),L}let{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:d,proposalRequestsResponses:p}=s,m=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});let{pairingTopic:g,proposer:w,requiredNamespaces:N,optionalNamespaces:U}=m,A=(n=this.client.core.eventClient)==null?void 0:n.getEvent({topic:g});A||(A=(i=this.client.core.eventClient)==null?void 0:i.createEvent({type:Ft.session_approve_started,properties:{topic:g,trace:[Ft.session_approve_started,Ft.session_namespaces_validation_success]}}));let S=yield this.client.core.crypto.generateKeyPair(),O=w.publicKey,k=yield this.client.core.crypto.generateSharedKey(S,O),D=$e(he(he(he({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:S,metadata:this.client.metadata},expiry:xe(cn)},u&&{sessionProperties:u}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),{proposalRequestsResponses:p}),M=we.relay;A.addTrace(Ft.subscribing_session_topic);try{yield this.client.core.relayer.subscribe(k,{transportType:M,internal:{skipSubscribe:!0}})}catch(L){throw A.setError(rr.subscribe_session_topic_failure),L}A.addTrace(Ft.subscribe_session_topic_success);let P=$e(he({},D),{topic:k,requiredNamespaces:N,optionalNamespaces:U,pairingTopic:g,acknowledged:!1,self:D.controller,peer:{publicKey:w.publicKey,metadata:w.metadata},controller:S,transportType:we.relay,authentication:p?.authentication,walletPayResult:p?.walletPay});yield this.client.session.set(k,P),A.addTrace(Ft.store_session);try{yield this.sendApproveSession({sessionTopic:k,proposal:m,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:S},sessionSettleRequest:D,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:he({correlationId:a},this.getTVFApproveParams(P))}}),A.addTrace(Ft.session_approve_publish_success)}catch(L){throw this.client.logger.error(L),this.client.session.delete(k,ge("USER_DISCONNECTED")),yield this.client.core.relayer.unsubscribe(k),L}return this.client.core.eventClient.deleteEvent({eventId:A.eventId}),yield this.client.core.pairing.updateMetadata({topic:g,metadata:w.metadata}),yield this.deleteProposal(a),yield this.client.core.pairing.activate({topic:g}),yield this.setExpiry(k,xe(cn)),{topic:k,acknowledged:()=>Promise.resolve(this.client.session.get(k))}})),B(this,"reject",s=>f(this,null,function*(){this.isInitialized(),yield this.confirmOnlineStateOrThrow();try{yield this.isValidReject(s)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}let{id:r,reason:n}=s,i;try{i=this.client.proposal.get(r).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${r}) failed`),o}i&&(yield this.sendError({id:r,topic:i,error:n,rpcOpts:Fe.wc_sessionPropose.reject})),yield this.deleteProposal(r)})),B(this,"update",s=>f(this,null,function*(){this.isInitialized(),yield this.confirmOnlineStateOrThrow();try{yield this.isValidUpdate(s)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}let{topic:r,namespaces:n}=s,{done:i,resolve:o,reject:a}=Cs(se.FIVE_MINUTES,"Session update request expired without receiving any acknowledgement"),c=gs(),l=ms().toString(),u=this.client.session.get(r).namespaces;return this.events.once(ue("session_update",c),({error:h})=>{h?a(h):o()}),yield this.client.session.update(r,{namespaces:n}),yield this.sendRequest({topic:r,method:"wc_sessionUpdate",params:{namespaces:n},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(r,{namespaces:u}),a(h)}),{acknowledged:i}})),B(this,"extend",s=>f(this,null,function*(){this.isInitialized(),yield this.confirmOnlineStateOrThrow();try{yield this.isValidExtend(s)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}let{topic:r}=s,n=gs(),{done:i,resolve:o,reject:a}=Cs(se.FIVE_MINUTES,"Session extend request expired without receiving any acknowledgement");return this.events.once(ue("session_extend",n),({error:c})=>{c?a(c):o()}),yield this.setExpiry(r,xe(cn)),this.sendRequest({topic:r,method:"wc_sessionExtend",params:{},clientRpcId:n,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:i}})),B(this,"request",s=>f(this,null,function*(){this.isInitialized();try{yield this.isValidRequest(s)}catch(w){throw this.client.logger.error("request() -> isValidRequest() failed"),w}let{chainId:r,request:n,topic:i,expiry:o=Fe.wc_sessionRequest.req.ttl}=s,a=this.client.session.get(i);a?.transportType===we.relay&&(yield this.confirmOnlineStateOrThrow());let c=gs(),l=ms().toString(),{done:u,resolve:h,reject:d}=Cs(o,"Request expired. Please try again.");this.events.once(ue("session_request",c),({error:w,result:N})=>{w?d(w):h(N)});let p="wc_sessionRequest",m=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(m)return yield this.sendRequest({clientRpcId:c,relayRpcId:l,topic:i,method:p,params:{request:$e(he({},n),{expiryTimestamp:xe(o)}),chainId:r},expiry:o,throwOnFailedPublish:!0,appLink:m}).catch(w=>d(w)),this.client.events.emit("session_request_sent",{topic:i,request:n,chainId:r,id:c}),yield u();let g={request:$e(he({},n),{expiryTimestamp:xe(o)}),chainId:r};return yield Promise.all([new Promise(w=>f(this,null,function*(){yield this.sendRequest({clientRpcId:c,relayRpcId:l,topic:i,method:p,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch(N=>d(N)),this.client.events.emit("session_request_sent",{topic:i,request:n,chainId:r,id:c}),w()})),new Promise(w=>f(this,null,function*(){var N;if(!((N=a.sessionConfig)!=null&&N.disableDeepLink)){let U=yield $f(this.client.core.storage,im);yield Ff({id:c,topic:i,wcDeepLink:U})}w()})),u()]).then(w=>w[2])})),B(this,"respond",s=>f(this,null,function*(){var r,n;this.isInitialized();let i=this.client.core.eventClient.createEvent({properties:{topic:s?.topic||((n=(r=s?.response)==null?void 0:r.id)==null?void 0:n.toString()),trace:[Ft.session_request_response_started]}});try{yield this.isValidRespond(s)}catch(h){throw i.addTrace(h?.message),i.setError(rr.session_request_response_validation_failure),h}i.addTrace(Ft.session_request_response_validation_success);let{topic:o,response:a}=s,{id:c}=a,l=this.client.session.get(o);l.transportType===we.relay&&(yield this.confirmOnlineStateOrThrow());let u=this.getAppLinkIfEnabled(l.peer.metadata,l.transportType);try{i.addTrace(Ft.session_request_response_publish_started),Vt(a)?yield this.sendResult({id:c,topic:o,result:a.result,throwOnFailedPublish:!0,appLink:u}):Ut(a)&&(yield this.sendError({id:c,topic:o,error:a.error,appLink:u})),this.cleanupAfterResponse(s)}catch(h){throw i.addTrace(h?.message),i.setError(rr.session_request_response_publish_failure),h}})),B(this,"ping",s=>f(this,null,function*(){this.isInitialized(),yield this.confirmOnlineStateOrThrow();try{yield this.isValidPing(s)}catch(n){throw this.client.logger.error("ping() -> isValidPing() failed"),n}let{topic:r}=s;if(this.client.session.keys.includes(r)){let n=gs(),i=ms().toString(),{done:o,resolve:a,reject:c}=Cs(se.FIVE_MINUTES,"Ping request expired without receiving any acknowledgement");this.events.once(ue("session_ping",n),({error:l})=>{l?c(l):a()}),yield Promise.all([this.sendRequest({topic:r,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:n,relayRpcId:i}),o()])}else this.client.core.pairing.pairings.keys.includes(r)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),yield this.client.core.pairing.ping({topic:r}))})),B(this,"emit",s=>f(this,null,function*(){this.isInitialized(),yield this.confirmOnlineStateOrThrow(),yield this.isValidEmit(s);let{topic:r,event:n,chainId:i}=s,o=ms().toString(),a=gs();yield this.sendRequest({topic:r,method:"wc_sessionEvent",params:{event:n,chainId:i},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})})),B(this,"disconnect",s=>f(this,null,function*(){this.isInitialized(),yield this.confirmOnlineStateOrThrow(),yield this.isValidDisconnect(s);let{topic:r}=s;if(this.client.session.keys.includes(r))yield this.sendRequest({topic:r,method:"wc_sessionDelete",params:ge("USER_DISCONNECTED"),throwOnFailedPublish:!0}),yield this.deleteSession({topic:r,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(r))yield this.client.core.pairing.disconnect({topic:r});else{let{message:n}=j("MISMATCHED_TOPIC",`Session or pairing topic not found: ${r}`);throw new Error(n)}})),B(this,"find",s=>(this.isInitialized(),this.client.session.getAll().filter(r=>Qp(r,s)))),B(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),B(this,"authenticate",(s,r)=>f(this,null,function*(){var n;this.isInitialized(),this.isValidAuthenticate(s);let i=r&&this.client.core.linkModeSupportedApps.includes(r)&&((n=this.client.metadata.redirect)==null?void 0:n.linkMode),o=i?we.link_mode:we.relay;o===we.relay&&(yield this.confirmOnlineStateOrThrow());let{chains:a,statement:c="",uri:l,domain:u,nonce:h,type:d,exp:p,nbf:m,methods:g=[],expiry:w}=s,N=[...s.resources||[]],{topic:U,uri:A}=yield this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:U,uri:A}});let S=yield this.client.core.crypto.generateKeyPair(),O=Qr(S);if(yield Promise.all([this.client.auth.authKeys.set(Vo,{responseTopic:O,publicKey:S}),this.client.auth.pairingTopics.set(O,{topic:O,pairingTopic:U})]),yield this.client.core.relayer.subscribe(O,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${U}`),g.length>0){let{namespace:x}=Qt(a[0]),T=cp(x,"request",g);Zn(N)&&(T=lp(T,N.pop())),N.push(T)}let k=w&&w>Fe.wc_sessionAuthenticate.req.ttl?w:Fe.wc_sessionAuthenticate.req.ttl,D={authPayload:{type:d??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:h,iat:new Date().toISOString(),exp:p,nbf:m,resources:N},requester:{publicKey:S,metadata:this.client.metadata},expiryTimestamp:xe(k)},M={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},P={requiredNamespaces:{},optionalNamespaces:M,relays:[{protocol:"irn"}],pairingTopic:U,proposer:{publicKey:S,metadata:this.client.metadata},expiryTimestamp:xe(Fe.wc_sessionPropose.req.ttl),id:gs()},{done:L,resolve:F,reject:C}=Cs(k,"Request expired"),v=gs(),I=ue("session_connect",P.id),y=ue("session_request",v),b=q=>f(this,[q],function*({error:x,session:T}){this.events.off(y,_),x?C(x):T&&F({session:T})}),_=x=>f(this,null,function*(){var T,q,$;if(yield this.deletePendingAuthRequest(v,{message:"fulfilled",code:0}),x.error){let Q=ge("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return x.error.code===Q.code?void 0:(this.events.off(I,b),C(x.error.message))}yield this.deleteProposal(P.id),this.events.off(I,b);let{cacaos:J,responder:W}=x.result,V=[],ee=[];for(let Q of J){(yield sl({cacao:Q,projectId:this.client.core.projectId}))||(this.client.logger.error(Q,"Signature verification failed"),C(ge("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:fe}=Q,tt=Zn(fe.resources),at=[Bo(fe.iss)],st=Xn(fe.iss);if(tt){let Nt=nl(tt),ks=il(tt);V.push(...Nt),at.push(...ks)}for(let Nt of at)ee.push(`${Nt}:${st}`)}let Z=yield this.client.core.crypto.generateSharedKey(S,W.publicKey),de;V.length>0&&(de={topic:Z,acknowledged:!0,self:{publicKey:S,metadata:this.client.metadata},peer:W,controller:W.publicKey,expiry:xe(cn),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:U,namespaces:yl([...new Set(V)],[...new Set(ee)]),transportType:o},yield this.client.core.relayer.subscribe(Z,{transportType:o}),yield this.client.session.set(Z,de),U&&(yield this.client.core.pairing.updateMetadata({topic:U,metadata:W.metadata})),de=this.client.session.get(Z)),(T=this.client.metadata.redirect)!=null&&T.linkMode&&(q=W.metadata.redirect)!=null&&q.linkMode&&($=W.metadata.redirect)!=null&&$.universal&&r&&(this.client.core.addLinkModeSupportedApp(W.metadata.redirect.universal),this.client.session.update(Z,{transportType:we.link_mode})),F({auths:J,session:de})});this.events.once(I,b),this.events.once(y,_);let R;try{if(i){let x=Et("wc_sessionAuthenticate",D,v);this.client.core.history.set(U,x);let T=yield this.client.core.crypto.encode("",x,{type:Jr,encoding:Os});R=ti(r,U,T)}else yield Promise.all([this.sendRequest({topic:U,method:"wc_sessionAuthenticate",params:D,expiry:s.expiry,throwOnFailedPublish:!0,clientRpcId:v}),this.sendRequest({topic:U,method:"wc_sessionPropose",params:P,expiry:Fe.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:P.id})])}catch(x){throw this.events.off(I,b),this.events.off(y,_),x}return yield this.setProposal(P.id,P),yield this.setAuthRequest(v,{request:$e(he({},D),{verifyContext:{}}),pairingTopic:U,transportType:o}),{uri:R??A,response:L}})),B(this,"approveSessionAuthenticate",s=>f(this,null,function*(){let{id:r,auths:n}=s,i=this.client.core.eventClient.createEvent({properties:{topic:r.toString(),trace:[nr.authenticated_session_approve_started]}});try{this.isInitialized()}catch(w){throw i.setError(an.no_internet_connection),w}let o=this.getPendingAuthRequest(r);if(!o)throw i.setError(an.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${r}`);let a=o.transportType||we.relay;a===we.relay&&(yield this.confirmOnlineStateOrThrow());let c=o.requester.publicKey,l=yield this.client.core.crypto.generateKeyPair(),u=Qr(c),h={type:ts,receiverPublicKey:c,senderPublicKey:l},d=[],p=[];for(let w of n){if(!(yield sl({cacao:w,projectId:this.client.core.projectId}))){i.setError(an.invalid_cacao);let O=ge("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw yield this.sendError({id:r,topic:u,error:O,encodeOpts:h}),new Error(O.message)}i.addTrace(nr.cacaos_verified);let{p:N}=w,U=Zn(N.resources),A=[Bo(N.iss)],S=Xn(N.iss);if(U){let O=nl(U),k=il(U);d.push(...O),A.push(...k)}for(let O of A)p.push(`${O}:${S}`)}let m=yield this.client.core.crypto.generateSharedKey(l,c);i.addTrace(nr.create_authenticated_session_topic);let g;if(d?.length>0){g={topic:m,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:xe(cn),authentication:n,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:yl([...new Set(d)],[...new Set(p)]),transportType:a},i.addTrace(nr.subscribing_authenticated_session_topic);try{yield this.client.core.relayer.subscribe(m,{transportType:a})}catch(w){throw i.setError(an.subscribe_authenticated_session_topic_failure),w}i.addTrace(nr.subscribe_authenticated_session_topic_success),yield this.client.session.set(m,g),i.addTrace(nr.store_authenticated_session),yield this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}i.addTrace(nr.publishing_authenticated_session_approve);try{yield this.sendResult({topic:u,id:r,result:{cacaos:n,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(w){throw i.setError(an.authenticated_session_approve_publish_failure),w}return yield this.client.auth.requests.delete(r,{message:"fulfilled",code:0}),yield this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:i.eventId}),{session:g}})),B(this,"rejectSessionAuthenticate",s=>f(this,null,function*(){this.isInitialized();let{id:r,reason:n}=s,i=this.getPendingAuthRequest(r);if(!i)throw new Error(`Could not find pending auth request with id ${r}`);i.transportType===we.relay&&(yield this.confirmOnlineStateOrThrow());let o=i.requester.publicKey,a=yield this.client.core.crypto.generateKeyPair(),c=Qr(o),l={type:ts,receiverPublicKey:o,senderPublicKey:a};yield this.sendError({id:r,topic:c,error:n,encodeOpts:l,rpcOpts:Fe.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(i.requester.metadata,i.transportType)}),yield this.client.auth.requests.delete(r,{message:"rejected",code:0}),yield this.deleteProposal(r)})),B(this,"formatAuthMessage",s=>{this.isInitialized();let{request:r,iss:n}=s;return rl(r,n)}),B(this,"processRelayMessageCache",()=>{setTimeout(()=>f(this,null,function*(){if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{let s=this.relayMessageCache.shift();s&&(yield this.onRelayMessage(s))}catch(s){this.client.logger.error(s)}}),50)}),B(this,"cleanupDuplicatePairings",s=>f(this,null,function*(){if(s.pairingTopic)try{let r=this.client.core.pairing.pairings.get(s.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter(i=>{var o,a;return((o=i.peerMetadata)==null?void 0:o.url)&&((a=i.peerMetadata)==null?void 0:a.url)===s.peer.metadata.url&&i.topic&&i.topic!==r.topic});if(n.length===0)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),yield Promise.all(n.map(i=>this.client.core.pairing.disconnect({topic:i.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(r){this.client.logger.error(r)}})),B(this,"deleteSession",s=>f(this,null,function*(){var r;let{topic:n,expirerHasDeleted:i=!1,emitEvent:o=!0,id:a=0}=s,{self:c}=this.client.session.get(n);yield this.client.core.relayer.unsubscribe(n),yield this.client.session.delete(n,ge("USER_DISCONNECTED")),this.addToRecentlyDeleted(n,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&(yield this.client.core.crypto.deleteKeyPair(c.publicKey)),this.client.core.crypto.keychain.has(n)&&(yield this.client.core.crypto.deleteSymKey(n)),i||this.client.core.expirer.del(n),this.client.core.storage.removeItem(im).catch(l=>this.client.logger.warn(l)),n===((r=this.sessionRequestQueue.queue[0])==null?void 0:r.topic)&&(this.sessionRequestQueue.state=ps.idle),yield Promise.all(this.getPendingSessionRequests().filter(l=>l.topic===n).map(l=>this.deletePendingSessionRequest(l.id,ge("USER_DISCONNECTED")))),o&&this.client.events.emit("session_delete",{id:a,topic:n})})),B(this,"deleteProposal",(s,r)=>f(this,null,function*(){if(r)try{let n=this.client.proposal.get(s);this.client.core.eventClient.getEvent({topic:n.pairingTopic})?.setError(rr.proposal_expired)}catch{}yield Promise.all([this.client.proposal.delete(s,ge("USER_DISCONNECTED")),r?Promise.resolve():this.client.core.expirer.del(s)]),this.addToRecentlyDeleted(s,"proposal")})),B(this,"deletePendingSessionRequest",(s,r,n=!1)=>f(this,null,function*(){yield Promise.all([this.client.pendingRequest.delete(s,r),n?Promise.resolve():this.client.core.expirer.del(s)]),this.addToRecentlyDeleted(s,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(i=>i.id!==s),n&&(this.sessionRequestQueue.state=ps.idle,this.client.events.emit("session_request_expire",{id:s}))})),B(this,"deletePendingAuthRequest",(s,r,n=!1)=>f(this,null,function*(){yield Promise.all([this.client.auth.requests.delete(s,r),n?Promise.resolve():this.client.core.expirer.del(s)])})),B(this,"setExpiry",(s,r)=>f(this,null,function*(){this.client.session.keys.includes(s)&&(this.client.core.expirer.set(s,r),yield this.client.session.update(s,{expiry:r}))})),B(this,"setProposal",(s,r)=>f(this,null,function*(){this.client.core.expirer.set(s,xe(Fe.wc_sessionPropose.req.ttl)),yield this.client.proposal.set(s,r)})),B(this,"setAuthRequest",(s,r)=>f(this,null,function*(){let{request:n,pairingTopic:i,transportType:o=we.relay}=r;this.client.core.expirer.set(s,n.expiryTimestamp),yield this.client.auth.requests.set(s,{authPayload:n.authPayload,requester:n.requester,expiryTimestamp:n.expiryTimestamp,id:s,pairingTopic:i,verifyContext:n.verifyContext,transportType:o})})),B(this,"setPendingSessionRequest",s=>f(this,null,function*(){let{id:r,topic:n,params:i,verifyContext:o}=s,a=i.request.expiryTimestamp||xe(Fe.wc_sessionRequest.req.ttl);this.client.core.expirer.set(r,a),yield this.client.pendingRequest.set(r,{id:r,topic:n,params:i,verifyContext:o})})),B(this,"sendRequest",s=>f(this,null,function*(){let{topic:r,method:n,params:i,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:h,publishOpts:d={}}=s,p=Et(n,i,c),m,g=!!u;try{let U=g?Os:Ze;m=yield this.client.core.crypto.encode(r,p,{encoding:U})}catch(U){throw yield this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${r} failed`),U}let w;if(M2.includes(n)){let U=wt(JSON.stringify(p)),A=wt(m);w=yield this.client.core.verify.register({id:A,decryptedId:U})}let N=he(he({},Fe[n].req),d);if(N.attestation=w,o&&(N.ttl=o),a&&(N.id=a),this.client.core.history.set(r,p),g){let U=ti(u,r,m);yield global.Linking.openURL(U,this.client.name)}else N.tvf=$e(he({},h),{correlationId:p.id}),l?(N.internal=$e(he({},N.internal),{throwOnFailedPublish:!0}),yield this.client.core.relayer.publish(r,m,N)):this.client.core.relayer.publish(r,m,N).catch(U=>this.client.logger.error(U));return p.id})),B(this,"sendProposeSession",s=>f(this,null,function*(){let{proposal:r,publishOpts:n}=s,i=Et("wc_sessionPropose",r,r.id);this.client.core.history.set(r.pairingTopic,i);let o=yield this.client.core.crypto.encode(r.pairingTopic,i,{encoding:Ze}),a=wt(JSON.stringify(i)),c=wt(o),l=yield this.client.core.verify.register({id:c,decryptedId:a});yield this.client.core.relayer.publishCustom({payload:{pairingTopic:r.pairingTopic,sessionProposal:o},opts:$e(he({},n),{publishMethod:"wc_proposeSession",attestation:l})})})),B(this,"sendApproveSession",s=>f(this,null,function*(){let{sessionTopic:r,pairingProposalResponse:n,proposal:i,sessionSettleRequest:o,publishOpts:a}=s,c=Bs(i.id,n),l=yield this.client.core.crypto.encode(i.pairingTopic,c,{encoding:Ze}),u=Et("wc_sessionSettle",o,a?.id),h=yield this.client.core.crypto.encode(r,u,{encoding:Ze});this.client.core.history.set(r,u),yield this.client.core.relayer.publishCustom({payload:{sessionTopic:r,pairingTopic:i.pairingTopic,sessionProposalResponse:l,sessionSettlementRequest:h},opts:$e(he({},a),{publishMethod:"wc_approveSession"})})})),B(this,"sendResult",s=>f(this,null,function*(){let{id:r,topic:n,result:i,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=s,l=Bs(r,i),u,h=c&&typeof(global==null?void 0:global.Linking)<"u";try{let m=h?Os:Ze;u=yield this.client.core.crypto.encode(n,l,$e(he({},a||{}),{encoding:m}))}catch(m){throw yield this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${n} failed`),m}let d,p;try{d=yield this.client.core.history.get(n,r);let m=d.request;try{p=this.getTVFParams(r,m.params,i)}catch(g){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${g?.message}`)}}catch(m){throw this.client.logger.error(`sendResult() -> history.get(${n}, ${r}) failed`),m}if(h){let m=ti(c,n,u);yield global.Linking.openURL(m,this.client.name)}else{let m=d.request.method,g=Fe[m].res;g.tvf=$e(he({},p),{correlationId:r}),o?(g.internal=$e(he({},g.internal),{throwOnFailedPublish:!0}),yield this.client.core.relayer.publish(n,u,g)):this.client.core.relayer.publish(n,u,g).catch(w=>this.client.logger.error(w))}yield this.client.core.history.resolve(l)})),B(this,"sendError",s=>f(this,null,function*(){let{id:r,topic:n,error:i,encodeOpts:o,rpcOpts:a,appLink:c}=s,l=mi(r,i),u,h=c&&typeof(global==null?void 0:global.Linking)<"u";try{let p=h?Os:Ze;u=yield this.client.core.crypto.encode(n,l,$e(he({},o||{}),{encoding:p}))}catch(p){throw yield this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${n} failed`),p}let d;try{d=yield this.client.core.history.get(n,r)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${n}, ${r}) failed`),p}if(h){let p=ti(c,n,u);yield global.Linking.openURL(p,this.client.name)}else{let p=d.request.method,m=a||Fe[p].res;this.client.core.relayer.publish(n,u,m)}yield this.client.core.history.resolve(l)})),B(this,"cleanup",()=>f(this,null,function*(){let s=[],r=[];this.client.session.getAll().forEach(n=>{let i=!1;Tt(n.expiry)&&(i=!0),this.client.core.crypto.keychain.has(n.topic)||(i=!0),i&&s.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{Tt(n.expiryTimestamp)&&r.push(n.id)}),yield Promise.all([...s.map(n=>this.deleteSession({topic:n})),...r.map(n=>this.deleteProposal(n))])})),B(this,"onProviderMessageEvent",s=>f(this,null,function*(){!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(s):yield this.onRelayMessage(s)})),B(this,"onRelayEventRequest",s=>f(this,null,function*(){this.requestQueue.queue.push(s),yield this.processRequestsQueue()})),B(this,"processRequestsQueue",()=>f(this,null,function*(){if(this.requestQueue.state===ps.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ps.active;let s=this.requestQueue.queue.shift();if(s)try{yield this.processRequest(s)}catch(r){this.client.logger.warn(r)}}this.requestQueue.state=ps.idle})),B(this,"processRequest",s=>f(this,null,function*(){let{topic:r,payload:n,attestation:i,transportType:o,encryptedId:a}=s,c=n.method;if(!this.shouldIgnorePairingRequest({topic:r,requestMethod:c}))switch(c){case"wc_sessionPropose":return yield this.onSessionProposeRequest({topic:r,payload:n,attestation:i,encryptedId:a});case"wc_sessionSettle":return yield this.onSessionSettleRequest(r,n);case"wc_sessionUpdate":return yield this.onSessionUpdateRequest(r,n);case"wc_sessionExtend":return yield this.onSessionExtendRequest(r,n);case"wc_sessionPing":return yield this.onSessionPingRequest(r,n);case"wc_sessionDelete":return yield this.onSessionDeleteRequest(r,n);case"wc_sessionRequest":return yield this.onSessionRequest({topic:r,payload:n,attestation:i,encryptedId:a,transportType:o});case"wc_sessionEvent":return yield this.onSessionEventRequest(r,n);case"wc_sessionAuthenticate":return yield this.onSessionAuthenticateRequest({topic:r,payload:n,attestation:i,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}})),B(this,"onRelayEventResponse",s=>f(this,null,function*(){let{topic:r,payload:n,transportType:i}=s,o=(yield this.client.core.history.get(r,n.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(r,n,i);case"wc_sessionSettle":return this.onSessionSettleResponse(r,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(r,n);case"wc_sessionExtend":return this.onSessionExtendResponse(r,n);case"wc_sessionPing":return this.onSessionPingResponse(r,n);case"wc_sessionRequest":return this.onSessionRequestResponse(r,n);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(r,n);default:return this.client.logger.info(`Unsupported response method ${o}`)}})),B(this,"onRelayEventUnknownPayload",s=>{let{topic:r}=s,{message:n}=j("MISSING_OR_INVALID",`Decoded payload on topic ${r} is not identifiable as a JSON-RPC request or a response.`);throw new Error(n)}),B(this,"shouldIgnorePairingRequest",s=>{let{topic:r,requestMethod:n}=s,i=this.expectedPairingMethodMap.get(r);return!i||i.includes(n)?!1:!!(i.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),B(this,"onSessionProposeRequest",s=>f(this,null,function*(){let{topic:r,payload:n,attestation:i,encryptedId:o}=s,{params:a,id:c}=n;try{let l=this.client.core.eventClient.getEvent({topic:r});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l?.setError(hs.proposal_listener_not_found)),this.isValidConnect(he({},n.params));let u=a.expiryTimestamp||xe(Fe.wc_sessionPropose.req.ttl),h=he({id:c,pairingTopic:r,expiryTimestamp:u,attestation:i,encryptedId:o},a);yield this.setProposal(c,h);let d=yield this.getVerifyContext({attestationId:i,hash:wt(JSON.stringify(n)),encryptedId:o,metadata:h.proposer.metadata});l?.addTrace(ns.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:d})}catch(l){yield this.sendError({id:c,topic:r,error:l,rpcOpts:Fe.wc_sessionPropose.autoReject}),this.client.logger.error(l)}})),B(this,"onSessionProposeResponse",(s,r,n)=>f(this,null,function*(){let{id:i}=r;if(Vt(r)){let{result:o}=r;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});let a=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});let c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});let l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});let u=yield this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(i,{sessionTopic:u,pairingTopic:s,proposalId:i,publicKey:c});let h=yield this.client.core.relayer.subscribe(u,{transportType:n});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),yield this.client.core.pairing.activate({topic:s})}else if(Ut(r)){yield this.deleteProposal(i);let o=ue("session_connect",i);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:r.error})}})),B(this,"onSessionSettleRequest",(s,r)=>f(this,null,function*(){let{id:n,params:i}=r;try{this.isValidSessionSettleRequest(i);let{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:d,proposalRequestsResponses:p}=r.params,m=[...this.pendingSessions.values()].find(N=>N.sessionTopic===s);if(!m)return this.client.logger.error(`Pending session not found for topic ${s}`);let g=this.client.proposal.get(m.proposalId),w=$e(he(he(he({topic:s,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:m.pairingTopic,requiredNamespaces:g.requiredNamespaces,optionalNamespaces:g.optionalNamespaces,controller:a.publicKey,self:{publicKey:m.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),{transportType:we.relay,authentication:p?.authentication,walletPayResult:p?.walletPay});yield this.client.session.set(w.topic,w),yield this.setExpiry(w.topic,w.expiry),yield this.client.core.pairing.updateMetadata({topic:m.pairingTopic,metadata:w.peer.metadata}),this.pendingSessions.delete(m.proposalId),this.deleteProposal(m.proposalId,!1),this.cleanupDuplicatePairings(w),yield this.sendResult({id:r.id,topic:s,throwOnFailedPublish:!0,result:!0}),this.client.events.emit("session_connect",{session:w}),this.events.emit(ue("session_connect",m.proposalId),{session:w})}catch(o){yield this.sendError({id:n,topic:s,error:o}),this.client.logger.error(o)}})),B(this,"onSessionSettleResponse",(s,r)=>f(this,null,function*(){let{id:n}=r;Vt(r)?(yield this.client.session.update(s,{acknowledged:!0}),this.events.emit(ue("session_approve",n),{})):Ut(r)&&(yield this.client.session.delete(s,ge("USER_DISCONNECTED")),this.events.emit(ue("session_approve",n),{error:r.error}))})),B(this,"onSessionUpdateRequest",(s,r)=>f(this,null,function*(){let{params:n,id:i}=r;try{let o=`${s}_session_update`,a=er.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.warn(`Discarding out of sync request - ${i}`),this.sendError({id:i,topic:s,error:ge("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(he({topic:s},n));try{er.set(o,i),yield this.client.session.update(s,{namespaces:n.namespaces}),yield this.sendResult({id:i,topic:s,result:!0})}catch(c){throw er.delete(o),c}this.client.events.emit("session_update",{id:i,topic:s,params:n})}catch(o){yield this.sendError({id:i,topic:s,error:o}),this.client.logger.error(o)}})),B(this,"isRequestOutOfSync",(s,r)=>r.toString().slice(0,-3)<s.toString().slice(0,-3)),B(this,"onSessionUpdateResponse",(s,r)=>{let{id:n}=r,i=ue("session_update",n);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Vt(r)?this.events.emit(ue("session_update",n),{}):Ut(r)&&this.events.emit(ue("session_update",n),{error:r.error})}),B(this,"onSessionExtendRequest",(s,r)=>f(this,null,function*(){let{id:n}=r;try{this.isValidExtend({topic:s}),yield this.setExpiry(s,xe(cn)),yield this.sendResult({id:n,topic:s,result:!0}),this.client.events.emit("session_extend",{id:n,topic:s})}catch(i){yield this.sendError({id:n,topic:s,error:i}),this.client.logger.error(i)}})),B(this,"onSessionExtendResponse",(s,r)=>{let{id:n}=r,i=ue("session_extend",n);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Vt(r)?this.events.emit(ue("session_extend",n),{}):Ut(r)&&this.events.emit(ue("session_extend",n),{error:r.error})}),B(this,"onSessionPingRequest",(s,r)=>f(this,null,function*(){let{id:n}=r;try{this.isValidPing({topic:s}),yield this.sendResult({id:n,topic:s,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:n,topic:s})}catch(i){yield this.sendError({id:n,topic:s,error:i}),this.client.logger.error(i)}})),B(this,"onSessionPingResponse",(s,r)=>{let{id:n}=r,i=ue("session_ping",n);setTimeout(()=>{if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners 2176`);Vt(r)?this.events.emit(ue("session_ping",n),{}):Ut(r)&&this.events.emit(ue("session_ping",n),{error:r.error})},500)}),B(this,"onSessionDeleteRequest",(s,r)=>f(this,null,function*(){let{id:n}=r;try{yield this.isValidDisconnect({topic:s,reason:r.params}),this.cleanupPendingSentRequestsForTopic({topic:s,error:ge("USER_DISCONNECTED")}),yield this.deleteSession({topic:s,id:n})}catch(i){this.client.logger.error(i)}})),B(this,"onSessionRequest",s=>f(this,null,function*(){var r,n,i;let{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=s,{id:h,params:d}=a;try{yield this.isValidRequest(he({topic:o},d));let p=this.client.session.get(o),m=yield this.getVerifyContext({attestationId:c,hash:wt(JSON.stringify(Et("wc_sessionRequest",d,h))),encryptedId:l,metadata:p.peer.metadata,transportType:u}),g={id:h,topic:o,params:d,verifyContext:m};yield this.setPendingSessionRequest(g),u===we.link_mode&&(r=p.peer.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp((n=p.peer.metadata.redirect)==null?void 0:n.universal),(i=this.client.signConfig)!=null&&i.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(p){yield this.sendError({id:h,topic:o,error:p}),this.client.logger.error(p)}})),B(this,"onSessionRequestResponse",(s,r)=>{let{id:n}=r,i=ue("session_request",n);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Vt(r)?this.events.emit(ue("session_request",n),{result:r.result}):Ut(r)&&this.events.emit(ue("session_request",n),{error:r.error})}),B(this,"onSessionEventRequest",(s,r)=>f(this,null,function*(){let{id:n,params:i}=r;try{let o=`${s}_session_event_${i.event.name}`,a=er.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.info(`Discarding out of sync request - ${n}`);return}this.isValidEmit(he({topic:s},i)),this.client.events.emit("session_event",{id:n,topic:s,params:i}),er.set(o,n)}catch(o){yield this.sendError({id:n,topic:s,error:o}),this.client.logger.error(o)}})),B(this,"onSessionAuthenticateResponse",(s,r)=>{let{id:n}=r;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:s,payload:r}),Vt(r)?this.events.emit(ue("session_request",n),{result:r.result}):Ut(r)&&this.events.emit(ue("session_request",n),{error:r.error})}),B(this,"onSessionAuthenticateRequest",s=>f(this,null,function*(){var r;let{topic:n,payload:i,attestation:o,encryptedId:a,transportType:c}=s;try{let{requester:l,authPayload:u,expiryTimestamp:h}=i.params,d=yield this.getVerifyContext({attestationId:o,hash:wt(JSON.stringify(i)),encryptedId:a,metadata:l.metadata,transportType:c}),p={requester:l,pairingTopic:n,id:i.id,authPayload:u,verifyContext:d,expiryTimestamp:h};yield this.setAuthRequest(i.id,{request:p,pairingTopic:n,transportType:c}),c===we.link_mode&&(r=l.metadata.redirect)!=null&&r.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:n,params:i.params,id:i.id,verifyContext:d})}catch(l){this.client.logger.error(l);let u=i.params.requester.publicKey,h=yield this.client.core.crypto.generateKeyPair(),d=this.getAppLinkIfEnabled(i.params.requester.metadata,c),p={type:ts,receiverPublicKey:u,senderPublicKey:h};yield this.sendError({id:i.id,topic:n,error:l,encodeOpts:p,rpcOpts:Fe.wc_sessionAuthenticate.autoReject,appLink:d})}})),B(this,"addSessionRequestToSessionRequestQueue",s=>{this.sessionRequestQueue.queue.push(s)}),B(this,"cleanupAfterResponse",s=>{this.deletePendingSessionRequest(s.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ps.idle,this.processSessionRequestQueue()},(0,se.toMiliseconds)(this.requestQueueDelay))}),B(this,"cleanupPendingSentRequestsForTopic",({topic:s,error:r})=>{let n=this.client.core.history.pending;n.length>0&&n.filter(i=>i.topic===s&&i.request.method==="wc_sessionRequest").forEach(i=>{this.events.emit(ue("session_request",i.request.id),{error:r})})}),B(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===ps.active){this.client.logger.info("session request queue is already active.");return}let s=this.sessionRequestQueue.queue[0];if(!s){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(s)}catch(r){this.client.logger.error(r)}}),B(this,"emitSessionRequest",s=>{if(this.emittedSessionRequests.has(s.id)){this.client.logger.warn({id:s.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${s.id}`);return}this.sessionRequestQueue.state=ps.active,this.emittedSessionRequests.add(s.id),this.client.events.emit("session_request",s)}),B(this,"onPairingCreated",s=>{if(s.methods&&this.expectedPairingMethodMap.set(s.topic,s.methods),s.active)return;let r=this.client.proposal.getAll().find(n=>n.pairingTopic===s.topic);r&&this.onSessionProposeRequest({topic:s.topic,payload:Et("wc_sessionPropose",$e(he({},r),{requiredNamespaces:r.requiredNamespaces,optionalNamespaces:r.optionalNamespaces,relays:r.relays,proposer:r.proposer,sessionProperties:r.sessionProperties,scopedProperties:r.scopedProperties}),r.id),attestation:r.attestation,encryptedId:r.encryptedId})}),B(this,"isValidConnect",s=>f(this,null,function*(){if(!Je(s)){let{message:l}=j("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(s)}`);throw new Error(l)}let{pairingTopic:r,requiredNamespaces:n,optionalNamespaces:i,sessionProperties:o,scopedProperties:a,relays:c}=s;if(Ae(r)||(yield this.isValidPairingTopic(r)),!og(c,!0)){let{message:l}=j("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(n&&!Ae(n)&&Lt(n)!==0){let l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(n,"requiredNamespaces")}if(i&&!Ae(i)&&Lt(i)!==0&&this.validateNamespaces(i,"optionalNamespaces"),o&&!Ae(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Ae(a)){this.validateSessionProps(a,"scopedProperties");let l=Object.keys(n||{}).concat(Object.keys(i||{}));if(!Object.keys(a).every(u=>l.includes(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}})),B(this,"validateNamespaces",(s,r)=>{let n=ig(s,"connect()",r);if(n)throw new Error(n.message)}),B(this,"isValidApprove",s=>f(this,null,function*(){if(!Je(s))throw new Error(j("MISSING_OR_INVALID",`approve() params: ${s}`).message);let{id:r,namespaces:n,relayProtocol:i,sessionProperties:o,scopedProperties:a}=s;this.checkRecentlyDeleted(r),yield this.isValidProposalId(r);let c=this.client.proposal.get(r),l=$o(n,"approve()");if(l)throw new Error(l.message);let u=El(c.requiredNamespaces,n,"approve()");if(u)throw new Error(u.message);if(!Ie(i,!0)){let{message:h}=j("MISSING_OR_INVALID",`approve() relayProtocol: ${i}`);throw new Error(h)}if(o&&!Ae(o)&&this.validateSessionProps(o,"sessionProperties"),a&&!Ae(a)){this.validateSessionProps(a,"scopedProperties");let h=new Set(Object.keys(n));if(!Object.keys(a).every(d=>h.has(d.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}})),B(this,"isValidReject",s=>f(this,null,function*(){if(!Je(s)){let{message:i}=j("MISSING_OR_INVALID",`reject() params: ${s}`);throw new Error(i)}let{id:r,reason:n}=s;if(this.checkRecentlyDeleted(r),yield this.isValidProposalId(r),!cg(n)){let{message:i}=j("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(i)}})),B(this,"isValidSessionSettleRequest",s=>{if(!Je(s)){let{message:l}=j("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${s}`);throw new Error(l)}let{relay:r,controller:n,namespaces:i,expiry:o}=s;if(!bl(r)){let{message:l}=j("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}let a=rg(n,"onSessionSettleRequest()");if(a)throw new Error(a.message);let c=$o(i,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(Tt(o)){let{message:l}=j("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),B(this,"isValidUpdate",s=>f(this,null,function*(){if(!Je(s)){let{message:c}=j("MISSING_OR_INVALID",`update() params: ${s}`);throw new Error(c)}let{topic:r,namespaces:n}=s;this.checkRecentlyDeleted(r),yield this.isValidSessionTopic(r);let i=this.client.session.get(r),o=$o(n,"update()");if(o)throw new Error(o.message);let a=El(i.requiredNamespaces,n,"update()");if(a)throw new Error(a.message)})),B(this,"isValidExtend",s=>f(this,null,function*(){if(!Je(s)){let{message:n}=j("MISSING_OR_INVALID",`extend() params: ${s}`);throw new Error(n)}let{topic:r}=s;this.checkRecentlyDeleted(r),yield this.isValidSessionTopic(r)})),B(this,"isValidRequest",s=>f(this,null,function*(){if(!Je(s)){let{message:c}=j("MISSING_OR_INVALID",`request() params: ${s}`);throw new Error(c)}let{topic:r,request:n,chainId:i,expiry:o}=s;this.checkRecentlyDeleted(r),yield this.isValidSessionTopic(r);let{namespaces:a}=this.client.session.get(r);if(!vl(a,i)){let{message:c}=j("MISSING_OR_INVALID",`request() chainId: ${i}`);throw new Error(c)}if(!lg(n)){let{message:c}=j("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(c)}if(!dg(a,i,n.method)){let{message:c}=j("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(c)}this.validateRequestExpiry(o)})),B(this,"isValidRespond",s=>f(this,null,function*(){var r;if(!Je(s)){let{message:a}=j("MISSING_OR_INVALID",`respond() params: ${s}`);throw new Error(a)}let{topic:n,response:i}=s;try{yield this.isValidSessionTopic(n)}catch(a){throw(r=s?.response)!=null&&r.id&&this.cleanupAfterResponse(s),a}if(!ug(i)){let{message:a}=j("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(i)}`);throw new Error(a)}let o=this.client.pendingRequest.get(i.id);if(o.topic!==n){let{message:a}=j("MISMATCHED_TOPIC",`Request response topic mismatch. reqId: ${i.id}, expected topic: ${o.topic}, received topic: ${n}`);throw new Error(a)}})),B(this,"isValidPing",s=>f(this,null,function*(){if(!Je(s)){let{message:n}=j("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(n)}let{topic:r}=s;yield this.isValidSessionOrPairingTopic(r)})),B(this,"isValidEmit",s=>f(this,null,function*(){if(!Je(s)){let{message:a}=j("MISSING_OR_INVALID",`emit() params: ${s}`);throw new Error(a)}let{topic:r,event:n,chainId:i}=s;yield this.isValidSessionTopic(r);let{namespaces:o}=this.client.session.get(r);if(!vl(o,i)){let{message:a}=j("MISSING_OR_INVALID",`emit() chainId: ${i}`);throw new Error(a)}if(!hg(n)){let{message:a}=j("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}if(!fg(o,i,n.name)){let{message:a}=j("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}})),B(this,"isValidDisconnect",s=>f(this,null,function*(){if(!Je(s)){let{message:n}=j("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(n)}let{topic:r}=s;yield this.isValidSessionOrPairingTopic(r)})),B(this,"isValidAuthenticate",s=>{let{chains:r,uri:n,domain:i,nonce:o}=s;if(!Array.isArray(r)||r.length===0)throw new Error("chains is required and must be a non-empty array");if(!Ie(n,!1))throw new Error("uri is required parameter");if(!Ie(i,!1))throw new Error("domain is required parameter");if(!Ie(o,!1))throw new Error("nonce is required parameter");if([...new Set(r.map(c=>Qt(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:a}=Qt(r[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),B(this,"getVerifyContext",s=>f(this,null,function*(){let{attestationId:r,hash:n,encryptedId:i,metadata:o,transportType:a}=s,c={verified:{verifyUrl:o.verifyUrl||on,validation:"UNKNOWN",origin:o.url||""}};try{if(a===we.link_mode){let u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}let l=yield this.client.core.verify.resolve({attestationId:r,hash:n,encryptedId:i,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c})),B(this,"validateSessionProps",(s,r)=>{Object.values(s).forEach((n,i)=>{if(n==null){let{message:o}=j("MISSING_OR_INVALID",`${r} must contain an existing value for each key. Received: ${n} for key ${Object.keys(s)[i]}`);throw new Error(o)}})}),B(this,"getPendingAuthRequest",s=>{let r=this.client.auth.requests.get(s);return typeof r=="object"?r:void 0}),B(this,"addToRecentlyDeleted",(s,r)=>{if(this.recentlyDeletedMap.set(s,r),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let n=0,i=this.recentlyDeletedLimit/2;for(let o of this.recentlyDeletedMap.keys()){if(n++>=i)break;this.recentlyDeletedMap.delete(o)}}}),B(this,"checkRecentlyDeleted",s=>{let r=this.recentlyDeletedMap.get(s);if(r){let{message:n}=j("MISSING_OR_INVALID",`Record was recently deleted - ${r}: ${s}`);throw new Error(n)}}),B(this,"isLinkModeEnabled",(s,r)=>{var n,i,o,a,c,l,u,h,d;return!s||r!==we.link_mode?!1:((i=(n=this.client.metadata)==null?void 0:n.redirect)==null?void 0:i.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=s?.redirect)==null?void 0:u.universal)!==void 0&&((h=s?.redirect)==null?void 0:h.universal)!==""&&((d=s?.redirect)==null?void 0:d.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(s.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),B(this,"getAppLinkIfEnabled",(s,r)=>{var n;return this.isLinkModeEnabled(s,r)?(n=s?.redirect)==null?void 0:n.universal:void 0}),B(this,"handleLinkModeMessage",({url:s})=>{if(!s||!s.includes("wc_ev")||!s.includes("topic"))return;let r=Yc(s,"topic")||"",n=decodeURIComponent(Yc(s,"wc_ev")||""),i=this.client.session.keys.includes(r);i&&this.client.session.update(r,{transportType:we.link_mode}),this.client.core.dispatchEnvelope({topic:r,message:n,sessionExists:i})}),B(this,"registerLinkModeListeners",()=>f(this,null,function*(){var s;if(Gn()||Ps()&&(s=this.client.metadata.redirect)!=null&&s.linkMode){let r=global==null?void 0:global.Linking;if(typeof r<"u"){r.addEventListener("url",this.handleLinkModeMessage,this.client.name);let n=yield r.getInitialURL();n&&setTimeout(()=>{this.handleLinkModeMessage({url:n})},50)}}})),B(this,"getTVFApproveParams",s=>{try{let r=ml(s.namespaces),n=Xp(s.namespaces),i=Zp(s.namespaces),o=s.sessionProperties,a=s.scopedProperties;return{approvedChains:r,approvedMethods:n,approvedEvents:i,sessionProperties:o,scopedProperties:a}}catch(r){return this.client.logger.warn(r,"Error getting TVF approve params"),{}}}),B(this,"getTVFParams",(s,r,n)=>{var i,o,a;if(!((i=r.request)!=null&&i.method))return{};let c={correlationId:s,rpcMethods:[r.request.method],chainId:r.chainId};try{let l=this.extractTxHashesFromResult(r.request,n);c.txHashes=l,c.contractAddresses=this.isValidContractData(r.request.params)?[(a=(o=r.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(l){this.client.logger.warn(l,"Error getting TVF params")}return c}),B(this,"isValidContractData",s=>{var r;if(!s)return!1;try{let n=s?.data||((r=s?.[0])==null?void 0:r.data);if(!n.startsWith("0x"))return!1;let i=n.slice(2);return/^[0-9a-fA-F]*$/.test(i)?i.length%2===0:!1}catch{}return!1}),B(this,"extractTxHashesFromResult",(s,r)=>{var n;try{if(!r)return[];let i=s.method,o=L2[i];if(i==="sui_signTransaction")return[rp(r.transactionBytes)];if(i==="near_signTransaction")return[el(r)];if(i==="near_signTransactions")return r.map(c=>el(c));if(i==="xrpl_signTransactionFor"||i==="xrpl_signTransaction")return[(n=r.tx_json)==null?void 0:n.hash];if(i==="polkadot_signTransaction")return[yg({transaction:s.params.transactionPayload,signature:r.signature})];if(i==="algo_signTxn")return ss(r)?r.map(c=>tl(c)):[tl(r)];if(i==="cosmos_signDirect")return[np(r)];if(i==="wallet_sendCalls")return ip(r);if(typeof r=="string")return[r];let a=r[o.key];if(ss(a))return i==="solana_signAllTransactions"?a.map(c=>sp(c)):a;if(typeof a=="string")return[a]}catch(i){this.client.logger.warn(i,"Error extracting tx hashes from result")}return[]})}processPendingMessageEvents(){return f(this,null,function*(){try{let e=this.client.session.keys,s=this.client.core.relayer.messages.getWithoutAck(e);for(let[r,n]of Object.entries(s))for(let i of n)try{yield this.onProviderMessageEvent({topic:r,message:i,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${r}, message: ${i}`)}}catch(e){this.client.logger.warn(e,"processPendingMessageEvents failed")}})}isInitialized(){if(!this.initialized){let{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}confirmOnlineStateOrThrow(){return f(this,null,function*(){yield this.client.core.relayer.confirmOnlineStateOrThrow()})}registerRelayerEvents(){this.client.core.relayer.on(_e.message,e=>{this.onProviderMessageEvent(e)})}onRelayMessage(e){return f(this,null,function*(){let{topic:s,message:r,attestation:n,transportType:i}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Vo)?this.client.auth.authKeys.get(Vo):{responseTopic:void 0,publicKey:void 0};try{let a=yield this.client.core.crypto.decode(s,r,{receiverPublicKey:o,encoding:i===we.link_mode?Os:Ze});wn(a)?(this.client.core.history.set(s,a),yield this.onRelayEventRequest({topic:s,payload:a,attestation:n,transportType:i,encryptedId:wt(r)})):bn(a)?(yield this.client.core.history.resolve(a),yield this.onRelayEventResponse({topic:s,payload:a,transportType:i}),this.client.core.history.delete(s,a.id)):(this.client.logger.error(`onRelayMessage() -> unknown payload: ${JSON.stringify(a)}`),yield this.onRelayEventUnknownPayload({topic:s,payload:a,transportType:i})),yield this.client.core.relayer.messages.ack(s,r)}catch(a){this.client.logger.error(`onRelayMessage() -> failed to process an inbound message: ${r}`),this.client.logger.error(a)}})}registerExpirerEvents(){this.client.core.expirer.on(Ot.expired,e=>f(this,null,function*(){let{topic:s,id:r}=Oo(e.target);if(r&&this.client.pendingRequest.keys.includes(r))return yield this.deletePendingSessionRequest(r,j("EXPIRED"),!0);if(r&&this.client.auth.requests.keys.includes(r))return yield this.deletePendingAuthRequest(r,j("EXPIRED"),!0);s?this.client.session.keys.includes(s)&&(yield this.deleteSession({topic:s,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:s})):r&&(yield this.deleteProposal(r,!0),this.client.events.emit("proposal_expire",{id:r}))}))}registerPairingEvents(){this.client.core.pairing.events.on(sr.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(sr.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!Ie(e,!1)){let{message:s}=j("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(s)}if(!this.client.core.pairing.pairings.keys.includes(e)){let{message:s}=j("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(s)}if(Tt(this.client.core.pairing.pairings.get(e).expiry)){let{message:s}=j("EXPIRED",`pairing topic: ${e}`);throw new Error(s)}}isValidSessionTopic(e){return f(this,null,function*(){if(!Ie(e,!1)){let{message:s}=j("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(s)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){let{message:s}=j("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(s)}if(Tt(this.client.session.get(e).expiry)){yield this.deleteSession({topic:e});let{message:s}=j("EXPIRED",`session topic: ${e}`);throw new Error(s)}if(!this.client.core.crypto.keychain.has(e)){let{message:s}=j("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw yield this.deleteSession({topic:e}),new Error(s)}})}isValidSessionOrPairingTopic(e){return f(this,null,function*(){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))yield this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Ie(e,!1)){let{message:s}=j("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(s)}else{let{message:s}=j("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(s)}})}isValidProposalId(e){return f(this,null,function*(){if(!ag(e)){let{message:s}=j("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(s)}if(!this.client.proposal.keys.includes(e)){let{message:s}=j("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(s)}if(Tt(this.client.proposal.get(e).expiryTimestamp)){yield this.deleteProposal(e);let{message:s}=j("EXPIRED",`proposal id: ${e}`);throw new Error(s)}})}validateRequestExpiry(e){if(e&&!pg(e,nu)){let{message:s}=j("MISSING_OR_INVALID",`request() expiry: ${e}. Expiry must be a number (in seconds) between ${nu.min} and ${nu.max}`);throw new Error(s)}}},cu=class extends fs{constructor(e,s){super(e,s,U2,mu),this.core=e,this.logger=s}},lu=class extends fs{constructor(e,s){super(e,s,B2,mu),this.core=e,this.logger=s}},uu=class extends fs{constructor(e,s){super(e,s,q2,mu,r=>r.id),this.core=e,this.logger=s}},hu=class extends fs{constructor(e,s){super(e,s,j2,Wo,()=>Vo),this.core=e,this.logger=s}},du=class extends fs{constructor(e,s){super(e,s,z2,Wo),this.core=e,this.logger=s}},fu=class extends fs{constructor(e,s){super(e,s,H2,Wo,r=>r.id),this.core=e,this.logger=s}},X2=Object.defineProperty,Z2=(t,e,s)=>e in t?X2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,iu=(t,e,s)=>Z2(t,typeof e!="symbol"?e+"":e,s),pu=class{constructor(e,s){this.core=e,this.logger=s,iu(this,"authKeys"),iu(this,"pairingTopics"),iu(this,"requests"),this.authKeys=new hu(this.core,this.logger),this.pairingTopics=new du(this.core,this.logger),this.requests=new fu(this.core,this.logger)}init(){return f(this,null,function*(){yield this.authKeys.init(),yield this.pairingTopics.init(),yield this.requests.init()})}},J2=Object.defineProperty,Q2=(t,e,s)=>e in t?J2(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ne=(t,e,s)=>Q2(t,typeof e!="symbol"?e+"":e,s),gu=class t extends Ci{constructor(e){super(e),ne(this,"protocol",cm),ne(this,"version",lm),ne(this,"name",ru.name),ne(this,"metadata"),ne(this,"core"),ne(this,"logger"),ne(this,"events",new Ko.EventEmitter),ne(this,"engine"),ne(this,"session"),ne(this,"proposal"),ne(this,"pendingRequest"),ne(this,"auth"),ne(this,"signConfig"),ne(this,"on",(r,n)=>this.events.on(r,n)),ne(this,"once",(r,n)=>this.events.once(r,n)),ne(this,"off",(r,n)=>this.events.off(r,n)),ne(this,"removeListener",(r,n)=>this.events.removeListener(r,n)),ne(this,"removeAllListeners",r=>this.events.removeAllListeners(r)),ne(this,"connect",r=>f(this,null,function*(){try{return yield this.engine.connect(r)}catch(n){throw this.logger.error(n.message),n}})),ne(this,"pair",r=>f(this,null,function*(){try{return yield this.engine.pair(r)}catch(n){throw this.logger.error(n.message),n}})),ne(this,"approve",r=>f(this,null,function*(){try{return yield this.engine.approve(r)}catch(n){throw this.logger.error(n.message),n}})),ne(this,"reject",r=>f(this,null,function*(){try{return yield this.engine.reject(r)}catch(n){throw this.logger.error(n.message),n}})),ne(this,"update",r=>f(this,null,function*(){try{return yield this.engine.update(r)}catch(n){throw this.logger.error(n.message),n}})),ne(this,"extend",r=>f(this,null,function*(){try{return yield this.engine.extend(r)}catch(n){throw this.logger.error(n.message),n}})),ne(this,"request",r=>f(this,null,function*(){try{return yield this.engine.request(r)}catch(n){throw this.logger.error(n.message),n}})),ne(this,"respond",r=>f(this,null,function*(){try{return yield this.engine.respond(r)}catch(n){throw this.logger.error(n.message),n}})),ne(this,"ping",r=>f(this,null,function*(){try{return yield this.engine.ping(r)}catch(n){throw this.logger.error(n.message),n}})),ne(this,"emit",r=>f(this,null,function*(){try{return yield this.engine.emit(r)}catch(n){throw this.logger.error(n.message),n}})),ne(this,"disconnect",r=>f(this,null,function*(){try{return yield this.engine.disconnect(r)}catch(n){throw this.logger.error(n.message),n}})),ne(this,"find",r=>{try{return this.engine.find(r)}catch(n){throw this.logger.error(n.message),n}}),ne(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(r){throw this.logger.error(r.message),r}}),ne(this,"authenticate",(r,n)=>f(this,null,function*(){try{return yield this.engine.authenticate(r,n)}catch(i){throw this.logger.error(i.message),i}})),ne(this,"formatAuthMessage",r=>{try{return this.engine.formatAuthMessage(r)}catch(n){throw this.logger.error(n.message),n}}),ne(this,"approveSessionAuthenticate",r=>f(this,null,function*(){try{return yield this.engine.approveSessionAuthenticate(r)}catch(n){throw this.logger.error(n.message),n}})),ne(this,"rejectSessionAuthenticate",r=>f(this,null,function*(){try{return yield this.engine.rejectSessionAuthenticate(r)}catch(n){throw this.logger.error(n.message),n}})),this.name=e?.name||ru.name,this.metadata=Bf(e?.metadata),this.signConfig=e?.signConfig;let s=sn({logger:e?.logger||ru.logger,name:this.name});this.logger=s,this.core=e?.core||new nm(e),this.session=new lu(this.core,this.logger),this.proposal=new cu(this.core,this.logger),this.pendingRequest=new uu(this.core,this.logger),this.engine=new au(this),this.auth=new pu(this.core,this.logger)}static init(e){return f(this,null,function*(){let s=new t(e);return yield s.initialize(),s})}get context(){return rt(this.logger)}get pairing(){return this.core.pairing.pairings}initialize(){return f(this,null,function*(){this.logger.trace("Initialized");try{yield this.core.start(),yield this.session.init(),yield this.proposal.init(),yield this.pendingRequest.init(),yield this.auth.init(),yield this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}})}};var hm=gu;var Nm=zt(gi(),1);function Cu(t){return t==null||typeof t!="object"&&typeof t!="function"}function km(t){return Object.getOwnPropertySymbols(t).filter(e=>Object.prototype.propertyIsEnumerable.call(t,e))}function Um(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}var eS="[object RegExp]",Bm="[object String]",Dm="[object Number]",Lm="[object Boolean]",qm="[object Arguments]",tS="[object Symbol]",sS="[object Date]",rS="[object Map]",nS="[object Set]",iS="[object Array]",oS="[object ArrayBuffer]",aS="[object Object]",cS="[object DataView]",lS="[object Uint8Array]",uS="[object Uint8ClampedArray]",hS="[object Uint16Array]",dS="[object Uint32Array]",fS="[object Int8Array]",pS="[object Int16Array]",gS="[object Int32Array]",mS="[object Float32Array]",yS="[object Float64Array]";function Ou(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function wS(t,e){return un(t,void 0,t,new Map,e)}function un(t,e,s,r=new Map,n=void 0){let i=n?.(t,e,s,r);if(i!=null)return i;if(Cu(t))return t;if(r.has(t))return r.get(t);if(Array.isArray(t)){let o=new Array(t.length);r.set(t,o);for(let a=0;a<t.length;a++)o[a]=un(t[a],a,s,r,n);return Object.hasOwn(t,"index")&&(o.index=t.index),Object.hasOwn(t,"input")&&(o.input=t.input),o}if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp){let o=new RegExp(t.source,t.flags);return o.lastIndex=t.lastIndex,o}if(t instanceof Map){let o=new Map;r.set(t,o);for(let[a,c]of t)o.set(a,un(c,a,s,r,n));return o}if(t instanceof Set){let o=new Set;r.set(t,o);for(let a of t)o.add(un(a,void 0,s,r,n));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(t))return t.subarray();if(Ou(t)){let o=new(Object.getPrototypeOf(t)).constructor(t.length);r.set(t,o);for(let a=0;a<t.length;a++)o[a]=un(t[a],a,s,r,n);return o}if(t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);if(t instanceof DataView){let o=new DataView(t.buffer.slice(0),t.byteOffset,t.byteLength);return r.set(t,o),Rr(o,t,s,r,n),o}if(typeof File<"u"&&t instanceof File){let o=new File([t],t.name,{type:t.type});return r.set(t,o),Rr(o,t,s,r,n),o}if(t instanceof Blob){let o=new Blob([t],{type:t.type});return r.set(t,o),Rr(o,t,s,r,n),o}if(t instanceof Error){let o=new t.constructor;return r.set(t,o),o.message=t.message,o.name=t.name,o.stack=t.stack,o.cause=t.cause,Rr(o,t,s,r,n),o}if(typeof t=="object"&&bS(t)){let o=Object.create(Object.getPrototypeOf(t));return r.set(t,o),Rr(o,t,s,r,n),o}return t}function Rr(t,e,s=t,r,n){let i=[...Object.keys(e),...km(e)];for(let o=0;o<i.length;o++){let a=i[o],c=Object.getOwnPropertyDescriptor(t,a);(c==null||c.writable)&&(t[a]=un(e[a],a,s,r,n))}}function bS(t){switch(Um(t)){case qm:case iS:case oS:case cS:case Lm:case sS:case mS:case yS:case fS:case pS:case gS:case rS:case Dm:case aS:case eS:case nS:case Bm:case tS:case lS:case uS:case hS:case dS:return!0;default:return!1}}function vS(t,e){return wS(t,(s,r,n,i)=>{let o=e?.(s,r,n,i);if(o!=null)return o;if(typeof t=="object")switch(Object.prototype.toString.call(t)){case Dm:case Bm:case Lm:{let a=new t.constructor(t?.valueOf());return Rr(a,t),a}case qm:{let a={};return Rr(a,t),a.length=t.length,a[Symbol.iterator]=t[Symbol.iterator],a}default:return}})}function dm(t){return vS(t)}function fm(t){return t!==null&&typeof t=="object"&&Um(t)==="[object Arguments]"}function pm(t){return typeof t=="object"&&t!==null}function ES(){}function xS(t){return Ou(t)}function SS(t){if(typeof t!="object"||t==null)return!1;if(Object.getPrototypeOf(t)===null)return!0;if(Object.prototype.toString.call(t)!=="[object Object]"){let s=t[Symbol.toStringTag];return s==null||!Object.getOwnPropertyDescriptor(t,Symbol.toStringTag)?.writable?!1:t.toString()===`[object ${s}]`}let e=t;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(t)===e}function IS(t){if(Cu(t))return t;if(Array.isArray(t)||Ou(t)||t instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&t instanceof SharedArrayBuffer)return t.slice(0);let e=Object.getPrototypeOf(t),s=e.constructor;if(t instanceof Date||t instanceof Map||t instanceof Set)return new s(t);if(t instanceof RegExp){let r=new s(t);return r.lastIndex=t.lastIndex,r}if(t instanceof DataView)return new s(t.buffer.slice(0));if(t instanceof Error){let r=new s(t.message);return r.stack=t.stack,r.name=t.name,r.cause=t.cause,r}if(typeof File<"u"&&t instanceof File)return new s([t],t.name,{type:t.type,lastModified:t.lastModified});if(typeof t=="object"){let r=Object.create(e);return Object.assign(r,t)}return t}function AS(t,...e){let s=e.slice(0,-1),r=e[e.length-1],n=t;for(let i=0;i<s.length;i++){let o=s[i];n=Su(n,o,r,new Map)}return n}function Su(t,e,s,r){if(Cu(t)&&(t=Object(t)),e==null||typeof e!="object")return t;if(r.has(e))return IS(r.get(e));if(r.set(e,t),Array.isArray(e)){e=e.slice();for(let i=0;i<e.length;i++)e[i]=e[i]??void 0}let n=[...Object.keys(e),...km(e)];for(let i=0;i<n.length;i++){let o=n[i],a=e[o],c=t[o];if(fm(a)&&(a=H({},a)),fm(c)&&(c=H({},c)),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=dm(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){let u=[],h=Reflect.ownKeys(c);for(let d=0;d<h.length;d++){let p=h[d];u[p]=c[p]}c=u}else c=[];let l=s(c,a,o,t,e,r);l!=null?t[o]=l:Array.isArray(a)||pm(c)&&pm(a)?t[o]=Su(c,a,s,r):c==null&&SS(a)?t[o]=Su({},a,s,r):c==null&&xS(a)?t[o]=dm(a):(c===void 0||a!==void 0)&&(t[o]=a)}return t}function _S(t,...e){return AS(t,...e,ES)}var gm="error",TS="wss://relay.walletconnect.org",PS="wc",Mm="universal_provider",Go=`${PS}@2:${Mm}:`,Fm="https://rpc.walletconnect.org/v1/",$m="generic",CS=`${Fm}bundler`,hn="call_status",OS=86400,Ru={DEFAULT_CHAIN_CHANGED:"default_chain_changed"},RS=Object.defineProperty,NS=Object.defineProperties,kS=Object.getOwnPropertyDescriptors,mm=Object.getOwnPropertySymbols,US=Object.prototype.hasOwnProperty,BS=Object.prototype.propertyIsEnumerable,ym=(t,e,s)=>e in t?RS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Yo=(t,e)=>{for(var s in e||(e={}))US.call(e,s)&&ym(t,s,e[s]);if(mm)for(var s of mm(e))BS.call(e,s)&&ym(t,s,e[s]);return t},DS=(t,e)=>NS(t,kS(e));function jm(t,e,s){var r;let n=Qt(t);return((r=e.rpcMap)==null?void 0:r[n.reference])||`${Fm}?chainId=${n.namespace}:${n.reference}&projectId=${s}`}function LS(t){return t.includes(":")?t.split(":")[1]:t}function zm(t){return t.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function qS(t,e){let s=Object.keys(e.namespaces).filter(n=>n.includes(t));if(!s.length)return[];let r=[];return s.forEach(n=>{let i=e.namespaces[n].accounts;r.push(...i)}),r}function wm(t){return Object.fromEntries(Object.entries(t).filter(([e,s])=>{var r,n;return((r=s?.chains)==null?void 0:r.length)&&((n=s?.chains)==null?void 0:n.length)>0}))}function Xo(t={},e={}){let s=wm(bm(t)),r=wm(bm(e));return _S(s,r)}function bm(t){var e,s,r,n,i;let o={};if(!Lt(t))return o;for(let[a,c]of Object.entries(t)){let l=si(a)?[a]:c.chains,u=c.methods||[],h=c.events||[],d=c.rpcMap||{},p=Cr(a);o[p]=DS(Yo(Yo({},o[p]),c),{chains:Yt(l,(e=o[p])==null?void 0:e.chains),methods:Yt(u,(s=o[p])==null?void 0:s.methods),events:Yt(h,(r=o[p])==null?void 0:r.events)}),(Lt(d)||Lt(((n=o[p])==null?void 0:n.rpcMap)||{}))&&(o[p].rpcMap=Yo(Yo({},d),(i=o[p])==null?void 0:i.rpcMap))}return o}function vm(t){return t.includes(":")?t.split(":")[2]:t}function Em(t){let e={};for(let[s,r]of Object.entries(t)){let n=r.methods||[],i=r.events||[],o=r.accounts||[],a=si(s)?[s]:r.chains?r.chains:zm(r.accounts);e[s]={chains:a,methods:n,events:i,accounts:o}}return e}function yu(t){return typeof t=="number"?t:t.includes("0x")?parseInt(t,16):(t=t.includes(":")?t.split(":")[1]:t,isNaN(Number(t))?t:Number(t))}function MS(t){try{let e=JSON.parse(t);return typeof e=="object"&&e!==null&&!Array.isArray(e)}catch{return!1}}var Hm={},dn=t=>Hm[t],wu=(t,e)=>{Hm[t]=e},FS=Object.defineProperty,xm=Object.getOwnPropertySymbols,$S=Object.prototype.hasOwnProperty,jS=Object.prototype.propertyIsEnumerable,Sm=(t,e,s)=>e in t?FS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Im=(t,e)=>{for(var s in e||(e={}))$S.call(e,s)&&Sm(t,s,e[s]);if(xm)for(var s of xm(e))jS.call(e,s)&&Sm(t,s,e[s]);return t},Am="eip155",zS=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],HS=t=>t&&t.startsWith("0x")?BigInt(t).toString(10):t,bu=t=>t&&t.startsWith("0x")?t:`0x${BigInt(t).toString(16)}`,_m=t=>Object.keys(t).filter(e=>zS.includes(e)).reduce((e,s)=>(e[s]=VS(t[s]),e),{}),VS=t=>typeof t=="string"&&MS(t)?JSON.parse(t):t,KS=(t,e,s)=>{let{sessionProperties:r={},scopedProperties:n={}}=t,i={};if(!Lt(n)&&!Lt(r))return;let o=_m(r);for(let a of s){let c=HS(a);if(!c)continue;i[bu(c)]=o;let l=n?.[`${Am}:${c}`];if(l){let u=l?.[`${Am}:${c}:${e}`];i[bu(c)]=Im(Im({},i[bu(c)]),_m(u||l))}}for(let[a,c]of Object.entries(i))Object.keys(c).length===0&&delete i[a];return Object.keys(i).length>0?i:void 0},WS=Object.defineProperty,GS=(t,e,s)=>e in t?WS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,YS=(t,e,s)=>GS(t,typeof e!="symbol"?e+"":e,s),vu,Iu=class t{constructor(e){YS(this,"storage"),this.storage=e}getItem(e){return f(this,null,function*(){return yield this.storage.getItem(e)})}setItem(e,s){return f(this,null,function*(){return yield this.storage.setItem(e,s)})}removeItem(e){return f(this,null,function*(){return yield this.storage.removeItem(e)})}static getStorage(e){return vu||(vu=new t(e)),vu}},XS=Object.defineProperty,ZS=Object.defineProperties,JS=Object.getOwnPropertyDescriptors,Tm=Object.getOwnPropertySymbols,QS=Object.prototype.hasOwnProperty,eI=Object.prototype.propertyIsEnumerable,Pm=(t,e,s)=>e in t?XS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,tI=(t,e)=>{for(var s in e||(e={}))QS.call(e,s)&&Pm(t,s,e[s]);if(Tm)for(var s of Tm(e))eI.call(e,s)&&Pm(t,s,e[s]);return t},sI=(t,e)=>ZS(t,JS(e));function rI(t,e){return f(this,null,function*(){let s=Qt(t.result.capabilities.caip345.caip2),r=t.result.capabilities.caip345.transactionHashes,n=yield Promise.allSettled(r.map(h=>nI(s.reference,h,e))),i=n.filter(h=>h.status==="fulfilled").map(h=>h.value).filter(h=>h);n.filter(h=>h.status==="rejected").forEach(h=>console.warn("Failed to fetch transaction receipt:",h.reason));let o=!i.length||i.some(h=>!h),a=i.every(h=>h?.status==="0x1"),c=i.every(h=>h?.status==="0x0"),l=i.some(h=>h?.status==="0x0"),u;return o?u=100:a?u=200:c?u=500:l&&(u=600),{id:t.result.id,version:t.request.version,atomic:t.request.atomicRequired,chainId:t.request.chainId,capabilities:t.result.capabilities,receipts:i,status:u}})}function nI(t,e,s){return f(this,null,function*(){return yield s(parseInt(t)).request(Et("eth_getTransactionReceipt",[e]))})}function iI(s){return f(this,arguments,function*({sendCalls:t,storage:e}){let r=yield e.getItem(hn);yield e.setItem(hn,sI(tI({},r),{[t.result.id]:{request:t.request,result:t.result,expiry:xe(OS)}}))})}function oI(s){return f(this,arguments,function*({resultId:t,storage:e}){let r=yield e.getItem(hn);if(r){delete r[t],yield e.setItem(hn,r);for(let n in r)Tt(r[n].expiry)&&delete r[n];yield e.setItem(hn,r)}})}function aI(s){return f(this,arguments,function*({resultId:t,storage:e}){let r=yield e.getItem(hn),n=r?.[t];if(n&&!Tt(n.expiry))return n;yield oI({resultId:t,storage:e})})}var cI=Object.defineProperty,lI=Object.defineProperties,uI=Object.getOwnPropertyDescriptors,Cm=Object.getOwnPropertySymbols,hI=Object.prototype.hasOwnProperty,dI=Object.prototype.propertyIsEnumerable,Au=(t,e,s)=>e in t?cI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,Eu=(t,e)=>{for(var s in e||(e={}))hI.call(e,s)&&Au(t,s,e[s]);if(Cm)for(var s of Cm(e))dI.call(e,s)&&Au(t,s,e[s]);return t},xu=(t,e)=>lI(t,uI(e)),Or=(t,e,s)=>Au(t,typeof e!="symbol"?e+"":e,s),_u=class{constructor(e){Or(this,"name","eip155"),Or(this,"client"),Or(this,"chainId"),Or(this,"namespace"),Or(this,"httpProviders"),Or(this,"events"),Or(this,"storage"),this.namespace=e.namespace,this.events=dn("events"),this.client=dn("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=Iu.getStorage(this.client.core.storage)}request(e){return f(this,null,function*(){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return yield this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return yield this.getCapabilities(e);case"wallet_getCallsStatus":return yield this.getCallStatus(e);case"wallet_sendCalls":return yield this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?yield this.client.request(e):this.getHttpProvider().request(e.request)})}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(parseInt(e),s);let r=this.chainId;this.chainId=parseInt(e),this.events.emit(Ru.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${r}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,s){let r=s||jm(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new vn(new yi(r,dn("disableProviderPing")))}setHttpProvider(e,s){let r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProviders(){let e={};return this.namespace.chains.forEach(s=>{var r;let n=parseInt(LS(s));e[n]=this.createHttpProvider(n,(r=this.namespace.rpcMap)==null?void 0:r[s])}),e}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}getHttpProvider(e){let s=e||this.chainId;return this.httpProviders[s]||(this.httpProviders=xu(Eu({},this.httpProviders),{[s]:this.createHttpProvider(s)}),this.httpProviders[s])}handleSwitchChain(e){return f(this,null,function*(){var s,r;let n=e.request.params?(s=e.request.params[0])==null?void 0:s.chainId:"0x0";n=n.startsWith("0x")?n:`0x${n}`;let i=parseInt(n,16);if(this.isChainApproved(i))this.setDefaultChain(`${i}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))yield this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:n}]},chainId:(r=this.namespace.chains)==null?void 0:r[0]}),this.setDefaultChain(`${i}`);else throw new Error(`Failed to switch to chain 'eip155:${i}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null})}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}getCapabilities(e){return f(this,null,function*(){var s,r,n,i,o;let a=(r=(s=e.request)==null?void 0:s.params)==null?void 0:r[0],c=((i=(n=e.request)==null?void 0:n.params)==null?void 0:i[1])||[];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");let l=this.client.session.get(e.topic),u=((o=l?.sessionProperties)==null?void 0:o.capabilities)||{},h=`${a}${c.join(",")}`,d=u?.[h];if(d)return d;let p;try{p=KS(l,a,c)}catch(g){console.warn("Failed to extract capabilities from session",g)}if(p)return p;let m=yield this.client.request(e);try{yield this.client.session.update(e.topic,{sessionProperties:xu(Eu({},l.sessionProperties||{}),{capabilities:xu(Eu({},u||{}),{[h]:m})})})}catch(g){console.warn("Failed to update session with capabilities",g)}return m})}getCallStatus(e){return f(this,null,function*(){var s,r,n;let i=this.client.session.get(e.topic),o=(s=i.sessionProperties)==null?void 0:s.bundler_name;if(o){let l=this.getBundlerUrl(e.chainId,o);try{return yield this.getUserOperationReceipt(l,e)}catch(u){console.warn("Failed to fetch call status from bundler",u,l)}}let a=(r=i.sessionProperties)==null?void 0:r.bundler_url;if(a)try{return yield this.getUserOperationReceipt(a,e)}catch(l){console.warn("Failed to fetch call status from custom bundler",l,a)}let c=yield aI({resultId:(n=e.request.params)==null?void 0:n[0],storage:this.storage});if(c)try{return yield rI(c,this.getHttpProvider.bind(this))}catch(l){console.warn("Failed to fetch call status from stored send calls",l,c)}if(this.namespace.methods.includes(e.request.method))return yield this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")})}getUserOperationReceipt(e,s){return f(this,null,function*(){var r;let n=new URL(e),i=yield fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Et("eth_getUserOperationReceipt",[(r=s.request.params)==null?void 0:r[0]]))});if(!i.ok)throw new Error(`Failed to fetch user operation receipt - ${i.status}`);return yield i.json()})}getBundlerUrl(e,s){return`${CS}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${s}`}sendCalls(e){return f(this,null,function*(){var s,r,n;let i=yield this.client.request(e),o=(s=e.request.params)==null?void 0:s[0],a=i?.id,c=i?.capabilities||{},l=(r=c?.caip345)==null?void 0:r.caip2,u=(n=c?.caip345)==null?void 0:n.transactionHashes;return!a||!l||!(u!=null&&u.length)||(yield iI({sendCalls:{request:o,result:i},storage:this.storage})),i})}},fI=Object.defineProperty,pI=(t,e,s)=>e in t?fI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,ln=(t,e,s)=>pI(t,typeof e!="symbol"?e+"":e,s),Tu=class{constructor(e){ln(this,"name",$m),ln(this,"client"),ln(this,"httpProviders"),ln(this,"events"),ln(this,"namespace"),ln(this,"chainId"),this.namespace=e.namespace,this.events=dn("events"),this.client=dn("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,s){this.httpProviders[e]||this.setHttpProvider(e,s);let r=this.chainId;this.chainId=e,this.events.emit(Ru.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${r}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){let e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return Qt(e).namespace}getAccounts(){let e=this.namespace.accounts;return e?[...new Set(e.filter(s=>s.split(":")[1]===this.chainId.toString()).map(s=>s.split(":")[2]))]:[]}createHttpProviders(){var e,s;let r={};return(s=(e=this.namespace)==null?void 0:e.accounts)==null||s.forEach(n=>{var i,o;let a=Qt(n),c=(o=(i=this.namespace)==null?void 0:i.rpcMap)==null?void 0:o[`${a.namespace}:${a.reference}`];r[a.reference]=this.createHttpProvider(n,c)}),r}getHttpProvider(e){let s=Qt(e).reference,r=this.httpProviders[s];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return r}setHttpProvider(e,s){let r=this.createHttpProvider(e,s);r&&(this.httpProviders[e]=r)}createHttpProvider(e,s){let r=s||jm(e,this.namespace,this.client.core.projectId);if(!r)throw new Error(`No RPC url provided for chainId: ${e}`);return new vn(new yi(r,dn("disableProviderPing")))}},gI=Object.defineProperty,mI=Object.defineProperties,yI=Object.getOwnPropertyDescriptors,Om=Object.getOwnPropertySymbols,wI=Object.prototype.hasOwnProperty,bI=Object.prototype.propertyIsEnumerable,Pu=(t,e,s)=>e in t?gI(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,li=(t,e)=>{for(var s in e||(e={}))wI.call(e,s)&&Pu(t,s,e[s]);if(Om)for(var s of Om(e))bI.call(e,s)&&Pu(t,s,e[s]);return t},Zo=(t,e)=>mI(t,yI(e)),Rt=(t,e,s)=>Pu(t,typeof e!="symbol"?e+"":e,s),Rm=class t{constructor(e){Rt(this,"client"),Rt(this,"namespaces"),Rt(this,"optionalNamespaces"),Rt(this,"sessionProperties"),Rt(this,"scopedProperties"),Rt(this,"events",new Nm.default),Rt(this,"rpcProviders",{}),Rt(this,"session"),Rt(this,"providerOpts"),Rt(this,"logger"),Rt(this,"uri"),Rt(this,"disableProviderPing",!1),Rt(this,"connectParams");var s,r;this.providerOpts=e,this.logger=sn({logger:(s=e.logger)!=null?s:gm,name:(r=this.providerOpts.name)!=null?r:Mm}),this.disableProviderPing=e?.disableProviderPing||!1}static init(e){return f(this,null,function*(){let s=new t(e);return yield s.initialize(),s})}request(e,s,r){return f(this,null,function*(){let[n,i]=this.validateChain(s);if(!this.session)throw new Error("Please call connect() before request()");return yield this.getProvider(n).request({request:li({},e),chainId:`${n}:${i}`,topic:this.session.topic,expiry:r})})}sendAsync(e,s,r,n){let i=new Date().getTime();this.request(e,r,n).then(o=>s(null,Bs(i,o))).catch(o=>s(o,void 0))}enable(){return f(this,null,function*(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||(yield this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties})),yield this.requestAccounts()})}disconnect(){return f(this,null,function*(){var e;if(!this.session)throw new Error("Please call connect() before enable()");yield this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:ge("USER_DISCONNECTED")}),yield this.cleanup()})}connect(e){return f(this,null,function*(){if(!this.client)throw new Error("Sign Client not initialized");if(this.connectParams=e,this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return yield this.pair(e.pairingTopic)})}authenticate(e,s){return f(this,null,function*(){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),yield this.cleanupPendingPairings();let{uri:r,response:n}=yield this.client.authenticate(e,s);r&&(this.uri=r,this.events.emit("display_uri",r));let i=yield n();if(this.session=i.session,this.session){let o=Em(this.session.namespaces);this.namespaces=Xo(this.namespaces,o),yield this.persist("namespaces",this.namespaces),this.onConnect()}return i})}on(e,s){this.events.on(e,s)}once(e,s){this.events.once(e,s)}removeListener(e,s){this.events.removeListener(e,s)}off(e,s){this.events.off(e,s)}get isWalletConnect(){return!0}pair(e){return f(this,null,function*(){var s,r;let{uri:n,approval:i}=yield this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties,authentication:(s=this.connectParams)==null?void 0:s.authentication,walletPay:(r=this.connectParams)==null?void 0:r.walletPay});n&&(this.uri=n,this.events.emit("display_uri",n));let o=yield i();this.session=o;let a=Em(o.namespaces);return this.namespaces=Xo(this.namespaces,a),yield this.persist("namespaces",this.namespaces),yield this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session})}setDefaultChain(e,s){try{if(!this.session)return;let[r,n]=this.validateChain(e);this.getProvider(r).setDefaultChain(n,s)}catch(r){if(!/Please call connect/.test(r.message))throw r}}cleanupPendingPairings(){return f(this,arguments,function*(e={}){try{this.logger.info("Cleaning up inactive pairings...");let s=this.client.pairing.getAll();if(!ss(s))return;for(let r of s)e.deletePairings?this.client.core.expirer.set(r.topic,0):yield this.client.core.relayer.subscriber.unsubscribe(r.topic);this.logger.info(`Inactive pairings cleared: ${s.length}`)}catch(s){this.logger.warn(s,"Failed to cleanup pending pairings")}})}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}checkStorage(){return f(this,null,function*(){this.namespaces=(yield this.getFromStore("namespaces"))||{},this.optionalNamespaces=(yield this.getFromStore("optionalNamespaces"))||{},this.session&&this.createProviders()})}initialize(){return f(this,null,function*(){this.logger.trace("Initialized"),yield this.createClient(),yield this.checkStorage(),this.registerEventListeners()})}createClient(){return f(this,null,function*(){var e,s;if(this.client=this.providerOpts.client||(yield hm.init({core:this.providerOpts.core,logger:this.providerOpts.logger||gm,relayUrl:this.providerOpts.relayUrl||TS,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled})),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(r){throw this.logger.error(r,"Failed to get session"),new Error(`The provided session: ${(s=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:s.topic} doesn't exist in the Sign client`)}else{let r=this.client.session.getAll();this.session=r[0]}this.logger.trace("SignClient Initialized")})}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");let e=[...new Set(Object.keys(this.session.namespaces).map(s=>Cr(s)))];wu("client",this.client),wu("events",this.events),wu("disableProviderPing",this.disableProviderPing),e.forEach(s=>{if(!this.session)return;let r=qS(s,this.session);if(r?.length===0)return;let n=zm(r),i=Xo(this.namespaces,this.optionalNamespaces),o=Zo(li({},i[s]),{accounts:r,chains:n});switch(s){case"eip155":this.rpcProviders[s]=new _u({namespace:o});break;default:this.rpcProviders[s]=new Tu({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var s;let{topic:r}=e;r===((s=this.session)==null?void 0:s.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var s;let{params:r,topic:n}=e;if(n!==((s=this.session)==null?void 0:s.topic))return;let{event:i}=r;if(i.name==="accountsChanged"){let o=i.data;o&&ss(o)&&this.events.emit("accountsChanged",o.map(vm))}else if(i.name==="chainChanged"){let o=r.chainId,a=r.event.data,c=Cr(o),l=yu(o)!==yu(a)?`${c}:${yu(a)}`:o;this.onChainChanged({currentCaipChainId:l})}else this.events.emit(i.name,i.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:s})=>{var r,n;if(e!==((r=this.session)==null?void 0:r.topic))return;let{namespaces:i}=s,o=(n=this.client)==null?void 0:n.session.get(e);this.session=Zo(li({},o),{namespaces:i}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:s})}),this.client.on("session_delete",e=>f(this,null,function*(){var s;e.topic===((s=this.session)==null?void 0:s.topic)&&(yield this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",Zo(li({},ge("USER_DISCONNECTED")),{data:e.topic})))})),this.on(Ru.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(Zo(li({},e),{internal:!0}))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[$m]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var s;this.getProvider(e).updateNamespace((s=this.session)==null?void 0:s.namespaces[e])})}setNamespaces(e){let{namespaces:s={},optionalNamespaces:r={},sessionProperties:n,scopedProperties:i}=e;this.optionalNamespaces=Xo(s,r),this.sessionProperties=n,this.scopedProperties=i}validateChain(e){let[s,r]=e?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[s,r];if(s&&!Object.keys(this.namespaces||{}).map(o=>Cr(o)).includes(s))throw new Error(`Namespace '${s}' is not configured. Please call connect() first with namespace config.`);if(s&&r)return[s,r];let n=Cr(Object.keys(this.namespaces)[0]),i=this.rpcProviders[n].getDefaultChain();return[n,i]}requestAccounts(){return f(this,null,function*(){let[e]=this.validateChain();return yield this.getProvider(e).requestAccounts()})}onChainChanged(n){return f(this,arguments,function*({currentCaipChainId:e,previousCaipChainId:s,internal:r=!1}){if(!this.namespaces)return;let[i,o]=this.validateChain(e);o&&(this.updateNamespaceChain(i,o),r?(this.events.emit("chainChanged",o),this.emitAccountsChangedOnChainChange({namespace:i,currentCaipChainId:e,previousCaipChainId:s})):this.getProvider(i).setDefaultChain(o),yield this.persist("namespaces",this.namespaces))})}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:s,previousCaipChainId:r}){var n,i;try{if(r===s)return;let o=(i=(n=this.session)==null?void 0:n.namespaces[e])==null?void 0:i.accounts;if(!o)return;let a=o.filter(c=>c.includes(`${s}:`)).map(vm);if(!ss(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn(o,"Failed to emit accountsChanged on chain change")}}updateNamespaceChain(e,s){if(!this.namespaces)return;let r=this.namespaces[e]?e:`${e}:${s}`,n={chains:[],methods:[],events:[],defaultChain:s};this.namespaces[r]?this.namespaces[r]&&(this.namespaces[r].defaultChain=s):this.namespaces[r]=n}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}cleanup(){return f(this,null,function*(){this.connectParams=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,yield this.deleteFromStore("namespaces"),yield this.deleteFromStore("optionalNamespaces"),yield this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),yield this.cleanupStorage()})}persist(e,s){return f(this,null,function*(){var r;let n=((r=this.session)==null?void 0:r.topic)||"";yield this.client.core.storage.setItem(`${Go}/${e}${n}`,s)})}getFromStore(e){return f(this,null,function*(){var s;let r=((s=this.session)==null?void 0:s.topic)||"";return yield this.client.core.storage.getItem(`${Go}/${e}${r}`)})}deleteFromStore(e){return f(this,null,function*(){var s;let r=((s=this.session)==null?void 0:s.topic)||"";yield this.client.core.storage.removeItem(`${Go}/${e}${r}`)})}cleanupStorage(){return f(this,null,function*(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;let s=yield this.client.core.storage.getKeys();for(let r of s)r.startsWith(Go)&&(yield this.client.core.storage.removeItem(r))}catch(s){this.logger.warn(s,"Failed to cleanup storage")}})}};var Vm={convertEVMChainIdToCoinType(t){if(t>=2147483648)throw new Error("Invalid chainId");return(2147483648|t)>>>0}};var $t=ct({suggestions:[],loading:!1}),vI={state:$t,subscribe(t){return kt($t,()=>t($t))},subscribeKey(t,e){return lt($t,t,e)},resolveName(t){return f(this,null,function*(){try{return yield Re.lookupEnsName(t)}catch(e){let s=e;throw new Error(s?.reasons?.[0]?.description||"Error resolving name")}})},isNameRegistered(t){return f(this,null,function*(){try{return yield Re.lookupEnsName(t),!0}catch{return!1}})},getSuggestions(t){return f(this,null,function*(){try{$t.loading=!0,$t.suggestions=[];let e=yield Re.getEnsNameSuggestions(t);return $t.suggestions=e.suggestions||[],$t.suggestions}catch(e){let s=fn.parseEnsApiError(e,"Error fetching name suggestions");throw new Error(s)}finally{$t.loading=!1}})},getNamesForAddress(t){return f(this,null,function*(){try{if(!Y.state.activeCaipNetwork)return[];let s=pn.getEnsFromCacheForAddress(t);if(s)return s;let r=yield Re.reverseLookupEnsName({address:t});return pn.updateEnsCache({address:t,ens:r,timestamp:Date.now()}),r}catch(e){let s=fn.parseEnsApiError(e,"Error fetching names for address");throw new Error(s)}})},registerName(t){return f(this,null,function*(){let e=Y.state.activeCaipNetwork,s=Y.getAccountData(e?.chainNamespace)?.address,r=as.getAuthConnector();if(!e)throw new Error("Network not found");if(!s||!r)throw new Error("Address or auth connector not found");$t.loading=!0;try{let n=JSON.stringify({name:t,attributes:{},timestamp:Math.floor(Date.now()/1e3)});pe.pushTransactionStack({onCancel(){pe.replace("RegisterAccountName")}});let i=yield ht.signMessage(n);$t.loading=!1;let o=e.id;if(!o)throw new Error("Network not found");let a=Vm.convertEVMChainIdToCoinType(Number(o));yield Re.registerEnsName({coinType:a,address:s,signature:i,message:n}),Y.setAccountProp("profileName",t,e.chainNamespace),pn.updateEnsCache({address:s,ens:[{name:t,registered_at:new Date().toISOString(),updated_at:void 0,addresses:{},attributes:[]}],timestamp:Date.now()}),pe.replace("RegisterAccountNameSuccess")}catch(n){let i=fn.parseEnsApiError(n,`Error registering name ${t}`);throw pe.replace("RegisterAccountName"),new Error(i)}finally{$t.loading=!1}})},validateName(t){return/^[a-zA-Z0-9-]{4,}$/u.test(t)},parseEnsApiError(t,e){return t?.reasons?.[0]?.description||e}},fn=Ht(vI);function Jo(t){try{return new URL(t)}catch{return null}}function EI(t){let e=t.split("/"),s=e.length>0&&e[0]!==void 0?e[0]:"",r=s.lastIndexOf(":");return r===-1?{host:s}:{host:s.slice(0,r),port:s.slice(r+1)}}function xI(t){let e=t.indexOf("://");if(e===-1)return null;let s=t.slice(0,e),r=e+3,n=t.indexOf("/",r);n===-1&&(n=t.length);let i=t.slice(r,n),o=i.lastIndexOf(":");return o===-1?{scheme:s,host:i}:{scheme:s,host:i.slice(0,o),port:i.slice(o+1)}}function Km(t,e){if(e.includes("://")){let o=Jo(e);return o?o.origin===t:!1}let{host:s,port:r}=EI(e),n=t.indexOf("://");if(n!==-1){let o=n+3,a=t.indexOf("/",o);a===-1&&(a=t.length);let c=t.slice(o,a);if(r!==void 0)return`${s}:${r}`===c;let l=c.split(":")[0];return s===l}let i=Jo(t);return i?r!==void 0?s===i.hostname&&r===(i.port||void 0):s===i.hostname:!1}function Wm(t,e,s){let r=s,n,i=r.indexOf("://");i!==-1&&(n=r.slice(0,i),r=r.slice(i+3));let o=r.indexOf("/");o!==-1&&(r=r.slice(0,o));let a=r,c,l=a.lastIndexOf(":");l!==-1&&(c=a.slice(l+1),a=a.slice(0,l));let u=a.split(".");for(let g of u)if(g.includes("*")&&g!=="*")return!1;let h=t.protocol.replace(/:$/u,"");if(n&&n!==h||c!==void 0&&c!=="*"&&c!==t.port)return!1;let d=xI(e),m=(d?d.host:t.hostname).split(".");if(u.length!==m.length)return!1;for(let g=u.length-1;g>=0;g-=1){let w=u[g],N=m[g];if(w!=="*"&&w!==N)return!1}return!0}var SI={ton:["ton_sendMessage","ton_signData"],solana:["solana_signMessage","solana_signTransaction","solana_requestAccounts","solana_getAccounts","solana_signAllTransactions","solana_signAndSendTransaction"],eip155:["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_showCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"],bip122:["sendTransfer","signMessage","signPsbt","getAccountAddresses"]},Nr={RPC_ERROR_CODE:{USER_REJECTED:5e3,USER_REJECTED_METHODS:5002},getMethodsByChainNamespace(t){return SI[t]||[]},createDefaultNamespace(t){return{methods:this.getMethodsByChainNamespace(t),events:["accountsChanged","chainChanged"],chains:[],rpcMap:{}}},applyNamespaceOverrides(t,e){if(!e)return H({},t);let s=H({},t),r=new Set;if(e.methods&&Object.keys(e.methods).forEach(n=>r.add(n)),e.chains&&Object.keys(e.chains).forEach(n=>r.add(n)),e.events&&Object.keys(e.events).forEach(n=>r.add(n)),e.rpcMap&&Object.keys(e.rpcMap).forEach(n=>{let[i]=n.split(":");i&&r.add(i)}),r.forEach(n=>{s[n]||(s[n]=this.createDefaultNamespace(n))}),e.methods&&Object.entries(e.methods).forEach(([n,i])=>{s[n]&&(s[n].methods=i)}),e.chains&&Object.entries(e.chains).forEach(([n,i])=>{s[n]&&(s[n].chains=i)}),e.events&&Object.entries(e.events).forEach(([n,i])=>{s[n]&&(s[n].events=i)}),e.rpcMap){let n=new Set;Object.entries(e.rpcMap).forEach(([i,o])=>{let[a,c]=i.split(":");!a||!c||!s[a]||(s[a].rpcMap||(s[a].rpcMap={}),n.has(a)||(s[a].rpcMap={},n.add(a)),s[a].rpcMap[c]=o)})}return s},createNamespaces(t,e){let s=t.reduce((r,n)=>{let{id:i,chainNamespace:o,rpcUrls:a}=n,c=a.default.http[0];r[o]||(r[o]=this.createDefaultNamespace(o));let l=`${o}:${i}`,u=r[o];switch(u.chains.push(l),l){case"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp":u.chains.push("solana:4sGjMW1sUnHzSxGspuhpqLDx6wiyjNtZ");break;case"solana:EtWTRABZaYq6iMfeYKouRu166VU2xqa1":u.chains.push("solana:8E9rvCKLFQia2Y35HXjjpWzj8weVo44K");break;default:}return u?.rpcMap&&c&&(u.rpcMap[i]=c),r},{});return this.applyNamespaceOverrides(s,e)},resolveReownName:t=>f(void 0,null,function*(){let e=yield fn.resolveName(t);return(e?.addresses?Object.values(e.addresses):[])[0]?.address||!1}),getChainsFromNamespaces(t={}){return Object.values(t).flatMap(e=>{let s=e.chains||[],r=e.accounts.map(n=>{let[i,o]=n.split(":");return`${i}:${o}`});return Array.from(new Set([...s,...r]))})},isSessionEventData(t){return typeof t=="object"&&t!==null&&"id"in t&&"topic"in t&&"params"in t&&typeof t.params=="object"&&t.params!==null&&"chainId"in t.params&&"event"in t.params&&typeof t.params.event=="object"&&t.params.event!==null},isUserRejectedRequestError(t){try{if(typeof t=="object"&&t!==null){let e=t,s=typeof e.code=="number",r=s&&e.code===Nr.RPC_ERROR_CODE.USER_REJECTED_METHODS,n=s&&e.code===Nr.RPC_ERROR_CODE.USER_REJECTED;return r||n}return!1}catch{return!1}},isOriginAllowed(t,e,s){let r=[...e,...s];if(e.length===0)return!0;let n=Jo(t);if(!n)return r.some(i=>!i.includes("*")&&i===t);if(n.hostname==="localhost"||n.hostname==="127.0.0.1")return!0;for(let i of r)if(i.includes("*")){if(Wm(n,t,i))return!0}else if(Km(t,i))return!0;return!1},listenWcProvider({universalProvider:t,namespace:e,onConnect:s,onDisconnect:r,onAccountsChanged:n,onChainChanged:i,onDisplayUri:o}){s&&t.on("connect",()=>{let a=Nr.getWalletConnectAccounts(t,e);s(a)}),r&&t.on("disconnect",()=>{r()}),n&&t.on("accountsChanged",a=>{try{let c=t.session?.namespaces?.[e]?.accounts||[],l=t.rpcProviders?.[e]?.getDefaultChain(),u=a.map(h=>{let d=c.find(g=>g.includes(`${e}:${l}:${h}`));if(!d)return;let{chainId:p,chainNamespace:m}=or.parseCaipAddress(d);return{address:h,chainId:p,chainNamespace:m}}).filter(h=>h!==void 0);u.length>0&&n(u)}catch(c){console.warn("Failed to parse accounts for namespace on accountsChanged event",e,a,c)}}),i&&t.on("chainChanged",a=>{i(a)}),o&&t.on("display_uri",a=>{o(a)})},getWalletConnectAccounts(t,e){let s=new Set,r=t?.session?.namespaces?.[e]?.accounts?.map(n=>or.parseCaipAddress(n)).filter(({address:n})=>s.has(n.toLowerCase())?!1:(s.add(n.toLowerCase()),!0));return r&&r.length>0?r:[]}};var II=[ve.CONNECTOR_ID.AUTH,ve.CONNECTOR_ID.WALLET_CONNECT],Nu=class{constructor(e){this.availableConnectors=[],this.availableConnections=[],this.providerHandlers={},this.eventListeners=new Map,this.getCaipNetworks=s=>Y.getCaipNetworks(s),this.getConnectorId=s=>as.getConnectorId(s),e&&this.construct(e)}construct(e){this.projectId=e.projectId,this.namespace=e.namespace,this.adapterType=e.adapterType}get connectors(){return this.availableConnectors}get connections(){return this.availableConnections}get networks(){return this.getCaipNetworks(this.namespace)}onAuthConnected({accounts:e,chainId:s}){let r=this.getCaipNetworks().filter(n=>n.chainNamespace===this.namespace).find(n=>n.id.toString()===s?.toString());e&&r&&this.addConnection({connectorId:ve.CONNECTOR_ID.AUTH,accounts:e,caipNetwork:r})}setAuthProvider(e){e.onConnect(this.onAuthConnected.bind(this)),e.onSocialConnected(this.onAuthConnected.bind(this)),this.addConnector({id:ve.CONNECTOR_ID.AUTH,type:"AUTH",name:ve.CONNECTOR_NAMES.AUTH,provider:e,imageId:void 0,chain:this.namespace,chains:[]})}addConnector(...e){let s=new Set;this.availableConnectors=[...e,...this.availableConnectors].filter(r=>s.has(r.id)?!1:(s.add(r.id),!0)),this.emit("connectors",this.availableConnectors)}addConnection(...e){let s=new Set;this.availableConnections=[...e,...this.availableConnections].filter(r=>s.has(r.connectorId.toLowerCase())?!1:(s.add(r.connectorId.toLowerCase()),!0)),this.emit("connections",this.availableConnections)}deleteConnection(e){this.availableConnections=this.availableConnections.filter(s=>s.connectorId.toLowerCase()!==e.toLowerCase()),this.emit("connections",this.availableConnections)}clearConnections(e=!1){this.availableConnections=[],e&&this.emit("connections",this.availableConnections)}setStatus(e,s){Y.setAccountProp("status",e,s)}on(e,s){this.eventListeners.has(e)||this.eventListeners.set(e,new Set),this.eventListeners.get(e)?.add(s)}off(e,s){let r=this.eventListeners.get(e);r&&r.delete(s)}removeAllEventListeners(){this.eventListeners.forEach(e=>{e.clear()})}emit(e,s){let r=this.eventListeners.get(e);r&&r.forEach(n=>n(s))}connectWalletConnect(e){return f(this,null,function*(){try{return{clientId:(yield this.getWalletConnectConnector().connectWalletConnect()).clientId}}catch(s){throw Nr.isUserRejectedRequestError(s)?new Xu(s):s}})}switchNetwork(e){return f(this,null,function*(){let{caipNetwork:s}=e,r=pi.getProviderId(s.chainNamespace),n=pi.getProvider(s.chainNamespace);if(!n)throw new Error("Provider not found");if(r==="WALLET_CONNECT"){n.setDefaultChain(s.caipNetworkId);return}if(r==="AUTH"){let i=as.getAuthConnector()?.provider;if(!i)throw new Error("Auth provider not found");let o=Us(s.chainNamespace);yield i.switchNetwork({chainId:s.caipNetworkId});let a=yield i.getUser({chainId:s.caipNetworkId,preferredAccountType:o});this.emit("switchNetwork",a)}})}getWalletConnectConnector(){let e=this.connectors.find(s=>s.id==="walletConnect");if(!e)throw new Error("WalletConnectConnector not found");return e}onConnect(e,s){if(e.length>0){let{address:r,chainId:n}=Ce.getAccount(e[0]),i=this.getCaipNetworks().filter(a=>a.chainNamespace===this.namespace).find(a=>a.id.toString()===n?.toString()),o=this.connectors.find(a=>a.id===s);r&&(this.emit("accountChanged",{address:r,chainId:n,connector:o}),this.addConnection({connectorId:s,accounts:e.map(a=>{let{address:c}=Ce.getAccount(a);return{address:c}}),caipNetwork:i}))}}onAccountsChanged(e,s,r=!0){if(e.length>0){let{address:n}=Ce.getAccount(e[0]),i=this.getConnection({connectorId:s,connections:this.connections,connectors:this.connectors});n&&this.getConnectorId(ve.CHAIN.EVM)?.toLowerCase()===s.toLowerCase()&&this.emit("accountChanged",{address:n,chainId:i?.caipNetwork?.id,connector:i?.connector}),this.addConnection({connectorId:s,accounts:e.map(o=>{let{address:a}=Ce.getAccount(o);return{address:a}}),caipNetwork:i?.caipNetwork})}else r&&this.onDisconnect(s)}onDisconnect(e){this.removeProviderListeners(e),this.deleteConnection(e),this.getConnectorId(ve.CHAIN.EVM)?.toLowerCase()===e.toLowerCase()&&this.emitFirstAvailableConnection(),this.connections.length===0&&this.emit("disconnect")}onChainChanged(e,s){let r=typeof e=="string"&&e.startsWith("0x")?parseInt(e,16).toString():e.toString(),n=this.getConnection({connectorId:s,connections:this.connections,connectors:this.connectors}),i=this.getCaipNetworks().filter(o=>o.chainNamespace===this.namespace).find(o=>o.id.toString()===r);n&&this.addConnection({connectorId:s,accounts:n.accounts,caipNetwork:i}),this.getConnectorId(ve.CHAIN.EVM)?.toLowerCase()===s.toLowerCase()&&this.emit("switchNetwork",{chainId:r})}listenProviderEvents(e,s){if(II.includes(e))return;let r=o=>this.onAccountsChanged(o,e),n=o=>this.onChainChanged(o,e),i=()=>this.onDisconnect(e);this.providerHandlers[e]||(s.on("disconnect",i),s.on("accountsChanged",r),s.on("chainChanged",n),this.providerHandlers[e]={provider:s,disconnect:i,accountsChanged:r,chainChanged:n})}removeProviderListeners(e){if(this.providerHandlers[e]){let{provider:s,disconnect:r,accountsChanged:n,chainChanged:i}=this.providerHandlers[e];s.removeListener("disconnect",r),s.removeListener("accountsChanged",n),s.removeListener("chainChanged",i),this.providerHandlers[e]=null}}emitFirstAvailableConnection(){let e=this.getConnection({connections:this.connections,connectors:this.connectors});if(e){let[s]=e.accounts;this.emit("accountChanged",{address:s?.address,chainId:e.caipNetwork?.id,connector:e.connector})}}getConnection({address:e,connectorId:s,connections:r,connectors:n}){if(s){let o=r.find(l=>l.connectorId.toLowerCase()===s.toLowerCase());if(!o)return null;let a=n.find(l=>l.id.toLowerCase()===o.connectorId.toLowerCase()),c=e?o.accounts.find(l=>l.address.toLowerCase()===e.toLowerCase()):o.accounts[0];return be(H({},o),{account:c,connector:a})}let i=r.find(o=>o.accounts.length>0&&n.some(a=>a.id.toLowerCase()===o.connectorId.toLowerCase()));if(i){let[o]=i.accounts,a=n.find(c=>c.id.toLowerCase()===i.connectorId.toLowerCase());return be(H({},i),{account:o,connector:a})}return null}};var kr=null,jt={getSIWX(){return Te.state.siwx},initializeIfEnabled(){return f(this,arguments,function*(t=Y.getActiveCaipAddress()){let e=Te.state.siwx;if(!(e&&t))return;let[s,r,n]=t.split(":");if(Y.checkIfSupportedNetwork(s,`${s}:${r}`))try{if(Te.state.remoteFeatures?.emailCapture){let o=Y.getAccountData(s)?.user;yield vt.open({view:"DataCapture",data:{email:o?.email??void 0}});return}if(kr&&(yield kr),(yield e.getSessions(`${s}:${r}`,n)).length)return;yield vt.open({view:"SIWXSignMessage"})}catch(i){console.error("SIWXUtil:initializeIfEnabled",i),nt.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties(i)}),yield ht._getClient()?.disconnect().catch(console.error),pe.reset("Connect"),Se.showError("A problem occurred while trying initialize authentication")}})},isAuthenticated(){return f(this,arguments,function*(t=Y.getActiveCaipAddress()){if(!Te.state.siwx||!t)return!0;let{chainNamespace:s,chainId:r,address:n}=or.parseCaipAddress(t),i=`${s}:${r}`;return(yield jt.getSessions({address:n,caipNetworkId:i})).length>0})},requestSignMessage(){return f(this,null,function*(){let t=Te.state.siwx,e=Ce.getPlainAddress(Y.getActiveCaipAddress()),s=mn();if(!t)throw new Error("SIWX is not enabled");if(!e)throw new Error("No ActiveCaipAddress found");if(!s)throw new Error("No ActiveCaipNetwork or client found");try{let r=yield t.createMessage({chainId:s.caipNetworkId,accountAddress:e}),n=r.toString(),i="";t.signMessage?i=yield t.signMessage({message:n,chainId:s.caipNetworkId,accountAddress:e}):(as.getConnectorId(s.chainNamespace)===ve.CONNECTOR_ID.AUTH&&pe.pushTransactionStack({}),i=(yield ht.signMessage(n))||""),yield t.addSession({data:r,message:n,signature:i}),Y.setLastConnectedSIWECaipNetwork(s),vt.close(),nt.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:this.getSIWXEventProperties()})}catch(r){(!vt.state.open||pe.state.view==="ApproveTransaction")&&(yield vt.open({view:"SIWXSignMessage"})),Se.showError("Error signing message"),nt.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:this.getSIWXEventProperties(r)}),console.error("SWIXUtil:requestSignMessage",r)}})},cancelSignMessage(){return f(this,null,function*(){try{let t=this.getSIWX();if(t?.getRequired?.()){let s=Y.getLastConnectedSIWECaipNetwork();if(s){let r=yield t?.getSessions(s?.caipNetworkId,Ce.getPlainAddress(Y.getActiveCaipAddress())||"");r&&r.length>0?yield Y.switchActiveNetwork(s):yield ht.disconnect()}else yield ht.disconnect()}else vt.close();vt.close(),nt.sendEvent({event:"CLICK_CANCEL_SIWX",type:"track",properties:this.getSIWXEventProperties()})}catch(t){console.error("SIWXUtil:cancelSignMessage",t)}})},getAllSessions(){return f(this,null,function*(){let t=this.getSIWX(),e=Y.getAllRequestedCaipNetworks(),s=[];return yield Promise.all(e.map(r=>f(this,null,function*(){let n=yield t?.getSessions(r.caipNetworkId,Ce.getPlainAddress(Y.getActiveCaipAddress())||"");n&&s.push(...n)}))),s})},getSessions(t){return f(this,null,function*(){let e=Te.state.siwx,s=t?.address;if(!s){let n=Y.getActiveCaipAddress();s=Ce.getPlainAddress(n)}let r=t?.caipNetworkId;return r||(r=Y.getActiveCaipNetwork()?.caipNetworkId),e&&s&&r?e.getSessions(r,s):[]})},isSIWXCloseDisabled(){return f(this,null,function*(){let t=this.getSIWX();if(t){let e=pe.state.view==="ApproveTransaction",s=pe.state.view==="SIWXSignMessage";if(e||s)return t.getRequired?.()&&(yield this.getSessions()).length===0}return!1})},authConnectorAuthenticate(i){return f(this,arguments,function*({authConnector:t,chainId:e,socialUri:s,preferredAccountType:r,chainNamespace:n}){let o=jt.getSIWX(),a=mn();if(!o||!n.includes(ve.CHAIN.EVM)||Te.state.remoteFeatures?.emailCapture){let d=yield t.connect({chainId:e,socialUri:s,preferredAccountType:r});return{address:d.address,chainId:d.chainId,accounts:d.accounts}}let c=`${n}:${e}`,l=yield o.createMessage({chainId:c,accountAddress:"<<AccountAddress>>"}),u={accountAddress:l.accountAddress,chainId:l.chainId,domain:l.domain,uri:l.uri,version:l.version,nonce:l.nonce,notBefore:l.notBefore,statement:l.statement,resources:l.resources,requestId:l.requestId,issuedAt:l.issuedAt,expirationTime:l.expirationTime,serializedMessage:l.toString()},h=yield t.connect({chainId:e,socialUri:s,siwxMessage:u,preferredAccountType:r});return u.accountAddress=h.address,u.serializedMessage=h.message||"",h.signature&&h.message&&(yield jt.addEmbeddedWalletSession(u,h.message,h.signature)),Y.setLastConnectedSIWECaipNetwork(a),{address:h.address,chainId:h.chainId,accounts:h.accounts}})},addEmbeddedWalletSession(t,e,s){return f(this,null,function*(){if(kr)return kr;let r=jt.getSIWX();return r?(kr=r.addSession({data:t,message:e,signature:s}).finally(()=>{kr=null}),kr):Promise.resolve()})},universalProviderAuthenticate(r){return f(this,arguments,function*({universalProvider:t,chains:e,methods:s}){let n=jt.getSIWX(),i=mn(),o=new Set(e.map(u=>u.split(":")[0]));if(!n||o.size!==1||!o.has("eip155"))return!1;let a=yield n.createMessage({chainId:mn()?.caipNetworkId||"",accountAddress:""}),c=yield t.authenticate({nonce:a.nonce,domain:a.domain,uri:a.uri,exp:a.expirationTime,iat:a.issuedAt,nbf:a.notBefore,requestId:a.requestId,version:a.version,resources:a.resources,statement:a.statement,chainId:a.chainId,methods:s,chains:[a.chainId,...e.filter(u=>u!==a.chainId)]});Se.showLoading("Authenticating...",{autoClose:!1});let l=be(H({},c.session.peer.metadata),{name:c.session.peer.metadata.name,icon:c.session.peer.metadata.icons?.[0],type:"WALLET_CONNECT"});if(Y.setAccountProp("connectedWalletInfo",l,Array.from(o)[0]),c?.auths?.length){let u=c.auths.map(h=>{let d=t.client.formatAuthMessage({request:h.p,iss:h.p.iss});return{data:be(H({},h.p),{accountAddress:h.p.iss.split(":").slice(-1).join(""),chainId:h.p.iss.split(":").slice(2,4).join(":"),uri:h.p.aud??"",version:h.p.version||a.version,expirationTime:h.p.exp,issuedAt:h.p.iat,notBefore:h.p.nbf}),message:d,signature:h.s.s,cacao:h}});try{yield n.setSessions(u),i&&Y.setLastConnectedSIWECaipNetwork(i),nt.sendEvent({type:"track",event:"SIWX_AUTH_SUCCESS",properties:jt.getSIWXEventProperties()})}catch(h){throw console.error("SIWX:universalProviderAuth - failed to set sessions",h),nt.sendEvent({type:"track",event:"SIWX_AUTH_ERROR",properties:jt.getSIWXEventProperties(h)}),yield t.disconnect().catch(console.error),h}finally{Se.hide()}}return!0})},getSIWXEventProperties(t){let e=Y.state.activeChain;if(!e)throw new Error("SIWXUtil:getSIWXEventProperties - namespace is required");return{network:Y.state.activeCaipNetwork?.caipNetworkId||"",isSmartAccount:Us(e)===Ur.ACCOUNT_TYPES.SMART_ACCOUNT,message:t?Ce.parseError(t):void 0}},clearSessions(){return f(this,null,function*(){let t=this.getSIWX();t&&(yield t.setSessions([]))})}};var ku=class{constructor({provider:e,namespace:s}){this.id=ve.CONNECTOR_ID.WALLET_CONNECT,this.name="WalletConnect",this.type="WALLET_CONNECT",this.imageId="ef1a1fcf-7fe8-4d69-bd6d-fda1345b4400",this.getCaipNetworks=Y.getCaipNetworks.bind(Y),this.caipNetworks=this.getCaipNetworks(),this.provider=e,this.chain=s}get chains(){return this.getCaipNetworks()}connectWalletConnect(){return f(this,null,function*(){if(!(yield this.authenticate())){let s=this.getCaipNetworks(),r=Te.state.universalProviderConfigOverride,n=Nr.createNamespaces(s,r);yield this.provider.connect({optionalNamespaces:n})}return{clientId:yield this.provider.client.core.crypto.getClientId(),session:this.provider.session}})}disconnect(){return f(this,null,function*(){yield this.provider.disconnect()})}authenticate(){return f(this,null,function*(){let e=this.chains.map(s=>s.caipNetworkId);return jt.universalProviderAuthenticate({universalProvider:this.provider,chains:e,methods:AI})})}},AI=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_getCallsStatus","wallet_sendCalls","wallet_getCapabilities","wallet_grantPermissions","wallet_revokePermissions","wallet_getAssets"];var Ns={getGasPriceInEther(t,e){let s=e*t;return Number(s)/1e18},getGasPriceInUSD(t,e,s){let r=Ns.getGasPriceInEther(e,s);return Ee.bigNumber(t).times(r).toNumber()},getPriceImpact({sourceTokenAmount:t,sourceTokenPriceInUSD:e,toTokenPriceInUSD:s,toTokenAmount:r}){let n=Ee.bigNumber(t).times(e),i=Ee.bigNumber(r).times(s);return n.minus(i).div(n).times(100).toNumber()},getMaxSlippage(t,e){let s=Ee.bigNumber(t).div(100);return Ee.multiply(e,s).toNumber()},getProviderFee(t,e=.0085){return Ee.bigNumber(t).times(e).toString()},isInsufficientNetworkTokenForGas(t,e){let s=e||"0";return Ee.bigNumber(t).eq(0)?!0:Ee.bigNumber(Ee.bigNumber(s)).gt(t)},isInsufficientSourceTokenForSwap(t,e,s){let r=s?.find(i=>i.address===e)?.quantity?.numeric;return Ee.bigNumber(r||"0").lt(t)}};var is=ct({message:"",variant:"info",open:!1}),_I={state:is,subscribeKey(t,e){return lt(is,t,e)},open(t,e){let{debug:s}=Te.state,{code:r,displayMessage:n,debugMessage:i}=t;n&&s&&(is.message=n,is.variant=e,is.open=!0),i&&console.error(typeof i=="function"?i():i,r?{code:r}:void 0)},warn(t,e,s){is.open=!0,is.message=t,is.variant="warning",e&&console.warn(e,s)},close(){is.open=!1,is.message="",is.variant="info"}},Uu=Ht(_I);var Gm=15e4,TI=6;var et={initializing:!1,initialized:!1,loadingPrices:!1,loadingQuote:!1,loadingApprovalTransaction:!1,loadingBuildTransaction:!1,loadingTransaction:!1,switchingTokens:!1,fetchError:!1,approvalTransaction:void 0,swapTransaction:void 0,transactionError:void 0,sourceToken:void 0,sourceTokenAmount:"",sourceTokenPriceInUSD:0,toToken:void 0,toTokenAmount:"",toTokenPriceInUSD:0,networkPrice:"0",networkBalanceInUSD:"0",networkTokenSymbol:"",inputError:void 0,slippage:ar.CONVERT_SLIPPAGE_TOLERANCE,tokens:void 0,popularTokens:void 0,suggestedTokens:void 0,foundTokens:void 0,myTokensWithBalance:void 0,tokensPriceMap:{},gasFee:"0",gasPriceInUSD:0,priceImpact:void 0,maxSlippage:void 0,providerFee:void 0},E=ct(H({},et)),Qo={state:E,subscribe(t){return kt(E,()=>t(E))},subscribeKey(t,e){return lt(E,t,e)},getParams(){let t=Y.state.activeChain,e=Y.getAccountData(t)?.caipAddress??Y.state.activeCaipAddress,s=Ce.getPlainAddress(e),r=gn(),n=as.getConnectorId(Y.state.activeChain);if(!s)throw new Error("No address found to swap the tokens from.");let i=!E.toToken?.address||!E.toToken?.decimals,o=!E.sourceToken?.address||!E.sourceToken?.decimals||!Ee.bigNumber(E.sourceTokenAmount).gt(0),a=!E.sourceTokenAmount;return{networkAddress:r,fromAddress:s,fromCaipAddress:e,sourceTokenAddress:E.sourceToken?.address,toTokenAddress:E.toToken?.address,toTokenAmount:E.toTokenAmount,toTokenDecimals:E.toToken?.decimals,sourceTokenAmount:E.sourceTokenAmount,sourceTokenDecimals:E.sourceToken?.decimals,invalidToToken:i,invalidSourceToken:o,invalidSourceTokenAmount:a,availableToSwap:e&&!i&&!o&&!a,isAuthConnector:n===ve.CONNECTOR_ID.AUTH}},setSourceToken(t){return f(this,null,function*(){if(!t){E.sourceToken=t,E.sourceTokenAmount="",E.sourceTokenPriceInUSD=0;return}E.sourceToken=t,yield X.setTokenPrice(t.address,"sourceToken")})},setSourceTokenAmount(t){E.sourceTokenAmount=t},setToToken(t){return f(this,null,function*(){if(!t){E.toToken=t,E.toTokenAmount="",E.toTokenPriceInUSD=0;return}E.toToken=t,yield X.setTokenPrice(t.address,"toToken")})},setToTokenAmount(t){E.toTokenAmount=t?Ee.toFixed(t,TI):""},setTokenPrice(t,e){return f(this,null,function*(){let s=E.tokensPriceMap[t]||0;s||(E.loadingPrices=!0,s=yield X.getAddressPrice(t)),e==="sourceToken"?E.sourceTokenPriceInUSD=s:e==="toToken"&&(E.toTokenPriceInUSD=s),E.loadingPrices&&(E.loadingPrices=!1),X.getParams().availableToSwap&&!E.switchingTokens&&X.swapTokens()})},switchTokens(){return f(this,null,function*(){if(!(E.initializing||!E.initialized||E.switchingTokens)){E.switchingTokens=!0;try{let t=E.toToken?H({},E.toToken):void 0,e=E.sourceToken?H({},E.sourceToken):void 0,s=t&&E.toTokenAmount===""?"1":E.toTokenAmount;X.setSourceTokenAmount(s),X.setToTokenAmount(""),yield X.setSourceToken(t),yield X.setToToken(e),E.switchingTokens=!1,X.swapTokens()}catch(t){throw E.switchingTokens=!1,t}}})},resetState(){E.myTokensWithBalance=et.myTokensWithBalance,E.tokensPriceMap=et.tokensPriceMap,E.initialized=et.initialized,E.initializing=et.initializing,E.switchingTokens=et.switchingTokens,E.sourceToken=et.sourceToken,E.sourceTokenAmount=et.sourceTokenAmount,E.sourceTokenPriceInUSD=et.sourceTokenPriceInUSD,E.toToken=et.toToken,E.toTokenAmount=et.toTokenAmount,E.toTokenPriceInUSD=et.toTokenPriceInUSD,E.networkPrice=et.networkPrice,E.networkTokenSymbol=et.networkTokenSymbol,E.networkBalanceInUSD=et.networkBalanceInUSD,E.inputError=et.inputError},resetValues(){let{networkAddress:t}=X.getParams(),e=E.tokens?.find(s=>s.address===t);X.setSourceToken(e),X.setToToken(void 0)},getApprovalLoadingState(){return E.loadingApprovalTransaction},clearError(){E.transactionError=void 0},initializeState(){return f(this,null,function*(){if(!E.initializing){if(E.initializing=!0,!E.initialized)try{yield X.fetchTokens(),E.initialized=!0}catch{E.initialized=!1,Se.showError("Failed to initialize swap"),pe.goBack()}E.initializing=!1}})},fetchTokens(){return f(this,null,function*(){let{networkAddress:t}=X.getParams();yield X.getNetworkTokenPrice(),yield X.getMyTokensWithBalance();let e=E.myTokensWithBalance?.find(s=>s.address===t);e&&(E.networkTokenSymbol=e.symbol,X.setSourceToken(e),X.setSourceTokenAmount("0"))})},getTokenList(){return f(this,null,function*(){let t=Y.state.activeCaipNetwork?.caipNetworkId;if(!(E.caipNetworkId===t&&E.tokens))try{E.tokensLoading=!0;let e=yield Br.getTokenList(t);E.tokens=e,E.caipNetworkId=t,E.popularTokens=e.sort((o,a)=>o.symbol<a.symbol?-1:o.symbol>a.symbol?1:0);let r=(t&&ar.SUGGESTED_TOKENS_BY_CHAIN?.[t]||[]).map(o=>e.find(a=>a.symbol===o)).filter(o=>!!o),i=(ar.SWAP_SUGGESTED_TOKENS||[]).map(o=>e.find(a=>a.symbol===o)).filter(o=>!!o).filter(o=>!r.some(a=>a.address===o.address));E.suggestedTokens=[...r,...i]}catch{E.tokens=[],E.popularTokens=[],E.suggestedTokens=[]}finally{E.tokensLoading=!1}})},getAddressPrice(t){return f(this,null,function*(){let e=E.tokensPriceMap[t];if(e)return e;let r=(yield Re.fetchTokenPrice({addresses:[t]}))?.fungibles||[],i=[...E.tokens||[],...E.myTokensWithBalance||[]]?.find(c=>c.address===t)?.symbol,o=r.find(c=>c.symbol.toLowerCase()===i?.toLowerCase())?.price||0,a=parseFloat(o.toString());return E.tokensPriceMap[t]=a,a})},getNetworkTokenPrice(){return f(this,null,function*(){let{networkAddress:t}=X.getParams(),s=(yield Re.fetchTokenPrice({addresses:[t]}).catch(()=>(Se.showError("Failed to fetch network token price"),{fungibles:[]}))).fungibles?.[0],r=s?.price.toString()||"0";E.tokensPriceMap[t]=parseFloat(r),E.networkTokenSymbol=s?.symbol||"",E.networkPrice=r})},getMyTokensWithBalance(t){return f(this,null,function*(){let e=yield eh.getMyTokensWithBalance(t),s=Br.mapBalancesToSwapTokens(e);s&&(yield X.getInitialGasPrice(),X.setBalances(s))})},setBalances(t){let{networkAddress:e}=X.getParams(),s=Y.state.activeCaipNetwork;if(!s)return;let r=t.find(n=>n.address===e);t.forEach(n=>{E.tokensPriceMap[n.address]=n.price||0}),E.myTokensWithBalance=t.filter(n=>n.address.startsWith(s.caipNetworkId)),E.networkBalanceInUSD=r?Ee.multiply(r.quantity.numeric,r.price).toString():"0"},getInitialGasPrice(){return f(this,null,function*(){let t=yield Br.fetchGasPrice();if(!t)return{gasPrice:null,gasPriceInUSD:null};switch(Y.state?.activeCaipNetwork?.chainNamespace){case ve.CHAIN.SOLANA:return E.gasFee=t.standard??"0",E.gasPriceInUSD=Ee.multiply(t.standard,E.networkPrice).div(1e9).toNumber(),{gasPrice:BigInt(E.gasFee),gasPriceInUSD:Number(E.gasPriceInUSD)};case ve.CHAIN.EVM:default:let e=t.standard??"0",s=BigInt(e),r=BigInt(Gm),n=Ns.getGasPriceInUSD(E.networkPrice,r,s);return E.gasFee=e,E.gasPriceInUSD=n,{gasPrice:s,gasPriceInUSD:n}}})},swapTokens(){return f(this,null,function*(){let t=Y.getAccountData()?.address,e=E.sourceToken,s=E.toToken,r=Ee.bigNumber(E.sourceTokenAmount).gt(0);if(r||X.setToTokenAmount(""),!s||!e||E.loadingPrices||!r||!t)return;E.loadingQuote=!0;let n=Ee.bigNumber(E.sourceTokenAmount).times(10**e.decimals).round(0);try{let i=yield Re.fetchSwapQuote({userAddress:t,from:e.address,to:s.address,gasPrice:E.gasFee,amount:n.toString()});E.loadingQuote=!1;let o=i?.quotes?.[0]?.toAmount;if(!o){Uu.open({displayMessage:"Incorrect amount",debugMessage:"Please enter a valid amount"},"error");return}let a=Ee.bigNumber(o).div(10**s.decimals).toString();X.setToTokenAmount(a),X.hasInsufficientToken(E.sourceTokenAmount,e.address)?E.inputError="Insufficient balance":(E.inputError=void 0,X.setTransactionDetails())}catch(i){let o=yield Br.handleSwapError(i);E.loadingQuote=!1,E.inputError=o||"Insufficient balance"}})},getTransaction(){return f(this,null,function*(){let{fromCaipAddress:t,availableToSwap:e}=X.getParams(),s=E.sourceToken,r=E.toToken;if(!(!t||!e||!s||!r||E.loadingQuote))try{E.loadingBuildTransaction=!0;let n=yield Br.fetchSwapAllowance({userAddress:t,tokenAddress:s.address,sourceTokenAmount:E.sourceTokenAmount,sourceTokenDecimals:s.decimals}),i;return n?i=yield X.createSwapTransaction():i=yield X.createAllowanceTransaction(),E.loadingBuildTransaction=!1,E.fetchError=!1,i}catch{pe.goBack(),Se.showError("Failed to check allowance"),E.loadingBuildTransaction=!1,E.approvalTransaction=void 0,E.swapTransaction=void 0,E.fetchError=!0;return}})},createAllowanceTransaction(){return f(this,null,function*(){let{fromCaipAddress:t,sourceTokenAddress:e,toTokenAddress:s}=X.getParams();if(!(!t||!s)){if(!e)throw new Error("createAllowanceTransaction - No source token address found.");try{let r=yield Re.generateApproveCalldata({from:e,to:s,userAddress:t}),n=Ce.getPlainAddress(r.tx.from);if(!n)throw new Error("SwapController:createAllowanceTransaction - address is required");let i={data:r.tx.data,to:n,gasPrice:BigInt(r.tx.eip155.gasPrice),value:BigInt(r.tx.value),toAmount:E.toTokenAmount};return E.swapTransaction=void 0,E.approvalTransaction={data:i.data,to:i.to,gasPrice:i.gasPrice,value:i.value,toAmount:i.toAmount},{data:i.data,to:i.to,gasPrice:i.gasPrice,value:i.value,toAmount:i.toAmount}}catch{pe.goBack(),Se.showError("Failed to create approval transaction"),E.approvalTransaction=void 0,E.swapTransaction=void 0,E.fetchError=!0;return}}})},createSwapTransaction(){return f(this,null,function*(){let{networkAddress:t,fromCaipAddress:e,sourceTokenAmount:s}=X.getParams(),r=E.sourceToken,n=E.toToken;if(!e||!s||!r||!n)return;let i=ht.parseUnits(s,r.decimals)?.toString();try{let o=yield Re.generateSwapCalldata({userAddress:e,from:r.address,to:n.address,amount:i,disableEstimate:!0}),a=r.address===t,c=BigInt(o.tx.eip155.gas),l=BigInt(o.tx.eip155.gasPrice),u=Ce.getPlainAddress(o.tx.to);if(!u)throw new Error("SwapController:createSwapTransaction - address is required");let h={data:o.tx.data,to:u,gas:c,gasPrice:l,value:BigInt(a?i??"0":"0"),toAmount:E.toTokenAmount};return E.gasPriceInUSD=Ns.getGasPriceInUSD(E.networkPrice,c,l),E.approvalTransaction=void 0,E.swapTransaction=h,h}catch{pe.goBack(),Se.showError("Failed to create transaction"),E.approvalTransaction=void 0,E.swapTransaction=void 0,E.fetchError=!0;return}})},onEmbeddedWalletApprovalSuccess(){Se.showLoading("Approve limit increase in your wallet"),pe.replace("SwapPreview")},sendTransactionForApproval(t){return f(this,null,function*(){let{fromAddress:e,isAuthConnector:s}=X.getParams();E.loadingApprovalTransaction=!0,s?pe.pushTransactionStack({onSuccess:X.onEmbeddedWalletApprovalSuccess}):Se.showLoading("Approve limit increase in your wallet");try{yield ht.sendTransaction({address:e,to:t.to,data:t.data,value:t.value,chainNamespace:ve.CHAIN.EVM}),yield X.swapTokens(),yield X.getTransaction(),E.approvalTransaction=void 0,E.loadingApprovalTransaction=!1}catch(n){let i=n;E.transactionError=i?.displayMessage,E.loadingApprovalTransaction=!1,Se.showError(i?.displayMessage||"Transaction error"),nt.sendEvent({type:"track",event:"SWAP_APPROVAL_ERROR",properties:{message:i?.displayMessage||i?.message||"Unknown",network:Y.state.activeCaipNetwork?.caipNetworkId||"",swapFromToken:X.state.sourceToken?.symbol||"",swapToToken:X.state.toToken?.symbol||"",swapFromAmount:X.state.sourceTokenAmount||"",swapToAmount:X.state.toTokenAmount||"",isSmartAccount:Us(ve.CHAIN.EVM)===Ur.ACCOUNT_TYPES.SMART_ACCOUNT}})}})},sendTransactionForSwap(t){return f(this,null,function*(){if(!t)return;let{fromAddress:e,toTokenAmount:s,isAuthConnector:r}=X.getParams();E.loadingTransaction=!0;let n=`Swapping ${E.sourceToken?.symbol} to ${Ee.formatNumberToLocalString(s,3)} ${E.toToken?.symbol}`,i=`Swapped ${E.sourceToken?.symbol} to ${Ee.formatNumberToLocalString(s,3)} ${E.toToken?.symbol}`;r?pe.pushTransactionStack({onSuccess(){pe.replace("Account"),Se.showLoading(n),Qo.resetState()}}):Se.showLoading("Confirm transaction in your wallet");try{let o=[E.sourceToken?.address,E.toToken?.address].join(","),a=yield ht.sendTransaction({address:e,to:t.to,data:t.data,value:t.value,chainNamespace:ve.CHAIN.EVM});return E.loadingTransaction=!1,Se.showSuccess(i),nt.sendEvent({type:"track",event:"SWAP_SUCCESS",properties:{network:Y.state.activeCaipNetwork?.caipNetworkId||"",swapFromToken:X.state.sourceToken?.symbol||"",swapToToken:X.state.toToken?.symbol||"",swapFromAmount:X.state.sourceTokenAmount||"",swapToAmount:X.state.toTokenAmount||"",isSmartAccount:Us(ve.CHAIN.EVM)===Ur.ACCOUNT_TYPES.SMART_ACCOUNT}}),Qo.resetState(),r||pe.replace("Account"),Qo.getMyTokensWithBalance(o),a}catch(o){let a=o;E.transactionError=a?.displayMessage,E.loadingTransaction=!1,Se.showError(a?.displayMessage||"Transaction error"),nt.sendEvent({type:"track",event:"SWAP_ERROR",properties:{message:a?.displayMessage||a?.message||"Unknown",network:Y.state.activeCaipNetwork?.caipNetworkId||"",swapFromToken:X.state.sourceToken?.symbol||"",swapToToken:X.state.toToken?.symbol||"",swapFromAmount:X.state.sourceTokenAmount||"",swapToAmount:X.state.toTokenAmount||"",isSmartAccount:Us(ve.CHAIN.EVM)===Ur.ACCOUNT_TYPES.SMART_ACCOUNT}});return}})},hasInsufficientToken(t,e){return Ns.isInsufficientSourceTokenForSwap(t,e,E.myTokensWithBalance)},setTransactionDetails(){let{toTokenAddress:t,toTokenDecimals:e}=X.getParams();!t||!e||(E.gasPriceInUSD=Ns.getGasPriceInUSD(E.networkPrice,BigInt(E.gasFee),BigInt(Gm)),E.priceImpact=Ns.getPriceImpact({sourceTokenAmount:E.sourceTokenAmount,sourceTokenPriceInUSD:E.sourceTokenPriceInUSD,toTokenPriceInUSD:E.toTokenPriceInUSD,toTokenAmount:E.toTokenAmount}),E.maxSlippage=Ns.getMaxSlippage(E.slippage,E.toTokenAmount),E.providerFee=Ns.getProviderFee(E.sourceTokenAmount))}},X=Ht(Qo);var os=ct({message:"",open:!1,triggerRect:{width:0,height:0,top:0,left:0},variant:"shade"}),PI={state:os,subscribe(t){return kt(os,()=>t(os))},subscribeKey(t,e){return lt(os,t,e)},showTooltip({message:t,triggerRect:e,variant:s}){os.open=!0,os.message=t,os.triggerRect=e,os.variant=s},hide(){os.open=!1,os.message="",os.triggerRect={width:0,height:0,top:0,left:0}}},CI=Ht(PI);var ui=ct({isLegalCheckboxChecked:!1}),OI={state:ui,subscribe(t){return kt(ui,()=>t(ui))},subscribeKey(t,e){return lt(ui,t,e)},setIsLegalCheckboxChecked(t){ui.isLegalCheckboxChecked=t}};var RI={eip155:{native:{assetNamespace:"slip44",assetReference:"60"},defaultTokenNamespace:"erc20"},solana:{native:{assetNamespace:"slip44",assetReference:"501"},defaultTokenNamespace:"token"}},Bu=class extends Error{};function NI(){let{sdkType:t,sdkVersion:e,projectId:s}=Te.getSnapshot(),r=new URL("https://rpc.walletconnect.org/v1/json-rpc");return r.searchParams.set("projectId",s),r.searchParams.set("st",t),r.searchParams.set("sv",e),r.searchParams.set("source","fund-wallet"),r.toString()}function Du(t,e){return f(this,null,function*(){let s=NI(),{projectId:r}=Te.getSnapshot(),n={jsonrpc:"2.0",id:1,method:t,params:be(H({},e||{}),{projectId:r})},o=yield(yield fetch(s,{method:"POST",body:JSON.stringify(n),headers:{"Content-Type":"application/json"}})).json();if(o.error)throw new Bu(o.error.message);return o})}function Lu(t){return f(this,null,function*(){return(yield Du("reown_getExchanges",t)).result})}function qu(t){return f(this,null,function*(){return(yield Du("reown_getExchangePayUrl",t)).result})}function Ym(t){return f(this,null,function*(){return(yield Du("reown_getExchangeBuyStatus",t)).result})}function ea(t,e){let{chainNamespace:s,chainId:r}=or.parseCaipNetworkId(t),n=RI[s];if(!n)throw new Error(`Unsupported chain namespace for CAIP-19 formatting: ${s}`);let i=n.native.assetNamespace,o=n.native.assetReference;return e!=="native"&&(i=n.defaultTokenNamespace,o=e),`${`${s}:${r}`}/${i}:${o}`}var kI={network:"eip155:1",asset:"native",metadata:{name:"Ethereum",symbol:"ETH",decimals:18}},UI={network:"eip155:8453",asset:"native",metadata:{name:"Ethereum",symbol:"ETH",decimals:18}},Xm={network:"eip155:8453",asset:"0x833589fcd6edb6e08f4c7c32d4f71b54bda02913",metadata:{name:"USD Coin",symbol:"USDC",decimals:6}},BI={network:"eip155:84532",asset:"0x036CbD53842c5426634e7929541eC2318f3dCF7e",metadata:{name:"USD Coin",symbol:"USDC",decimals:6}},DI={network:"eip155:84532",asset:"native",metadata:{name:"Ethereum",symbol:"ETH",decimals:18}},LI={network:"eip155:1",asset:"0xA0b86991c6218b36c1d19D4a2e9Eb0cE3606eB48",metadata:{name:"USD Coin",symbol:"USDC",decimals:6}},qI={network:"eip155:42161",asset:"0xaf88d065e77c8cC2239327C5EDb3A432268e5831",metadata:{name:"USD Coin",symbol:"USDC",decimals:6}},MI={network:"eip155:137",asset:"0x2791bca1f2de4661ed88a30c99a7a9449aa84174",metadata:{name:"USD Coin",symbol:"USDC",decimals:6}},FI={network:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",asset:"EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",metadata:{name:"USD Coin",symbol:"USDC",decimals:6}},$I={network:"eip155:1",asset:"0xdAC17F958D2ee523a2206206994597C13D831ec7",metadata:{name:"Tether USD",symbol:"USDT",decimals:6}},jI={network:"eip155:10",asset:"0x94b008aA00579c1307B0EF2c499aD98a8ce58e58",metadata:{name:"Tether USD",symbol:"USDT",decimals:6}},zI={network:"eip155:42161",asset:"0xFd086bC7CD5C481DCC9C85ebE478A1C0b69FCbb9",metadata:{name:"Tether USD",symbol:"USDT",decimals:6}},HI={network:"eip155:137",asset:"0xc2132d05d31c914a87c6611c10748aeb04b58e8f",metadata:{name:"Tether USD",symbol:"USDT",decimals:6}},VI={network:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",asset:"Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB",metadata:{name:"Tether USD",symbol:"USDT",decimals:6}},KI={network:"solana:5eykt4UsFv8P8NJdTREpY1vzqKqZKvdp",asset:"native",metadata:{name:"Solana",symbol:"SOL",decimals:9}},WI={ethereumETH:kI,baseETH:UI,baseUSDC:Xm,baseSepoliaETH:DI,ethereumUSDC:LI,arbitrumUSDC:qI,polygonUSDC:MI,solanaUSDC:FI,ethereumUSDT:$I,optimismUSDT:jI,arbitrumUSDT:zI,polygonUSDT:HI,solanaUSDT:VI,solanaSOL:KI};function Mu(t){return Object.values(WI).filter(e=>e.network===t)}var GI=0,Zm={paymentAsset:null,amount:null,tokenAmount:0,priceLoading:!1,error:null,exchanges:[],isLoading:!1,currentPayment:void 0,isPaymentInProgress:!1,paymentId:"",assets:[]},G=ct(Zm),ir={state:G,subscribe(t){return kt(G,()=>t(G))},subscribeKey(t,e){return lt(G,t,e)},resetState(){Object.assign(G,H({},Zm))},getAssetsForNetwork(t){return f(this,null,function*(){let e=Mu(t),s=yield ir.getAssetsImageAndPrice(e),r=e.map(n=>{let i=n.asset==="native"?gn():`${n.network}:${n.asset}`,o=s.find(a=>a.fungibles?.[0]?.address?.toLowerCase()===i.toLowerCase());return be(H({},n),{price:o?.fungibles?.[0]?.price||1,metadata:be(H({},n.metadata),{iconUrl:o?.fungibles?.[0]?.iconUrl})})});return G.assets=r,r})},getAssetsImageAndPrice(t){return f(this,null,function*(){let e=t.map(r=>r.asset==="native"?gn():`${r.network}:${r.asset}`);return yield Promise.all(e.map(r=>Re.fetchTokenPrice({addresses:[r]})))})},getTokenAmount(){if(!G?.paymentAsset?.price)throw new Error("Cannot get token price");let t=Ee.bigNumber(G.amount??0).round(8),e=Ee.bigNumber(G.paymentAsset.price).round(8);return t.div(e).round(8).toNumber()},setAmount(t){G.amount=t,G.paymentAsset?.price&&(G.tokenAmount=ir.getTokenAmount())},setPaymentAsset(t){G.paymentAsset=t},isPayWithExchangeEnabled(){return Te.state.remoteFeatures?.payWithExchange},isPayWithExchangeSupported(){return ir.isPayWithExchangeEnabled()&&Y.state.activeCaipNetwork&&ar.PAY_WITH_EXCHANGE_SUPPORTED_CHAIN_NAMESPACES.includes(Y.state.activeCaipNetwork.chainNamespace)},fetchExchanges(){return f(this,null,function*(){try{let t=ir.isPayWithExchangeSupported();if(!G.paymentAsset||!t){G.exchanges=[],G.isLoading=!1;return}G.isLoading=!0;let e=yield Lu({page:GI,asset:ea(G.paymentAsset.network,G.paymentAsset.asset),amount:G.amount?.toString()??"0"});G.exchanges=e.exchanges.slice(0,2)}catch{throw Se.showError("Unable to get exchanges"),new Error("Unable to get exchanges")}finally{G.isLoading=!1}})},getPayUrl(t,e){return f(this,null,function*(){try{let s=Number(e.amount),r=yield qu({exchangeId:t,asset:ea(e.network,e.asset),amount:s.toString(),recipient:`${e.network}:${e.recipient}`});return nt.sendEvent({type:"track",event:"PAY_EXCHANGE_SELECTED",properties:{exchange:{id:t},configuration:{network:e.network,asset:e.asset,recipient:e.recipient,amount:s},currentPayment:{type:"exchange",exchangeId:t},source:"fund-from-exchange",headless:!1}}),r}catch(s){throw s instanceof Error&&s.message.includes("is not supported")?new Error("Asset not supported"):new Error(s.message)}})},handlePayWithExchange(t){return f(this,null,function*(){try{let e=Y.getAccountData()?.address;if(!e)throw new Error("No account connected");if(!G.paymentAsset)throw new Error("No payment asset selected");let s=Ce.returnOpenHref("","popupWindow","scrollbar=yes,width=480,height=720");if(!s)throw new Error("Could not create popup window");G.isPaymentInProgress=!0,G.paymentId=crypto.randomUUID(),G.currentPayment={type:"exchange",exchangeId:t};let{network:r,asset:n}=G.paymentAsset,i={network:r,asset:n,amount:G.tokenAmount,recipient:e},o=yield ir.getPayUrl(t,i);if(!o){try{s.close()}catch(a){console.error("Unable to close popup window",a)}throw new Error("Unable to initiate payment")}G.currentPayment.sessionId=o.sessionId,G.currentPayment.status="IN_PROGRESS",G.currentPayment.exchangeId=t,s.location.href=o.url}catch{G.error="Unable to initiate payment",Se.showError(G.error)}})},waitUntilComplete(n){return f(this,arguments,function*({exchangeId:t,sessionId:e,paymentId:s,retries:r=20}){let i=yield ir.getBuyStatus(t,e,s);if(i.status==="SUCCESS"||i.status==="FAILED")return i;if(r===0)throw new Error("Unable to get deposit status");return yield new Promise(o=>{setTimeout(o,5e3)}),ir.waitUntilComplete({exchangeId:t,sessionId:e,paymentId:s,retries:r-1})})},getBuyStatus(t,e,s){return f(this,null,function*(){try{if(!G.currentPayment)throw new Error("No current payment");let r=yield Ym({sessionId:e,exchangeId:t});if(G.currentPayment.status=r.status,r.status==="SUCCESS"||r.status==="FAILED"){let n=Y.getAccountData()?.address;G.currentPayment.result=r.txHash,G.isPaymentInProgress=!1,nt.sendEvent({type:"track",event:r.status==="SUCCESS"?"PAY_SUCCESS":"PAY_ERROR",properties:{message:r.status==="FAILED"?Ce.parseError(G.error):void 0,source:"fund-from-exchange",paymentId:s,configuration:{network:G.paymentAsset?.network||"",asset:G.paymentAsset?.asset||"",recipient:n||"",amount:G.amount??0},currentPayment:{type:"exchange",exchangeId:G.currentPayment?.exchangeId,sessionId:G.currentPayment?.sessionId,result:r.txHash}}})}return r}catch{return{status:"UNKNOWN",txHash:""}}})},reset(){G.currentPayment=void 0,G.isPaymentInProgress=!1,G.paymentId="",G.paymentAsset=null,G.amount=0,G.tokenAmount=0,G.priceLoading=!1,G.error=null,G.exchanges=[],G.isLoading=!1}};var YI={isUnsupportedChainView(){return pe.state.view==="UnsupportedChain"||pe.state.view==="SwitchNetwork"&&pe.state.history.includes("UnsupportedChain")},safeClose(){return f(this,null,function*(){if(this.isUnsupportedChainView()){vt.shake();return}if(yield jt.isSIWXCloseDisabled()){vt.shake();return}(pe.state.view==="DataCapture"||pe.state.view==="DataCaptureOtpConfirm")&&ht.disconnect(),vt.close()})}};export{ha as a,Rm as b,fn as c,Nr as d,Nu as e,jt as f,ku as g,Uu as h,X as i,CI as j,OI as k,Xm as l,BI as m,ir as n,YI as o};
