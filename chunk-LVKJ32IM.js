import{a as M}from"./chunk-O63J7XX2.js";import{a as x,b as O,c as g}from"./chunk-YVK6EA54.js";import{A as h,D as f,J as y,Q as b,h as E,i as p,r as B,s as N}from"./chunk-XLSZADC6.js";import{b as W}from"./chunk-CDMUM2L7.js";import{a as _,b as S,n as U}from"./chunk-VNDKUXGB.js";var R={getConnectorsByType(e,t,n){let{customWallets:o}=N.state,l=E.getRecentWallets(),i=I.filterOutDuplicateWallets(t),s=I.filterOutDuplicateWallets(n),r=e.filter(c=>c.type==="MULTI_CHAIN"),m=e.filter(c=>c.type==="ANNOUNCED"),d=e.filter(c=>c.type==="INJECTED"),u=e.filter(c=>c.type==="EXTERNAL");return{custom:o,recent:l,external:u,multiChain:r,announced:m,injected:d,recommended:i,featured:s}},showConnector(e){let t=e.info?.rdns,n=!!t&&h.state.excludedWallets.some(l=>!!l.rdns&&l.rdns===t),o=!!e.name&&h.state.excludedWallets.some(l=>g.isLowerCaseMatch(l.name,e.name));return!(e.type==="INJECTED"&&(e.name==="Browser Wallet"&&(!p.isMobile()||p.isMobile()&&!t&&!y.checkInstalled())||n||o)||(e.type==="ANNOUNCED"||e.type==="EXTERNAL")&&(n||o))},getIsConnectedWithWC(){return Array.from(b.state.chains.values()).some(n=>f.getConnectorId(n.namespace)===W.CONNECTOR_ID.WALLET_CONNECT)},getConnectorTypeOrder({recommended:e,featured:t,custom:n,recent:o,announced:l,injected:i,multiChain:s,external:r,overriddenConnectors:m=N.state.features?.connectorTypeOrder??[]}){let u=[{type:"walletConnect",isEnabled:!0},{type:"recent",isEnabled:o.length>0},{type:"injected",isEnabled:[...i,...l,...s].length>0},{type:"featured",isEnabled:t.length>0},{type:"custom",isEnabled:n&&n.length>0},{type:"external",isEnabled:r.length>0},{type:"recommended",isEnabled:e.length>0}].filter(a=>a.isEnabled),c=new Set(u.map(a=>a.type)),A=m.filter(a=>c.has(a)).map(a=>({type:a,isEnabled:!0})),T=u.filter(({type:a})=>!A.some(({type:D})=>D===a));return Array.from(new Set([...A,...T].map(({type:a})=>a)))},sortConnectorsByExplorerWallet(e){return[...e].sort((t,n)=>t.explorerWallet&&n.explorerWallet?(t.explorerWallet.order??0)-(n.explorerWallet.order??0):t.explorerWallet?-1:n.explorerWallet?1:0)},getAuthName({email:e,socialUsername:t,socialProvider:n}){return t?n&&n==="discord"&&t.endsWith("0")?t.slice(0,-1):t:e.length>30?`${e.slice(0,-3)}...`:e},fetchProviderData(e){return U(this,null,function*(){try{if(e.name==="Browser Wallet"&&!p.isMobile())return{accounts:[],chainId:void 0};if(e.id===W.CONNECTOR_ID.AUTH)return{accounts:[],chainId:void 0};let[t,n]=yield Promise.all([e.provider?.request({method:"eth_accounts"}),e.provider?.request({method:"eth_chainId"}).then(o=>Number(o))]);return{accounts:t,chainId:n}}catch(t){return console.warn(`Failed to fetch provider data for ${e.name}`,t),{accounts:[],chainId:void 0}}})},getFilteredCustomWallets(e){let t=E.getRecentWallets(),n=f.state.connectors.map(s=>s.info?.rdns).filter(Boolean),o=t.map(s=>s.rdns).filter(Boolean),l=n.concat(o);if(l.includes("io.metamask.mobile")&&p.isMobile()){let s=l.indexOf("io.metamask.mobile");l[s]="io.metamask"}return e.filter(s=>!l.includes(String(s?.rdns)))},hasWalletConnector(e){return f.state.connectors.some(t=>t.id===e.id||t.name===e.name)},isWalletCompatibleWithCurrentChain(e){let t=b.state.activeChain;return t&&e.chains?e.chains.some(n=>{let o=n.split(":")[0];return t===o}):!0},getFilteredRecentWallets(){return E.getRecentWallets().filter(n=>!I.isExcluded(n)).filter(n=>!this.hasWalletConnector(n)).filter(n=>this.isWalletCompatibleWithCurrentChain(n))},getCappedRecommendedWallets(e){let{connectors:t}=f.state,{customWallets:n,featuredWalletIds:o}=N.state,l=t.find(C=>C.id==="walletConnect"),i=t.filter(C=>C.type==="INJECTED"||C.type==="ANNOUNCED"||C.type==="MULTI_CHAIN");if(!l&&!i.length&&!n?.length)return[];let s=B.isEmailEnabled(),r=B.isSocialsEnabled(),m=i.filter(C=>C.name!=="Browser Wallet"&&C.name!=="WalletConnect"),d=o?.length||0,u=n?.length||0,c=m.length||0,A=s?1:0,T=r?1:0,a=d+u+c+A+T,D=Math.max(0,4-a);return D<=0?[]:I.filterOutDuplicateWallets(e).slice(0,D)}};var w=[O.ConnectorExplorerIds[W.CONNECTOR_ID.COINBASE],O.ConnectorExplorerIds[W.CONNECTOR_ID.COINBASE_SDK],O.ConnectorExplorerIds[W.CONNECTOR_ID.BASE_ACCOUNT],O.ConnectorExplorerIds[x.SOLFLARE_CONNECTOR_NAME],O.ConnectorExplorerIds[x.PHANTOM_CONNECTOR_NAME],O.ConnectorExplorerIds[x.BINANCE_CONNECTOR_NAME]],I={filterOutDuplicatesByRDNS(e){let t=N.state.enableEIP6963?f.state.connectors:[],n=E.getRecentWallets(),o=t.map(r=>r.info?.rdns).filter(Boolean),l=n.map(r=>r.rdns).filter(Boolean),i=o.concat(l);if(i.includes("io.metamask.mobile")&&p.isMobile()){let r=i.indexOf("io.metamask.mobile");i[r]="io.metamask"}return e.filter(r=>!(r?.rdns&&i.includes(String(r.rdns))||!r?.rdns&&t.some(d=>d.name===r.name)))},filterOutDuplicatesByIds(e){let t=f.state.connectors.filter(r=>r.type==="ANNOUNCED"||r.type==="INJECTED"||r.type==="MULTI_CHAIN"),n=E.getRecentWallets(),o=t.map(r=>r.explorerId||r.explorerWallet?.id||r.id),l=n.map(r=>r.id),i=o.concat(l);return e.filter(r=>!i.includes(r?.id))},filterOutDuplicateWallets(e){let t=this.filterOutDuplicatesByRDNS(e);return this.filterOutDuplicatesByIds(t)},markWalletsAsInstalled(e){let{connectors:t}=f.state,{featuredWalletIds:n}=N.state,o=t.filter(s=>s.type==="ANNOUNCED").reduce((s,r)=>(r.info?.rdns&&(s[r.info.rdns]=!0),s),{});return e.map(s=>S(_({},s),{installed:!!s.rdns&&!!o[s.rdns??""]})).sort((s,r)=>{let m=Number(r.installed)-Number(s.installed);if(m!==0)return m;if(n?.length){let d=n.indexOf(s.id),u=n.indexOf(r.id);if(d!==-1&&u!==-1)return d-u;if(d!==-1)return-1;if(u!==-1)return 1}return 0})},getConnectOrderMethod(e,t){let n=e?.connectMethodsOrder||N.state.features?.connectMethodsOrder,o=t||f.state.connectors;if(n)return n;let{injected:l,announced:i}=R.getConnectorsByType(o,h.state.recommended,h.state.featured),s=l.filter(R.showConnector),r=i.filter(R.showConnector);return s.length||r.length?["wallet","email","social"]:M.DEFAULT_CONNECT_METHOD_ORDER},isExcluded(e){let t=!!e.rdns&&h.state.excludedWallets.some(o=>o.rdns===e.rdns),n=!!e.name&&h.state.excludedWallets.some(o=>g.isLowerCaseMatch(o.name,e.name));return t||n},markWalletsWithDisplayIndex(e){return e.map((t,n)=>S(_({},t),{display_index:n}))},filterWalletsByWcSupport(e){return y.state.wcBasic?e.filter(t=>t.supports_wc):p.isMobile()?e.filter(t=>t.supports_wc||w.includes(t.id)):e}};export{I as a,R as b};
