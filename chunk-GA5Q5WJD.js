import{a as vt}from"./chunk-HBY4NJPF.js";import{d as Te,i as Ze}from"./chunk-M3G4TYWD.js";import{$g as xe,Bg as je,Dg as Ee,V as Ne,Wh as Oe,Z as Ae,ah as ve,lf as Se,v as Ce,y as De}from"./chunk-RREX6AKU.js";import"./chunk-YUFH6IGI.js";import"./chunk-IV5FR2YO.js";import{A as de,a as T,o as Y,w as jt,x as Et}from"./chunk-G5N4ZAKI.js";import"./chunk-2CDTKQ3E.js";import"./chunk-UHR73J24.js";import{a as Ve,b as xt}from"./chunk-VAHX4GR7.js";import"./chunk-I2YJHZ2B.js";import{H,N as ce}from"./chunk-AX3MU5C4.js";import"./chunk-ZRBE6OMV.js";import"./chunk-Z3SE2D4B.js";import"./chunk-5LQ6A2AX.js";import{U as Ge,Xb as be,Z as j,ac as N,b as He,fc as x,ia as A}from"./chunk-5G3DVQVW.js";import"./chunk-HINDXNTT.js";import"./chunk-X3F4NDXO.js";import"./chunk-JKZLGYQN.js";import"./chunk-EEU3LH2V.js";import"./chunk-TRLFM7P4.js";import"./chunk-QMRWXCSQ.js";import{a as y,b as I,f as k,k as St,n as a,q as ae}from"./chunk-VNDKUXGB.js";function Ot(e={}){let t,n,r,s;return d=>({id:"baseAccount",name:"Base Account",rdns:"app.base.account",type:"baseAccount",connect(){return a(this,arguments,function*({chainId:i,withCapabilities:u}={}){try{let c=yield this.getProvider(),h=(yield c.request({method:"eth_requestAccounts",params:[]})).map(g=>A(g));n||(n=this.onAccountsChanged.bind(this),c.on("accountsChanged",n)),r||(r=this.onChainChanged.bind(this),c.on("chainChanged",r)),s||(s=this.onDisconnect.bind(this),c.on("disconnect",s));let o=yield this.getChainId();return i&&o!==i&&(o=(yield this.switchChain({chainId:i}).catch(l=>{if(l.code===N.code)throw l;return{id:o}}))?.id??o),{accounts:u?h.map(g=>({address:g,capabilities:{}})):h,chainId:o}}catch(c){throw/(user closed modal|accounts received is empty|user denied account|request rejected)/i.test(c.message)?new N(c):c}})},disconnect(){return a(this,null,function*(){let i=yield this.getProvider();n&&(i.removeListener("accountsChanged",n),n=void 0),r&&(i.removeListener("chainChanged",r),r=void 0),s&&(i.removeListener("disconnect",s),s=void 0),i.disconnect()})},getAccounts(){return a(this,null,function*(){return(yield(yield this.getProvider()).request({method:"eth_accounts"})).map(u=>A(u))})},getChainId(){return a(this,null,function*(){let u=yield(yield this.getProvider()).request({method:"eth_chainId"});return Number(u)})},getProvider(){return a(this,null,function*(){if(!t){let i=typeof e.preference=="string"?{options:e.preference}:I(y({},e.preference),{options:e.preference?.options??"all"}),{createBaseAccountSDK:u}=yield import("./chunk-KAM3UA3C.js");t=u(I(y({},e),{appChainIds:d.chains.map(h=>h.id),preference:i})).getProvider()}return t})},isAuthorized(){return a(this,null,function*(){try{return!!(yield this.getAccounts()).length}catch{return!1}})},switchChain(c){return a(this,arguments,function*({addEthereumChainParameter:i,chainId:u}){let h=d.chains.find(g=>g.id===u);if(!h)throw new x(new T);let o=yield this.getProvider();try{return yield o.request({method:"wallet_switchEthereumChain",params:[{chainId:j(h.id)}]}),h}catch(g){if(g.code===4902)try{let l;i?.blockExplorerUrls?l=i.blockExplorerUrls:l=h.blockExplorers?.default.url?[h.blockExplorers?.default.url]:[];let p;i?.rpcUrls?.length?p=i.rpcUrls:p=[h.rpcUrls.default?.http[0]??""];let m={blockExplorerUrls:l,chainId:j(u),chainName:i?.chainName??h.name,iconUrls:i?.iconUrls,nativeCurrency:i?.nativeCurrency??h.nativeCurrency,rpcUrls:p};return yield o.request({method:"wallet_addEthereumChain",params:[m]}),h}catch(l){throw new N(l)}throw new x(g)}})},onAccountsChanged(i){i.length===0?this.onDisconnect():d.emitter.emit("change",{accounts:i.map(u=>A(u))})},onChainChanged(i){let u=Number(i);d.emitter.emit("change",{chainId:u})},onDisconnect(i){return a(this,null,function*(){d.emitter.emit("disconnect");let u=yield this.getProvider();n&&(u.removeListener("accountsChanged",n),n=void 0),r&&(u.removeListener("chainChanged",r),r=void 0),s&&(u.removeListener("disconnect",s),s=void 0)})}})}ue.type="coinbaseWallet";function ue(e={}){return e.version==="3"||e.headlessMode?zt(e):Tt(e)}function Tt(e){let t,n,r,s;return d=>({id:"coinbaseWalletSDK",name:"Coinbase Wallet",rdns:"com.coinbase.wallet",type:ue.type,connect(){return a(this,arguments,function*(h={}){var o=h,{chainId:i,withCapabilities:u}=o,c=k(o,["chainId","withCapabilities"]);try{let g=yield this.getProvider(),l=(yield g.request({method:"eth_requestAccounts",params:"instantOnboarding"in c&&c.instantOnboarding?[{onboarding:"instant"}]:[]})).map(m=>A(m));n||(n=this.onAccountsChanged.bind(this),g.on("accountsChanged",n)),r||(r=this.onChainChanged.bind(this),g.on("chainChanged",r)),s||(s=this.onDisconnect.bind(this),g.on("disconnect",s));let p=yield this.getChainId();return i&&p!==i&&(p=(yield this.switchChain({chainId:i}).catch(M=>{if(M.code===N.code)throw M;return{id:p}}))?.id??p),{accounts:u?l.map(m=>({address:m,capabilities:{}})):l,chainId:p}}catch(g){throw/(user closed modal|accounts received is empty|user denied account|request rejected)/i.test(g.message)?new N(g):g}})},disconnect(){return a(this,null,function*(){let i=yield this.getProvider();n&&(i.removeListener("accountsChanged",n),n=void 0),r&&(i.removeListener("chainChanged",r),r=void 0),s&&(i.removeListener("disconnect",s),s=void 0),i.disconnect(),i.close?.()})},getAccounts(){return a(this,null,function*(){return(yield(yield this.getProvider()).request({method:"eth_accounts"})).map(u=>A(u))})},getChainId(){return a(this,null,function*(){let u=yield(yield this.getProvider()).request({method:"eth_chainId"});return Number(u)})},getProvider(){return a(this,null,function*(){if(!t){let i=typeof e.preference=="string"?{options:e.preference}:I(y({},e.preference),{options:e.preference?.options??"all"}),{createCoinbaseWalletSDK:u}=yield import("./chunk-AETQ7KOU.js");t=u(I(y({},e),{appChainIds:d.chains.map(h=>h.id),preference:i})).getProvider()}return t})},isAuthorized(){return a(this,null,function*(){try{return!!(yield this.getAccounts()).length}catch{return!1}})},switchChain(c){return a(this,arguments,function*({addEthereumChainParameter:i,chainId:u}){let h=d.chains.find(g=>g.id===u);if(!h)throw new x(new T);let o=yield this.getProvider();try{return yield o.request({method:"wallet_switchEthereumChain",params:[{chainId:j(h.id)}]}),h}catch(g){if(g.code===4902)try{let l;i?.blockExplorerUrls?l=i.blockExplorerUrls:l=h.blockExplorers?.default.url?[h.blockExplorers?.default.url]:[];let p;i?.rpcUrls?.length?p=i.rpcUrls:p=[h.rpcUrls.default?.http[0]??""];let m={blockExplorerUrls:l,chainId:j(u),chainName:i?.chainName??h.name,iconUrls:i?.iconUrls,nativeCurrency:i?.nativeCurrency??h.nativeCurrency,rpcUrls:p};return yield o.request({method:"wallet_addEthereumChain",params:[m]}),h}catch(l){throw new N(l)}throw new x(g)}})},onAccountsChanged(i){i.length===0?this.onDisconnect():d.emitter.emit("change",{accounts:i.map(u=>A(u))})},onChainChanged(i){let u=Number(i);d.emitter.emit("change",{chainId:u})},onDisconnect(i){return a(this,null,function*(){d.emitter.emit("disconnect");let u=yield this.getProvider();n&&(u.removeListener("accountsChanged",n),n=void 0),r&&(u.removeListener("chainChanged",r),r=void 0),s&&(u.removeListener("disconnect",s),s=void 0)})}})}function zt(e){let n,r,s,d,f;return i=>({id:"coinbaseWalletSDK",name:"Coinbase Wallet",rdns:"com.coinbase.wallet",type:ue.type,connect(){return a(this,arguments,function*({chainId:c,withCapabilities:h}={}){try{let o=yield this.getProvider(),g=(yield o.request({method:"eth_requestAccounts"})).map(p=>A(p));s||(s=this.onAccountsChanged.bind(this),o.on("accountsChanged",s)),d||(d=this.onChainChanged.bind(this),o.on("chainChanged",d)),f||(f=this.onDisconnect.bind(this),o.on("disconnect",f));let l=yield this.getChainId();return c&&l!==c&&(l=(yield this.switchChain({chainId:c}).catch(m=>{if(m.code===N.code)throw m;return{id:l}}))?.id??l),{accounts:h?g.map(p=>({address:p,capabilities:{}})):g,chainId:l}}catch(o){throw/(user closed modal|accounts received is empty|user denied account)/i.test(o.message)?new N(o):o}})},disconnect(){return a(this,null,function*(){let c=yield this.getProvider();s&&(c.removeListener("accountsChanged",s),s=void 0),d&&(c.removeListener("chainChanged",d),d=void 0),f&&(c.removeListener("disconnect",f),f=void 0),c.disconnect(),c.close()})},getAccounts(){return a(this,null,function*(){return(yield(yield this.getProvider()).request({method:"eth_accounts"})).map(h=>A(h))})},getChainId(){return a(this,null,function*(){let h=yield(yield this.getProvider()).request({method:"eth_chainId"});return Number(h)})},getProvider(){return a(this,null,function*(){if(!r){let c=yield a(this,null,function*(){let{default:p}=yield import("./chunk-5MCVNML4.js");return typeof p!="function"&&typeof p.default=="function"?p.default:p});n=new c(I(y({},e),{reloadOnDisconnect:!1}));let h=n.walletExtension?.getChainId(),o=i.chains.find(p=>e.chainId?p.id===e.chainId:p.id===h)||i.chains[0],g=e.chainId||o?.id,l=e.jsonRpcUrl||o?.rpcUrls.default.http[0];r=n.makeWeb3Provider(l,g)}return r})},isAuthorized(){return a(this,null,function*(){try{return!!(yield this.getAccounts()).length}catch{return!1}})},switchChain(o){return a(this,arguments,function*({addEthereumChainParameter:c,chainId:h}){let g=i.chains.find(p=>p.id===h);if(!g)throw new x(new T);let l=yield this.getProvider();try{return yield l.request({method:"wallet_switchEthereumChain",params:[{chainId:j(g.id)}]}),g}catch(p){if(p.code===4902)try{let m;c?.blockExplorerUrls?m=c.blockExplorerUrls:m=g.blockExplorers?.default.url?[g.blockExplorers?.default.url]:[];let M;c?.rpcUrls?.length?M=c.rpcUrls:M=[g.rpcUrls.default?.http[0]??""];let b={blockExplorerUrls:m,chainId:j(h),chainName:c?.chainName??g.name,iconUrls:c?.iconUrls,nativeCurrency:c?.nativeCurrency??g.nativeCurrency,rpcUrls:M};return yield l.request({method:"wallet_addEthereumChain",params:[b]}),g}catch(m){throw new N(m)}throw new x(p)}})},onAccountsChanged(c){c.length===0?this.onDisconnect():i.emitter.emit("change",{accounts:c.map(h=>A(h))})},onChainChanged(c){let h=Number(c);i.emitter.emit("change",{chainId:h})},onDisconnect(c){return a(this,null,function*(){i.emitter.emit("disconnect");let h=yield this.getProvider();s&&(h.removeListener("accountsChanged",s),s=void 0),d&&(h.removeListener("chainChanged",d),d=void 0),f&&(h.removeListener("disconnect",f),f=void 0)})}})}var he=class extends TypeError{constructor(t,n){let r,c=t,{message:s,explanation:d}=c,f=k(c,["message","explanation"]),{path:i}=t,u=i.length===0?s:`At path: ${i.join(".")} -- ${s}`;super(d??u),d!=null&&(this.cause=u),Object.assign(this,f),this.name=this.constructor.name,this.failures=()=>r??(r=[t,...n()])}};function Pt(e){return P(e)&&typeof e[Symbol.iterator]=="function"}function P(e){return typeof e=="object"&&e!==null}function U(e){return typeof e=="symbol"?e.toString():typeof e=="string"?JSON.stringify(e):`${e}`}function Xe(e){let{done:t,value:n}=e.next();return t?void 0:n}function _t(e,t,n,r){if(e===!0)return;e===!1?e={}:typeof e=="string"&&(e={message:e});let{path:s,branch:d}=t,{type:f}=n,{refinement:i,message:u=`Expected a value of type \`${f}\`${i?` with refinement \`${i}\``:""}, but received: \`${U(r)}\``}=e;return I(y({value:r,type:f,refinement:i,key:s[s.length-1],path:s,branch:d},e),{message:u})}function*G(e,t,n,r){Pt(e)||(e=[e]);for(let s of e){let d=_t(s,t,n,r);d&&(yield d)}}function*V(e,t,n={}){let{path:r=[],branch:s=[e],coerce:d=!1,mask:f=!1}=n,i={path:r,branch:s};if(d&&(e=t.coercer(e,i),f&&t.type!=="type"&&P(t.schema)&&P(e)&&!Array.isArray(e)))for(let c in e)t.schema[c]===void 0&&delete e[c];let u="valid";for(let c of t.validator(e,i))c.explanation=n.message,u="not_valid",yield[c,void 0];for(let[c,h,o]of t.entries(e,i)){let g=V(h,o,{path:c===void 0?r:[...r,c],branch:c===void 0?s:[...s,h],coerce:d,mask:f,message:n.message});for(let l of g)l[0]?(u=l[0].refinement===null||l[0].refinement===void 0?"not_valid":"not_refined",yield[l[0],void 0]):d&&(h=l[1],c===void 0?e=h:e instanceof Map?e.set(c,h):e instanceof Set?e.add(h):P(e)&&(h!==void 0||c in e)&&(e[c]=h))}if(u!=="not_valid")for(let c of t.refiner(e,i))c.explanation=n.message,u="not_refined",yield[c,void 0];u==="valid"&&(yield[void 0,e])}var v=class{constructor(t){let{type:n,schema:r,validator:s,refiner:d,coercer:f=u=>u,entries:i=function*(){}}=t;this.type=n,this.schema=r,this.entries=i,this.coercer=f,s?this.validator=(u,c)=>{let h=s(u,c);return G(h,c,this,u)}:this.validator=()=>[],d?this.refiner=(u,c)=>{let h=d(u,c);return G(h,c,this,u)}:this.refiner=()=>[]}assert(t,n){return Ut(t,this,n)}create(t,n){return ze(t,this,n)}is(t){return J(t,this)}mask(t,n){return Lt(t,this,n)}validate(t,n={}){return Z(t,this,n)}},et="EXACT_OPTIONAL",le=class extends v{constructor(t){super(I(y({},t),{type:`exact optional ${t.type}`})),this.brand=et}static isExactOptional(t){return P(t)&&"brand"in t&&t.brand===et}};function Ut(e,t,n){let r=Z(e,t,{message:n});if(r[0])throw r[0]}function ze(e,t,n){let r=Z(e,t,{coerce:!0,message:n});if(r[0])throw r[0];return r[1]}function Lt(e,t,n){let r=Z(e,t,{coerce:!0,mask:!0,message:n});if(r[0])throw r[0];return r[1]}function J(e,t){return!Z(e,t)[0]}function Z(e,t,n={}){let r=V(e,t,n),s=Xe(r);return s[0]?[new he(s[0],function*(){for(let i of r)i[0]&&(yield i[0])}),void 0]:[void 0,s[1]]}function Q(e,t){return new v({type:e,schema:null,validator:t})}function tt(){return Q("any",()=>!0)}function nt(e){return new v({type:"array",schema:e,*entries(t){if(e&&Array.isArray(t))for(let[n,r]of t.entries())yield[n,r,e]},coercer(t){return Array.isArray(t)?t.slice():t},validator(t){return Array.isArray(t)||`Expected an array value, but received: ${U(t)}`}})}function rt(){return Q("integer",e=>typeof e=="number"&&!isNaN(e)&&Number.isInteger(e)||`Expected an integer, but received: ${U(e)}`)}function it(e){let t=U(e),n=typeof e;return new v({type:"literal",schema:n==="string"||n==="number"||n==="boolean"?e:null,validator(r){return r===e||`Expected the literal \`${t}\`, but received: ${U(r)}`}})}function Rt(){return Q("never",()=>!1)}function st(e){return new v(I(y({},e),{validator:(t,n)=>t===null||e.validator(t,n),refiner:(t,n)=>t===null||e.refiner(t,n)}))}function ot(){return Q("number",e=>typeof e=="number"&&!isNaN(e)||`Expected a number, but received: ${U(e)}`)}function Pe(e){let t=e?Object.keys(e):[],n=Rt();return new v({type:"object",schema:e??null,*entries(r){if(e&&P(r)){let s=new Set(Object.keys(r));for(let d of t){s.delete(d);let f=e[d];le.isExactOptional(f)&&!Object.prototype.hasOwnProperty.call(r,d)||(yield[d,r[d],e[d]])}for(let d of s)yield[d,r[d],n]}},validator(r){return P(r)||`Expected an object, but received: ${U(r)}`},coercer(r){return P(r)?y({},r):r}})}function _e(e){return new v(I(y({},e),{validator:(t,n)=>t===void 0||e.validator(t,n),refiner:(t,n)=>t===void 0||e.refiner(t,n)}))}function at(e,t){return new v({type:"record",schema:null,*entries(n){if(P(n))for(let r in n){let s=n[r];yield[r,r,e],yield[r,s,t]}},validator(n){return P(n)||`Expected an object, but received: ${U(n)}`}})}function $(){return Q("string",e=>typeof e=="string"||`Expected a string, but received: ${U(e)}`)}function pe(e){let t=e.map(n=>n.type).join(" | ");return new v({type:"union",schema:null,coercer(n){for(let r of e){let[s,d]=r.validate(n,{coerce:!0});if(!s)return d}return n},validator(n,r){let s=[];for(let d of e){let[...f]=V(n,d,r),[i]=f;if(!i?.[0])return[];for(let[u]of f)u&&s.push(u)}return[`Expected the value to satisfy a union of \`${t}\`, but received: ${U(n)}`,...s]}})}function ct(){return Q("unknown",()=>!0)}function dt(e,t,n){return new v(I(y({},e),{coercer:(r,s)=>J(r,t)?e.coercer(n(r,s),s):e.coercer(r,s)}))}function ut(e,t,n){return new v(I(y({},e),{*refiner(r,s){yield*ae(e.refiner(r,s));let d=n(r,s),f=G(d,s,e,r);for(let i of f)yield I(y({},i),{refinement:t})}}))}function B(e){return!!e&&typeof e=="object"&&!Array.isArray(e)}var K=(e,t)=>Object.hasOwnProperty.call(e,t);var Ue;(function(e){e[e.Null=4]="Null",e[e.Comma=1]="Comma",e[e.Wrapper=1]="Wrapper",e[e.True=4]="True",e[e.False=5]="False",e[e.Quote=1]="Quote",e[e.Colon=1]="Colon",e[e.Date=24]="Date"})(Ue=Ue||(Ue={}));function ht(e){if(typeof e!="object"||e===null)return!1;try{let t=e;for(;Object.getPrototypeOf(t)!==null;)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}catch{return!1}}var ee=e=>Pe(e);function lt({path:e,branch:t}){let n=e[e.length-1];return K(t[t.length-2],n)}function fe(e){return new v(I(y({},e),{type:`optional ${e.type}`,validator:(t,n)=>!lt(n)||e.validator(t,n),refiner:(t,n)=>!lt(n)||e.refiner(t,n)}))}function Le(e){if(e===null||typeof e=="boolean"||typeof e=="string"||typeof e=="number"&&Number.isFinite(e))return!0;if(typeof e=="object"){let t=!0;if(Array.isArray(e)){for(let r=0;r<e.length;r++)if(!Le(e[r])){t=!1;break}return t}let n=Object.entries(e);for(let r=0;r<n.length;r++)if(typeof n[r][0]!="string"||!Le(n[r][1])){t=!1;break}return t}return!1}var pt=Q("JSON",e=>Le(e)),X=dt(pt,ut(tt(),"JSON",e=>J(e,pt)),e=>JSON.parse(JSON.stringify(e,(t,n)=>{if(!(t==="__proto__"||t==="constructor"))return n})));function ge(e){try{return kt(e),!0}catch{return!1}}function kt(e){return ze(e,X)}var Yt="2.0",te=it(Yt),me=st(pe([ot(),$()])),Re=ee({code:rt(),message:$(),data:fe(X),stack:fe($())}),ft=pe([at($(),X),nt(X)]),Xn=ee({id:me,jsonrpc:te,method:$(),params:fe(ft)}),er=ee({jsonrpc:te,method:$(),params:fe(ft)});var tr=Pe({id:me,jsonrpc:te,result:_e(ct()),error:_e(Re)}),qt=ee({id:me,jsonrpc:te,result:X}),Qt=ee({id:me,jsonrpc:te,error:Re}),nr=pe([qt,Qt]);function ke(e){return J(e,Re)}var wt=St(vt(),1);var S={rpc:{invalidInput:-32e3,resourceNotFound:-32001,resourceUnavailable:-32002,transactionRejected:-32003,methodNotSupported:-32004,limitExceeded:-32005,parse:-32700,invalidRequest:-32600,methodNotFound:-32601,invalidParams:-32602,internal:-32603},provider:{userRejectedRequest:4001,unauthorized:4100,unsupportedMethod:4200,disconnected:4900,chainDisconnected:4901}},Ye={"-32700":{standard:"JSON RPC 2.0",message:"Invalid JSON was received by the server. An error occurred on the server while parsing the JSON text."},"-32600":{standard:"JSON RPC 2.0",message:"The JSON sent is not a valid Request object."},"-32601":{standard:"JSON RPC 2.0",message:"The method does not exist / is not available."},"-32602":{standard:"JSON RPC 2.0",message:"Invalid method parameter(s)."},"-32603":{standard:"JSON RPC 2.0",message:"Internal JSON-RPC error."},"-32000":{standard:"EIP-1474",message:"Invalid input."},"-32001":{standard:"EIP-1474",message:"Resource not found."},"-32002":{standard:"EIP-1474",message:"Resource unavailable."},"-32003":{standard:"EIP-1474",message:"Transaction rejected."},"-32004":{standard:"EIP-1474",message:"Method not supported."},"-32005":{standard:"EIP-1474",message:"Request limit exceeded."},4001:{standard:"EIP-1193",message:"User rejected the request."},4100:{standard:"EIP-1193",message:"The requested account and/or method has not been authorized by the user."},4200:{standard:"EIP-1193",message:"The requested method is not supported by this Ethereum provider."},4900:{standard:"EIP-1193",message:"The provider is disconnected from all chains."},4901:{standard:"EIP-1193",message:"The provider is disconnected from the specified chain."}};var gt=S.rpc.internal,Kt="Unspecified error message. This is a bug, please report it.",$t={code:gt,message:ne(gt)},Wt="Unspecified server error.";function ne(e,t=Kt){if(Ft(e)){let n=e.toString();if(K(Ye,n))return Ye[n].message;if(Ht(e))return Wt}return t}function Ft(e){return Number.isInteger(e)}function qe(e,{fallbackError:t=$t,shouldIncludeStack:n=!0,shouldPreserveMessage:r=!0}={}){if(!ke(t))throw new Error("Must provide fallback error with integer number code and string message.");let s=Jt(e,t,r);return n||delete s.stack,s}function Jt(e,t,n){if(e&&typeof e=="object"&&"serialize"in e&&typeof e.serialize=="function")return e.serialize();if(ke(e))return e;let r=Bt(e),s=we(e);return I(y(y({},t),n&&r&&{message:r}),{data:{cause:s}})}function Bt(e){if(B(e)&&K(e,"message")&&typeof e.message=="string"&&e.message.length>0)return e.message}function Ht(e){return e>=-32099&&e<=-32e3}function we(e){return Array.isArray(e)?e.map(t=>ge(t)?t:B(t)?mt(t):null):B(e)?mt(e):ge(e)?e:null}function mt(e){return Object.getOwnPropertyNames(e).reduce((t,n)=>{let r=e[n];return ge(r)&&(t[n]=r),t},{})}function Qe(e){return B(e)&&K(e,"cause")&&B(e.cause)}function Gt(e){return e?.__esModule?e.default:e}var Vt=Gt(wt.default),re=class extends Error{constructor(t,n,r){if(!Number.isInteger(t))throw new Error('"code" must be an integer.');if(!n||typeof n!="string")throw new Error('"message" must be a non-empty string.');Qe(r)?(super(n,{cause:r.cause}),K(this,"cause")||Object.assign(this,{cause:r.cause})):super(n),r!==void 0&&(this.data=r),this.code=t}serialize(){let t={code:this.code,message:this.message};return this.data!==void 0&&(t.data=this.data,ht(this.data)&&(t.data.cause=we(this.data.cause))),this.stack&&(t.stack=this.stack),t}toString(){return Vt(this.serialize(),Xt,2)}},ie=class extends re{constructor(t,n,r){if(!Zt(t))throw new Error('"code" must be an integer such that: 1000 <= code <= 4999');super(t,n,r)}};function Zt(e){return Number.isInteger(e)&&e>=1e3&&e<=4999}function Xt(e,t){if(t!=="[Circular]")return t}var E={parse:e=>_(S.rpc.parse,e),invalidRequest:e=>_(S.rpc.invalidRequest,e),invalidParams:e=>_(S.rpc.invalidParams,e),methodNotFound:e=>_(S.rpc.methodNotFound,e),internal:e=>_(S.rpc.internal,e),server:e=>{if(!e||typeof e!="object"||Array.isArray(e))throw new Error("Ethereum RPC Server errors must provide single object argument.");let{code:t}=e;if(!Number.isInteger(t)||t>-32005||t<-32099)throw new Error('"code" must be an integer such that: -32099 <= code <= -32005');return _(t,e)},invalidInput:e=>_(S.rpc.invalidInput,e),resourceNotFound:e=>_(S.rpc.resourceNotFound,e),resourceUnavailable:e=>_(S.rpc.resourceUnavailable,e),transactionRejected:e=>_(S.rpc.transactionRejected,e),methodNotSupported:e=>_(S.rpc.methodNotSupported,e),limitExceeded:e=>_(S.rpc.limitExceeded,e)},q={userRejectedRequest:e=>se(S.provider.userRejectedRequest,e),unauthorized:e=>se(S.provider.unauthorized,e),unsupportedMethod:e=>se(S.provider.unsupportedMethod,e),disconnected:e=>se(S.provider.disconnected,e),chainDisconnected:e=>se(S.provider.chainDisconnected,e),custom:e=>{if(!e||typeof e!="object"||Array.isArray(e))throw new Error("Ethereum Provider custom errors must provide single object argument.");let{code:t,message:n,data:r}=e;if(!n||typeof n!="string")throw new Error('"message" must be a nonempty string');return new ie(t,n,r)}};function _(e,t){let[n,r]=yt(t);return new re(e,n??ne(e),r)}function se(e,t){let[n,r]=yt(t);return new ie(e,n??ne(e),r)}function yt(e){if(e){if(typeof e=="string")return[e];if(typeof e=="object"&&!Array.isArray(e)){let{message:t,data:n}=e;if(t&&typeof t!="string")throw new Error("Must specify string message.");return[t??void 0,n]}}return[]}xt();var en={name:"@gemini-wallet/core",version:"0.3.2",description:"Core SDK for Gemini Wallet integration with popup communication",main:"./dist/index.cjs",types:"./dist/index.d.ts",type:"module",repository:{type:"git",url:"git+https://github.com/gemini/gemini-wallet-core.git"},homepage:"https://keys.gemini.com",bugs:{url:"https://github.com/gemini/gemini-wallet-core/issues"},license:"MIT",author:"Gemini",files:["dist","src","README.md","LICENSE"],exports:{".":{types:"./dist/index.d.ts",import:"./dist/index.js",require:"./dist/index.cjs"},"./package.json":"./package.json"},scripts:{build:"dotenv -e .env.production -- tsup",dev:"dotenv -e .env.local -- tsup --watch",typecheck:"tsc --noEmit",lint:"eslint ./src","lint:ci":"eslint --max-warnings 0 ./src","lint:fix":"eslint ./src --fix",test:"bun test"},dependencies:{"@metamask/rpc-errors":"7.0.2",eventemitter3:"5.0.1"},devDependencies:{"@eslint/eslintrc":"3.3.1","@eslint/js":"9.38.0","@types/node":"22.13.0","dotenv-cli":"10.0.0","esbuild-plugin-replace":"1.4.0",eslint:"9.38.0","eslint-config-prettier":"10.1.8","eslint-config-turbo":"2.5.6","eslint-plugin-import":"2.32.0","eslint-plugin-only-warn":"1.1.0","eslint-plugin-prettier":"5.5.4","eslint-plugin-simple-import-sort":"12.1.1","eslint-plugin-sort-keys-fix":"1.1.2",globals:"16.4.0",prettier:"3.6.2",tsup:"8.5.0",typescript:"5.5.3","typescript-eslint":"8.40.0",vitest:"3.2.4"},peerDependencies:{viem:">=2.0.0"},keywords:["gemini","wallet","sdk","ethereum","web3","crypto"],module:"./dist/index.js"},tn="https://keys.gemini.com",nn=tn;var rn=en.version,oe=42161,sn={ARBITRUM_ONE:42161,BASE:8453,ETHEREUM:1,OP_MAINNET:10,POLYGON:137},on={ARBITRUM_SEPOLIA:421614,BASE_SEPOLIA:84532,OP_SEPOLIA:11155420,POLYGON_AMOY:80002,SEPOLIA:11155111},an=[...Object.values(sn),...Object.values(on)];function ye(e){return{[Se.id]:Se.rpcUrls.default.http[0],[Ce.id]:Ce.rpcUrls.default.http[0],[je.id]:je.rpcUrls.default.http[0],[Ne.id]:Ne.rpcUrls.default.http[0],[xe.id]:xe.rpcUrls.default.http[0],[Oe.id]:Oe.rpcUrls.default.http[0],[De.id]:De.rpcUrls.default.http[0],[Ee.id]:Ee.rpcUrls.default.http[0],[Ae.id]:Ae.rpcUrls.default.http[0],[ve.id]:ve.rpcUrls.default.http[0]}[e]}var cn=class extends Ve.default{};var Ct={ATTESTER:"0x000474392a9cd86a4687354f1Ce2964B52e97484",BOOTSTRAPPER:"0x00000000D3254452a909E4eeD47455Af7E27C289",REGISTRY:"0x000000000069E2a187AEFFb852bF3cCdC95151B2"},Nr=I(y({},Ct),{ACCOUNT_IMPLEMENTATION:"0x00000000029d9c8b864DD51d6bb0d99FB72D650b",FACTORY:"0x000000000452377e1Bd9e72E939855ECb9363Cab",WEBAUTHN_VALIDATOR:"0x7ab16Ff354AcB328452F1D445b3Ddee9a91e9e69"}),Ar=I(y({},Ct),{ACCOUNT_IMPLEMENTATION:"0x0006050168DE255a8672ACaD4821e721CBA44337",FACTORY:"0x00E58DF70FaB983a324c4C068c82d20407579FaC",WEBAUTHN_VALIDATOR:"0xbA45a2BFb8De3D24cA9D7F1B551E14dFF5d690Fd"});var Mt=420,It=650,dn=e=>{let t=(window.innerWidth-Mt)/2+window.screenX,n=(window.innerHeight-It)/2+window.screenY,r=`wallet_${window?.crypto?.randomUUID()}`,s=window.open(e,r,`width=${Mt}, height=${It}, left=${t}, top=${n}`);if(s?.focus(),!s)throw E.internal("Pop up window failed to open");return s},un=e=>{e&&!e.closed&&(e.opener?.focus(),e.close())},Me=e=>`0x${BigInt(e).toString(16)}`,hn=e=>JSON.stringify(e,(t,n)=>typeof n=="bigint"?n.toString()+"n":n,2),ln=class{constructor({appMetadata:e,onDisconnectCallback:t}){this.popup=null,this.listeners=new Map,this.postMessage=n=>a(this,null,function*(){(yield this.waitForPopupLoaded()).postMessage(n,this.url.origin)}),this.postRequestAndWaitForResponse=n=>a(this,null,function*(){let r=this.onMessage(({requestId:s})=>s===n.requestId);return this.postMessage(n),yield r}),this.onMessage=n=>new Promise((r,s)=>{let d=f=>{if(f.origin!==this.url.origin)return;let i=f.data;n(i)&&(r(i),window.removeEventListener("message",d),this.listeners.delete(d))};window.addEventListener("message",d),this.listeners.set(d,{reject:s})}),this.onRequestCancelled=()=>{un(this.popup),this.popup=null,this.listeners.forEach(({reject:n},r)=>{n(q.userRejectedRequest()),window.removeEventListener("message",r)}),this.listeners.clear()},this.waitForPopupLoaded=()=>this.popup&&!this.popup.closed?(this.popup.focus(),Promise.resolve(this.popup)):(this.popup=dn(this.url),this.onMessage(({event:n})=>n==="POPUP_UNLOADED").then(this.onRequestCancelled).catch(()=>{}),this.onMessage(({event:n})=>n==="SDK_DISCONNECT").then(()=>{this.onDisconnectCallback?.(),this.onRequestCancelled()}).catch(()=>{}),this.onMessage(({event:n})=>n==="POPUP_LOADED").then(n=>{this.postMessage({chainId:oe,data:{appMetadata:this.appMetadata,origin:window.location.origin,sdkVersion:rn},event:"POPUP_APP_CONTEXT",origin:window.location.origin,requestId:n.requestId})}).then(()=>{if(!this.popup)throw E.internal();return this.popup})),this.url=new URL(nn),this.appMetadata=e,this.onDisconnectCallback=t}},Ke={},Dt=class{constructor({scope:e="@gemini",module:t="wallet"}={}){this.scope=e,this.module=t}scopedKey(e){return`${this.scope}.${this.module}.${e}`}storeObject(e,t){return a(this,null,function*(){let n=hn(t);yield this.setItem(e,n)})}loadObject(e,t){return a(this,null,function*(){let n=yield this.getItem(e);if(!n)return yield this.storeObject(e,t),t;try{return JSON.parse(n)}catch(r){return console.error(`Error parsing JSON for key ${e}:`,r),t}})}setItem(e,t){return a(this,null,function*(){let n=this.scopedKey(e);try{localStorage.setItem(n,t)}catch(r){console.warn("localStorage not available, using memory storage",r),Ke[n]=t}})}getItem(e){return a(this,null,function*(){let t=this.scopedKey(e);try{return localStorage.getItem(t)}catch(n){return console.warn("localStorage not available, using memory storage",n),Ke[t]||null}})}removeItem(e){return a(this,null,function*(){let t=this.scopedKey(e);try{localStorage.removeItem(t)}catch(n){console.warn("localStorage not available, using memory storage",n),delete Ke[t]}})}removeItems(e){return a(this,null,function*(){yield Promise.all(e.map(t=>this.removeItem(t)))})}},Ie="eth-accounts",$e="eth-active-chain";var W="call-batches";function pn(e){return an.includes(e)}var bt=class{constructor({appMetadata:e,chain:t,onDisconnectCallback:n,storage:r}){this.accounts=[],this.chain={id:oe},this.communicator=new ln({appMetadata:e,onDisconnectCallback:n}),this.storage=r||new Dt;let s=t?.id??oe,d=t?.rpcUrl??ye(s),f={id:s,rpcUrl:d};this.initPromise=this.initializeFromStorage(f)}initializeFromStorage(e){return a(this,null,function*(){let t=I(y({},e),{rpcUrl:e.rpcUrl||ye(e.id)}),[n,r]=yield Promise.all([this.storage.loadObject($e,t),this.storage.loadObject(Ie,this.accounts)]);this.chain=I(y({},n),{rpcUrl:n.rpcUrl||ye(n.id)}),this.accounts=r})}ensureInitialized(){return a(this,null,function*(){yield this.initPromise})}connect(){return a(this,null,function*(){yield this.ensureInitialized();let e=yield this.sendMessageToPopup({chainId:this.chain.id,event:"SDK_CONNECT",origin:window.location.origin});return this.accounts=e.data.address?[e.data.address]:[],yield this.storage.storeObject(Ie,this.accounts),this.accounts})}disconnect(){return a(this,null,function*(){yield this.ensureInitialized(),this.accounts=[],yield this.storage.storeObject(Ie,this.accounts)})}switchChain(t){return a(this,arguments,function*({id:e}){return yield this.ensureInitialized(),pn(e)?(this.chain={id:e,rpcUrl:ye(e)},yield this.storage.storeObject($e,this.chain),null):(yield this.sendMessageToPopup({chainId:this.chain.id,data:e,event:"SDK_SWITCH_CHAIN",origin:window.location.origin})).data.error??"Unsupported chain."})}sendTransaction(e){return a(this,null,function*(){return yield this.ensureInitialized(),(yield this.sendMessageToPopup({chainId:this.chain.id,data:e,event:"SDK_SEND_TRANSACTION",origin:window.location.origin})).data})}signData(t){return a(this,arguments,function*({message:e}){return yield this.ensureInitialized(),(yield this.sendMessageToPopup({chainId:this.chain.id,data:{message:e},event:"SDK_SIGN_DATA",origin:window.location.origin})).data})}signTypedData(s){return a(this,arguments,function*({message:e,types:t,primaryType:n,domain:r}){return yield this.ensureInitialized(),(yield this.sendMessageToPopup({chainId:this.chain.id,data:{domain:r,message:e,primaryType:n,types:t},event:"SDK_SIGN_TYPED_DATA",origin:window.location.origin})).data})}openSettings(){return a(this,null,function*(){yield this.ensureInitialized(),yield this.sendMessageToPopup({chainId:this.chain.id,data:{},event:"SDK_OPEN_SETTINGS",origin:window.location.origin})})}getCapabilities(e){let t={},n=e?.map(r=>parseInt(r,16))||[this.chain.id];for(let r of n){let s=Me(r);t[s]={atomic:{status:"supported"},paymasterService:{supported:!0}}}return t}sendCalls(e){return a(this,null,function*(){yield this.ensureInitialized();let t=window?.crypto?.randomUUID()||`batch-${Date.now()}-${Math.random()}`,n=parseInt(e.chainId,16);if(n!==this.chain.id)throw new Error(`Chain mismatch. Expected ${this.chain.id}, got ${n}`);if(!e.calls||e.calls.length===0)throw new Error("No calls provided");let r={calls:e.calls,capabilities:e.capabilities,chainId:e.chainId,from:e.from,id:t,status:"pending",timestamp:Date.now()},s=yield this.storage.loadObject(W,{});s[t]=r,yield this.storage.storeObject(W,s);try{let d=yield this.sendMessageToPopup({chainId:this.chain.id,data:{calls:e.calls},event:"SDK_SEND_BATCH_CALLS",origin:window.location.origin});if(d.data.error)throw new Error(d.data.error);return r.transactionHash=d.data.hash,r.status="pending",s[t]=r,yield this.storage.storeObject(W,s),{capabilities:{caip345:{caip2:`eip155:${n}`,transactionHashes:[d.data.hash]}},id:t}}catch(d){throw r.status="failed",s[t]=r,yield this.storage.storeObject(W,s),d}})}getCallsStatus(e){return a(this,null,function*(){yield this.ensureInitialized();let t=yield this.storage.loadObject(W,{}),n=t[e];if(!n)throw new Error(`Unknown bundle ID: ${e}`);if(n.transactionHash&&this.chain.rpcUrl)try{let f=(yield(yield fetch(this.chain.rpcUrl,{body:JSON.stringify({id:1,jsonrpc:"2.0",method:"eth_getTransactionReceipt",params:[n.transactionHash]}),headers:{"Content-Type":"application/json"},method:"POST"})).json()).result;if(f){let i=f.status==="0x1"?"confirmed":"reverted";return n.status=i,t[e]=n,yield this.storage.storeObject(W,t),{atomic:!0,chainId:n.chainId,id:e,receipts:[{blockHash:f.blockHash,blockNumber:f.blockNumber,gasUsed:f.gasUsed,logs:f.logs.map(u=>({address:u.address,data:u.data,topics:u.topics})),status:i==="confirmed"?"success":"reverted",transactionHash:f.transactionHash}],status:i==="confirmed"?200:500,version:"2.0.0"}}}catch(s){console.error("Failed to fetch transaction receipt:",s)}let r;switch(n.status){case"pending":r=100;break;case"confirmed":r=200;break;case"failed":r=400;break;case"reverted":r=500;break;default:r=100}return{atomic:!0,chainId:n.chainId,id:e,status:r,version:"2.0.0"}})}showCallsStatus(e){return a(this,null,function*(){if(yield this.ensureInitialized(),!(yield this.storage.loadObject(W,{}))[e])throw new Error(`Unknown bundle ID: ${e}`)})}sendMessageToPopup(e){return this.communicator.postRequestAndWaitForResponse(I(y({},e),{requestId:window?.crypto?.randomUUID()}))}},fn=(e,t)=>a(void 0,null,function*(){let n=I(y({},e),{id:window?.crypto?.randomUUID(),jsonrpc:"2.0"}),r=yield window.fetch(t,{body:JSON.stringify(n),headers:{"Content-Type":"application/json"},method:"POST",mode:"cors"}),{result:s,error:d}=yield r.json();if(d)throw d;return s});function gn(e){if(!e||typeof e!="object"||Array.isArray(e))throw E.invalidParams({message:"Expected a single, non-array, object argument."});let{method:t,params:n}=e;if(typeof t!="string"||t.length===0)throw E.invalidParams({message:"'args.method' must be a non-empty string."});if(n!==void 0&&!Array.isArray(n)&&(typeof n!="object"||n===null))throw E.invalidParams({message:"'args.params' must be an object or array if provided."})}function mn(e){let t=["value","gas","gasPrice","maxPriorityFeePerGas","maxFeePerGas"],n=y({},e);for(let r of t){if(!(r in e))continue;let s=e[r];typeof s!="bigint"&&He(s)&&(n[r]=BigInt(s))}return n}var Nt=class extends cn{constructor(e){super(),this.wallet=null,this.config=e;let t=e.onDisconnectCallback;this.wallet=new bt(I(y({},e),{onDisconnectCallback:()=>{t?.(),this.disconnect()}}))}request(e){return a(this,null,function*(){try{if(gn(e),!this.wallet?.accounts?.length)switch(e.method){case"eth_requestAccounts":{if(!this.wallet){let r=this.config.onDisconnectCallback;this.wallet=new bt(I(y({},this.config),{onDisconnectCallback:()=>{r?.(),this.disconnect()}}))}yield this.wallet.connect(),this.emit("accountsChanged",this.wallet.accounts);break}case"net_version":return oe;case"eth_chainId":return Me(oe);default:throw q.unauthorized()}let t,n;switch(e.method){case"eth_requestAccounts":case"eth_accounts":t=this.wallet.accounts;break;case"net_version":t=this.wallet.chain.id;break;case"eth_chainId":t=Me(this.wallet.chain.id);break;case"personal_sign":case"wallet_sign":if(n=e.params,t=yield this.wallet.signData({account:n[1],message:n[0]}),t.error)throw E.transactionRejected(t.error);t=t.hash;break;case"eth_sendTransaction":case"wallet_sendTransaction":if(n=e.params,n=mn(n[0]),t=yield this.wallet.sendTransaction(n),t.error)throw E.transactionRejected(t.error);t=t.hash;break;case"wallet_switchEthereumChain":{let r=e.params,s;if(Array.isArray(r)&&r[0]?.chainId)s=parseInt(r[0].chainId,16);else if(r&&typeof r=="object"&&"id"in r&&Number.isInteger(r.id))s=r.id;else throw E.invalidParams("Invalid chain id argument. Expected [{ chainId: hex_string }] or { id: number }.");if(t=yield this.wallet.switchChain({id:s}),t)throw q.custom({code:4902,message:t});yield this.emit("chainChanged",Me(s));break}case"eth_signTypedData_v1":case"eth_signTypedData_v2":case"eth_signTypedData_v3":case"eth_signTypedData_v4":case"eth_signTypedData":{n=e.params;let r=JSON.parse(n[1]);if(t=yield this.wallet.signTypedData({account:n[0],domain:r.domain,message:r.message,primaryType:r.primaryType,types:r.types}),t.error)throw E.transactionRejected(t.error);t=t.hash;break}case"wallet_getCapabilities":{let r=Array.isArray(e.params)?e.params:void 0;t=this.getCapabilities(r);break}case"wallet_sendCalls":{n=e.params,t=yield this.sendCalls(n[0]);break}case"wallet_getCallsStatus":{n=e.params,t=yield this.getCallsStatus(n[0]);break}case"wallet_showCallsStatus":{n=e.params,yield this.showCallsStatus(n[0]),t=null;break}case"eth_ecRecover":case"eth_subscribe":case"eth_unsubscribe":case"personal_ecRecover":case"eth_signTransaction":case"wallet_watchAsset":case"wallet_grantPermissions":throw E.methodNotSupported("Not yet implemented.");case"eth_sign":case"eth_coinbase":case"wallet_addEthereumChain":throw E.methodNotSupported();default:if(!this.wallet.chain.rpcUrl)throw E.internal(`RPC URL missing for current chain (${this.wallet.chain.id})`);return fn(e,this.wallet.chain.rpcUrl)}return t}catch(t){let{code:n}=t;return n===S.provider.unauthorized&&this.disconnect(),Promise.reject(qe(t))}})}openSettings(){return a(this,null,function*(){yield this.wallet?.openSettings()})}getCapabilities(e){if(!this.wallet)throw q.unauthorized();let t=e?.[0];return this.wallet.getCapabilities(t)}sendCalls(e){return a(this,null,function*(){if(!this.wallet)throw q.unauthorized();try{return yield this.wallet.sendCalls(e)}catch(t){throw E.transactionRejected(t instanceof Error?t.message:String(t))}})}getCallsStatus(e){return a(this,null,function*(){if(!this.wallet)throw q.unauthorized();try{return yield this.wallet.getCallsStatus(e)}catch(t){throw E.invalidParams(t instanceof Error?t.message:String(t))}})}showCallsStatus(e){return a(this,null,function*(){if(!this.wallet)throw q.unauthorized();try{yield this.wallet.showCallsStatus(e)}catch(t){throw E.invalidParams(t instanceof Error?t.message:String(t))}})}disconnect(){return a(this,null,function*(){if(this.wallet){let e=this.config.storage||new Dt;yield e.removeItem(Ie),yield e.removeItem($e)}this.wallet=null,this.config.onDisconnectCallback?.(),yield this.emit("disconnect","User initiated disconnection"),yield this.emit("accountsChanged",[])})}};We.type="gemini";function We(e={}){let t,n,r,s;return d=>({id:"gemini",name:"Gemini Wallet",type:We.type,icon:"https://keys.gemini.com/images/gemini-wallet-logo.svg",connect(){return a(this,arguments,function*({chainId:i,withCapabilities:u}={}){try{let c=yield this.getProvider(),h=yield c.request({method:"eth_requestAccounts"});n||(n=this.onAccountsChanged.bind(this),c.on("accountsChanged",n)),r||(r=this.onChainChanged.bind(this),c.on("chainChanged",r)),s||(s=this.onDisconnect.bind(this),c.on("disconnect",s));let o=yield this.getChainId();return i&&o!==i&&(o=(yield this.switchChain({chainId:i}).catch(l=>{if(l.code===N.code)throw l;return{id:o}}))?.id??o),{accounts:u?h.map(g=>({address:g,capabilities:{}})):h,chainId:o}}catch(c){throw/(user closed modal|accounts received is empty|user denied account|request rejected)/i.test(c.message)?new N(c):c}})},disconnect(){return a(this,null,function*(){let i=yield this.getProvider();n&&(i.removeListener("accountsChanged",n),n=void 0),r&&(i.removeListener("chainChanged",r),r=void 0),s&&(i.removeListener("disconnect",s),s=void 0),yield i.disconnect()})},getAccounts(){return a(this,null,function*(){return(yield(yield this.getProvider()).request({method:"eth_accounts"})).map(c=>A(c))})},getChainId(){return a(this,null,function*(){let u=yield(yield this.getProvider()).request({method:"eth_chainId"});return Number(u)})},getProvider(){return a(this,null,function*(){return t||(t=new Nt({appMetadata:e.appMetadata??{},chain:{id:d.chains[0]?.id??1,rpcUrl:d.chains[0]?.rpcUrls?.default?.http[0]}})),t})},isAuthorized(){return a(this,null,function*(){try{return!!(yield this.getAccounts()).length}catch{return!1}})},switchChain(u){return a(this,arguments,function*({chainId:i}){let c=d.chains.find(o=>o.id===i);if(!c)throw new x(new T);let h=yield this.getProvider();try{return yield h.request({method:"wallet_switchEthereumChain",params:[{chainId:j(i)}]}),c}catch(o){throw new x(o)}})},onAccountsChanged(i){i.length===0?this.onDisconnect():d.emitter.emit("change",{accounts:i.map(u=>A(u))})},onChainChanged(i){let u=Number(i);d.emitter.emit("change",{chainId:u})},onDisconnect(){return a(this,null,function*(){d.emitter.emit("disconnect");let i=yield this.getProvider();n&&(i.removeListener("accountsChanged",n),n=void 0),r&&(i.removeListener("chainChanged",r),r=void 0),s&&(i.removeListener("disconnect",s),s=void 0)})}})}Fe.type="metaMask";function Fe(e={}){let t,n,r,s,d,f,i,u;return c=>({id:"metaMaskSDK",name:"MetaMask",rdns:["io.metamask","io.metamask.mobile"],type:Fe.type,setup(){return a(this,null,function*(){let o=yield this.getProvider();o?.on&&(f||(f=this.onConnect.bind(this),o.on("connect",f)),s||(s=this.onAccountsChanged.bind(this),o.on("accountsChanged",s)))})},connect(){return a(this,arguments,function*({chainId:o,isReconnecting:g,withCapabilities:l}={}){let p=yield this.getProvider();i||(i=this.onDisplayUri,p.on("display_uri",i));let m=[];g&&(m=yield this.getAccounts().catch(()=>[]));try{let M,b;m?.length||(e.connectAndSign||e.connectWith?(e.connectAndSign?M=yield t.connectAndSign({msg:e.connectAndSign}):e.connectWith&&(b=yield t.connectWith({method:e.connectWith.method,params:e.connectWith.params})),m=yield this.getAccounts()):m=(yield t.connect()).map(D=>A(D)));let w=yield this.getChainId();return o&&w!==o&&(w=(yield this.switchChain({chainId:o}).catch(D=>{if(D.code===N.code)throw D;return{id:w}}))?.id??w),i&&(p.removeListener("display_uri",i),i=void 0),M?p.emit("connectAndSign",{accounts:m,chainId:w,signResponse:M}):b&&p.emit("connectWith",{accounts:m,chainId:w,connectWithResponse:b}),f&&(p.removeListener("connect",f),f=void 0),s||(s=this.onAccountsChanged.bind(this),p.on("accountsChanged",s)),d||(d=this.onChainChanged.bind(this),p.on("chainChanged",d)),u||(u=this.onDisconnect.bind(this),p.on("disconnect",u)),{accounts:l?m.map(C=>({address:C,capabilities:{}})):m,chainId:w}}catch(M){let b=M;throw b.code===N.code?new N(b):b.code===be.code?new be(b):b}})},disconnect(){return a(this,null,function*(){let o=yield this.getProvider();d&&(o.removeListener("chainChanged",d),d=void 0),u&&(o.removeListener("disconnect",u),u=void 0),f||(f=this.onConnect.bind(this),o.on("connect",f)),yield t.terminate()})},getAccounts(){return a(this,null,function*(){return(yield(yield this.getProvider()).request({method:"eth_accounts"})).map(l=>A(l))})},getChainId(){return a(this,null,function*(){let o=yield this.getProvider(),g=o.getChainId()||(yield o?.request({method:"eth_chainId"}));return Number(g)})},getProvider(){return a(this,null,function*(){function o(){return a(this,null,function*(){let g=yield a(this,null,function*(){let{default:M}=yield import("./chunk-ZDXJLWW7.js");return typeof M!="function"&&typeof M.default=="function"?M.default:M}),l={};for(let M of c.chains)l[j(M.id)]=de({chain:M,transports:c.transports})?.[0];t=new g(I(y({_source:"wagmi",forceDeleteProvider:!1,forceInjectProvider:!1,injectProvider:!1},e),{readonlyRPCMap:l,dappMetadata:I(y({},e.dappMetadata),{name:e.dappMetadata?.name?e.dappMetadata?.name:"wagmi",url:e.dappMetadata?.url?e.dappMetadata?.url:typeof window<"u"?window.location.origin:"https://wagmi.sh"}),useDeeplink:e.useDeeplink??!0}));let p=yield t.init(),m=p?.activeProvider?p.activeProvider:t.getProvider();if(!m)throw new Y;return m})}return n||(r||(r=o()),n=yield r),n})},isAuthorized(){return a(this,null,function*(){try{return!!(yield H(()=>ce(()=>this.getAccounts(),{timeout:200}),{delay:201,retryCount:3})).length}catch{return!1}})},switchChain(l){return a(this,arguments,function*({addEthereumChainParameter:o,chainId:g}){let p=yield this.getProvider(),m=c.chains.find(w=>w.id===g);if(!m)throw new x(new T);try{return yield p.request({method:"wallet_switchEthereumChain",params:[{chainId:j(g)}]}),yield M(),yield b(g),m}catch(w){let C=w;if(C.code===N.code)throw new N(C);if(C.code===4902||C?.data?.originalError?.code===4902)try{return yield p.request({method:"wallet_addEthereumChain",params:[{blockExplorerUrls:(()=>{let L=m.blockExplorers??{},{default:D}=L,O=k(L,["default"]);if(o?.blockExplorerUrls)return o.blockExplorerUrls;if(D)return[D.url,...Object.values(O).map(z=>z.url)]})(),chainId:j(g),chainName:o?.chainName??m.name,iconUrls:o?.iconUrls,nativeCurrency:o?.nativeCurrency??m.nativeCurrency,rpcUrls:o?.rpcUrls?.length?o.rpcUrls:[m.rpcUrls.default?.http[0]??""]}]}),yield M(),yield b(g),m}catch(D){let O=D;throw O.code===N.code?new N(O):new x(O)}throw new x(C)}function M(){return a(this,null,function*(){yield H(()=>a(this,null,function*(){let w=Ge(yield p.request({method:"eth_chainId"}));if(w!==g)throw new Error("User rejected switch after adding network.");return w}),{delay:50,retryCount:20})})}function b(w){return a(this,null,function*(){yield new Promise(C=>{let D=O=>{"chainId"in O&&O.chainId===w&&(c.emitter.off("change",D),C())};c.emitter.on("change",D),c.emitter.emit("change",{chainId:w})})})}})},onAccountsChanged(o){return a(this,null,function*(){if(o.length===0)if(t.isExtensionActive())this.onDisconnect();else return;else if(c.emitter.listenerCount("connect")){let g=(yield this.getChainId()).toString();this.onConnect({chainId:g})}else c.emitter.emit("change",{accounts:o.map(g=>A(g))})})},onChainChanged(o){let g=Number(o);c.emitter.emit("change",{chainId:g})},onConnect(o){return a(this,null,function*(){let g=yield this.getAccounts();if(g.length===0)return;let l=Number(o.chainId);c.emitter.emit("connect",{accounts:g,chainId:l});let p=yield this.getProvider();f&&(p.removeListener("connect",f),f=void 0),s||(s=this.onAccountsChanged.bind(this),p.on("accountsChanged",s)),d||(d=this.onChainChanged.bind(this),p.on("chainChanged",d)),u||(u=this.onDisconnect.bind(this),p.on("disconnect",u))})},onDisconnect(o){return a(this,null,function*(){let g=yield this.getProvider();o&&o.code===1013&&g&&(yield this.getAccounts()).length||(c.emitter.emit("disconnect"),d&&(g.removeListener("chainChanged",d),d=void 0),u&&(g.removeListener("disconnect",u),u=void 0),f||(f=this.onConnect.bind(this),g.on("connect",f)))})},onDisplayUri(o){c.emitter.emit("message",{type:"display_uri",data:o})}})}function wn(e={}){return t=>{let n=t.chains??e.chains??[],r=t.transports?t.transports:e.transports,s,d,f,i,u;return{connect(){return a(this,arguments,function*(g={}){var l=g,{chainId:h=n[0].id}=l,o=k(l,["chainId"]);let p="isReconnecting"in o&&o.isReconnecting||!1,m="withCapabilities"in o&&o.withCapabilities||!1,M=[],b;p&&([M,b]=yield Promise.all([this.getAccounts().catch(()=>[]),this.getChainId().catch(()=>{})]),h&&b!==h&&(b=(yield this.switchChain({chainId:h}).catch(D=>{if(D.code===N.code)throw D;return{id:b}}))?.id??b));let w=yield this.getProvider();try{if(!M?.length&&!p){let C=yield w.request({method:"wallet_connect",params:[I(y({},"capabilities"in o?{capabilities:Te.encode(Ze.wallet_connect.Capabilities,o.capabilities??{})}:{}),{chainIds:[j(h),...n.filter(D=>D.id!==h).map(D=>j(D.id))]})]});M=C.accounts,b=Number(C.chainIds[0])}if(!b)throw new T;return i&&(w.removeListener("connect",i),i=void 0),d||(d=this.onAccountsChanged.bind(this),w.on("accountsChanged",d)),f||(f=this.onChainChanged.bind(this),w.on("chainChanged",f)),u||(u=this.onDisconnect.bind(this),w.on("disconnect",u)),{accounts:M.map(C=>typeof C=="object"?m?C:C.address:m?{address:C,capabilities:{}}:C),chainId:b}}catch(C){let D=C;throw D.code===N.code?new N(D):D}})},disconnect(){return a(this,null,function*(){let h=yield this.getProvider();f&&(h.removeListener("chainChanged",f),f=void 0),u&&(h.removeListener("disconnect",u),u=void 0),i||(i=this.onConnect.bind(this),h.on("connect",i)),yield h.request({method:"wallet_disconnect"})})},getAccounts(){return a(this,null,function*(){return(yield(yield this.getProvider()).request({method:"eth_accounts"})).map(g=>A(g))})},getChainId(){return a(this,null,function*(){let o=yield(yield this.getProvider()).request({method:"eth_chainId"});return Number(o)})},getPortoInstance(){return a(this,null,function*(){return s??=a(this,null,function*(){let{Porto:h}=yield import("./chunk-SUKUICUS.js");return h.create(I(y({},e),{announceProvider:!1,chains:n,transports:r}))}),yield s})},getProvider(){return a(this,null,function*(){return(yield this.getPortoInstance()).provider})},icon:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDIyIiBoZWlnaHQ9IjQyMiIgdmlld0JveD0iMCAwIDQyMiA0MjIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSI0MjIiIGhlaWdodD0iNDIyIiBmaWxsPSJibGFjayIvPgo8ZyBjbGlwLXBhdGg9InVybCgjY2xpcDBfMV8xNSkiPgo8cGF0aCBkPSJNODEgMjg2LjM2NkM4MSAyODAuODkzIDg1LjQ1MDUgMjc2LjQ1NSA5MC45NDA0IDI3Ni40NTVIMzI5LjUxMUMzMzUuMDAxIDI3Ni40NTUgMzM5LjQ1MiAyODAuODkzIDMzOS40NTIgMjg2LjM2NlYzMDYuMTg4QzMzOS40NTIgMzExLjY2MiAzMzUuMDAxIDMxNi4wOTkgMzI5LjUxMSAzMTYuMDk5SDkwLjk0MDRDODUuNDUwNSAzMTYuMDk5IDgxIDMxMS42NjIgODEgMzA2LjE4OFYyODYuMzY2WiIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC41Ii8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNOTAuOTQwNCAyMzQuODI4Qzg1LjQ1MDUgMjM0LjgyOCA4MSAyMzkuMjY2IDgxIDI0NC43MzlWMjcxLjUzMUM4My44NDMyIDI2OS42MzMgODcuMjYyMiAyNjguNTI2IDkwLjk0MDQgMjY4LjUyNkgzMjkuNTExQzMzMy4xODggMjY4LjUyNiAzMzYuNjA4IDI2OS42MzMgMzM5LjQ1MiAyNzEuNTMxVjI0NC43MzlDMzM5LjQ1MiAyMzkuMjY2IDMzNS4wMDEgMjM0LjgyOCAzMjkuNTExIDIzNC44MjhIOTAuOTQwNFpNMzM5LjQ1MiAyODYuMzY2QzMzOS40NTIgMjgwLjg5MyAzMzUuMDAxIDI3Ni40NTUgMzI5LjUxMSAyNzYuNDU1SDkwLjk0MDRDODUuNDUwNSAyNzYuNDU1IDgxIDI4MC44OTMgODEgMjg2LjM2NlYzMDYuMTlDODEgMzExLjY2NCA4NS40NTA1IDMxNi4xMDEgOTAuOTQwNCAzMTYuMTAxSDMyOS41MTFDMzM1LjAwMSAzMTYuMTAxIDMzOS40NTIgMzExLjY2NCAzMzkuNDUyIDMwNi4xOVYyODYuMzY2WiIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC41Ii8+CjxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNOTAuOTQwNCAxOTMuMjAxQzg1LjQ1MDUgMTkzLjIwMSA4MSAxOTcuNjM4IDgxIDIwMy4xMTJWMjI5LjkwM0M4My44NDMyIDIyOC4wMDYgODcuMjYyMiAyMjYuODk5IDkwLjk0MDQgMjI2Ljg5OUgzMjkuNTExQzMzMy4xODggMjI2Ljg5OSAzMzYuNjA4IDIyOC4wMDYgMzM5LjQ1MiAyMjkuOTAzVjIwMy4xMTJDMzM5LjQ1MiAxOTcuNjM4IDMzNS4wMDEgMTkzLjIwMSAzMjkuNTExIDE5My4yMDFIOTAuOTQwNFpNMzM5LjQ1MiAyNDQuNzM5QzMzOS40NTIgMjM5LjI2NSAzMzUuMDAxIDIzNC44MjggMzI5LjUxMSAyMzQuODI4SDkwLjk0MDRDODUuNDUwNSAyMzQuODI4IDgxIDIzOS4yNjUgODEgMjQ0LjczOVYyNzEuNTNDODEuMjE3NSAyNzEuMzg1IDgxLjQzODMgMjcxLjI0NSA4MS42NjI0IDI3MS4xMDlDODMuODMyNSAyNjkuNzk0IDg2LjMwNTQgMjY4LjkyNyA4OC45NTIzIDI2OC42MzVDODkuNjA1MSAyNjguNTYzIDkwLjI2ODQgMjY4LjUyNiA5MC45NDA0IDI2OC41MjZIMzI5LjUxMUMzMzAuMTgzIDI2OC41MjYgMzMwLjg0NiAyNjguNTYzIDMzMS40OTggMjY4LjYzNUMzMzQuNDE5IDI2OC45NTcgMzM3LjEyOCAyNjkuOTggMzM5LjQ1MiAyNzEuNTNWMjQ0LjczOVpNMzM5LjQ1MiAyODYuMzY2QzMzOS40NTIgMjgxLjAyMSAzMzUuMjA2IDI3Ni42NjMgMzI5Ljg5MyAyNzYuNDYyQzMyOS43NjcgMjc2LjQ1NyAzMjkuNjQgMjc2LjQ1NSAzMjkuNTExIDI3Ni40NTVIOTAuOTQwNEM4NS40NTA1IDI3Ni40NTUgODEgMjgwLjg5MyA4MSAyODYuMzY2VjMwNi4xODhDODEgMzExLjY2MiA4NS40NTA1IDMxNi4xMDEgOTAuOTQwNCAzMTYuMTAxSDMyOS41MTFDMzM1LjAwMSAzMTYuMTAxIDMzOS40NTIgMzExLjY2MiAzMzkuNDUyIDMwNi4xODhWMjg2LjM2NloiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuNSIvPgo8cGF0aCBvcGFjaXR5PSIwLjMiIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNOTguMDE0NiAxMDRDODguNjE3NyAxMDQgODEgMTExLjU5NSA4MSAxMjAuOTY1VjE4OC4yNzZDODMuODQzMiAxODYuMzc5IDg3LjI2MjIgMTg1LjI3MiA5MC45NDA0IDE4NS4yNzJIMzI5LjUxMUMzMzMuMTg4IDE4NS4yNzIgMzM2LjYwOCAxODYuMzc5IDMzOS40NTIgMTg4LjI3NlYxMjAuOTY1QzMzOS40NTIgMTExLjU5NSAzMzEuODMzIDEwNCAzMjIuNDM3IDEwNEg5OC4wMTQ2Wk0zMzkuNDUyIDIwMy4xMTJDMzM5LjQ1MiAxOTcuNjM4IDMzNS4wMDEgMTkzLjIwMSAzMjkuNTExIDE5My4yMDFIOTAuOTQwNEM4NS40NTA1IDE5My4yMDEgODEgMTk3LjYzOCA4MSAyMDMuMTEyVjIyOS45MDNDODEuMjE3NSAyMjkuNzU4IDgxLjQzODMgMjI5LjYxOCA4MS42NjI0IDIyOS40ODJDODMuODMyNSAyMjguMTY3IDg2LjMwNTQgMjI3LjMgODguOTUyMyAyMjcuMDA4Qzg5LjYwNTEgMjI2LjkzNiA5MC4yNjg0IDIyNi44OTkgOTAuOTQwNCAyMjYuODk5SDMyOS41MTFDMzMwLjE4MyAyMjYuODk5IDMzMC44NDYgMjI2LjkzNiAzMzEuNDk4IDIyNy4wMDhDMzM0LjQxOSAyMjcuMzMgMzM3LjEyOCAyMjguMzUyIDMzOS40NTIgMjI5LjkwM1YyMDMuMTEyWk0zMzkuNDUyIDI0NC43MzlDMzM5LjQ1MiAyMzkuMzkzIDMzNS4yMDYgMjM1LjAzNiAzMjkuODkzIDIzNC44MzVDMzI5Ljc2NyAyMzQuODMgMzI5LjY0IDIzNC44MjggMzI5LjUxMSAyMzQuODI4SDkwLjk0MDRDODUuNDUwNSAyMzQuODI4IDgxIDIzOS4yNjUgODEgMjQ0LjczOVYyNzEuNTNMODEuMDcwNyAyNzEuNDgzQzgxLjI2NTMgMjcxLjM1NSA4MS40NjI1IDI3MS4yMyA4MS42NjI0IDI3MS4xMDlDODEuOTA4MyAyNzAuOTYgODIuMTU4MSAyNzAuODE3IDgyLjQxMTcgMjcwLjY3OUM4NC4zOTUzIDI2OS42MDUgODYuNjA1NCAyNjguODk0IDg4Ljk1MjMgMjY4LjYzNUM4OS4wMDUyIDI2OC42MjkgODkuMDU4IDI2OC42MjQgODkuMTExIDI2OC42MThDODkuNzEyNSAyNjguNTU3IDkwLjMyMjggMjY4LjUyNiA5MC45NDA0IDI2OC41MjZIMzI5LjUxMUMzMjkuNzM4IDI2OC41MjYgMzI5Ljk2NSAyNjguNTMgMzMwLjE5MiAyNjguNTM5QzMzMC42MzEgMjY4LjU1NSAzMzEuMDY3IDI2OC41ODcgMzMxLjQ5OCAyNjguNjM1QzMzNC40MTkgMjY4Ljk1NyAzMzcuMTI4IDI2OS45OCAzMzkuNDUyIDI3MS41M1YyNDQuNzM5Wk0zMzkuNDUyIDI4Ni4zNjZDMzM5LjQ1MiAyODEuMDIxIDMzNS4yMDYgMjc2LjY2MyAzMjkuODkzIDI3Ni40NjJMMzI5Ljg2NSAyNzYuNDYxQzMyOS43NDggMjc2LjQ1NyAzMjkuNjI5IDI3Ni40NTUgMzI5LjUxMSAyNzYuNDU1SDkwLjk0MDRDODUuNDUwNSAyNzYuNDU1IDgxIDI4MC44OTMgODEgMjg2LjM2NlYzMDYuMTg4QzgxIDMxMS42NjIgODUuNDUwNSAzMTYuMTAxIDkwLjk0MDQgMzE2LjEwMUgzMjkuNTExQzMzNS4wMDEgMzE2LjEwMSAzMzkuNDUyIDMxMS42NjIgMzM5LjQ1MiAzMDYuMTg4VjI4Ni4zNjZaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBkPSJNMjY5Ljg2OCAxMzEuNzUyQzI2OS44NjggMTI2LjI3OCAyNzQuMzE4IDEyMS44NCAyNzkuODA4IDEyMS44NEgzMTEuNjE4QzMxNy4xMDggMTIxLjg0IDMyMS41NTggMTI2LjI3OCAzMjEuNTU4IDEzMS43NTJWMTYxLjQ4NUMzMjEuNTU4IDE2Ni45NTkgMzE3LjEwOCAxNzEuMzk2IDMxMS42MTggMTcxLjM5NkgyNzkuODA4QzI3NC4zMTggMTcxLjM5NiAyNjkuODY4IDE2Ni45NTkgMjY5Ljg2OCAxNjEuNDg1VjEzMS43NTJaIiBmaWxsPSJ3aGl0ZSIvPgo8L2c+CjxkZWZzPgo8Y2xpcFBhdGggaWQ9ImNsaXAwXzFfMTUiPgo8cmVjdCB3aWR0aD0iMjU5IiBoZWlnaHQ9IjIxMyIgZmlsbD0id2hpdGUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDgxIDEwNCkiLz4KPC9jbGlwUGF0aD4KPC9kZWZzPgo8L3N2Zz4K",id:"xyz.ithaca.porto",isAuthorized(){return a(this,null,function*(){try{return!!(yield H(()=>this.getAccounts())).length}catch{return!1}})},name:"Porto",onAccountsChanged(h){return a(this,null,function*(){t.emitter.emit("change",{accounts:h.map(o=>A(o))})})},onChainChanged(h){let o=Number(h);t.emitter.emit("change",{chainId:o})},onConnect(h){return a(this,null,function*(){let o=yield this.getAccounts();if(o.length===0)return;let g=Number(h.chainId);t.emitter.emit("connect",{accounts:o,chainId:g});let l=yield this.getProvider();l&&(i&&(l.removeListener("connect",i),i=void 0),d||(d=this.onAccountsChanged.bind(this),l.on("accountsChanged",d)),f||(f=this.onChainChanged.bind(this),l.on("chainChanged",f)),u||(u=this.onDisconnect.bind(this),l.on("disconnect",u)))})},onDisconnect(h){return a(this,null,function*(){let o=yield this.getProvider();t.emitter.emit("disconnect"),o&&(f&&(o.removeListener("chainChanged",f),f=void 0),u&&(o.removeListener("disconnect",u),u=void 0),i||(i=this.onConnect.bind(this),o.on("connect",i)))})},setup(){return a(this,null,function*(){if(!i){let h=yield this.getProvider();i=this.onConnect.bind(this),h.on("connect",i)}})},switchChain(o){return a(this,arguments,function*({chainId:h}){let g=n.find(p=>p.id===h);if(!g)throw new x(new T);return yield(yield this.getProvider()).request({method:"wallet_switchEthereumChain",params:[{chainId:j(h)}]}),g})},type:"injected"}}}Je.type="safe";function Je(e={}){let{shimDisconnect:t=!1}=e,n,r;return s=>({id:"safe",name:"Safe",type:Je.type,connect(){return a(this,arguments,function*({withCapabilities:f}={}){let i=yield this.getProvider();if(!i)throw new Y;let u=yield this.getAccounts(),c=yield this.getChainId();return r||(r=this.onDisconnect.bind(this),i.on("disconnect",r)),t&&(yield s.storage?.removeItem("safe.disconnected")),{accounts:f?u.map(h=>({address:h,capabilities:{}})):u,chainId:c}})},disconnect(){return a(this,null,function*(){let f=yield this.getProvider();if(!f)throw new Y;r&&(f.removeListener("disconnect",r),r=void 0),t&&(yield s.storage?.setItem("safe.disconnected",!0))})},getAccounts(){return a(this,null,function*(){let f=yield this.getProvider();if(!f)throw new Y;return(yield f.request({method:"eth_accounts"})).map(A)})},getProvider(){return a(this,null,function*(){if(typeof window<"u"&&window?.parent!==window){if(!n){let{default:i}=yield import("./chunk-CYOXAQVM.js"),u=new i(e),c=yield ce(()=>u.safe.getInfo(),{timeout:e.unstable_getInfoTimeout??10});if(!c)throw new Error("Could not load Safe information");let h=yield a(this,null,function*(){let o=yield import("./chunk-PGOLRDLN.js");return typeof o.SafeAppProvider!="function"&&typeof o.default.SafeAppProvider=="function"?o.default.SafeAppProvider:o.SafeAppProvider});n=new h(c,u)}return n}})},getChainId(){return a(this,null,function*(){let f=yield this.getProvider();if(!f)throw new Y;return Number(f.chainId)})},isAuthorized(){return a(this,null,function*(){try{return t&&(yield s.storage?.getItem("safe.disconnected"))?!1:!!(yield this.getAccounts()).length}catch{return!1}})},onAccountsChanged(){},onChainChanged(){},onDisconnect(){s.emitter.emit("disconnect")}})}var yn="6.1.4";Be.type="walletConnect";function Be(e){let t=e.isNewChainsStale??!0,n,r,s="eip155",d,f,i,u,c,h;return o=>({id:"walletConnect",name:"WalletConnect",type:Be.type,setup(){return a(this,null,function*(){let l=yield this.getProvider().catch(()=>null);l&&(i||(i=this.onConnect.bind(this),l.on("connect",i)),c||(c=this.onSessionDelete.bind(this),l.on("session_delete",c)))})},connect(){return a(this,arguments,function*(M={}){var b=M,{chainId:l,withCapabilities:p}=b,m=k(b,["chainId","withCapabilities"]);try{let w=yield this.getProvider();if(!w)throw new Y;u||(u=this.onDisplayUri,w.on("display_uri",u));let C=l;if(!C){let z=(yield o.storage?.getItem("state"))??{};o.chains.some(At=>At.id===z.chainId)?C=z.chainId:C=o.chains[0]?.id}if(!C)throw new Error("No chains found on connector.");let D=yield this.isChainsStale();if(w.session&&D&&(yield w.disconnect()),!w.session||D){let z=o.chains.filter(R=>R.id!==C).map(R=>R.id);yield w.connect(y({optionalChains:[C,...z]},"pairingTopic"in m?{pairingTopic:m.pairingTopic}:{})),this.setRequestedChainsIds(o.chains.map(R=>R.id))}let O=(yield w.enable()).map(z=>A(z)),L=yield this.getChainId();return l&&L!==l&&(L=(yield this.switchChain({chainId:l}).catch(R=>{if(R.code===N.code&&R.cause?.message!=="Missing or invalid. request() method: wallet_addEthereumChain")throw R;return{id:L}}))?.id??L),u&&(w.removeListener("display_uri",u),u=void 0),i&&(w.removeListener("connect",i),i=void 0),d||(d=this.onAccountsChanged.bind(this),w.on("accountsChanged",d)),f||(f=this.onChainChanged.bind(this),w.on("chainChanged",f)),h||(h=this.onDisconnect.bind(this),w.on("disconnect",h)),c||(c=this.onSessionDelete.bind(this),w.on("session_delete",c)),{accounts:p?O.map(z=>({address:z,capabilities:{}})):O,chainId:L}}catch(w){throw/(user rejected|connection request reset)/i.test(w?.message)?new N(w):w}})},disconnect(){return a(this,null,function*(){let l=yield this.getProvider();try{yield l?.disconnect()}catch(p){if(!/No matching key/i.test(p.message))throw p}finally{f&&(l?.removeListener("chainChanged",f),f=void 0),h&&(l?.removeListener("disconnect",h),h=void 0),i||(i=this.onConnect.bind(this),l?.on("connect",i)),d&&(l?.removeListener("accountsChanged",d),d=void 0),c&&(l?.removeListener("session_delete",c),c=void 0),this.setRequestedChainsIds([])}})},getAccounts(){return a(this,null,function*(){return(yield this.getProvider()).accounts.map(p=>A(p))})},getProvider(){return a(this,arguments,function*({chainId:l}={}){function p(){return a(this,null,function*(){let m=o.chains.map(b=>b.id);if(!m.length)return;let{EthereumProvider:M}=yield import("./chunk-MYPIYVWU.js");return yield M.init(I(y({},e),{disableProviderPing:!0,optionalChains:m,projectId:e.projectId,rpcMap:Object.fromEntries(o.chains.map(b=>{let[w]=de({chain:b,transports:o.transports});return[b.id,w]})),showQrModal:e.showQrModal??!0}))})}return n||(r||(r=p()),n=yield r,n?.events.setMaxListeners(Number.POSITIVE_INFINITY)),l&&(yield this.switchChain?.({chainId:l})),n})},getChainId(){return a(this,null,function*(){return(yield this.getProvider()).chainId})},isAuthorized(){return a(this,null,function*(){try{let[l,p]=yield Promise.all([this.getAccounts(),this.getProvider()]);return l.length?(yield this.isChainsStale())&&p.session?(yield p.disconnect().catch(()=>{}),!1):!0:!1}catch{return!1}})},switchChain(m){return a(this,arguments,function*({addEthereumChainParameter:l,chainId:p}){let M=yield this.getProvider();if(!M)throw new Y;let b=o.chains.find(w=>w.id===p);if(!b)throw new x(new T);try{yield Promise.all([new Promise(C=>{let D=({chainId:O})=>{O===p&&(o.emitter.off("change",D),C())};o.emitter.on("change",D)}),M.request({method:"wallet_switchEthereumChain",params:[{chainId:j(p)}]})]);let w=yield this.getRequestedChainsIds();return this.setRequestedChainsIds([...w,p]),b}catch(w){let C=w;if(/(user rejected)/i.test(C.message))throw new N(C);try{let D;l?.blockExplorerUrls?D=l.blockExplorerUrls:D=b.blockExplorers?.default.url?[b.blockExplorers?.default.url]:[];let O;l?.rpcUrls?.length?O=l.rpcUrls:O=[...b.rpcUrls.default.http];let L={blockExplorerUrls:D,chainId:j(p),chainName:l?.chainName??b.name,iconUrls:l?.iconUrls,nativeCurrency:l?.nativeCurrency??b.nativeCurrency,rpcUrls:O};yield M.request({method:"wallet_addEthereumChain",params:[L]});let z=yield this.getRequestedChainsIds();return this.setRequestedChainsIds([...z,p]),b}catch(D){throw new N(D)}}})},onAccountsChanged(l){l.length===0?this.onDisconnect():o.emitter.emit("change",{accounts:l.map(p=>A(p))})},onChainChanged(l){let p=Number(l);o.emitter.emit("change",{chainId:p})},onConnect(l){return a(this,null,function*(){let p=Number(l.chainId),m=yield this.getAccounts();o.emitter.emit("connect",{accounts:m,chainId:p})})},onDisconnect(l){return a(this,null,function*(){this.setRequestedChainsIds([]),o.emitter.emit("disconnect");let p=yield this.getProvider();d&&(p.removeListener("accountsChanged",d),d=void 0),f&&(p.removeListener("chainChanged",f),f=void 0),h&&(p.removeListener("disconnect",h),h=void 0),c&&(p.removeListener("session_delete",c),c=void 0),i||(i=this.onConnect.bind(this),p.on("connect",i))})},onDisplayUri(l){o.emitter.emit("message",{type:"display_uri",data:l})},onSessionDelete(){this.onDisconnect()},getNamespaceChainsIds(){return n?n.session?.namespaces[s]?.accounts?.map(p=>Number.parseInt(p.split(":")[1]||"",10))??[]:[]},getRequestedChainsIds(){return a(this,null,function*(){return(yield o.storage?.getItem(this.requestedChainsStorageKey))??[]})},isChainsStale(){return a(this,null,function*(){if(!t)return!1;let l=o.chains.map(M=>M.id),p=this.getNamespaceChainsIds();if(p.length&&!p.some(M=>l.includes(M)))return!1;let m=yield this.getRequestedChainsIds();return!l.every(M=>m.includes(M))})},setRequestedChainsIds(l){return a(this,null,function*(){yield o.storage?.setItem(this.requestedChainsStorageKey,l)})},get requestedChainsStorageKey(){return`${this.id}.requestedChains`}})}export{Ot as baseAccount,ue as coinbaseWallet,We as gemini,jt as injected,Fe as metaMask,Et as mock,wn as porto,Je as safe,yn as version,Be as walletConnect};
